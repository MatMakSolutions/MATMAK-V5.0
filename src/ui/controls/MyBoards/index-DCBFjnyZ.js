var k_=Object.defineProperty;var R_=(r,t,e)=>t in r?k_(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var tt=(r,t,e)=>(R_(r,typeof t!="symbol"?t+"":t,e),e),qd=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var Xn=(r,t,e)=>(qd(r,t,"read from private field"),e?e.call(r):t.get(r)),Zd=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},Kd=(r,t,e,i)=>(qd(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();function B_(r,t){const e=new Map;return e.set("config",t),t.init(e),{...Object.keys(r).reduce((s,n)=>{const o={do:h=>{t.onEvent(n,"Do",h,e)},handle:h=>{const d=p=>{t.onEvent(n,"Response",p,e)};return t.onEvent(n,"Handle",{handler:h,response:d},e)},waitFor:h=>t.onEvent(n,"WaitFor",h,e)};return s[n]=o,s},{}),dispose:()=>{t.dispose(e)}}}function td(r,t=""){for(const e in r){const i=`${t}${t!==""?".":""}${e}`;if(typeof r[e]=="string"&&r[e].length===0){r[e]=i;continue}typeof r[e]=="object"&&td(r[e],i)}return r}function ho(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var t=Math.random()*16|0,e=r=="x"?t:t&3|8;return e.toString(16)})}var us;class L_{constructor(){Zd(this,us,new Map)}on(t,e,i=!1){!Xn(this,us).has(t)&&Xn(this,us).set(t,new Map);const s={id:ho(),callback:e,once:i};return Xn(this,us).get(t).set(s.id,s),{id:s.id,off:()=>{var n;return(n=Xn(this,us).get(t))==null?void 0:n.delete(s.id)}}}emit(t,e){var i;(i=Xn(this,us).get(t))==null||i.forEach((s,n,o)=>{s.callback(e),s.once&&o.delete(n)})}clear(){Kd(this,us,new Map)}}us=new WeakMap;const Lt=new L_,je=td({ButtonBar:{Click:""},PatternSelection:{zoomIn:"",zoomOut:"",addAll:"",addSelected:"",onResize:""},cutBoard:{zoomIn:"",zoomOut:""}}),Kt=td({Utils:{Nesting:{Do:{CreateSession:"",AddPart:"",Start:"",Stop:""},WaitFor:{SessionCreation:"",Progress:"",PackingResult:"",SessionAbortion:""}}},BoardSurface:{onConfigChange:"",zoomIn:"",zoomOut:"",addAll:"",addSelected:"",onResize:"",onMove:"",onMouseDown:"",onMouseUp:"",onMouseScroll:"",onMouseLeave:"",onMouseOut:"",onNesting:"",onNestingResult:"",onNestingProgress:"",onNestingAbort:"",onNestingComplete:"",onNestingError:"",onAskForNesting:"",onRotate:"",onCutCommand:"",onOutward:"",onGlobalCollisionComplete:"",onToggleMaterialusage:"",onReloadConfig:"",onUndo:"",onRedo:""},Item:{onSelected:"",onUnselected:"",onMove:"",onRebuild:"",onRefresh:"",onApplyUIChanges:"",onZoom:"",onSetState:"",onGetState:"",onSerialize:"",onDeserialize:"",onEnterEdit:"",onEnterSubPatternRemove:"",onEnterWrapEdit:"",onEnterSplitEdit:"",onSegmentHover:"",onSegmentSelected:"",onExitEdit:"",onEnterWrap:"",onExitWrap:"",onSetWrapStart:"",onSetWrapEnd:"",onWrapSelected:"",onFullWrap:"",onCheckCollisions:""}}),Yi=B_({sessionCreation:{},addPart:{},setBin:{},start:{},stop:{},progress:{},packingResult:{}},{init:r=>{const t=[];r.set("events",t)},onEvent:(r,t,e,i)=>{const s=i.get("events");switch(i.get("config"),t){case"Do":Lt.emit(`nesting-do-${r}`,e);break;case"Handle":const n=Lt.on(`nesting-do-${r}`,h=>{e.handler(h,e.response)});return s.push(n),n;case"WaitFor":const o=Lt.on(`nesting-wait-${r}`,h=>{e(h)});return s.push(o),o;case"Response":Lt.emit(`nesting-wait-${r}`,e);break}},dispose:r=>{r.get("events").forEach(e=>e.off())}});var D_=Object.defineProperty,F_=(r,t,e)=>t in r?D_(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,wg=(r,t,e)=>(F_(r,typeof t!="symbol"?t+"":t,e),e),ed=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)},ae=(r,t,e)=>(ed(r,t,"read from private field"),e?e.call(r):t.get(r)),oi=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},rr=(r,t,e,i)=>(ed(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e),Cn=(r,t,e)=>(ed(r,t,"access private method"),e),ph,Le,Sg,En,Qd,Cg,Fu,uo={},id=[],O_=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,rd=Array.isArray;function Ns(r,t){for(var e in t)r[e]=t[e];return r}function Eg(r){var t=r.parentNode;t&&t.removeChild(r)}function Z(r,t,e){var i,s,n,o={};for(n in t)n=="key"?i=t[n]:n=="ref"?s=t[n]:o[n]=t[n];if(arguments.length>2&&(o.children=arguments.length>3?ph.call(arguments,2):e),typeof r=="function"&&r.defaultProps!=null)for(n in r.defaultProps)o[n]===void 0&&(o[n]=r.defaultProps[n]);return dl(r,o,i,s,null)}function dl(r,t,e,i,s){var n={type:r,props:t,key:e,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++Sg,__i:-1,__u:0};return s==null&&Le.vnode!=null&&Le.vnode(n),n}function Re(r){return r.children}function fl(r,t){this.props=r,this.context=t}function ba(r,t){if(t==null)return r.__?ba(r.__,r.__i+1):null;for(var e;t<r.__k.length;t++)if((e=r.__k[t])!=null&&e.__e!=null)return e.__e;return typeof r.type=="function"?ba(r):null}function N_(r,t,e){var i,s=r.__v,n=s.__e,o=r.__P;if(o)return(i=Ns({},s)).__v=s.__v+1,Le.vnode&&Le.vnode(i),sd(o,i,s,r.__n,o.ownerSVGElement!==void 0,32&s.__u?[n]:null,t,n??ba(s),!!(32&s.__u),e),i.__v=s.__v,i.__.__k[i.__i]=i,i.__d=void 0,i.__e!=n&&Pg(i),i}function Pg(r){var t,e;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,t=0;t<r.__k.length;t++)if((e=r.__k[t])!=null&&e.__e!=null){r.__e=r.__c.base=e.__e;break}return Pg(r)}}function Jd(r){(!r.__d&&(r.__d=!0)&&En.push(r)&&!Nl.__r++||Qd!==Le.debounceRendering)&&((Qd=Le.debounceRendering)||Cg)(Nl)}function Nl(){var r,t,e,i=[],s=[];for(En.sort(Fu);r=En.shift();)r.__d&&(e=En.length,t=N_(r,i,s)||t,e===0||En.length>e?(Ou(i,t,s),s.length=i.length=0,t=void 0,En.sort(Fu)):t&&Le.__c&&Le.__c(t,id));t&&Ou(i,t,s),Nl.__r=0}function Tg(r,t,e,i,s,n,o,h,d,p,m){var v,b,y,P,M,z=i&&i.__k||id,q=t.length;for(e.__d=d,U_(e,t,z),d=e.__d,v=0;v<q;v++)(y=e.__k[v])!=null&&typeof y!="boolean"&&typeof y!="function"&&(b=y.__i===-1?uo:z[y.__i]||uo,y.__i=v,sd(r,y,b,s,n,o,h,d,p,m),P=y.__e,y.ref&&b.ref!=y.ref&&(b.ref&&nd(b.ref,null,y),m.push(y.ref,y.__c||P,y)),M==null&&P!=null&&(M=P),65536&y.__u||b.__k===y.__k?d=Ig(y,d,r):typeof y.type=="function"&&y.__d!==void 0?d=y.__d:P&&(d=P.nextSibling),y.__d=void 0,y.__u&=-196609);e.__d=d,e.__e=M}function U_(r,t,e){var i,s,n,o,h,d=t.length,p=e.length,m=p,v=0;for(r.__k=[],i=0;i<d;i++)o=i+v,(s=r.__k[i]=(s=t[i])==null||typeof s=="boolean"||typeof s=="function"?null:typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?dl(null,s,null,null,null):rd(s)?dl(Re,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?dl(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s)!=null?(s.__=r,s.__b=r.__b+1,h=z_(s,e,o,m),s.__i=h,n=null,h!==-1&&(m--,(n=e[h])&&(n.__u|=131072)),n==null||n.__v===null?(h==-1&&v--,typeof s.type!="function"&&(s.__u|=65536)):h!==o&&(h===o+1?v++:h>o?m>d-o?v+=h-o:v--:h<o?h==o-1&&(v=h-o):v=0,h!==i+v&&(s.__u|=65536))):(n=e[o])&&n.key==null&&n.__e&&!(131072&n.__u)&&(n.__e==r.__d&&(r.__d=ba(n)),Nu(n,n,!1),e[o]=null,m--);if(m)for(i=0;i<p;i++)(n=e[i])!=null&&!(131072&n.__u)&&(n.__e==r.__d&&(r.__d=ba(n)),Nu(n,n))}function Ig(r,t,e){var i,s;if(typeof r.type=="function"){for(i=r.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=r,t=Ig(i[s],t,e));return t}r.__e!=t&&(e.insertBefore(r.__e,t||null),t=r.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType===8);return t}function z_(r,t,e,i){var s=r.key,n=r.type,o=e-1,h=e+1,d=t[e];if(d===null||d&&s==d.key&&n===d.type&&!(131072&d.__u))return e;if(i>(d!=null&&!(131072&d.__u)?1:0))for(;o>=0||h<t.length;){if(o>=0){if((d=t[o])&&!(131072&d.__u)&&s==d.key&&n===d.type)return o;o--}if(h<t.length){if((d=t[h])&&!(131072&d.__u)&&s==d.key&&n===d.type)return h;h++}}return-1}function tf(r,t,e){t[0]==="-"?r.setProperty(t,e??""):r[t]=e==null?"":typeof e!="number"||O_.test(t)?e:e+"px"}function Fo(r,t,e,i,s){var n;t:if(t==="style")if(typeof e=="string")r.style.cssText=e;else{if(typeof i=="string"&&(r.style.cssText=i=""),i)for(t in i)e&&t in e||tf(r.style,t,"");if(e)for(t in e)i&&e[t]===i[t]||tf(r.style,t,e[t])}else if(t[0]==="o"&&t[1]==="n")n=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in r?t.toLowerCase().slice(2):t.slice(2),r.l||(r.l={}),r.l[t+n]=e,e?i?e.u=i.u:(e.u=Date.now(),r.addEventListener(t,n?rf:ef,n)):r.removeEventListener(t,n?rf:ef,n);else{if(s)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="width"&&t!=="height"&&t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t!=="rowSpan"&&t!=="colSpan"&&t!=="role"&&t in r)try{r[t]=e??"";break t}catch{}typeof e=="function"||(e==null||e===!1&&t[4]!=="-"?r.removeAttribute(t):r.setAttribute(t,e))}}function ef(r){if(this.l){var t=this.l[r.type+!1];if(r.t){if(r.t<=t.u)return}else r.t=Date.now();return t(Le.event?Le.event(r):r)}}function rf(r){if(this.l)return this.l[r.type+!0](Le.event?Le.event(r):r)}function sd(r,t,e,i,s,n,o,h,d,p){var m,v,b,y,P,M,z,q,V,I,Y,K,T,at,ct,pt=t.type;if(t.constructor!==void 0)return null;128&e.__u&&(d=!!(32&e.__u),n=[h=t.__e=e.__e]),(m=Le.__b)&&m(t);t:if(typeof pt=="function")try{if(q=t.props,V=(m=pt.contextType)&&i[m.__c],I=m?V?V.props.value:m.__:i,e.__c?z=(v=t.__c=e.__c).__=v.__E:("prototype"in pt&&pt.prototype.render?t.__c=v=new pt(q,I):(t.__c=v=new fl(q,I),v.constructor=pt,v.render=V_),V&&V.sub(v),v.props=q,v.state||(v.state={}),v.context=I,v.__n=i,b=v.__d=!0,v.__h=[],v._sb=[]),v.__s==null&&(v.__s=v.state),pt.getDerivedStateFromProps!=null&&(v.__s==v.state&&(v.__s=Ns({},v.__s)),Ns(v.__s,pt.getDerivedStateFromProps(q,v.__s))),y=v.props,P=v.state,v.__v=t,b)pt.getDerivedStateFromProps==null&&v.componentWillMount!=null&&v.componentWillMount(),v.componentDidMount!=null&&v.__h.push(v.componentDidMount);else{if(pt.getDerivedStateFromProps==null&&q!==y&&v.componentWillReceiveProps!=null&&v.componentWillReceiveProps(q,I),!v.__e&&(v.shouldComponentUpdate!=null&&v.shouldComponentUpdate(q,v.__s,I)===!1||t.__v===e.__v)){for(t.__v!==e.__v&&(v.props=q,v.state=v.__s,v.__d=!1),t.__e=e.__e,t.__k=e.__k,t.__k.forEach(function(wt){wt&&(wt.__=t)}),Y=0;Y<v._sb.length;Y++)v.__h.push(v._sb[Y]);v._sb=[],v.__h.length&&o.push(v);break t}v.componentWillUpdate!=null&&v.componentWillUpdate(q,v.__s,I),v.componentDidUpdate!=null&&v.__h.push(function(){v.componentDidUpdate(y,P,M)})}if(v.context=I,v.props=q,v.__P=r,v.__e=!1,K=Le.__r,T=0,"prototype"in pt&&pt.prototype.render){for(v.state=v.__s,v.__d=!1,K&&K(t),m=v.render(v.props,v.state,v.context),at=0;at<v._sb.length;at++)v.__h.push(v._sb[at]);v._sb=[]}else do v.__d=!1,K&&K(t),m=v.render(v.props,v.state,v.context),v.state=v.__s;while(v.__d&&++T<25);v.state=v.__s,v.getChildContext!=null&&(i=Ns(Ns({},i),v.getChildContext())),b||v.getSnapshotBeforeUpdate==null||(M=v.getSnapshotBeforeUpdate(y,P)),Tg(r,rd(ct=m!=null&&m.type===Re&&m.key==null?m.props.children:m)?ct:[ct],t,e,i,s,n,o,h,d,p),v.base=t.__e,t.__u&=-161,v.__h.length&&o.push(v),z&&(v.__E=v.__=null)}catch(wt){t.__v=null,d||n!=null?(t.__e=h,t.__u|=d?160:32,n[n.indexOf(h)]=null):(t.__e=e.__e,t.__k=e.__k),Le.__e(wt,t,e)}else n==null&&t.__v===e.__v?(t.__k=e.__k,t.__e=e.__e):t.__e=G_(e.__e,t,e,i,s,n,o,d,p);(m=Le.diffed)&&m(t)}function Ou(r,t,e){for(var i=0;i<e.length;i++)nd(e[i],e[++i],e[++i]);Le.__c&&Le.__c(t,r),r.some(function(s){try{r=s.__h,s.__h=[],r.some(function(n){n.call(s)})}catch(n){Le.__e(n,s.__v)}})}function G_(r,t,e,i,s,n,o,h,d){var p,m,v,b,y,P,M,z=e.props,q=t.props,V=t.type;if(V==="svg"&&(s=!0),n!=null){for(p=0;p<n.length;p++)if((y=n[p])&&"setAttribute"in y==!!V&&(V?y.localName===V:y.nodeType===3)){r=y,n[p]=null;break}}if(r==null){if(V===null)return document.createTextNode(q);r=s?document.createElementNS("http://www.w3.org/2000/svg",V):document.createElement(V,q.is&&q),n=null,h=!1}if(V===null)z===q||h&&r.data===q||(r.data=q);else{if(n=n&&ph.call(r.childNodes),z=e.props||uo,!h&&n!=null)for(z={},p=0;p<r.attributes.length;p++)z[(y=r.attributes[p]).name]=y.value;for(p in z)y=z[p],p=="children"||(p=="dangerouslySetInnerHTML"?v=y:p==="key"||p in q||Fo(r,p,null,y,s));for(p in q)y=q[p],p=="children"?b=y:p=="dangerouslySetInnerHTML"?m=y:p=="value"?P=y:p=="checked"?M=y:p==="key"||h&&typeof y!="function"||z[p]===y||Fo(r,p,y,z[p],s);if(m)h||v&&(m.__html===v.__html||m.__html===r.innerHTML)||(r.innerHTML=m.__html),t.__k=[];else if(v&&(r.innerHTML=""),Tg(r,rd(b)?b:[b],t,e,i,s&&V!=="foreignObject",n,o,n?n[0]:e.__k&&ba(e,0),h,d),n!=null)for(p=n.length;p--;)n[p]!=null&&Eg(n[p]);h||(p="value",P!==void 0&&(P!==r[p]||V==="progress"&&!P||V==="option"&&P!==z[p])&&Fo(r,p,P,z[p],!1),p="checked",M!==void 0&&M!==r[p]&&Fo(r,p,M,z[p],!1))}return r}function nd(r,t,e){try{typeof r=="function"?r(t):r.current=t}catch(i){Le.__e(i,e)}}function Nu(r,t,e){var i,s;if(Le.unmount&&Le.unmount(r),(i=r.ref)&&(i.current&&i.current!==r.__e||nd(i,null,t)),(i=r.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){Le.__e(n,t)}i.base=i.__P=null,r.__c=void 0}if(i=r.__k)for(s=0;s<i.length;s++)i[s]&&Nu(i[s],t,e||typeof r.type!="function");e||r.__e==null||Eg(r.__e),r.__=r.__e=r.__d=void 0}function V_(r,t,e){return this.constructor(r,e)}function Oo(r,t,e){var i,s,n,o;Le.__&&Le.__(r,t),s=(i=typeof e=="function")?null:e&&e.__k||t.__k,n=[],o=[],sd(t,r=(!i&&e||t).__k=Z(Re,null,[r]),s||uo,uo,t.ownerSVGElement!==void 0,!i&&e?[e]:s?null:t.firstChild?ph.call(t.childNodes):null,n,!i&&e?e:s?s.__e:t.firstChild,i,o),r.__d=void 0,Ou(n,r,o)}ph=id.slice,Le={__e:function(r,t,e,i){for(var s,n,o;t=t.__;)if((s=t.__c)&&!s.__)try{if((n=s.constructor)&&n.getDerivedStateFromError!=null&&(s.setState(n.getDerivedStateFromError(r)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(r,i||{}),o=s.__d),o)return s.__E=s}catch(h){r=h}throw r}},Sg=0,fl.prototype.setState=function(r,t){var e;e=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Ns({},this.state),typeof r=="function"&&(r=r(Ns({},e),this.props)),r&&Ns(e,r),r!=null&&this.__v&&(t&&this._sb.push(t),Jd(this))},fl.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),Jd(this))},fl.prototype.render=Re,En=[],Cg=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Fu=function(r,t){return r.__v.__b-t.__v.__b},Nl.__r=0;function Ag(r,t=""){for(let e in r){let i=`${t}${t!==""?".":""}${e}`;if(typeof r[e]=="string"&&r[e].length===0){r[e]=i;continue}typeof r[e]=="object"&&Ag(r[e],i)}return r}var Mg=class{static getGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var t=Math.random()*16|0,e=r=="x"?t:t&3|8;return e.toString(16)})}},Ms,kg=class{constructor(){oi(this,Ms,new Map)}on(r,t,e=!1){!ae(this,Ms).has(r)&&ae(this,Ms).set(r,new Map);let i={id:Mg.getGuid(),callback:t,once:e};return ae(this,Ms).get(r).set(i.id,i),{id:i.id,off:()=>{var s;return(s=ae(this,Ms).get(r))==null?void 0:s.delete(i.id)}}}emit(r,t){var e;(e=ae(this,Ms).get(r))==null||e.forEach((i,s,n)=>{i.callback(t),i.once&&n.delete(s)})}clear(){rr(this,Ms,new Map)}};Ms=new WeakMap;new kg;Ag({APP:{RELOADED:"",REFRESH:""},MSG:{NEW:"",ENDED:"",USER_PROMPT:""}});var Rg=function(r,t,e,i){var s;t[0]=0;for(var n=1;n<t.length;n++){var o=t[n++],h=t[n]?(t[0]|=o?1:2,e[t[n++]]):t[++n];o===3?i[0]=h:o===4?i[1]=Object.assign(i[1]||{},h):o===5?(i[1]=i[1]||{})[t[++n]]=h:o===6?i[1][t[++n]]+=h+"":o?(s=r.apply(h,Rg(r,h,e,["",null])),i.push(s),h[0]?t[0]|=2:(t[n-2]=0,t[n]=s)):i.push(h)}return i},sf=new Map;function H_(r){var t=sf.get(this);return t||(t=new Map,sf.set(this,t)),(t=Rg(this,t.get(r)||(t.set(r,t=function(e){for(var i,s,n=1,o="",h="",d=[0],p=function(b){n===1&&(b||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?d.push(0,b,o):n===3&&(b||o)?(d.push(3,b,o),n=2):n===2&&o==="..."&&b?d.push(4,b,0):n===2&&o&&!b?d.push(5,0,!0,o):n>=5&&((o||!b&&n===5)&&(d.push(n,0,o,s),n=6),b&&(d.push(n,b,0,s),n=6)),o=""},m=0;m<e.length;m++){m&&(n===1&&p(),p(m));for(var v=0;v<e[m].length;v++)i=e[m][v],n===1?i==="<"?(p(),d=[d],n=3):o+=i:n===4?o==="--"&&i===">"?(n=1,o=""):o=i+o[0]:h?i===h?h="":o+=i:i==='"'||i==="'"?h=i:i===">"?(p(),n=1):n&&(i==="="?(n=5,s=o,o=""):i==="/"&&(n<5||e[m][v+1]===">")?(p(),n===3&&(d=d[0]),n=d,(d=d[0]).push(2,0,n),n=0):i===" "||i==="	"||i===`
`||i==="\r"?(p(),n=2):o+=i),n===3&&o==="!--"&&(n=4,d=d[0])}return p(),d}(r)),t),arguments,[])).length>1?t:t[0]}var Hh=H_.bind(Z),nf=/[\s\n\\/='"\0<>]/,af=/^(xlink|xmlns|xml)([A-Z])/,W_=/^accessK|^auto[A-Z]|^ch|^col|cont|cross|dateT|encT|form[A-Z]|frame|hrefL|inputM|maxL|minL|noV|playsI|readO|rowS|spellC|src[A-Z]|tabI|item[A-Z]/,X_=/^ac|^ali|arabic|basel|cap|clipPath$|clipRule$|color|dominant|enable|fill|flood|font|glyph[^R]|horiz|image|letter|lighting|marker[^WUH]|overline|panose|pointe|paint|rendering|shape|stop|strikethrough|stroke|text[^L]|transform|underline|unicode|units|^v[^i]|^w|^xH/,j_=/["&<]/;function No(r){if(r.length===0||j_.test(r)===!1)return r;for(var t=0,e=0,i="",s="";e<r.length;e++){switch(r.charCodeAt(e)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;default:continue}e!==t&&(i+=r.slice(t,e)),i+=s,t=e+1}return e!==t&&(i+=r.slice(t,e)),i}var of={},$_=new Set(["animation-iteration-count","border-image-outset","border-image-slice","border-image-width","box-flex","box-flex-group","box-ordinal-group","column-count","fill-opacity","flex","flex-grow","flex-negative","flex-order","flex-positive","flex-shrink","flood-opacity","font-weight","grid-column","grid-row","line-clamp","line-height","opacity","order","orphans","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-miterlimit","stroke-opacity","stroke-width","tab-size","widows","z-index","zoom"]),Y_=/[A-Z]/g;function q_(r){var t="";for(var e in r){var i=r[e];if(i!=null&&i!==""){var s=e[0]=="-"?e:of[e]||(of[e]=e.replace(Y_,"-$&").toLowerCase()),n=";";typeof i!="number"||s.startsWith("--")||$_.has(s)||(n="px;"),t=t+s+":"+i+n}}return t||void 0}var Uu,pn,co,gn,lf=[],hf=Array.isArray,zu=Object.assign;function Z_(r,t){var e=Le.__s;Le.__s=!0,Uu=Le.__b,pn=Le.diffed,co=Le.__r,gn=Le.unmount;var i=Z(Re,null);i.__k=[r];try{return mn(r,t||Bg,!1,void 0,i,!1)}catch(s){throw s.then?new Error('Use "renderToStringAsync" for suspenseful rendering.'):s}finally{Le.__c&&Le.__c(r,lf),Le.__s=e,lf.length=0}}function uf(){this.__d=!0}var Bg={};function cf(r,t){var e,i=r.type,s=!0;return r.__c?(s=!1,(e=r.__c).state=e.__s):e=new i(r.props,t),r.__c=e,e.__v=r,e.props=r.props,e.context=t,e.__d=!0,e.state==null&&(e.state=Bg),e.__s==null&&(e.__s=e.state),i.getDerivedStateFromProps?e.state=zu({},e.state,i.getDerivedStateFromProps(e.props,e.state)):s&&e.componentWillMount?(e.componentWillMount(),e.state=e.__s!==e.state?e.__s:e.state):!s&&e.componentWillUpdate&&e.componentWillUpdate(),co&&co(r),e.render(e.props,e.state,t)}function mn(r,t,e,i,s,n){if(r==null||r===!0||r===!1||r==="")return"";if(typeof r!="object")return typeof r=="function"?"":No(r+"");if(hf(r)){var o,h="";s.__k=r;for(var d=0;d<r.length;d++){var p=r[d];if(p!=null&&typeof p!="boolean"){var m,v=mn(p,t,e,i,s,n);typeof v=="string"?h+=v:(o=o||[],h&&o.push(h),h="",Array.isArray(v)?(m=o).push.apply(m,v):o.push(v))}}return o?(h&&o.push(h),o):h}if(r.constructor!==void 0)return"";r.__=s,Uu&&Uu(r);var b,y,P,M=r.type,z=r.props,q=t;if(typeof M=="function"){if(M===Re){if(z.tpl){for(var V="",I=0;I<z.tpl.length;I++)if(V+=z.tpl[I],z.exprs&&I<z.exprs.length){var Y=z.exprs[I];if(Y==null)continue;typeof Y!="object"||Y.constructor!==void 0&&!hf(Y)?V+=Y:V+=mn(Y,t,e,i,r,n)}return V}if(z.UNSTABLE_comment)return"<!--"+No(z.UNSTABLE_comment||"")+"-->";y=z.children}else{if((b=M.contextType)!=null){var K=t[b.__c];q=K?K.props.value:b.__}if(M.prototype&&typeof M.prototype.render=="function")y=cf(r,q),P=r.__c;else{r.__c=P={__v:r,props:z,context:q,setState:uf,forceUpdate:uf,__d:!0,__h:[]};for(var T=0;P.__d&&T++<25;)P.__d=!1,co&&co(r),y=M.call(P,z,q);P.__d=!0}if(P.getChildContext!=null&&(t=zu({},t,P.getChildContext())),(M.getDerivedStateFromError||P.componentDidCatch)&&Le.errorBoundaries){var at="";y=y!=null&&y.type===Re&&y.key==null?y.props.children:y;try{return at=mn(y,t,e,i,r,n)}catch(kt){return M.getDerivedStateFromError&&(P.__s=M.getDerivedStateFromError(kt)),P.componentDidCatch&&P.componentDidCatch(kt,{}),P.__d&&(y=cf(r,t),(P=r.__c).getChildContext!=null&&(t=zu({},t,P.getChildContext())),at=mn(y=y!=null&&y.type===Re&&y.key==null?y.props.children:y,t,e,i,r,n)),at}finally{pn&&pn(r),r.__=void 0,gn&&gn(r)}}}y=y!=null&&y.type===Re&&y.key==null?y.props.children:y;var ct=function(){return mn(y,t,e,i,r,n)};try{var pt=ct();return pn&&pn(r),r.__=void 0,gn&&gn(r),pt}catch(kt){if(!n||!kt||typeof kt.then!="function")throw kt;var wt=function Gt(){try{return ct()}catch(vt){return vt.then(function(){return ct()},function(){return Gt()})}};return kt.then(function(){return wt()})}}var It,bt="<"+M,dt="";for(var ht in z){var Mt=z[ht];switch(ht){case"children":It=Mt;continue;case"key":case"ref":case"__self":case"__source":continue;case"htmlFor":if("for"in z)continue;ht="for";break;case"className":if("class"in z)continue;ht="class";break;case"defaultChecked":ht="checked";break;case"defaultSelected":ht="selected";break;case"defaultValue":case"value":switch(ht="value",M){case"textarea":It=Mt;continue;case"select":i=Mt;continue;case"option":i!=Mt||"selected"in z||(bt+=" selected")}break;case"dangerouslySetInnerHTML":dt=Mt&&Mt.__html;continue;case"style":typeof Mt=="object"&&(Mt=q_(Mt));break;case"acceptCharset":ht="accept-charset";break;case"httpEquiv":ht="http-equiv";break;default:if(af.test(ht))ht=ht.replace(af,"$1:$2").toLowerCase();else{if(nf.test(ht))continue;ht[4]!=="-"&&ht!=="draggable"||Mt==null?e?X_.test(ht)&&(ht=ht==="panose1"?"panose-1":ht.replace(/([A-Z])/g,"-$1").toLowerCase()):W_.test(ht)&&(ht=ht.toLowerCase()):Mt+=""}}Mt!=null&&Mt!==!1&&typeof Mt!="function"&&(bt=Mt===!0||Mt===""?bt+" "+ht:bt+" "+ht+'="'+No(Mt+"")+'"')}if(nf.test(M))throw new Error(M+" is not a valid HTML tag name in "+bt+">");if(dt||(typeof It=="string"?dt=No(It):It!=null&&It!==!1&&It!==!0&&(dt=mn(It,t,M==="svg"||M!=="foreignObject"&&e,i,r,n))),pn&&pn(r),r.__=void 0,gn&&gn(r),!dt&&K_.has(M))return bt+"/>";var _t="</"+M+">",Rt=bt+">";return Array.isArray(dt)?[Rt].concat(dt,[_t]):typeof dt!="string"?[Rt,dt,_t]:Rt+dt+_t}var K_=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),Q_=Z_,Ul,xi,Wh,df,Gu=0,Lg=[],pl=[],Ei=Le,ff=Ei.__b,pf=Ei.__r,gf=Ei.diffed,mf=Ei.__c,_f=Ei.unmount,vf=Ei.__;function Dg(r,t){Ei.__h&&Ei.__h(xi,r,Gu||t),Gu=0;var e=xi.__H||(xi.__H={__:[],__h:[]});return r>=e.__.length&&e.__.push({__V:pl}),e.__[r]}function J_(r){return Gu=1,tv(Fg,r)}function tv(r,t,e){var i=Dg(Ul++,2);if(i.t=r,!i.__c&&(i.__=[e?e(t):Fg(void 0,t),function(h){var d=i.__N?i.__N[0]:i.__[0],p=i.t(d,h);d!==p&&(i.__N=[p,i.__[1]],i.__c.setState({}))}],i.__c=xi,!xi.u)){var s=function(h,d,p){if(!i.__c.__H)return!0;var m=i.__c.__H.__.filter(function(b){return!!b.__c});if(m.every(function(b){return!b.__N}))return!n||n.call(this,h,d,p);var v=!1;return m.forEach(function(b){if(b.__N){var y=b.__[0];b.__=b.__N,b.__N=void 0,y!==b.__[0]&&(v=!0)}}),!(!v&&i.__c.props===h)&&(!n||n.call(this,h,d,p))};xi.u=!0;var n=xi.shouldComponentUpdate,o=xi.componentWillUpdate;xi.componentWillUpdate=function(h,d,p){if(this.__e){var m=n;n=void 0,s(h,d,p),n=m}o&&o.call(this,h,d,p)},xi.shouldComponentUpdate=s}return i.__N||i.__}function ev(r,t){var e=Dg(Ul++,3);!Ei.__s&&sv(e.__H,t)&&(e.__=r,e.i=t,xi.__H.__h.push(e))}function iv(){for(var r;r=Lg.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(gl),r.__H.__h.forEach(Vu),r.__H.__h=[]}catch(t){r.__H.__h=[],Ei.__e(t,r.__v)}}Ei.__b=function(r){xi=null,ff&&ff(r)},Ei.__=function(r,t){r&&t.__k&&t.__k.__m&&(r.__m=t.__k.__m),vf&&vf(r,t)},Ei.__r=function(r){pf&&pf(r),Ul=0;var t=(xi=r.__c).__H;t&&(Wh===xi?(t.__h=[],xi.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=pl,e.__N=e.i=void 0})):(t.__h.forEach(gl),t.__h.forEach(Vu),t.__h=[],Ul=0)),Wh=xi},Ei.diffed=function(r){gf&&gf(r);var t=r.__c;t&&t.__H&&(t.__H.__h.length&&(Lg.push(t)!==1&&df===Ei.requestAnimationFrame||((df=Ei.requestAnimationFrame)||rv)(iv)),t.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==pl&&(e.__=e.__V),e.i=void 0,e.__V=pl})),Wh=xi=null},Ei.__c=function(r,t){t.some(function(e){try{e.__h.forEach(gl),e.__h=e.__h.filter(function(i){return!i.__||Vu(i)})}catch(i){t.some(function(s){s.__h&&(s.__h=[])}),t=[],Ei.__e(i,e.__v)}}),mf&&mf(r,t)},Ei.unmount=function(r){_f&&_f(r);var t,e=r.__c;e&&e.__H&&(e.__H.__.forEach(function(i){try{gl(i)}catch(s){t=s}}),e.__H=void 0,t&&Ei.__e(t,e.__v))};var yf=typeof requestAnimationFrame=="function";function rv(r){var t,e=function(){clearTimeout(i),yf&&cancelAnimationFrame(t),setTimeout(r)},i=setTimeout(e,100);yf&&(t=requestAnimationFrame(e))}function gl(r){var t=xi,e=r.__c;typeof e=="function"&&(r.__c=void 0,e()),xi=t}function Vu(r){var t=xi;r.__c=r.__(),xi=t}function sv(r,t){return!r||r.length!==t.length||t.some(function(e,i){return e!==r[i]})}function Fg(r,t){return typeof t=="function"?t(r):t}window._debug={};function za(r,t){_debug[r]||(_debug[r]={}),_debug[r][t]||(_debug[r][t]=0),_debug[r][t]++}function nv(r){let{cls:t,template:e}=r,[i,s]=J_(0);return za(t.guid,"render"),ev(()=>{let n=[];return za(t.guid,"useEffect"),n.push(hs.on(t.guid,()=>{za(t.guid,"refresh"),s(o=>o+1)})),hs.emit(t.guid+"_mounted"),za(t.guid,"mounted"),t.hasChildren&&s(o=>o+1),()=>{za(t.guid,"unmounted"),hs.emit(t.guid+"_unmounted"),n.forEach(o=>o.off())}},[]),e()}function av(r){let t="",e=0,i=2;for(let s=0,n=r.length;s<n;s++){let o=r[s];if(o==="<")if(r[s+1]==="/")e--,t+=`
`+" ".repeat(e*i)+o;else if(r.substr(s,4)==="<!--"){let h=r.indexOf("-->",s+4)+3;t+=r.slice(s,h),s=h-1}else t+=`
`+" ".repeat(e*i)+o,e++;else if(o===">"){t+=o;let h=r[s+1];if(h&&h!=="<"){let d=r.indexOf("<",s+1);t+=r.slice(s+1,d),s=d-1}}else if(s===0||r[s-1]===">"){let h=r.indexOf("<",s);h!==-1&&(t+=r.slice(s,h),s=h-1)}else t+=o}return t.trim()}var xf={},ml,Cr,_l,Nr,vl,Qn,_n,Ya,Hu,Wu,Og,Pn,Ng=class Xu{constructor(t="BaseComponent"){oi(this,Wu),oi(this,ml,void 0),oi(this,Cr,void 0),oi(this,_l,!0),oi(this,Nr,void 0),oi(this,vl,"default"),wg(this,"shadowRoot",null),oi(this,Qn,null),oi(this,_n,void 0),oi(this,Ya,new Map),oi(this,Hu,!1),oi(this,Pn,()=>{let i=ae(this,ml);return i=i.replace(/([A-Z])/g,"-$1").toLowerCase().substring(1),i.includes("-")||(i="sdr-"+i),i}),rr(this,ml,t),rr(this,_n,new Map),xf[ae(this,Pn).call(this)]||(Cn(this,Wu,Og).call(this),xf[ae(this,Pn).call(this)]=!0),rr(this,Cr,Mg.getGuid());let e=this;try{rr(this,Nr,Z(nv,{key:ae(this,Cr),cls:this,template:()=>e.getRenderTemplate()(e,Hh)}))}catch(i){console.error("Error",i),rr(this,Nr,Hh`<div>Error rendering component</div>`)}}static getSystemDesign(){return this._systemDesignMap.get(this.prototype.constructor.name)}static registerSystemDesign(t){Xu._systemDesignMap.set(this.prototype.constructor.name,t)}get guid(){return ae(this,Cr)}get autoRefresh(){return ae(this,_l)}set autoRefresh(t){rr(this,_l,t)}get vdom(){return ae(this,Nr)}get hasChildren(){return ae(this,Hu)}getRenderTemplate(t){let e=t??ae(this,vl)??"default";return ae(this,_n).has(e)===!1?()=>Hh`<div>No template selected of found</div>`:ae(this,_n).get(e)}registerDependencyProperties(t){t.forEach(e=>{let i=this[e];delete this[e],Object.defineProperty(this,e,{get:()=>{let s=ae(this,Ya).get(e)??null;if(Array.isArray(s)){let n=[...s],o=n.push;return n.push=(...h)=>{let d=o.call(s,...h);return this.update(),d},n}return s},set:s=>{ae(this,Ya).set(e,s),this.update()}}),i&&ae(this,Ya).set(e,i)})}registerTemplate(t,e){ae(this,_n).set(t,e)}setState(t){if(ae(this,_n).has(t)===!1)throw new Error("State not found");rr(this,vl,t),this.update()}registerStyleSheet(t,e){let i=document.createElement("style");i.innerHTML=e,i.id=t,ae(this,Qn)?ae(this,Qn).appendChild(i):document.head.appendChild(i)}unregisterStyleSheet(t){(this.shadowRoot?this.shadowRoot:document.head).querySelectorAll("style").forEach(e=>{e.id===t&&e.remove()})}renderToString(){return av(Q_(ae(this,Nr),{pretty:!0}))}getRenderedDom(t={useShadowDom:!0,accessMode:"closed"}){let e=document.createElement("div");return new Promise((i,s)=>{if(t.useShadowDom===!1){this.shadowRoot=e,Oo(ae(this,Nr),this.shadowRoot),hs.emit(ae(this,Cr)+"_mounted"),i(e);return}let n=document.createElement(ae(this,Pn).call(this));e.appendChild(n);let o=document.createElement("div");o.id="styleContainer",rr(this,Qn,o),this.shadowRoot=n.__;let h=Xu.getSystemDesign();h&&h.applyCss(this.shadowRoot),this.shadowRoot.appendChild(o);let d=document.createElement("div");d.id="fragment",this.shadowRoot.appendChild(d),Oo(ae(this,Nr),d),hs.on(ae(this,Cr)+"_mounted",()=>{i(e)})})}attachTo(t,e={useShadowDom:!0,accessMode:"closed"}){return new Promise((i,s)=>{if(e.useShadowDom===!1){this.shadowRoot=t;let p=this.constructor.getSystemDesign();p&&(p.targetShadowRoot=!1,p.applyCss(this.shadowRoot)),Oo(ae(this,Nr),this.shadowRoot),i(void 0);return}let n=document.createElement(ae(this,Pn).call(this));t.appendChild(n);let o=document.createElement("div");o.id="styleContainer",rr(this,Qn,o),this.shadowRoot=n.__;let h=this.constructor.getSystemDesign();h&&(h.targetShadowRoot=!0,h.applyCss(this.shadowRoot)),this.shadowRoot.appendChild(o);let d=document.createElement("div");d.id="fragment",this.shadowRoot.appendChild(d),Oo(ae(this,Nr),d),hs.on(ae(this,Cr)+"_mounted",()=>{i(void 0)})}).catch(i=>{console.error("critical",i)})}addEventListener(t,e){if(t==="mount")return hs.on(ae(this,Cr)+"_mounted",e);if(t==="unmount")return hs.on(ae(this,Cr)+"_unmounted",e)}update(){hs.emit(ae(this,Cr))}};ml=new WeakMap,Cr=new WeakMap,_l=new WeakMap,Nr=new WeakMap,vl=new WeakMap,Qn=new WeakMap,_n=new WeakMap,Ya=new WeakMap,Hu=new WeakMap,Wu=new WeakSet,Og=function(){let r=class extends HTMLElement{constructor(){super();tt(this,"__");this.__=this.attachShadow({mode:"open"})}};customElements.define(ae(this,Pn).call(this),r)},Pn=new WeakMap,wg(Ng,"_systemDesignMap",new Map);var ri=Ng,oa,yl,xl,bl,zl,wl,Gl,jr,ju,bf,Jn,Ga,$u,Ug,ov=class{constructor(r,t,e,i){this.acronym=r,this.reference=t,this.system=e,this.component=i,oi(this,ju),oi(this,Jn),oi(this,$u),oi(this,oa,!0),oi(this,yl,""),oi(this,xl,""),oi(this,bl,""),oi(this,zl,new Map),oi(this,wl,new Map),oi(this,Gl,new Map),oi(this,jr,new Map)}get targetShadowRoot(){return ae(this,oa)}set targetShadowRoot(r){rr(this,oa,r)}addTheme(r,t){ae(this,zl).set(r,t)}addCssSheet(r,t){ae(this,Gl).set(r,t)}applyCss(r){ae(this,jr).size===0&&Cn(this,$u,Ug).call(this),ae(this,oa)?r.adoptedStyleSheets=Array.from(ae(this,jr).values()):document.adoptedStyleSheets=Array.from(ae(this,jr).values())}};oa=new WeakMap,yl=new WeakMap,xl=new WeakMap,bl=new WeakMap,zl=new WeakMap,wl=new WeakMap,Gl=new WeakMap,jr=new WeakMap,ju=new WeakSet,bf=function(){rr(this,yl,`
      :${ae(this,oa)?"host":"root"} {
        ${Cn(this,Jn,Ga).call(this,this.acronym,"ref",this.reference)}
      }
    `),rr(this,xl,`
      .${this.acronym} {
        /* Ref tokens*/
        ${Cn(this,Jn,Ga).call(this,this.acronym,"sys",this.system)}
      }
    `),rr(this,bl,`
      .${this.acronym} {
        /* Ref tokens*/
        ${Cn(this,Jn,Ga).call(this,this.acronym,"cmp",this.component)}
      }
    `),ae(this,zl).forEach((r,t)=>{ae(this,wl).set(t,`
        .${t}-theme {
          /* Ref tokens*/
          ${Cn(this,Jn,Ga).call(this,this.acronym,"ref",r)}
        }
      `)})},Jn=new WeakSet,Ga=function(r,t,e){let i="";function s(n,o){if(typeof o=="string")i+=`--${r}-${t}-${n}: ${o};
`;else for(let h in o)s(`${n}-${h}`,o[h])}for(let n in e)s(n,e[n]);return i},$u=new WeakSet,Ug=function(){Cn(this,ju,bf).call(this),ae(this,jr).clear(),ae(this,jr).set("tokens",new CSSStyleSheet),ae(this,jr).get("tokens").replaceSync(`
      ${ae(this,yl)}
      ${ae(this,xl)}
      ${ae(this,bl)}
      ${Array.from(ae(this,wl).values()).join(`
`)}
    `),ae(this,Gl).forEach((r,t)=>{ae(this,jr).set(t,new CSSStyleSheet),ae(this,jr).get(t).replaceSync(r)})};var hs=new kg;class Ci{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(t,e=!1){return this.onePassHasher.start().appendStr(t).end(e)}static hashAsciiStr(t,e=!1){return this.onePassHasher.start().appendAsciiStr(t).end(e)}static _hex(t){const e=Ci.hexChars,i=Ci.hexOut;let s,n,o,h;for(h=0;h<4;h+=1)for(n=h*8,s=t[h],o=0;o<8;o+=2)i[n+1+o]=e.charAt(s&15),s>>>=4,i[n+0+o]=e.charAt(s&15),s>>>=4;return i.join("")}static _md5cycle(t,e){let i=t[0],s=t[1],n=t[2],o=t[3];i+=(s&n|~s&o)+e[0]-680876936|0,i=(i<<7|i>>>25)+s|0,o+=(i&s|~i&n)+e[1]-389564586|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&s)+e[2]+606105819|0,n=(n<<17|n>>>15)+o|0,s+=(n&o|~n&i)+e[3]-1044525330|0,s=(s<<22|s>>>10)+n|0,i+=(s&n|~s&o)+e[4]-176418897|0,i=(i<<7|i>>>25)+s|0,o+=(i&s|~i&n)+e[5]+1200080426|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&s)+e[6]-1473231341|0,n=(n<<17|n>>>15)+o|0,s+=(n&o|~n&i)+e[7]-45705983|0,s=(s<<22|s>>>10)+n|0,i+=(s&n|~s&o)+e[8]+1770035416|0,i=(i<<7|i>>>25)+s|0,o+=(i&s|~i&n)+e[9]-1958414417|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&s)+e[10]-42063|0,n=(n<<17|n>>>15)+o|0,s+=(n&o|~n&i)+e[11]-1990404162|0,s=(s<<22|s>>>10)+n|0,i+=(s&n|~s&o)+e[12]+1804603682|0,i=(i<<7|i>>>25)+s|0,o+=(i&s|~i&n)+e[13]-40341101|0,o=(o<<12|o>>>20)+i|0,n+=(o&i|~o&s)+e[14]-1502002290|0,n=(n<<17|n>>>15)+o|0,s+=(n&o|~n&i)+e[15]+1236535329|0,s=(s<<22|s>>>10)+n|0,i+=(s&o|n&~o)+e[1]-165796510|0,i=(i<<5|i>>>27)+s|0,o+=(i&n|s&~n)+e[6]-1069501632|0,o=(o<<9|o>>>23)+i|0,n+=(o&s|i&~s)+e[11]+643717713|0,n=(n<<14|n>>>18)+o|0,s+=(n&i|o&~i)+e[0]-373897302|0,s=(s<<20|s>>>12)+n|0,i+=(s&o|n&~o)+e[5]-701558691|0,i=(i<<5|i>>>27)+s|0,o+=(i&n|s&~n)+e[10]+38016083|0,o=(o<<9|o>>>23)+i|0,n+=(o&s|i&~s)+e[15]-660478335|0,n=(n<<14|n>>>18)+o|0,s+=(n&i|o&~i)+e[4]-405537848|0,s=(s<<20|s>>>12)+n|0,i+=(s&o|n&~o)+e[9]+568446438|0,i=(i<<5|i>>>27)+s|0,o+=(i&n|s&~n)+e[14]-1019803690|0,o=(o<<9|o>>>23)+i|0,n+=(o&s|i&~s)+e[3]-187363961|0,n=(n<<14|n>>>18)+o|0,s+=(n&i|o&~i)+e[8]+1163531501|0,s=(s<<20|s>>>12)+n|0,i+=(s&o|n&~o)+e[13]-1444681467|0,i=(i<<5|i>>>27)+s|0,o+=(i&n|s&~n)+e[2]-51403784|0,o=(o<<9|o>>>23)+i|0,n+=(o&s|i&~s)+e[7]+1735328473|0,n=(n<<14|n>>>18)+o|0,s+=(n&i|o&~i)+e[12]-1926607734|0,s=(s<<20|s>>>12)+n|0,i+=(s^n^o)+e[5]-378558|0,i=(i<<4|i>>>28)+s|0,o+=(i^s^n)+e[8]-2022574463|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^s)+e[11]+1839030562|0,n=(n<<16|n>>>16)+o|0,s+=(n^o^i)+e[14]-35309556|0,s=(s<<23|s>>>9)+n|0,i+=(s^n^o)+e[1]-1530992060|0,i=(i<<4|i>>>28)+s|0,o+=(i^s^n)+e[4]+1272893353|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^s)+e[7]-155497632|0,n=(n<<16|n>>>16)+o|0,s+=(n^o^i)+e[10]-1094730640|0,s=(s<<23|s>>>9)+n|0,i+=(s^n^o)+e[13]+681279174|0,i=(i<<4|i>>>28)+s|0,o+=(i^s^n)+e[0]-358537222|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^s)+e[3]-722521979|0,n=(n<<16|n>>>16)+o|0,s+=(n^o^i)+e[6]+76029189|0,s=(s<<23|s>>>9)+n|0,i+=(s^n^o)+e[9]-640364487|0,i=(i<<4|i>>>28)+s|0,o+=(i^s^n)+e[12]-421815835|0,o=(o<<11|o>>>21)+i|0,n+=(o^i^s)+e[15]+530742520|0,n=(n<<16|n>>>16)+o|0,s+=(n^o^i)+e[2]-995338651|0,s=(s<<23|s>>>9)+n|0,i+=(n^(s|~o))+e[0]-198630844|0,i=(i<<6|i>>>26)+s|0,o+=(s^(i|~n))+e[7]+1126891415|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~s))+e[14]-1416354905|0,n=(n<<15|n>>>17)+o|0,s+=(o^(n|~i))+e[5]-57434055|0,s=(s<<21|s>>>11)+n|0,i+=(n^(s|~o))+e[12]+1700485571|0,i=(i<<6|i>>>26)+s|0,o+=(s^(i|~n))+e[3]-1894986606|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~s))+e[10]-1051523|0,n=(n<<15|n>>>17)+o|0,s+=(o^(n|~i))+e[1]-2054922799|0,s=(s<<21|s>>>11)+n|0,i+=(n^(s|~o))+e[8]+1873313359|0,i=(i<<6|i>>>26)+s|0,o+=(s^(i|~n))+e[15]-30611744|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~s))+e[6]-1560198380|0,n=(n<<15|n>>>17)+o|0,s+=(o^(n|~i))+e[13]+1309151649|0,s=(s<<21|s>>>11)+n|0,i+=(n^(s|~o))+e[4]-145523070|0,i=(i<<6|i>>>26)+s|0,o+=(s^(i|~n))+e[11]-1120210379|0,o=(o<<10|o>>>22)+i|0,n+=(i^(o|~s))+e[2]+718787259|0,n=(n<<15|n>>>17)+o|0,s+=(o^(n|~i))+e[9]-343485551|0,s=(s<<21|s>>>11)+n|0,t[0]=i+t[0]|0,t[1]=s+t[1]|0,t[2]=n+t[2]|0,t[3]=o+t[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(Ci.stateIdentity),this}appendStr(t){const e=this._buffer8,i=this._buffer32;let s=this._bufferLength,n,o;for(o=0;o<t.length;o+=1){if(n=t.charCodeAt(o),n<128)e[s++]=n;else if(n<2048)e[s++]=(n>>>6)+192,e[s++]=n&63|128;else if(n<55296||n>56319)e[s++]=(n>>>12)+224,e[s++]=n>>>6&63|128,e[s++]=n&63|128;else{if(n=(n-55296)*1024+(t.charCodeAt(++o)-56320)+65536,n>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");e[s++]=(n>>>18)+240,e[s++]=n>>>12&63|128,e[s++]=n>>>6&63|128,e[s++]=n&63|128}s>=64&&(this._dataLength+=64,Ci._md5cycle(this._state,i),s-=64,i[0]=i[16])}return this._bufferLength=s,this}appendAsciiStr(t){const e=this._buffer8,i=this._buffer32;let s=this._bufferLength,n,o=0;for(;;){for(n=Math.min(t.length-o,64-s);n--;)e[s++]=t.charCodeAt(o++);if(s<64)break;this._dataLength+=64,Ci._md5cycle(this._state,i),s=0}return this._bufferLength=s,this}appendByteArray(t){const e=this._buffer8,i=this._buffer32;let s=this._bufferLength,n,o=0;for(;;){for(n=Math.min(t.length-o,64-s);n--;)e[s++]=t[o++];if(s<64)break;this._dataLength+=64,Ci._md5cycle(this._state,i),s=0}return this._bufferLength=s,this}getState(){const t=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[t[0],t[1],t[2],t[3]]}}setState(t){const e=t.buffer,i=t.state,s=this._state;let n;for(this._dataLength=t.length,this._bufferLength=t.buflen,s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],n=0;n<e.length;n+=1)this._buffer8[n]=e.charCodeAt(n)}end(t=!1){const e=this._bufferLength,i=this._buffer8,s=this._buffer32,n=(e>>2)+1;this._dataLength+=e;const o=this._dataLength*8;if(i[e]=128,i[e+1]=i[e+2]=i[e+3]=0,s.set(Ci.buffer32Identity.subarray(n),n),e>55&&(Ci._md5cycle(this._state,s),s.set(Ci.buffer32Identity)),o<=4294967295)s[14]=o;else{const h=o.toString(16).match(/(.*?)(.{0,8})$/);if(h===null)return;const d=parseInt(h[2],16),p=parseInt(h[1],16)||0;s[14]=d,s[15]=p}return Ci._md5cycle(this._state,s),t?this._state:Ci._hex(this._state)}}Ci.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);Ci.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);Ci.hexChars="0123456789abcdef";Ci.hexOut=[];Ci.onePassHasher=new Ci;if(Ci.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");const fr={id:"",name:""},bi={images:[],selections:[],selectionsDisp:[],shouldBeProcessed:!1},lv="https://backenduatapis.matmaksolutions.com/api/",Ce=async(r,t,e,i=!0)=>{const s=hv();let n=t+r+JSON.stringify(e??{});n=new Ci().appendStr(n).end().toString();const o=await s.get(n);if(o&&!i)return o;const h={method:t,headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}};e&&(h.body=JSON.stringify(e));const p=await(await fetch(lv+r,h)).json();return i||await s.set(n,p),p},hv=()=>window.cache,Ir=new Map,Us={currentSearchIdx:0,currentName:""},io=[];function uv(r){return Array.from(r,([t,e])=>({key:t,value:e}))}function cv(r){return Array.from(r,([t,e])=>({key:t,value:e}))}var Nn=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(Nn||{}),zg=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(zg||{}),Yu=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(Yu||{}),fe=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(fe||{}),Zr=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(Zr||{}),Ft=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(Ft||{}),da=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(da||{}),oe=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(oe||{}),Yt=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(Yt||{}),cs=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(cs||{}),Xs=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(Xs||{}),ts=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(ts||{}),ar=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(ar||{}),$r=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))($r||{}),ad=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(ad||{}),mr=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(mr||{}),ki=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(ki||{}),Pi=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(Pi||{}),Qr=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(Qr||{});const dv={createCanvas:(r,t)=>{const e=document.createElement("canvas");return e.width=r,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")},qt={ADAPTER:dv,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Xh=/iPhone/i,wf=/iPod/i,Sf=/iPad/i,Cf=/\biOS-universal(?:.+)Mac\b/i,jh=/\bAndroid(?:.+)Mobile\b/i,Ef=/Android/i,jn=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Uo=/Silk/i,as=/Windows Phone/i,Pf=/\bWindows(?:.+)ARM\b/i,Tf=/BlackBerry/i,If=/BB10/i,Af=/Opera Mini/i,Mf=/\b(CriOS|Chrome)(?:.+)Mobile/i,kf=/Mobile(?:.+)Firefox\b/i,Rf=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function fv(r){return function(t){return t.test(r)}}function Bf(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var s=fv(e),n={apple:{phone:s(Xh)&&!s(as),ipod:s(wf),tablet:!s(Xh)&&(s(Sf)||Rf(t))&&!s(as),universal:s(Cf),device:(s(Xh)||s(wf)||s(Sf)||s(Cf)||Rf(t))&&!s(as)},amazon:{phone:s(jn),tablet:!s(jn)&&s(Uo),device:s(jn)||s(Uo)},android:{phone:!s(as)&&s(jn)||!s(as)&&s(jh),tablet:!s(as)&&!s(jn)&&!s(jh)&&(s(Uo)||s(Ef)),device:!s(as)&&(s(jn)||s(Uo)||s(jh)||s(Ef))||s(/\bokhttp\b/i)},windows:{phone:s(as),tablet:s(Pf),device:s(as)||s(Pf)},other:{blackberry:s(Tf),blackberry10:s(If),opera:s(Af),firefox:s(kf),chrome:s(Mf),device:s(Tf)||s(If)||s(Af)||s(kf)||s(Mf)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const pv=Bf.default??Bf,ds=pv(globalThis.navigator);qt.RETINA_PREFIX=/@([0-9\.]+)x/;qt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var js=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Gg(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return r[i]}})}),e}var Vg={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function s(d,p,m){this.fn=d,this.context=p,this.once=m||!1}function n(d,p,m,v,b){if(typeof m!="function")throw new TypeError("The listener must be a function");var y=new s(m,v||d,b),P=e?e+p:p;return d._events[P]?d._events[P].fn?d._events[P]=[d._events[P],y]:d._events[P].push(y):(d._events[P]=y,d._eventsCount++),d}function o(d,p){--d._eventsCount===0?d._events=new i:delete d._events[p]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var p=[],m,v;if(this._eventsCount===0)return p;for(v in m=this._events)t.call(m,v)&&p.push(e?v.slice(1):v);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(m)):p},h.prototype.listeners=function(p){var m=e?e+p:p,v=this._events[m];if(!v)return[];if(v.fn)return[v.fn];for(var b=0,y=v.length,P=new Array(y);b<y;b++)P[b]=v[b].fn;return P},h.prototype.listenerCount=function(p){var m=e?e+p:p,v=this._events[m];return v?v.fn?1:v.length:0},h.prototype.emit=function(p,m,v,b,y,P){var M=e?e+p:p;if(!this._events[M])return!1;var z=this._events[M],q=arguments.length,V,I;if(z.fn){switch(z.once&&this.removeListener(p,z.fn,void 0,!0),q){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,m),!0;case 3:return z.fn.call(z.context,m,v),!0;case 4:return z.fn.call(z.context,m,v,b),!0;case 5:return z.fn.call(z.context,m,v,b,y),!0;case 6:return z.fn.call(z.context,m,v,b,y,P),!0}for(I=1,V=new Array(q-1);I<q;I++)V[I-1]=arguments[I];z.fn.apply(z.context,V)}else{var Y=z.length,K;for(I=0;I<Y;I++)switch(z[I].once&&this.removeListener(p,z[I].fn,void 0,!0),q){case 1:z[I].fn.call(z[I].context);break;case 2:z[I].fn.call(z[I].context,m);break;case 3:z[I].fn.call(z[I].context,m,v);break;case 4:z[I].fn.call(z[I].context,m,v,b);break;default:if(!V)for(K=1,V=new Array(q-1);K<q;K++)V[K-1]=arguments[K];z[I].fn.apply(z[I].context,V)}}return!0},h.prototype.on=function(p,m,v){return n(this,p,m,v,!1)},h.prototype.once=function(p,m,v){return n(this,p,m,v,!0)},h.prototype.removeListener=function(p,m,v,b){var y=e?e+p:p;if(!this._events[y])return this;if(!m)return o(this,y),this;var P=this._events[y];if(P.fn)P.fn===m&&(!b||P.once)&&(!v||P.context===v)&&o(this,y);else{for(var M=0,z=[],q=P.length;M<q;M++)(P[M].fn!==m||b&&!P[M].once||v&&P[M].context!==v)&&z.push(P[M]);z.length?this._events[y]=z.length===1?z[0]:z:o(this,y)}return this},h.prototype.removeAllListeners=function(p){var m;return p?(m=e?e+p:p,this._events[m]&&o(this,m)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,r.exports=h})(Vg);var gv=Vg.exports;const yo=vo(gv);var od={exports:{}};od.exports=gh;od.exports.default=gh;function gh(r,t,e){e=e||2;var i=t&&t.length,s=i?t[0]*e:r.length,n=Hg(r,0,s,e,!0),o=[];if(!n||n.next===n.prev)return o;var h,d,p,m,v,b,y;if(i&&(n=xv(r,t,n,e)),r.length>80*e){h=p=r[0],d=m=r[1];for(var P=e;P<s;P+=e)v=r[P],b=r[P+1],v<h&&(h=v),b<d&&(d=b),v>p&&(p=v),b>m&&(m=b);y=Math.max(p-h,m-d),y=y!==0?32767/y:0}return fo(n,o,e,h,d,y,0),o}function Hg(r,t,e,i,s){var n,o;if(s===Ku(r,t,e,i)>0)for(n=t;n<e;n+=i)o=Lf(n,r[n],r[n+1],o);else for(n=e-i;n>=t;n-=i)o=Lf(n,r[n],r[n+1],o);return o&&mh(o,o.next)&&(go(o),o=o.next),o}function Ln(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(mh(e,e.next)||li(e.prev,e,e.next)===0)){if(go(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function fo(r,t,e,i,s,n,o){if(r){!o&&n&&Ev(r,i,s,n);for(var h=r,d,p;r.prev!==r.next;){if(d=r.prev,p=r.next,n?_v(r,i,s,n):mv(r)){t.push(d.i/e|0),t.push(r.i/e|0),t.push(p.i/e|0),go(r),r=p.next,h=p.next;continue}if(r=p,r===h){o?o===1?(r=vv(Ln(r),t,e),fo(r,t,e,i,s,n,2)):o===2&&yv(r,t,e,i,s,n):fo(Ln(r),t,e,i,s,n,1);break}}}}function mv(r){var t=r.prev,e=r,i=r.next;if(li(t,e,i)>=0)return!1;for(var s=t.x,n=e.x,o=i.x,h=t.y,d=e.y,p=i.y,m=s<n?s<o?s:o:n<o?n:o,v=h<d?h<p?h:p:d<p?d:p,b=s>n?s>o?s:o:n>o?n:o,y=h>d?h>p?h:p:d>p?d:p,P=i.next;P!==t;){if(P.x>=m&&P.x<=b&&P.y>=v&&P.y<=y&&la(s,h,n,d,o,p,P.x,P.y)&&li(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function _v(r,t,e,i){var s=r.prev,n=r,o=r.next;if(li(s,n,o)>=0)return!1;for(var h=s.x,d=n.x,p=o.x,m=s.y,v=n.y,b=o.y,y=h<d?h<p?h:p:d<p?d:p,P=m<v?m<b?m:b:v<b?v:b,M=h>d?h>p?h:p:d>p?d:p,z=m>v?m>b?m:b:v>b?v:b,q=qu(y,P,t,e,i),V=qu(M,z,t,e,i),I=r.prevZ,Y=r.nextZ;I&&I.z>=q&&Y&&Y.z<=V;){if(I.x>=y&&I.x<=M&&I.y>=P&&I.y<=z&&I!==s&&I!==o&&la(h,m,d,v,p,b,I.x,I.y)&&li(I.prev,I,I.next)>=0||(I=I.prevZ,Y.x>=y&&Y.x<=M&&Y.y>=P&&Y.y<=z&&Y!==s&&Y!==o&&la(h,m,d,v,p,b,Y.x,Y.y)&&li(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;I&&I.z>=q;){if(I.x>=y&&I.x<=M&&I.y>=P&&I.y<=z&&I!==s&&I!==o&&la(h,m,d,v,p,b,I.x,I.y)&&li(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;Y&&Y.z<=V;){if(Y.x>=y&&Y.x<=M&&Y.y>=P&&Y.y<=z&&Y!==s&&Y!==o&&la(h,m,d,v,p,b,Y.x,Y.y)&&li(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function vv(r,t,e){var i=r;do{var s=i.prev,n=i.next.next;!mh(s,n)&&Wg(s,i,i.next,n)&&po(s,n)&&po(n,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),go(i),go(i.next),i=r=n),i=i.next}while(i!==r);return Ln(i)}function yv(r,t,e,i,s,n){var o=r;do{for(var h=o.next.next;h!==o.prev;){if(o.i!==h.i&&Iv(o,h)){var d=Xg(o,h);o=Ln(o,o.next),d=Ln(d,d.next),fo(o,t,e,i,s,n,0),fo(d,t,e,i,s,n,0);return}h=h.next}o=o.next}while(o!==r)}function xv(r,t,e,i){var s=[],n,o,h,d,p;for(n=0,o=t.length;n<o;n++)h=t[n]*i,d=n<o-1?t[n+1]*i:r.length,p=Hg(r,h,d,i,!1),p===p.next&&(p.steiner=!0),s.push(Tv(p));for(s.sort(bv),n=0;n<s.length;n++)e=wv(s[n],e);return e}function bv(r,t){return r.x-t.x}function wv(r,t){var e=Sv(r,t);if(!e)return t;var i=Xg(e,r);return Ln(i,i.next),Ln(e,e.next)}function Sv(r,t){var e=t,i=r.x,s=r.y,n=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var h=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=i&&h>n&&(n=h,o=e.x<e.next.x?e:e.next,h===i))return o}e=e.next}while(e!==t);if(!o)return null;var d=o,p=o.x,m=o.y,v=1/0,b;e=o;do i>=e.x&&e.x>=p&&i!==e.x&&la(s<m?i:n,s,p,m,s<m?n:i,s,e.x,e.y)&&(b=Math.abs(s-e.y)/(i-e.x),po(e,r)&&(b<v||b===v&&(e.x>o.x||e.x===o.x&&Cv(o,e)))&&(o=e,v=b)),e=e.next;while(e!==d);return o}function Cv(r,t){return li(r.prev,r,t.prev)<0&&li(t.next,r,r.next)<0}function Ev(r,t,e,i){var s=r;do s.z===0&&(s.z=qu(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Pv(s)}function Pv(r){var t,e,i,s,n,o,h,d,p=1;do{for(e=r,r=null,n=null,o=0;e;){for(o++,i=e,h=0,t=0;t<p&&(h++,i=i.nextZ,!!i);t++);for(d=p;h>0||d>0&&i;)h!==0&&(d===0||!i||e.z<=i.z)?(s=e,e=e.nextZ,h--):(s=i,i=i.nextZ,d--),n?n.nextZ=s:r=s,s.prevZ=n,n=s;e=i}n.nextZ=null,p*=2}while(o>1);return r}function qu(r,t,e,i,s){return r=(r-e)*s|0,t=(t-i)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function Tv(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function la(r,t,e,i,s,n,o,h){return(s-o)*(t-h)>=(r-o)*(n-h)&&(r-o)*(i-h)>=(e-o)*(t-h)&&(e-o)*(n-h)>=(s-o)*(i-h)}function Iv(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Av(r,t)&&(po(r,t)&&po(t,r)&&Mv(r,t)&&(li(r.prev,r,t.prev)||li(r,t.prev,t))||mh(r,t)&&li(r.prev,r,r.next)>0&&li(t.prev,t,t.next)>0)}function li(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function mh(r,t){return r.x===t.x&&r.y===t.y}function Wg(r,t,e,i){var s=Go(li(r,t,e)),n=Go(li(r,t,i)),o=Go(li(e,i,r)),h=Go(li(e,i,t));return!!(s!==n&&o!==h||s===0&&zo(r,e,t)||n===0&&zo(r,i,t)||o===0&&zo(e,r,i)||h===0&&zo(e,t,i))}function zo(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function Go(r){return r>0?1:r<0?-1:0}function Av(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&Wg(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function po(r,t){return li(r.prev,r,r.next)<0?li(r,t,r.next)>=0&&li(r,r.prev,t)>=0:li(r,t,r.prev)<0||li(r,r.next,t)<0}function Mv(r,t){var e=r,i=!1,s=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function Xg(r,t){var e=new Zu(r.i,r.x,r.y),i=new Zu(t.i,t.x,t.y),s=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function Lf(r,t,e,i){var s=new Zu(r,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function go(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Zu(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}gh.deviation=function(r,t,e,i){var s=t&&t.length,n=s?t[0]*e:r.length,o=Math.abs(Ku(r,0,n,e));if(s)for(var h=0,d=t.length;h<d;h++){var p=t[h]*e,m=h<d-1?t[h+1]*e:r.length;o-=Math.abs(Ku(r,p,m,e))}var v=0;for(h=0;h<i.length;h+=3){var b=i[h]*e,y=i[h+1]*e,P=i[h+2]*e;v+=Math.abs((r[b]-r[P])*(r[y+1]-r[b+1])-(r[b]-r[y])*(r[P+1]-r[b+1]))}return o===0&&v===0?0:Math.abs((v-o)/o)};function Ku(r,t,e,i){for(var s=0,n=t,o=e-i;n<e;n+=i)s+=(r[o]-r[n])*(r[n+1]+r[o+1]),o=n;return s}gh.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,s=0;s<r.length;s++){for(var n=0;n<r[s].length;n++)for(var o=0;o<t;o++)e.vertices.push(r[s][n][o]);s>0&&(i+=r[s-1].length,e.holes.push(i))}return e};var kv=od.exports;const Rv=vo(kv);var Vl={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Vl.exports;(function(r,t){(function(e){var i=t&&!t.nodeType&&t,s=r&&!r.nodeType&&r,n=typeof js=="object"&&js;(n.global===n||n.window===n||n.self===n)&&(e=n);var o,h=2147483647,d=36,p=1,m=26,v=38,b=700,y=72,P=128,M="-",z=/^xn--/,q=/[^\x20-\x7E]/,V=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Y=d-p,K=Math.floor,T=String.fromCharCode,at;function ct(vt){throw new RangeError(I[vt])}function pt(vt,Pt){for(var Vt=vt.length,le=[];Vt--;)le[Vt]=Pt(vt[Vt]);return le}function wt(vt,Pt){var Vt=vt.split("@"),le="";Vt.length>1&&(le=Vt[0]+"@",vt=Vt[1]),vt=vt.replace(V,".");var re=vt.split("."),ee=pt(re,Pt).join(".");return le+ee}function It(vt){for(var Pt=[],Vt=0,le=vt.length,re,ee;Vt<le;)re=vt.charCodeAt(Vt++),re>=55296&&re<=56319&&Vt<le?(ee=vt.charCodeAt(Vt++),(ee&64512)==56320?Pt.push(((re&1023)<<10)+(ee&1023)+65536):(Pt.push(re),Vt--)):Pt.push(re);return Pt}function bt(vt){return pt(vt,function(Pt){var Vt="";return Pt>65535&&(Pt-=65536,Vt+=T(Pt>>>10&1023|55296),Pt=56320|Pt&1023),Vt+=T(Pt),Vt}).join("")}function dt(vt){return vt-48<10?vt-22:vt-65<26?vt-65:vt-97<26?vt-97:d}function ht(vt,Pt){return vt+22+75*(vt<26)-((Pt!=0)<<5)}function Mt(vt,Pt,Vt){var le=0;for(vt=Vt?K(vt/b):vt>>1,vt+=K(vt/Pt);vt>Y*m>>1;le+=d)vt=K(vt/Y);return K(le+(Y+1)*vt/(vt+v))}function _t(vt){var Pt=[],Vt=vt.length,le,re=0,ee=P,Qt=y,xe,Fe,se,ne,Zt,Oe,Ae,Xe,Ve;for(xe=vt.lastIndexOf(M),xe<0&&(xe=0),Fe=0;Fe<xe;++Fe)vt.charCodeAt(Fe)>=128&&ct("not-basic"),Pt.push(vt.charCodeAt(Fe));for(se=xe>0?xe+1:0;se<Vt;){for(ne=re,Zt=1,Oe=d;se>=Vt&&ct("invalid-input"),Ae=dt(vt.charCodeAt(se++)),(Ae>=d||Ae>K((h-re)/Zt))&&ct("overflow"),re+=Ae*Zt,Xe=Oe<=Qt?p:Oe>=Qt+m?m:Oe-Qt,!(Ae<Xe);Oe+=d)Ve=d-Xe,Zt>K(h/Ve)&&ct("overflow"),Zt*=Ve;le=Pt.length+1,Qt=Mt(re-ne,le,ne==0),K(re/le)>h-ee&&ct("overflow"),ee+=K(re/le),re%=le,Pt.splice(re++,0,ee)}return bt(Pt)}function Rt(vt){var Pt,Vt,le,re,ee,Qt,xe,Fe,se,ne,Zt,Oe=[],Ae,Xe,Ve,ci;for(vt=It(vt),Ae=vt.length,Pt=P,Vt=0,ee=y,Qt=0;Qt<Ae;++Qt)Zt=vt[Qt],Zt<128&&Oe.push(T(Zt));for(le=re=Oe.length,re&&Oe.push(M);le<Ae;){for(xe=h,Qt=0;Qt<Ae;++Qt)Zt=vt[Qt],Zt>=Pt&&Zt<xe&&(xe=Zt);for(Xe=le+1,xe-Pt>K((h-Vt)/Xe)&&ct("overflow"),Vt+=(xe-Pt)*Xe,Pt=xe,Qt=0;Qt<Ae;++Qt)if(Zt=vt[Qt],Zt<Pt&&++Vt>h&&ct("overflow"),Zt==Pt){for(Fe=Vt,se=d;ne=se<=ee?p:se>=ee+m?m:se-ee,!(Fe<ne);se+=d)ci=Fe-ne,Ve=d-ne,Oe.push(T(ht(ne+ci%Ve,0))),Fe=K(ci/Ve);Oe.push(T(ht(Fe,0))),ee=Mt(Vt,Xe,le==re),Vt=0,++le}++Vt,++Pt}return Oe.join("")}function kt(vt){return wt(vt,function(Pt){return z.test(Pt)?_t(Pt.slice(4).toLowerCase()):Pt})}function Gt(vt){return wt(vt,function(Pt){return q.test(Pt)?"xn--"+Rt(Pt):Pt})}if(o={version:"1.4.1",ucs2:{decode:It,encode:bt},decode:_t,encode:Rt,toASCII:Gt,toUnicode:kt},i&&s)if(r.exports==i)s.exports=o;else for(at in o)o.hasOwnProperty(at)&&(i[at]=o[at]);else e.punycode=o})(js)})(Vl,Vl.exports);var Bv=Vl.exports,Lv=Error,Dv=EvalError,Fv=RangeError,Ov=ReferenceError,jg=SyntaxError,xo=TypeError,Nv=URIError,Uv=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),i=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var n=Object.getOwnPropertySymbols(t);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==s||o.enumerable!==!0)return!1}return!0},Df=typeof Symbol<"u"&&Symbol,zv=Uv,Gv=function(){return typeof Df!="function"||typeof Symbol!="function"||typeof Df("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:zv()},$h={__proto__:null,foo:{}},Vv=Object,Hv=function(){return{__proto__:$h}.foo===$h.foo&&!($h instanceof Vv)},Wv="Function.prototype.bind called on incompatible ",Xv=Object.prototype.toString,jv=Math.max,$v="[object Function]",Ff=function(t,e){for(var i=[],s=0;s<t.length;s+=1)i[s]=t[s];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i},Yv=function(t,e){for(var i=[],s=e||0,n=0;s<t.length;s+=1,n+=1)i[n]=t[s];return i},qv=function(r,t){for(var e="",i=0;i<r.length;i+=1)e+=r[i],i+1<r.length&&(e+=t);return e},Zv=function(t){var e=this;if(typeof e!="function"||Xv.apply(e)!==$v)throw new TypeError(Wv+e);for(var i=Yv(arguments,1),s,n=function(){if(this instanceof s){var m=e.apply(this,Ff(i,arguments));return Object(m)===m?m:this}return e.apply(t,Ff(i,arguments))},o=jv(0,e.length-i.length),h=[],d=0;d<o;d++)h[d]="$"+d;if(s=Function("binder","return function ("+qv(h,",")+"){ return binder.apply(this,arguments); }")(n),e.prototype){var p=function(){};p.prototype=e.prototype,s.prototype=new p,p.prototype=null}return s},Kv=Zv,ld=Function.prototype.bind||Kv,Qv=Function.prototype.call,Jv=Object.prototype.hasOwnProperty,ty=ld,ey=ty.call(Qv,Jv),De,iy=Lv,ry=Dv,sy=Fv,ny=Ov,wa=jg,fa=xo,ay=Nv,$g=Function,Yh=function(r){try{return $g('"use strict"; return ('+r+").constructor;")()}catch{}},Mn=Object.getOwnPropertyDescriptor;if(Mn)try{Mn({},"")}catch{Mn=null}var qh=function(){throw new fa},oy=Mn?function(){try{return arguments.callee,qh}catch{try{return Mn(arguments,"callee").get}catch{return qh}}}():qh,$n=Gv(),ly=Hv(),Fi=Object.getPrototypeOf||(ly?function(r){return r.__proto__}:null),ta={},hy=typeof Uint8Array>"u"||!Fi?De:Fi(Uint8Array),kn={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?De:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?De:ArrayBuffer,"%ArrayIteratorPrototype%":$n&&Fi?Fi([][Symbol.iterator]()):De,"%AsyncFromSyncIteratorPrototype%":De,"%AsyncFunction%":ta,"%AsyncGenerator%":ta,"%AsyncGeneratorFunction%":ta,"%AsyncIteratorPrototype%":ta,"%Atomics%":typeof Atomics>"u"?De:Atomics,"%BigInt%":typeof BigInt>"u"?De:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?De:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?De:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?De:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":iy,"%eval%":eval,"%EvalError%":ry,"%Float32Array%":typeof Float32Array>"u"?De:Float32Array,"%Float64Array%":typeof Float64Array>"u"?De:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?De:FinalizationRegistry,"%Function%":$g,"%GeneratorFunction%":ta,"%Int8Array%":typeof Int8Array>"u"?De:Int8Array,"%Int16Array%":typeof Int16Array>"u"?De:Int16Array,"%Int32Array%":typeof Int32Array>"u"?De:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":$n&&Fi?Fi(Fi([][Symbol.iterator]())):De,"%JSON%":typeof JSON=="object"?JSON:De,"%Map%":typeof Map>"u"?De:Map,"%MapIteratorPrototype%":typeof Map>"u"||!$n||!Fi?De:Fi(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?De:Promise,"%Proxy%":typeof Proxy>"u"?De:Proxy,"%RangeError%":sy,"%ReferenceError%":ny,"%Reflect%":typeof Reflect>"u"?De:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?De:Set,"%SetIteratorPrototype%":typeof Set>"u"||!$n||!Fi?De:Fi(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?De:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":$n&&Fi?Fi(""[Symbol.iterator]()):De,"%Symbol%":$n?Symbol:De,"%SyntaxError%":wa,"%ThrowTypeError%":oy,"%TypedArray%":hy,"%TypeError%":fa,"%Uint8Array%":typeof Uint8Array>"u"?De:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?De:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?De:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?De:Uint32Array,"%URIError%":ay,"%WeakMap%":typeof WeakMap>"u"?De:WeakMap,"%WeakRef%":typeof WeakRef>"u"?De:WeakRef,"%WeakSet%":typeof WeakSet>"u"?De:WeakSet};if(Fi)try{null.error}catch(r){var uy=Fi(Fi(r));kn["%Error.prototype%"]=uy}var cy=function r(t){var e;if(t==="%AsyncFunction%")e=Yh("async function () {}");else if(t==="%GeneratorFunction%")e=Yh("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Yh("async function* () {}");else if(t==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(e=i.prototype)}else if(t==="%AsyncIteratorPrototype%"){var s=r("%AsyncGenerator%");s&&Fi&&(e=Fi(s.prototype))}return kn[t]=e,e},Of={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bo=ld,Hl=ey,dy=bo.call(Function.call,Array.prototype.concat),fy=bo.call(Function.apply,Array.prototype.splice),Nf=bo.call(Function.call,String.prototype.replace),Wl=bo.call(Function.call,String.prototype.slice),py=bo.call(Function.call,RegExp.prototype.exec),gy=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,my=/\\(\\)?/g,_y=function(t){var e=Wl(t,0,1),i=Wl(t,-1);if(e==="%"&&i!=="%")throw new wa("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&e!=="%")throw new wa("invalid intrinsic syntax, expected opening `%`");var s=[];return Nf(t,gy,function(n,o,h,d){s[s.length]=h?Nf(d,my,"$1"):o||n}),s},vy=function(t,e){var i=t,s;if(Hl(Of,i)&&(s=Of[i],i="%"+s[0]+"%"),Hl(kn,i)){var n=kn[i];if(n===ta&&(n=cy(i)),typeof n>"u"&&!e)throw new fa("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:i,value:n}}throw new wa("intrinsic "+t+" does not exist!")},Pa=function(t,e){if(typeof t!="string"||t.length===0)throw new fa("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new fa('"allowMissing" argument must be a boolean');if(py(/^%?[^%]*%?$/,t)===null)throw new wa("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=_y(t),s=i.length>0?i[0]:"",n=vy("%"+s+"%",e),o=n.name,h=n.value,d=!1,p=n.alias;p&&(s=p[0],fy(i,dy([0,1],p)));for(var m=1,v=!0;m<i.length;m+=1){var b=i[m],y=Wl(b,0,1),P=Wl(b,-1);if((y==='"'||y==="'"||y==="`"||P==='"'||P==="'"||P==="`")&&y!==P)throw new wa("property names with quotes must have matching quotes");if((b==="constructor"||!v)&&(d=!0),s+="."+b,o="%"+s+"%",Hl(kn,o))h=kn[o];else if(h!=null){if(!(b in h)){if(!e)throw new fa("base intrinsic for "+t+" exists, but the property is not available.");return}if(Mn&&m+1>=i.length){var M=Mn(h,b);v=!!M,v&&"get"in M&&!("originalValue"in M.get)?h=M.get:h=h[b]}else v=Hl(h,b),h=h[b];v&&!d&&(kn[o]=h)}}return h},Yg={exports:{}},Zh,Uf;function hd(){if(Uf)return Zh;Uf=1;var r=Pa,t=r("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Zh=t,Zh}var yy=Pa,Sl=yy("%Object.getOwnPropertyDescriptor%",!0);if(Sl)try{Sl([],"length")}catch{Sl=null}var qg=Sl,zf=hd(),xy=jg,Yn=xo,Gf=qg,by=function(t,e,i){if(!t||typeof t!="object"&&typeof t!="function")throw new Yn("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new Yn("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Yn("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Yn("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Yn("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Yn("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,d=!!Gf&&Gf(t,e);if(zf)zf(t,e,{configurable:o===null&&d?d.configurable:!o,enumerable:s===null&&d?d.enumerable:!s,value:i,writable:n===null&&d?d.writable:!n});else if(h||!s&&!n&&!o)t[e]=i;else throw new xy("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Qu=hd(),Zg=function(){return!!Qu};Zg.hasArrayLengthDefineBug=function(){if(!Qu)return null;try{return Qu([],"length",{value:1}).length!==1}catch{return!0}};var wy=Zg,Sy=Pa,Vf=by,Cy=wy(),Hf=qg,Wf=xo,Ey=Sy("%Math.floor%"),Py=function(t,e){if(typeof t!="function")throw new Wf("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||Ey(e)!==e)throw new Wf("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],s=!0,n=!0;if("length"in t&&Hf){var o=Hf(t,"length");o&&!o.configurable&&(s=!1),o&&!o.writable&&(n=!1)}return(s||n||!i)&&(Cy?Vf(t,"length",e,!0,!0):Vf(t,"length",e)),t};(function(r){var t=ld,e=Pa,i=Py,s=xo,n=e("%Function.prototype.apply%"),o=e("%Function.prototype.call%"),h=e("%Reflect.apply%",!0)||t.call(o,n),d=hd(),p=e("%Math.max%");r.exports=function(b){if(typeof b!="function")throw new s("a function is required");var y=h(t,o,arguments);return i(y,1+p(0,b.length-(arguments.length-1)),!0)};var m=function(){return h(t,n,arguments)};d?d(r.exports,"apply",{value:m}):r.exports.apply=m})(Yg);var Ty=Yg.exports,Kg=Pa,Qg=Ty,Iy=Qg(Kg("String.prototype.indexOf")),Ay=function(t,e){var i=Kg(t,!!e);return typeof i=="function"&&Iy(t,".prototype.")>-1?Qg(i):i};const My={},ky=Object.freeze(Object.defineProperty({__proto__:null,default:My},Symbol.toStringTag,{value:"Module"})),Ju=Gg(ky);var ud=typeof Map=="function"&&Map.prototype,Kh=Object.getOwnPropertyDescriptor&&ud?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Xl=ud&&Kh&&typeof Kh.get=="function"?Kh.get:null,Xf=ud&&Map.prototype.forEach,cd=typeof Set=="function"&&Set.prototype,Qh=Object.getOwnPropertyDescriptor&&cd?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,jl=cd&&Qh&&typeof Qh.get=="function"?Qh.get:null,jf=cd&&Set.prototype.forEach,Ry=typeof WeakMap=="function"&&WeakMap.prototype,ro=Ry?WeakMap.prototype.has:null,By=typeof WeakSet=="function"&&WeakSet.prototype,so=By?WeakSet.prototype.has:null,Ly=typeof WeakRef=="function"&&WeakRef.prototype,$f=Ly?WeakRef.prototype.deref:null,Dy=Boolean.prototype.valueOf,Fy=Object.prototype.toString,Oy=Function.prototype.toString,Ny=String.prototype.match,dd=String.prototype.slice,zs=String.prototype.replace,Uy=String.prototype.toUpperCase,Yf=String.prototype.toLowerCase,Jg=RegExp.prototype.test,qf=Array.prototype.concat,Yr=Array.prototype.join,zy=Array.prototype.slice,Zf=Math.floor,tc=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Jh=Object.getOwnPropertySymbols,ec=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Sa=typeof Symbol=="function"&&typeof Symbol.iterator=="object",qi=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Sa||!0)?Symbol.toStringTag:null,t0=Object.prototype.propertyIsEnumerable,Kf=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Qf(r,t){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Jg.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-Zf(-r):Zf(r);if(i!==r){var s=String(i),n=dd.call(t,s.length+1);return zs.call(s,e,"$&_")+"."+zs.call(zs.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return zs.call(t,e,"$&_")}var ic=Ju,Jf=ic.custom,tp=i0(Jf)?Jf:null,Gy=function r(t,e,i,s){var n=e||{};if(Ls(n,"quoteStyle")&&n.quoteStyle!=="single"&&n.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ls(n,"maxStringLength")&&(typeof n.maxStringLength=="number"?n.maxStringLength<0&&n.maxStringLength!==1/0:n.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Ls(n,"customInspect")?n.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ls(n,"indent")&&n.indent!==null&&n.indent!=="	"&&!(parseInt(n.indent,10)===n.indent&&n.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ls(n,"numericSeparator")&&typeof n.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=n.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return s0(t,n);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var d=String(t);return h?Qf(t,d):d}if(typeof t=="bigint"){var p=String(t)+"n";return h?Qf(t,p):p}var m=typeof n.depth>"u"?5:n.depth;if(typeof i>"u"&&(i=0),i>=m&&m>0&&typeof t=="object")return rc(t)?"[Array]":"[Object]";var v=nx(n,i);if(typeof s>"u")s=[];else if(r0(s,t)>=0)return"[Circular]";function b(dt,ht,Mt){if(ht&&(s=zy.call(s),s.push(ht)),Mt){var _t={depth:n.depth};return Ls(n,"quoteStyle")&&(_t.quoteStyle=n.quoteStyle),r(dt,_t,i+1,s)}return r(dt,n,i+1,s)}if(typeof t=="function"&&!ep(t)){var y=Zy(t),P=Vo(t,b);return"[Function"+(y?": "+y:" (anonymous)")+"]"+(P.length>0?" { "+Yr.call(P,", ")+" }":"")}if(i0(t)){var M=Sa?zs.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):ec.call(t);return typeof t=="object"&&!Sa?Va(M):M}if(ix(t)){for(var z="<"+Yf.call(String(t.nodeName)),q=t.attributes||[],V=0;V<q.length;V++)z+=" "+q[V].name+"="+e0(Vy(q[V].value),"double",n);return z+=">",t.childNodes&&t.childNodes.length&&(z+="..."),z+="</"+Yf.call(String(t.nodeName))+">",z}if(rc(t)){if(t.length===0)return"[]";var I=Vo(t,b);return v&&!sx(I)?"["+sc(I,v)+"]":"[ "+Yr.call(I,", ")+" ]"}if(Wy(t)){var Y=Vo(t,b);return!("cause"in Error.prototype)&&"cause"in t&&!t0.call(t,"cause")?"{ ["+String(t)+"] "+Yr.call(qf.call("[cause]: "+b(t.cause),Y),", ")+" }":Y.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Yr.call(Y,", ")+" }"}if(typeof t=="object"&&o){if(tp&&typeof t[tp]=="function"&&ic)return ic(t,{depth:m-i});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Ky(t)){var K=[];return Xf&&Xf.call(t,function(dt,ht){K.push(b(ht,t,!0)+" => "+b(dt,t))}),ip("Map",Xl.call(t),K,v)}if(tx(t)){var T=[];return jf&&jf.call(t,function(dt){T.push(b(dt,t))}),ip("Set",jl.call(t),T,v)}if(Qy(t))return tu("WeakMap");if(ex(t))return tu("WeakSet");if(Jy(t))return tu("WeakRef");if(jy(t))return Va(b(Number(t)));if(Yy(t))return Va(b(tc.call(t)));if($y(t))return Va(Dy.call(t));if(Xy(t))return Va(b(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===js)return"{ [object globalThis] }";if(!Hy(t)&&!ep(t)){var at=Vo(t,b),ct=Kf?Kf(t)===Object.prototype:t instanceof Object||t.constructor===Object,pt=t instanceof Object?"":"null prototype",wt=!ct&&qi&&Object(t)===t&&qi in t?dd.call(qs(t),8,-1):pt?"Object":"",It=ct||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",bt=It+(wt||pt?"["+Yr.call(qf.call([],wt||[],pt||[]),": ")+"] ":"");return at.length===0?bt+"{}":v?bt+"{"+sc(at,v)+"}":bt+"{ "+Yr.call(at,", ")+" }"}return String(t)};function e0(r,t,e){var i=(e.quoteStyle||t)==="double"?'"':"'";return i+r+i}function Vy(r){return zs.call(String(r),/"/g,"&quot;")}function rc(r){return qs(r)==="[object Array]"&&(!qi||!(typeof r=="object"&&qi in r))}function Hy(r){return qs(r)==="[object Date]"&&(!qi||!(typeof r=="object"&&qi in r))}function ep(r){return qs(r)==="[object RegExp]"&&(!qi||!(typeof r=="object"&&qi in r))}function Wy(r){return qs(r)==="[object Error]"&&(!qi||!(typeof r=="object"&&qi in r))}function Xy(r){return qs(r)==="[object String]"&&(!qi||!(typeof r=="object"&&qi in r))}function jy(r){return qs(r)==="[object Number]"&&(!qi||!(typeof r=="object"&&qi in r))}function $y(r){return qs(r)==="[object Boolean]"&&(!qi||!(typeof r=="object"&&qi in r))}function i0(r){if(Sa)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!ec)return!1;try{return ec.call(r),!0}catch{}return!1}function Yy(r){if(!r||typeof r!="object"||!tc)return!1;try{return tc.call(r),!0}catch{}return!1}var qy=Object.prototype.hasOwnProperty||function(r){return r in this};function Ls(r,t){return qy.call(r,t)}function qs(r){return Fy.call(r)}function Zy(r){if(r.name)return r.name;var t=Ny.call(Oy.call(r),/^function\s*([\w$]+)/);return t?t[1]:null}function r0(r,t){if(r.indexOf)return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1}function Ky(r){if(!Xl||!r||typeof r!="object")return!1;try{Xl.call(r);try{jl.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function Qy(r){if(!ro||!r||typeof r!="object")return!1;try{ro.call(r,ro);try{so.call(r,so)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function Jy(r){if(!$f||!r||typeof r!="object")return!1;try{return $f.call(r),!0}catch{}return!1}function tx(r){if(!jl||!r||typeof r!="object")return!1;try{jl.call(r);try{Xl.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function ex(r){if(!so||!r||typeof r!="object")return!1;try{so.call(r,so);try{ro.call(r,ro)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function ix(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function s0(r,t){if(r.length>t.maxStringLength){var e=r.length-t.maxStringLength,i="... "+e+" more character"+(e>1?"s":"");return s0(dd.call(r,0,t.maxStringLength),t)+i}var s=zs.call(zs.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,rx);return e0(s,"single",t)}function rx(r){var t=r.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+Uy.call(t.toString(16))}function Va(r){return"Object("+r+")"}function tu(r){return r+" { ? }"}function ip(r,t,e,i){var s=i?sc(e,i):Yr.call(e,", ");return r+" ("+t+") {"+s+"}"}function sx(r){for(var t=0;t<r.length;t++)if(r0(r[t],`
`)>=0)return!1;return!0}function nx(r,t){var e;if(r.indent==="	")e="	";else if(typeof r.indent=="number"&&r.indent>0)e=Yr.call(Array(r.indent+1)," ");else return null;return{base:e,prev:Yr.call(Array(t+1),e)}}function sc(r,t){if(r.length===0)return"";var e=`
`+t.prev+t.base;return e+Yr.call(r,","+e)+`
`+t.prev}function Vo(r,t){var e=rc(r),i=[];if(e){i.length=r.length;for(var s=0;s<r.length;s++)i[s]=Ls(r,s)?t(r[s],r):""}var n=typeof Jh=="function"?Jh(r):[],o;if(Sa){o={};for(var h=0;h<n.length;h++)o["$"+n[h]]=n[h]}for(var d in r)Ls(r,d)&&(e&&String(Number(d))===d&&d<r.length||Sa&&o["$"+d]instanceof Symbol||(Jg.call(/[^\w$]/,d)?i.push(t(d,r)+": "+t(r[d],r)):i.push(d+": "+t(r[d],r))));if(typeof Jh=="function")for(var p=0;p<n.length;p++)t0.call(r,n[p])&&i.push("["+t(n[p])+"]: "+t(r[n[p]],r));return i}var n0=Pa,Ta=Ay,ax=Gy,ox=xo,Ho=n0("%WeakMap%",!0),Wo=n0("%Map%",!0),lx=Ta("WeakMap.prototype.get",!0),hx=Ta("WeakMap.prototype.set",!0),ux=Ta("WeakMap.prototype.has",!0),cx=Ta("Map.prototype.get",!0),dx=Ta("Map.prototype.set",!0),fx=Ta("Map.prototype.has",!0),fd=function(r,t){for(var e=r,i;(i=e.next)!==null;e=i)if(i.key===t)return e.next=i.next,i.next=r.next,r.next=i,i},px=function(r,t){var e=fd(r,t);return e&&e.value},gx=function(r,t,e){var i=fd(r,t);i?i.value=e:r.next={key:t,next:r.next,value:e}},mx=function(r,t){return!!fd(r,t)},_x=function(){var t,e,i,s={assert:function(n){if(!s.has(n))throw new ox("Side channel does not contain "+ax(n))},get:function(n){if(Ho&&n&&(typeof n=="object"||typeof n=="function")){if(t)return lx(t,n)}else if(Wo){if(e)return cx(e,n)}else if(i)return px(i,n)},has:function(n){if(Ho&&n&&(typeof n=="object"||typeof n=="function")){if(t)return ux(t,n)}else if(Wo){if(e)return fx(e,n)}else if(i)return mx(i,n);return!1},set:function(n,o){Ho&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new Ho),hx(t,n,o)):Wo?(e||(e=new Wo),dx(e,n,o)):(i||(i={key:{},next:null}),gx(i,n,o))}};return s},vx=String.prototype.replace,yx=/%20/g,eu={RFC1738:"RFC1738",RFC3986:"RFC3986"},pd={default:eu.RFC3986,formatters:{RFC1738:function(r){return vx.call(r,yx,"+")},RFC3986:function(r){return String(r)}},RFC1738:eu.RFC1738,RFC3986:eu.RFC3986},xx=pd,iu=Object.prototype.hasOwnProperty,Tn=Array.isArray,Or=function(){for(var r=[],t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r}(),bx=function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(Tn(i)){for(var s=[],n=0;n<i.length;++n)typeof i[n]<"u"&&s.push(i[n]);e.obj[e.prop]=s}}},a0=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)typeof t[s]<"u"&&(i[s]=t[s]);return i},wx=function r(t,e,i){if(!e)return t;if(typeof e!="object"){if(Tn(t))t.push(e);else if(t&&typeof t=="object")(i&&(i.plainObjects||i.allowPrototypes)||!iu.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var s=t;return Tn(t)&&!Tn(e)&&(s=a0(t,i)),Tn(t)&&Tn(e)?(e.forEach(function(n,o){if(iu.call(t,o)){var h=t[o];h&&typeof h=="object"&&n&&typeof n=="object"?t[o]=r(h,n,i):t.push(n)}else t[o]=n}),t):Object.keys(e).reduce(function(n,o){var h=e[o];return iu.call(n,o)?n[o]=r(n[o],h,i):n[o]=h,n},s)},Sx=function(t,e){return Object.keys(e).reduce(function(i,s){return i[s]=e[s],i},t)},Cx=function(r,t,e){var i=r.replace(/\+/g," ");if(e==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},ru=1024,Ex=function(t,e,i,s,n){if(t.length===0)return t;var o=t;if(typeof t=="symbol"?o=Symbol.prototype.toString.call(t):typeof t!="string"&&(o=String(t)),i==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(y){return"%26%23"+parseInt(y.slice(2),16)+"%3B"});for(var h="",d=0;d<o.length;d+=ru){for(var p=o.length>=ru?o.slice(d,d+ru):o,m=[],v=0;v<p.length;++v){var b=p.charCodeAt(v);if(b===45||b===46||b===95||b===126||b>=48&&b<=57||b>=65&&b<=90||b>=97&&b<=122||n===xx.RFC1738&&(b===40||b===41)){m[m.length]=p.charAt(v);continue}if(b<128){m[m.length]=Or[b];continue}if(b<2048){m[m.length]=Or[192|b>>6]+Or[128|b&63];continue}if(b<55296||b>=57344){m[m.length]=Or[224|b>>12]+Or[128|b>>6&63]+Or[128|b&63];continue}v+=1,b=65536+((b&1023)<<10|p.charCodeAt(v)&1023),m[m.length]=Or[240|b>>18]+Or[128|b>>12&63]+Or[128|b>>6&63]+Or[128|b&63]}h+=m.join("")}return h},Px=function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],s=0;s<e.length;++s)for(var n=e[s],o=n.obj[n.prop],h=Object.keys(o),d=0;d<h.length;++d){var p=h[d],m=o[p];typeof m=="object"&&m!==null&&i.indexOf(m)===-1&&(e.push({obj:o,prop:p}),i.push(m))}return bx(e),t},Tx=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},Ix=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},Ax=function(t,e){return[].concat(t,e)},Mx=function(t,e){if(Tn(t)){for(var i=[],s=0;s<t.length;s+=1)i.push(e(t[s]));return i}return e(t)},o0={arrayToObject:a0,assign:Sx,combine:Ax,compact:Px,decode:Cx,encode:Ex,isBuffer:Ix,isRegExp:Tx,maybeMap:Mx,merge:wx},l0=_x,Cl=o0,no=pd,kx=Object.prototype.hasOwnProperty,h0={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Wr=Array.isArray,Rx=Array.prototype.push,u0=function(r,t){Rx.apply(r,Wr(t)?t:[t])},Bx=Date.prototype.toISOString,rp=no.default,Mi={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Cl.encode,encodeValuesOnly:!1,format:rp,formatter:no.formatters[rp],indices:!1,serializeDate:function(t){return Bx.call(t)},skipNulls:!1,strictNullHandling:!1},Lx=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},su={},Dx=function r(t,e,i,s,n,o,h,d,p,m,v,b,y,P,M,z,q,V){for(var I=t,Y=V,K=0,T=!1;(Y=Y.get(su))!==void 0&&!T;){var at=Y.get(t);if(K+=1,typeof at<"u"){if(at===K)throw new RangeError("Cyclic object value");T=!0}typeof Y.get(su)>"u"&&(K=0)}if(typeof m=="function"?I=m(e,I):I instanceof Date?I=y(I):i==="comma"&&Wr(I)&&(I=Cl.maybeMap(I,function(vt){return vt instanceof Date?y(vt):vt})),I===null){if(o)return p&&!z?p(e,Mi.encoder,q,"key",P):e;I=""}if(Lx(I)||Cl.isBuffer(I)){if(p){var ct=z?e:p(e,Mi.encoder,q,"key",P);return[M(ct)+"="+M(p(I,Mi.encoder,q,"value",P))]}return[M(e)+"="+M(String(I))]}var pt=[];if(typeof I>"u")return pt;var wt;if(i==="comma"&&Wr(I))z&&p&&(I=Cl.maybeMap(I,p)),wt=[{value:I.length>0?I.join(",")||null:void 0}];else if(Wr(m))wt=m;else{var It=Object.keys(I);wt=v?It.sort(v):It}var bt=d?e.replace(/\./g,"%2E"):e,dt=s&&Wr(I)&&I.length===1?bt+"[]":bt;if(n&&Wr(I)&&I.length===0)return dt+"[]";for(var ht=0;ht<wt.length;++ht){var Mt=wt[ht],_t=typeof Mt=="object"&&typeof Mt.value<"u"?Mt.value:I[Mt];if(!(h&&_t===null)){var Rt=b&&d?Mt.replace(/\./g,"%2E"):Mt,kt=Wr(I)?typeof i=="function"?i(dt,Rt):dt:dt+(b?"."+Rt:"["+Rt+"]");V.set(t,K);var Gt=l0();Gt.set(su,V),u0(pt,r(_t,kt,i,s,n,o,h,d,i==="comma"&&z&&Wr(I)?null:p,m,v,b,y,P,M,z,q,Gt))}}return pt},Fx=function(t){if(!t)return Mi;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Mi.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=no.default;if(typeof t.format<"u"){if(!kx.call(no.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var s=no.formatters[i],n=Mi.filter;(typeof t.filter=="function"||Wr(t.filter))&&(n=t.filter);var o;if(t.arrayFormat in h0?o=t.arrayFormat:"indices"in t?o=t.indices?"indices":"repeat":o=Mi.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:Mi.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Mi.addQueryPrefix,allowDots:h,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Mi.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Mi.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Mi.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Mi.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Mi.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Mi.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Mi.encodeValuesOnly,filter:n,format:i,formatter:s,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Mi.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Mi.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Mi.strictNullHandling}},Ox=function(r,t){var e=r,i=Fx(t),s,n;typeof i.filter=="function"?(n=i.filter,e=n("",e)):Wr(i.filter)&&(n=i.filter,s=n);var o=[];if(typeof e!="object"||e===null)return"";var h=h0[i.arrayFormat],d=h==="comma"&&i.commaRoundTrip;s||(s=Object.keys(e)),i.sort&&s.sort(i.sort);for(var p=l0(),m=0;m<s.length;++m){var v=s[m];i.skipNulls&&e[v]===null||u0(o,Dx(e[v],v,h,d,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,p))}var b=o.join(i.delimiter),y=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),b.length>0?y+b:""},Ca=o0,nc=Object.prototype.hasOwnProperty,Nx=Array.isArray,fi={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Ca.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},Ux=function(r){return r.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},c0=function(r,t){return r&&typeof r=="string"&&t.comma&&r.indexOf(",")>-1?r.split(","):r},zx="utf8=%26%2310003%3B",Gx="utf8=%E2%9C%93",Vx=function(t,e){var i={__proto__:null},s=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;s=s.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var n=e.parameterLimit===1/0?void 0:e.parameterLimit,o=s.split(e.delimiter,n),h=-1,d,p=e.charset;if(e.charsetSentinel)for(d=0;d<o.length;++d)o[d].indexOf("utf8=")===0&&(o[d]===Gx?p="utf-8":o[d]===zx&&(p="iso-8859-1"),h=d,d=o.length);for(d=0;d<o.length;++d)if(d!==h){var m=o[d],v=m.indexOf("]="),b=v===-1?m.indexOf("="):v+1,y,P;b===-1?(y=e.decoder(m,fi.decoder,p,"key"),P=e.strictNullHandling?null:""):(y=e.decoder(m.slice(0,b),fi.decoder,p,"key"),P=Ca.maybeMap(c0(m.slice(b+1),e),function(z){return e.decoder(z,fi.decoder,p,"value")})),P&&e.interpretNumericEntities&&p==="iso-8859-1"&&(P=Ux(P)),m.indexOf("[]=")>-1&&(P=Nx(P)?[P]:P);var M=nc.call(i,y);M&&e.duplicates==="combine"?i[y]=Ca.combine(i[y],P):(!M||e.duplicates==="last")&&(i[y]=P)}return i},Hx=function(r,t,e,i){for(var s=i?t:c0(t,e),n=r.length-1;n>=0;--n){var o,h=r[n];if(h==="[]"&&e.parseArrays)o=e.allowEmptyArrays&&(s===""||e.strictNullHandling&&s===null)?[]:[].concat(s);else{o=e.plainObjects?Object.create(null):{};var d=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h,p=e.decodeDotInKeys?d.replace(/%2E/g,"."):d,m=parseInt(p,10);!e.parseArrays&&p===""?o={0:s}:!isNaN(m)&&h!==p&&String(m)===p&&m>=0&&e.parseArrays&&m<=e.arrayLimit?(o=[],o[m]=s):p!=="__proto__"&&(o[p]=s)}s=o}return s},Wx=function(t,e,i,s){if(t){var n=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/,h=/(\[[^[\]]*])/g,d=i.depth>0&&o.exec(n),p=d?n.slice(0,d.index):n,m=[];if(p){if(!i.plainObjects&&nc.call(Object.prototype,p)&&!i.allowPrototypes)return;m.push(p)}for(var v=0;i.depth>0&&(d=h.exec(n))!==null&&v<i.depth;){if(v+=1,!i.plainObjects&&nc.call(Object.prototype,d[1].slice(1,-1))&&!i.allowPrototypes)return;m.push(d[1])}if(d){if(i.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");m.push("["+n.slice(d.index)+"]")}return Hx(m,e,i,s)}},Xx=function(t){if(!t)return fi;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?fi.charset:t.charset,i=typeof t.duplicates>"u"?fi.duplicates:t.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var s=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:fi.allowDots:!!t.allowDots;return{allowDots:s,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:fi.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:fi.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:fi.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:fi.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:fi.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:fi.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:fi.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:fi.decoder,delimiter:typeof t.delimiter=="string"||Ca.isRegExp(t.delimiter)?t.delimiter:fi.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:fi.depth,duplicates:i,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:fi.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:fi.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:fi.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:fi.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:fi.strictNullHandling}},jx=function(r,t){var e=Xx(t);if(r===""||r===null||typeof r>"u")return e.plainObjects?Object.create(null):{};for(var i=typeof r=="string"?Vx(r,e):r,s=e.plainObjects?Object.create(null):{},n=Object.keys(i),o=0;o<n.length;++o){var h=n[o],d=Wx(h,i[h],e,typeof r=="string");s=Ca.merge(s,d,e)}return e.allowSparse===!0?s:Ca.compact(s)},$x=Ox,Yx=jx,qx=pd,Zx={formats:qx,parse:Yx,stringify:$x},Kx=Bv;function ms(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Qx=/^([a-z0-9.+-]+:)/i,Jx=/:[0-9]*$/,t1=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,e1=["<",">",'"',"`"," ","\r",`
`,"	"],i1=["{","}","|","\\","^","`"].concat(e1),ac=["'"].concat(i1),sp=["%","/","?",";","#"].concat(ac),np=["/","?","#"],r1=255,ap=/^[+a-z0-9A-Z_-]{0,63}$/,s1=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,n1={javascript:!0,"javascript:":!0},oc={javascript:!0,"javascript:":!0},pa={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},lc=Zx;function a1(r,t,e){if(r&&typeof r=="object"&&r instanceof ms)return r;var i=new ms;return i.parse(r,t,e),i}ms.prototype.parse=function(r,t,e){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),s=i!==-1&&i<r.indexOf("#")?"?":"#",n=r.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),r=n.join(s);var h=r;if(h=h.trim(),!e&&r.split("#").length===1){var d=t1.exec(h);if(d)return this.path=h,this.href=h,this.pathname=d[1],d[2]?(this.search=d[2],t?this.query=lc.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var p=Qx.exec(h);if(p){p=p[0];var m=p.toLowerCase();this.protocol=m,h=h.substr(p.length)}if(e||p||h.match(/^\/\/[^@/]+@[^@/]+/)){var v=h.substr(0,2)==="//";v&&!(p&&oc[p])&&(h=h.substr(2),this.slashes=!0)}if(!oc[p]&&(v||p&&!pa[p])){for(var b=-1,y=0;y<np.length;y++){var P=h.indexOf(np[y]);P!==-1&&(b===-1||P<b)&&(b=P)}var M,z;b===-1?z=h.lastIndexOf("@"):z=h.lastIndexOf("@",b),z!==-1&&(M=h.slice(0,z),h=h.slice(z+1),this.auth=decodeURIComponent(M)),b=-1;for(var y=0;y<sp.length;y++){var P=h.indexOf(sp[y]);P!==-1&&(b===-1||P<b)&&(b=P)}b===-1&&(b=h.length),this.host=h.slice(0,b),h=h.slice(b),this.parseHost(),this.hostname=this.hostname||"";var q=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!q)for(var V=this.hostname.split(/\./),y=0,I=V.length;y<I;y++){var Y=V[y];if(Y&&!Y.match(ap)){for(var K="",T=0,at=Y.length;T<at;T++)Y.charCodeAt(T)>127?K+="x":K+=Y[T];if(!K.match(ap)){var ct=V.slice(0,y),pt=V.slice(y+1),wt=Y.match(s1);wt&&(ct.push(wt[1]),pt.unshift(wt[2])),pt.length&&(h="/"+pt.join(".")+h),this.hostname=ct.join(".");break}}}this.hostname.length>r1?this.hostname="":this.hostname=this.hostname.toLowerCase(),q||(this.hostname=Kx.toASCII(this.hostname));var It=this.port?":"+this.port:"",bt=this.hostname||"";this.host=bt+It,this.href+=this.host,q&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!n1[m])for(var y=0,I=ac.length;y<I;y++){var dt=ac[y];if(h.indexOf(dt)!==-1){var ht=encodeURIComponent(dt);ht===dt&&(ht=escape(dt)),h=h.split(dt).join(ht)}}var Mt=h.indexOf("#");Mt!==-1&&(this.hash=h.substr(Mt),h=h.slice(0,Mt));var _t=h.indexOf("?");if(_t!==-1?(this.search=h.substr(_t),this.query=h.substr(_t+1),t&&(this.query=lc.parse(this.query)),h=h.slice(0,_t)):t&&(this.search="",this.query={}),h&&(this.pathname=h),pa[m]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var It=this.pathname||"",Rt=this.search||"";this.path=It+Rt}return this.href=this.format(),this};ms.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",s=!1,n="";this.host?s=r+this.host:this.hostname&&(s=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(n=lc.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||pa[t])&&s!==!1?(s="//"+(s||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):s||(s=""),i&&i.charAt(0)!=="#"&&(i="#"+i),o&&o.charAt(0)!=="?"&&(o="?"+o),e=e.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),o=o.replace("#","%23"),t+s+e+o+i};ms.prototype.resolve=function(r){return this.resolveObject(a1(r,!1,!0)).format()};ms.prototype.resolveObject=function(r){if(typeof r=="string"){var t=new ms;t.parse(r,!1,!0),r=t}for(var e=new ms,i=Object.keys(this),s=0;s<i.length;s++){var n=i[s];e[n]=this[n]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var o=Object.keys(r),h=0;h<o.length;h++){var d=o[h];d!=="protocol"&&(e[d]=r[d])}return pa[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!pa[r.protocol]){for(var p=Object.keys(r),m=0;m<p.length;m++){var v=p[m];e[v]=r[v]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!oc[r.protocol]){for(var I=(r.pathname||"").split("/");I.length&&!(r.host=I.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),I[0]!==""&&I.unshift(""),I.length<2&&I.unshift(""),e.pathname=I.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var b=e.pathname||"",y=e.search||"";e.path=b+y}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var P=e.pathname&&e.pathname.charAt(0)==="/",M=r.host||r.pathname&&r.pathname.charAt(0)==="/",z=M||P||e.host&&r.pathname,q=z,V=e.pathname&&e.pathname.split("/")||[],I=r.pathname&&r.pathname.split("/")||[],Y=e.protocol&&!pa[e.protocol];if(Y&&(e.hostname="",e.port=null,e.host&&(V[0]===""?V[0]=e.host:V.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(I[0]===""?I[0]=r.host:I.unshift(r.host)),r.host=null),z=z&&(I[0]===""||V[0]==="")),M)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,V=I;else if(I.length)V||(V=[]),V.pop(),V=V.concat(I),e.search=r.search,e.query=r.query;else if(r.search!=null){if(Y){e.host=V.shift(),e.hostname=e.host;var K=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;K&&(e.auth=K.shift(),e.hostname=K.shift(),e.host=e.hostname)}return e.search=r.search,e.query=r.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!V.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var T=V.slice(-1)[0],at=(e.host||r.host||V.length>1)&&(T==="."||T==="..")||T==="",ct=0,pt=V.length;pt>=0;pt--)T=V[pt],T==="."?V.splice(pt,1):T===".."?(V.splice(pt,1),ct++):ct&&(V.splice(pt,1),ct--);if(!z&&!q)for(;ct--;ct)V.unshift("..");z&&V[0]!==""&&(!V[0]||V[0].charAt(0)!=="/")&&V.unshift(""),at&&V.join("/").substr(-1)!=="/"&&V.push("");var wt=V[0]===""||V[0]&&V[0].charAt(0)==="/";if(Y){e.hostname=wt?"":V.length?V.shift():"",e.host=e.hostname;var K=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;K&&(e.auth=K.shift(),e.hostname=K.shift(),e.host=e.hostname)}return z=z||e.host&&V.length,z&&!wt&&V.unshift(""),V.length>0?e.pathname=V.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};ms.prototype.parseHost=function(){var r=this.host,t=Jx.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};const op={};function Be(r,t,e=3){if(op[t])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${r}`),console.warn(i))),op[t]=!0}function br(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function Ha(r){return r.split("?")[0].split("#")[0]}function o1(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l1(r,t,e){return r.replace(new RegExp(o1(t),"g"),e)}function h1(r,t){let e="",i=0,s=-1,n=0,o=-1;for(let h=0;h<=r.length;++h){if(h<r.length)o=r.charCodeAt(h);else{if(o===47)break;o=47}if(o===47){if(!(s===h-1||n===1))if(s!==h-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const d=e.lastIndexOf("/");if(d!==e.length-1){d===-1?(e="",i=0):(e=e.slice(0,d),i=e.length-1-e.lastIndexOf("/")),s=h,n=0;continue}}else if(e.length===2||e.length===1){e="",i=0,s=h,n=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${r.slice(s+1,h)}`:e=r.slice(s+1,h),i=h-s-1;s=h,n=0}else o===46&&n!==-1?++n:n=-1}return e}const Ni={toPosix(r){return l1(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){br(r),r=this.toPosix(r);const t=/^file:\/\/\//.exec(r);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(r);return e?e[0]:""},toAbsolute(r,t,e){if(br(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const i=Ha(this.toPosix(t??qt.ADAPTER.getBaseUrl())),s=Ha(this.toPosix(e??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?Ni.join(s,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(br(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let t="";const e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));const i=r.endsWith("/");return r=h1(r,!1),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return br(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){const i=r[e];if(br(i),i.length>0)if(t===void 0)t=i;else{const s=r[e-1]??"";this.joinExtensions.includes(this.extname(s).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(br(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0);const e=t===47;let i=-1,s=!0;const n=this.getProtocol(r),o=r;r=r.slice(n.length);for(let h=r.length-1;h>=1;--h)if(t=r.charCodeAt(h),t===47){if(!s){i=h;break}}else s=!1;return i===-1?e?"/":this.isUrl(o)?n+r:n:e&&i===1?"//":n+r.slice(0,i)},rootname(r){br(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){const e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){br(r),t&&br(t),r=Ha(this.toPosix(r));let e=0,i=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let o=t.length-1,h=-1;for(n=r.length-1;n>=0;--n){const d=r.charCodeAt(n);if(d===47){if(!s){e=n+1;break}}else h===-1&&(s=!1,h=n+1),o>=0&&(d===t.charCodeAt(o)?--o===-1&&(i=n):(o=-1,i=h))}return e===i?i=h:i===-1&&(i=r.length),r.slice(e,i)}for(n=r.length-1;n>=0;--n)if(r.charCodeAt(n)===47){if(!s){e=n+1;break}}else i===-1&&(s=!1,i=n+1);return i===-1?"":r.slice(e,i)},extname(r){br(r),r=Ha(this.toPosix(r));let t=-1,e=0,i=-1,s=!0,n=0;for(let o=r.length-1;o>=0;--o){const h=r.charCodeAt(o);if(h===47){if(!s){e=o+1;break}continue}i===-1&&(s=!1,i=o+1),h===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){br(r);const t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=Ha(this.toPosix(r));let e=r.charCodeAt(0);const i=this.isAbsolute(r);let s;t.root=this.rootname(r),i||this.hasProtocol(r)?s=1:s=0;let n=-1,o=0,h=-1,d=!0,p=r.length-1,m=0;for(;p>=s;--p){if(e=r.charCodeAt(p),e===47){if(!d){o=p+1;break}continue}h===-1&&(d=!1,h=p+1),e===46?n===-1?n=p:m!==1&&(m=1):n!==-1&&(m=-1)}return n===-1||h===-1||m===0||m===1&&n===h-1&&n===o+1?h!==-1&&(o===0&&i?t.base=t.name=r.slice(1,h):t.base=t.name=r.slice(o,h)):(o===0&&i?(t.name=r.slice(1,n),t.base=r.slice(1,h)):(t.name=r.slice(o,n),t.base=r.slice(o,h)),t.ext=r.slice(n,h)),t.dir=this.dirname(r),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let nu;async function u1(){return nu??(nu=(async()=>{var n;const r=document.createElement("canvas").getContext("webgl");if(!r)return ar.UNPACK;const t=await new Promise(o=>{const h=document.createElement("video");h.onloadeddata=()=>o(h),h.onerror=()=>o(null),h.autoplay=!1,h.crossOrigin="anonymous",h.preload="auto",h.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",h.load()});if(!t)return ar.UNPACK;const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);const i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);const s=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(i),r.deleteTexture(e),(n=r.getExtension("WEBGL_lose_context"))==null||n.loseContext(),s[0]<=s[3]?ar.PMA:ar.UNPACK})()),nu}let au;function c1(){return typeof au>"u"&&(au=function(){var t;const r={stencil:!0,failIfMajorPerformanceCaveat:qt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!qt.ADAPTER.getWebGLRenderingContext())return!1;const e=qt.ADAPTER.createCanvas();let i=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);const s=!!((t=i==null?void 0:i.getContextAttributes())!=null&&t.stencil);if(i){const n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,s}catch{return!1}}()),au}var d1={grad:.9,turn:360,rad:360/(2*Math.PI)},os=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Oi=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*r)/e+0},_r=function(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),r>e?e:r>t?r:t},d0=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},lp=function(r){return{r:_r(r.r,0,255),g:_r(r.g,0,255),b:_r(r.b,0,255),a:_r(r.a)}},ou=function(r){return{r:Oi(r.r),g:Oi(r.g),b:Oi(r.b),a:Oi(r.a,3)}},f1=/^#([0-9a-f]{3,8})$/i,Xo=function(r){var t=r.toString(16);return t.length<2?"0"+t:t},f0=function(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=Math.max(t,e,i),o=n-Math.min(t,e,i),h=o?n===t?(e-i)/o:n===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(h<0?h+6:h),s:n?o/n*100:0,v:n/255*100,a:s}},p0=function(r){var t=r.h,e=r.s,i=r.v,s=r.a;t=t/360*6,e/=100,i/=100;var n=Math.floor(t),o=i*(1-e),h=i*(1-(t-n)*e),d=i*(1-(1-t+n)*e),p=n%6;return{r:255*[i,h,o,o,d,i][p],g:255*[d,i,i,h,o,o][p],b:255*[o,o,d,i,i,h][p],a:s}},hp=function(r){return{h:d0(r.h),s:_r(r.s,0,100),l:_r(r.l,0,100),a:_r(r.a)}},up=function(r){return{h:Oi(r.h),s:Oi(r.s),l:Oi(r.l),a:Oi(r.a,3)}},cp=function(r){return p0((e=(t=r).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},ao=function(r){return{h:(t=f0(r)).h,s:(s=(200-(e=t.s))*(i=t.v)/100)>0&&s<200?e*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,i,s},p1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,g1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_1=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,hc={string:[[function(r){var t=f1.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Oi(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Oi(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var t=m1.exec(r)||_1.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:lp({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(r){var t=p1.exec(r)||g1.exec(r);if(!t)return null;var e,i,s=hp({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*(d1[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return cp(s)},"hsl"]],object:[[function(r){var t=r.r,e=r.g,i=r.b,s=r.a,n=s===void 0?1:s;return os(t)&&os(e)&&os(i)?lp({r:Number(t),g:Number(e),b:Number(i),a:Number(n)}):null},"rgb"],[function(r){var t=r.h,e=r.s,i=r.l,s=r.a,n=s===void 0?1:s;if(!os(t)||!os(e)||!os(i))return null;var o=hp({h:Number(t),s:Number(e),l:Number(i),a:Number(n)});return cp(o)},"hsl"],[function(r){var t=r.h,e=r.s,i=r.v,s=r.a,n=s===void 0?1:s;if(!os(t)||!os(e)||!os(i))return null;var o=function(h){return{h:d0(h.h),s:_r(h.s,0,100),v:_r(h.v,0,100),a:_r(h.a)}}({h:Number(t),s:Number(e),v:Number(i),a:Number(n)});return p0(o)},"hsv"]]},dp=function(r,t){for(var e=0;e<t.length;e++){var i=t[e][0](r);if(i)return[i,t[e][1]]}return[null,void 0]},v1=function(r){return typeof r=="string"?dp(r.trim(),hc.string):typeof r=="object"&&r!==null?dp(r,hc.object):[null,void 0]},lu=function(r,t){var e=ao(r);return{h:e.h,s:_r(e.s+100*t,0,100),l:e.l,a:e.a}},hu=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},fp=function(r,t){var e=ao(r);return{h:e.h,s:e.s,l:_r(e.l+100*t,0,100),a:e.a}},uc=function(){function r(t){this.parsed=v1(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Oi(hu(this.rgba),2)},r.prototype.isDark=function(){return hu(this.rgba)<.5},r.prototype.isLight=function(){return hu(this.rgba)>=.5},r.prototype.toHex=function(){return t=ou(this.rgba),e=t.r,i=t.g,s=t.b,o=(n=t.a)<1?Xo(Oi(255*n)):"","#"+Xo(e)+Xo(i)+Xo(s)+o;var t,e,i,s,n,o},r.prototype.toRgb=function(){return ou(this.rgba)},r.prototype.toRgbString=function(){return t=ou(this.rgba),e=t.r,i=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+i+", "+s+", "+n+")":"rgb("+e+", "+i+", "+s+")";var t,e,i,s,n},r.prototype.toHsl=function(){return up(ao(this.rgba))},r.prototype.toHslString=function(){return t=up(ao(this.rgba)),e=t.h,i=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+i+"%, "+s+"%, "+n+")":"hsl("+e+", "+i+"%, "+s+"%)";var t,e,i,s,n},r.prototype.toHsv=function(){return t=f0(this.rgba),{h:Oi(t.h),s:Oi(t.s),v:Oi(t.v),a:Oi(t.a,3)};var t},r.prototype.invert=function(){return Ur({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},r.prototype.saturate=function(t){return t===void 0&&(t=.1),Ur(lu(this.rgba,t))},r.prototype.desaturate=function(t){return t===void 0&&(t=.1),Ur(lu(this.rgba,-t))},r.prototype.grayscale=function(){return Ur(lu(this.rgba,-1))},r.prototype.lighten=function(t){return t===void 0&&(t=.1),Ur(fp(this.rgba,t))},r.prototype.darken=function(t){return t===void 0&&(t=.1),Ur(fp(this.rgba,-t))},r.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},r.prototype.alpha=function(t){return typeof t=="number"?Ur({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Oi(this.rgba.a,3);var e},r.prototype.hue=function(t){var e=ao(this.rgba);return typeof t=="number"?Ur({h:t,s:e.s,l:e.l,a:e.a}):Oi(e.h)},r.prototype.isEqual=function(t){return this.toHex()===Ur(t).toHex()},r}(),Ur=function(r){return r instanceof uc?r:new uc(r)},pp=[],y1=function(r){r.forEach(function(t){pp.indexOf(t)<0&&(t(uc,hc),pp.push(t))})};function x1(r,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in e)i[e[s]]=s;var n={};r.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var h,d,p=i[this.toHex()];if(p)return p;if(o!=null&&o.closest){var m=this.toRgb(),v=1/0,b="black";if(!n.length)for(var y in e)n[y]=new r(e[y]).toRgb();for(var P in e){var M=(h=m,d=n[P],Math.pow(h.r-d.r,2)+Math.pow(h.g-d.g,2)+Math.pow(h.b-d.b,2));M<v&&(v=M,b=P)}return b}},t.string.push([function(o){var h=o.toLowerCase(),d=h==="transparent"?"#0000":e[h];return d?new r(d).toRgb():null},"name"])}y1([x1]);const ea=class El{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof El)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,i,s]=this._components;return{r:t,g:e,b:i,a:s}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];const[e,i,s]=this._components;return t[0]=e,t[1]=i,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,s,n]=El.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(i=i*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(i<<16)+(s<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,i,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(i*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,i,s,n]=this._components;return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t}normalize(t){let e,i,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,s=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,s,n=255]=t,e/=255,i/=255,s/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const h=El.HEX_PATTERN.exec(t);h&&(t=`#${h[2]}`)}const o=Ur(t);o.isValid()&&({r:e,g:i,b:s,a:n}=o.rgba,e/=255,i/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),i)}),t)}};ea.shared=new ea,ea.temp=new ea,ea.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Je=ea;function b1(r){return Be("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Je.shared.setValue(r).toHex()}function w1(r){return Be("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Je.shared.setValue(r).toNumber()}function S1(){const r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[fe.NORMAL_NPM]=fe.NORMAL,r[fe.ADD_NPM]=fe.ADD,r[fe.SCREEN_NPM]=fe.SCREEN,t[fe.NORMAL]=fe.NORMAL_NPM,t[fe.ADD]=fe.ADD_NPM,t[fe.SCREEN]=fe.SCREEN_NPM;const e=[];return e.push(t),e.push(r),e}const g0=S1();function m0(r,t){return g0[t?1:0][r]}function C1(r,t=null){const e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,s=0;i<e;i+=6,s+=4)t[i+0]=s+0,t[i+1]=s+1,t[i+2]=s+2,t[i+3]=s+0,t[i+4]=s+2,t[i+5]=s+3;return t}function _0(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function $l(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function gp(r){return!(r&r-1)&&!!r}function mp(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function ga(r,t,e){const i=r.length;let s;if(t>=i||e===0)return;e=t+e>i?i-t:e;const n=i-e;for(s=t;s<n;++s)r[s]=r[s+e];r.length=n}function Gs(r){return r===0?0:r<0?-1:1}let E1=0;function Dn(){return++E1}const cc=class{constructor(r,t,e,i){this.left=r,this.top=t,this.right=e,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};cc.EMPTY=new cc(0,0,0,0);let _p=cc;const vp={},zr=Object.create(null),Is=Object.create(null);class P1{constructor(t,e,i){this._canvas=qt.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||qt.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function yp(r,t,e){for(let i=0,s=4*e*t;i<t;++i,s+=4)if(r[s+3]!==0)return!1;return!0}function xp(r,t,e,i,s){const n=4*t;for(let o=i,h=i*n+4*e;o<=s;++o,h+=n)if(r[h+3]!==0)return!1;return!0}function T1(r){const{width:t,height:e}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const s=i.getImageData(0,0,t,e).data;let n=0,o=0,h=t-1,d=e-1;for(;o<e&&yp(s,t,o);)++o;if(o===e)return _p.EMPTY;for(;yp(s,t,d);)--d;for(;xp(s,t,n,o,d);)++n;for(;xp(s,t,h,o,d);)--h;return++h,++d,new _p(n,o,h,d)}function I1(r){const t=T1(r),{width:e,height:i}=t;let s=null;if(!t.isEmpty()){const n=r.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(t.left,t.top,e,i)}return{width:e,height:i,data:s}}function A1(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(r,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function vs(r,t=1){var i;const e=(i=qt.RETINA_PREFIX)==null?void 0:i.exec(r);return e?parseFloat(e[1]):t}var Xt=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(Xt||{});const dc=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},bp=(r,t)=>dc(r).priority??t,te={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(dc).forEach(t=>{t.type.forEach(e=>{var i,s;return(s=(i=this._removeHandlers)[e])==null?void 0:s.call(i,t)})}),this},add(...r){return r.map(dc).forEach(t=>{t.type.forEach(e=>{var n,o;const i=this._addHandlers,s=this._queue;i[e]?(n=i[e])==null||n.call(i,t):(s[e]=s[e]||[],(o=s[e])==null||o.push(t))})}),this},handle(r,t,e){var o;const i=this._addHandlers,s=this._removeHandlers;if(i[r]||s[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=t,s[r]=e;const n=this._queue;return n[r]&&((o=n[r])==null||o.forEach(h=>t(h)),delete n[r]),this},handleByMap(r,t){return this.handle(r,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(r,t,e=-1){return this.handle(r,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((s,n)=>bp(n,e)-bp(s,e)))},i=>{const s=t.indexOf(i.ref);s!==-1&&t.splice(s,1)})}};class fc{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const M1=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function k1(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function R1(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=M1.replace(/%forloop%/gi,k1(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}const uu=0,cu=1,du=2,fu=3,pu=4,gu=5;let Zs=class v0{constructor(){this.data=0,this.blendMode=fe.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<uu)}set blend(t){!!(this.data&1<<uu)!==t&&(this.data^=1<<uu)}get offsets(){return!!(this.data&1<<cu)}set offsets(t){!!(this.data&1<<cu)!==t&&(this.data^=1<<cu)}get culling(){return!!(this.data&1<<du)}set culling(t){!!(this.data&1<<du)!==t&&(this.data^=1<<du)}get depthTest(){return!!(this.data&1<<fu)}set depthTest(t){!!(this.data&1<<fu)!==t&&(this.data^=1<<fu)}get depthMask(){return!!(this.data&1<<gu)}set depthMask(t){!!(this.data&1<<gu)!==t&&(this.data^=1<<gu)}get clockwiseFrontFace(){return!!(this.data&1<<pu)}set clockwiseFrontFace(t){!!(this.data&1<<pu)!==t&&(this.data^=1<<pu)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==fe.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new v0;return t.depthTest=!1,t.blend=!0,t}};Zs.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const pc=[];function y0(r,t){if(!r)return null;let e="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=pc.length-1;i>=0;--i){const s=pc[i];if(s.test&&s.test(r,e))return new s(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Rr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,n,o,h,d){if(arguments.length>8)throw new Error("max arguments reached");const{name:p,items:m}=this;this._aliasCount++;for(let v=0,b=m.length;v<b;v++)m[v][p](t,e,i,s,n,o,h,d);return m===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Rr.prototype,{dispatch:{value:Rr.prototype.emit},run:{value:Rr.prototype.emit}});class mo{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Rr("setRealSize"),this.onUpdate=new Rr("update"),this.onError=new Rr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class _h extends mo{constructor(t,e){const{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ar.UNPACK);const n=e.realWidth,o=e.realHeight;return i.width===n&&i.height===o?s.texSubImage2D(e.target,0,0,0,n,o,e.format,i.type,this.data):(i.width=n,i.height=o,s.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const B1={scaleMode:cs.NEAREST,alphaMode:ar.NPM},gc=class ia extends yo{constructor(t=null,e=null){super(),e=Object.assign({},ia.defaultOptions,e);const{alphaMode:i,mipmap:s,anisotropicLevel:n,scaleMode:o,width:h,height:d,wrapMode:p,format:m,type:v,target:b,resolution:y,resourceOptions:P}=e;t&&!(t instanceof mo)&&(t=y0(t,P),t.internal=!0),this.resolution=y||qt.RESOLUTION,this.width=Math.round((h||0)*this.resolution)/this.resolution,this.height=Math.round((d||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=p,this._scaleMode=o,this.format=m,this.type=v,this.target=b,this.alphaMode=i,this.uid=Dn(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=h>0&&d>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=gp(this.realWidth)&&gp(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Is[this.cacheId],delete zr[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),ia.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=qt.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else{if(!t._pixiId){const h=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${Dn()}`}n=t._pixiId}let o=Is[n];if(s&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new ia(t,e),o.cacheId=n,ia.addToCache(o,n)),o}static fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);const n=new _h(t,{width:e,height:i,...s==null?void 0:s.resourceOptions});let o,h;return t instanceof Float32Array?(o=Ft.RGBA,h=oe.FLOAT):t instanceof Int32Array?(o=Ft.RGBA_INTEGER,h=oe.INT):t instanceof Uint32Array?(o=Ft.RGBA_INTEGER,h=oe.UNSIGNED_INT):t instanceof Int16Array?(o=Ft.RGBA_INTEGER,h=oe.SHORT):t instanceof Uint16Array?(o=Ft.RGBA_INTEGER,h=oe.UNSIGNED_SHORT):t instanceof Int8Array?(o=Ft.RGBA,h=oe.BYTE):(o=Ft.RGBA,h=oe.UNSIGNED_BYTE),n.internal=!0,new ia(n,Object.assign({},B1,{type:h,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Is[e]&&Is[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Is[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Is[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete Is[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Is[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};gc.defaultOptions={mipmap:ts.POW2,anisotropicLevel:0,scaleMode:cs.LINEAR,wrapMode:Xs.CLAMP,alphaMode:ar.UNPACK,target:da.TEXTURE_2D,format:Ft.RGBA,type:oe.UNSIGNED_BYTE},gc._globalBatch=0;let Se=gc;class mc{constructor(){this.texArray=null,this.blend=0,this.type=Zr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let L1=0;class wi{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=L1++,this.disposeRunner=new Rr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Qr.ELEMENT_ARRAY_BUFFER:Qr.ARRAY_BUFFER}get index(){return this.type===Qr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new wi(t)}}class Yl{constructor(t,e=0,i=!1,s=oe.FLOAT,n,o,h,d=1){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=n,this.start=o,this.instance=h,this.divisor=d}destroy(){this.buffer=null}static from(t,e,i,s,n){return new Yl(t,e,i,s,n)}}const D1={Float32Array,Uint32Array,Int32Array,Uint8Array};function F1(r,t){let e=0,i=0;const s={};for(let d=0;d<r.length;d++)i+=t[d],e+=r[d].length;const n=new ArrayBuffer(e*4);let o=null,h=0;for(let d=0;d<r.length;d++){const p=t[d],m=r[d],v=_0(m);s[v]||(s[v]=new D1[v](n)),o=s[v];for(let b=0;b<m.length;b++){const y=(b/p|0)*i+h,P=b%p;o[y+P]=m[b]}h+=p}return new Float32Array(n)}const wp={5126:4,5123:2,5121:1};let O1=0;const N1={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class $s{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=O1++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Rr("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,n,o,h,d=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof wi||(e instanceof Array&&(e=new Float32Array(e)),e=new wi(e));const p=t.split("|");if(p.length>1){for(let v=0;v<p.length;v++)this.addAttribute(p[v],e,i,s,n);return this}let m=this.buffers.indexOf(e);return m===-1&&(this.buffers.push(e),m=this.buffers.length-1),this.attributes[t]=new Yl(m,i,s,n,o,h,d),this.instanced=this.instanced||d,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof wi||(t instanceof Array&&(t=new Uint16Array(t)),t=new wi(t)),t.type=Qr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new wi;let s;for(s in this.attributes){const n=this.attributes[s],o=this.buffers[n.buffer];t.push(o.data),e.push(n.size*wp[n.type]/4),n.buffer=0}for(i.data=F1(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new $s;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new wi(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new Yl(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Qr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new $s,i=[],s=[],n=[];let o;for(let h=0;h<t.length;h++){o=t[h];for(let d=0;d<o.buffers.length;d++)s[d]=s[d]||0,s[d]+=o.buffers[d].data.length,n[d]=0}for(let h=0;h<o.buffers.length;h++)i[h]=new N1[_0(o.buffers[h].data)](s[h]),e.buffers[h]=new wi(i[h]);for(let h=0;h<t.length;h++){o=t[h];for(let d=0;d<o.buffers.length;d++)i[d].set(o.buffers[d].data,n[d]),n[d]+=o.buffers[d].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.type=Qr.ELEMENT_ARRAY_BUFFER;let h=0,d=0,p=0,m=0;for(let v=0;v<o.buffers.length;v++)if(o.buffers[v]!==o.indexBuffer){m=v;break}for(const v in o.attributes){const b=o.attributes[v];(b.buffer|0)===m&&(d+=b.size*wp[b.type]/4)}for(let v=0;v<t.length;v++){const b=t[v].indexBuffer.data;for(let y=0;y<b.length;y++)e.indexBuffer.data[y+p]+=h;h+=t[v].buffers[m].data.length/d,p+=b.length}}return e}}class x0 extends $s{constructor(t=!1){super(),this._buffer=new wi(null,t,!1),this._indexBuffer=new wi(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,oe.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,oe.FLOAT).addAttribute("aColor",this._buffer,4,!0,oe.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,oe.FLOAT).addIndex(this._indexBuffer)}}const ql=Math.PI*2,U1=180/Math.PI,z1=Math.PI/180;var Xi=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(Xi||{});let Ue=class b0{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new b0(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}};Ue.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const jo=[new Ue,new Ue,new Ue,new Ue];class Pe{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=Xi.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Pe(0,0,0,0)}clone(){return new Pe(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const ct=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=ct)return!1;const pt=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>pt}const i=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=i||o<=n)return!1;const h=jo[0].set(t.left,t.top),d=jo[1].set(t.left,t.bottom),p=jo[2].set(t.right,t.top),m=jo[3].set(t.right,t.bottom);if(p.x<=h.x||d.y<=h.y)return!1;const v=Math.sign(e.a*e.d-e.b*e.c);if(v===0||(e.apply(h,h),e.apply(d,d),e.apply(p,p),e.apply(m,m),Math.max(h.x,d.x,p.x,m.x)<=i||Math.min(h.x,d.x,p.x,m.x)>=s||Math.max(h.y,d.y,p.y,m.y)<=n||Math.min(h.y,d.y,p.y,m.y)>=o))return!1;const b=v*(d.y-h.y),y=v*(h.x-d.x),P=b*i+y*n,M=b*s+y*n,z=b*i+y*o,q=b*s+y*o;if(Math.max(P,M,z,q)<=b*h.x+y*h.y||Math.min(P,M,z,q)>=b*m.x+y*m.y)return!1;const V=v*(h.y-p.y),I=v*(p.x-h.x),Y=V*i+I*n,K=V*s+I*n,T=V*i+I*o,at=V*s+I*o;return!(Math.max(Y,K,T,at)<=V*h.x+I*h.y||Math.min(Y,K,T,at)>=V*m.x+I*m.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=n-s,this}}Pe.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class vh{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=Xi.CIRC}clone(){return new vh(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let s=this.x-t,n=this.y-e;return s*=s,n*=n,s+n<=i}getBounds(){return new Pe(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}vh.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};let w0=class S0{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=Xi.ELIP}clone(){return new S0(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new Pe(this.x-this.width,this.y-this.height,this.width,this.height)}};w0.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Rn{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let s=0,n=e.length;s<n;s++)i.push(e[s].x,e[s].y);e=i}this.points=e,this.type=Xi.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Rn(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){const h=this.points[n*2],d=this.points[n*2+1],p=this.points[o*2],m=this.points[o*2+1];d>e!=m>e&&t<(p-h)*((e-d)/(m-d))+h&&(i=!i)}return i}}Rn.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,t)=>`${r}, ${t}`,"")}]`};class yh{constructor(t=0,e=0,i=0,s=0,n=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=n,this.type=Xi.RREC}clone(){return new yh(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),n=e-(this.y+i);const o=i*i;if(s*s+n*n<=o||(s=t-(this.x+this.width-i),s*s+n*n<=o)||(n=e-(this.y+this.height-i),s*s+n*n<=o)||(s=t-(this.x+i),s*s+n*n<=o))return!0}return!1}}yh.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};let gi=class Pl{constructor(t=1,e=0,i=0,s=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,n,o){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new Ue;const i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Ue;const i=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*i*s+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*n+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.c,o=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}setTransform(t,e,i,s,n,o,h,d,p){return this.a=Math.cos(h+p)*n,this.b=Math.sin(h+p)*n,this.c=-Math.sin(h-d)*o,this.d=Math.cos(h-d)*o,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,s=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,s=this.c,n=this.d,o=t.pivot,h=-Math.atan2(-s,n),d=Math.atan2(i,e),p=Math.abs(h+d);return p<1e-5||Math.abs(ql-p)<1e-5?(t.rotation=d,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=d),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(o.x*e+o.y*s),t.position.y=this.ty+(o.x*i+o.y*n),t}invert(){const t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,o=t*s-e*i;return this.a=s/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-s*n)/o,this.ty=-(t*this.ty-e*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Pl;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Pl}static get TEMP_MATRIX(){return new Pl}};gi.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const vn=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],yn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],xn=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],bn=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],_c=[],C0=[],$o=Math.sign;function G1(){for(let r=0;r<16;r++){const t=[];_c.push(t);for(let e=0;e<16;e++){const i=$o(vn[r]*vn[e]+xn[r]*yn[e]),s=$o(yn[r]*vn[e]+bn[r]*yn[e]),n=$o(vn[r]*xn[e]+xn[r]*bn[e]),o=$o(yn[r]*xn[e]+bn[r]*bn[e]);for(let h=0;h<16;h++)if(vn[h]===i&&yn[h]===s&&xn[h]===n&&bn[h]===o){t.push(h);break}}}for(let r=0;r<16;r++){const t=new gi;t.set(vn[r],yn[r],xn[r],bn[r],0,0),C0.push(t)}}G1();const ai={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>vn[r],uY:r=>yn[r],vX:r=>xn[r],vY:r=>bn[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>_c[r][t],sub:(r,t)=>_c[r][ai.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?ai.S:ai.N:Math.abs(t)*2<=Math.abs(r)?r>0?ai.E:ai.W:t>0?r>0?ai.SE:ai.SW:r>0?ai.NE:ai.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{const s=C0[ai.inv(t)];s.tx=e,s.ty=i,r.append(s)}};class fs{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new fs(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}fs.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const vc=class{constructor(){this.worldTransform=new gi,this.localTransform=new gi,this.position=new fs(this.onChange,this,0,0),this.scale=new fs(this.onChange,this,1,1),this.pivot=new fs(this.onChange,this,0,0),this.skew=new fs(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};vc.IDENTITY=new vc;let gd=vc;gd.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var V1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,H1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Sp(r,t,e){const i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function mu(r){const t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function E0(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return mu(2*t);case"bvec3":return mu(3*t);case"bvec4":return mu(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ma=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,t)=>r.type==="vec3"&&r.size===1&&!r.isArray&&t.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],W1={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},X1={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function j1(r,t){var i;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const s in r.uniforms){const n=t[s];if(!n){((i=r.uniforms[s])==null?void 0:i.group)===!0&&(r.uniforms[s].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}const o=r.uniforms[s];let h=!1;for(let d=0;d<ma.length;d++)if(ma[d].test(n,o)){e.push(ma[d].code(s,o)),h=!0;break}if(!h){const d=(n.size===1&&!n.isArray?W1:X1)[n.type].replace("location",`ud["${s}"].location`);e.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${d};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const P0={};let qn=P0;function $1(){if(qn===P0||qn!=null&&qn.isContextLost()){const r=qt.ADAPTER.createCanvas();let t;qt.PREFER_ENV>=Nn.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),qn=t}return qn}let Yo;function Y1(){if(!Yo){Yo=mr.MEDIUM;const r=$1();if(r&&r.getShaderPrecisionFormat){const t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);t&&(Yo=t.precision?mr.HIGH:mr.MEDIUM)}}return Yo}function Cp(r,t){const e=r.getShaderSource(t).split(`
`).map((p,m)=>`${m}: ${p}`),i=r.getShaderInfoLog(t),s=i.split(`
`),n={},o=s.map(p=>parseFloat(p.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(p=>p&&!n[p]?(n[p]=!0,!0):!1),h=[""];o.forEach(p=>{e[p-1]=`%c${e[p-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const d=e.join(`
`);h[0]=d,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function q1(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||Cp(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||Cp(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}const Z1={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function T0(r){return Z1[r]}let qo=null;const Ep={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function I0(r,t){if(!qo){const e=Object.keys(Ep);qo={};for(let i=0;i<e.length;++i){const s=e[i];qo[r[s]]=Ep[s]}}return qo[t]}function Pp(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===mr.HIGH&&e!==mr.HIGH&&(i=mr.MEDIUM),`precision ${i} float;
${r}`}else if(e!==mr.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}let Wa;function K1(){if(typeof Wa=="boolean")return Wa;try{Wa=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Wa=!1}return Wa}let Q1=0;const Zo={},yc=class ra{constructor(t,e,i="pixi-shader",s={}){this.extra={},this.id=Q1++,this.vertexSrc=t||ra.defaultVertexSrc,this.fragmentSrc=e||ra.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Zo[i]?(Zo[i]++,i+=`-${Zo[i]}`):Zo[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Pp(this.vertexSrc,ra.defaultVertexPrecision,mr.HIGH),this.fragmentSrc=Pp(this.fragmentSrc,ra.defaultFragmentPrecision,Y1())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return H1}static get defaultFragmentSrc(){return V1}static from(t,e,i){const s=t+e;let n=vp[s];return n||(vp[s]=n=new ra(t,e,i)),n}};yc.defaultVertexPrecision=mr.HIGH,yc.defaultFragmentPrecision=ds.apple.device?mr.HIGH:mr.MEDIUM;let ps=yc,J1=0;class Br{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=J1++,this.static=!!e,this.ubo=!!i,t instanceof wi?(this.buffer=t,this.buffer.type=Qr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new wi(new Float32Array(1)),this.buffer.type=Qr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new Br(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new Br(t,e,i)}static uboFrom(t,e){return new Br(t,e??!0,!0)}}class Jr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Br?this.uniformGroup=e:this.uniformGroup=new Br(e):this.uniformGroup=new Br({}),this.disposeRunner=new Rr("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const s=e.uniforms[i];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const s=ps.from(t,e);return new Jr(s,i)}}class tb{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=n;this.defaultGroupCache[t]=Br.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ps(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new gi,default:this.defaultGroupCache[t]};return new Jr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class xc{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function eb(){return!ds.apple.device}function ib(r){let t=!0;const e=qt.ADAPTER.getNavigator();if(ds.tablet||ds.phone){if(ds.apple.device){const i=e.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(t=!1)}if(ds.android.device){const i=e.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(t=!1)}}return t?r:4}class xh{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var rb=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,sb=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const qa=class Er extends xh{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=x0,this.vertexSize=6,this.state=Zs.for2d(),this.size=Er.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??ib(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??eb(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Be("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return sb}static get defaultFragmentTemplate(){return rb}setShaderGenerator({vertex:t=Er.defaultVertexSrc,fragment:e=Er.defaultFragmentTemplate}={}){this.shaderGenerator=new tb(t,e)}contextChange(){const t=this.renderer.gl;qt.PREFER_ENV===Nn.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Er.defaultMaxTextures),this.maxTextures=R1(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Er,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new mc);for(;e.length<s;)e.push(new xc);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,i=Er._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let h=++Se._globalBatch,d=0,p=i[0],m=0;s.copyBoundTextures(n,e);for(let v=0;v<this._bufferSize;++v){const b=t[v];t[v]=null,b._batchEnabled!==h&&(p.count>=e&&(s.boundArray(p,n,h,e),this.buildDrawCalls(p,m,v),m=v,p=i[++d],++h),b._batchEnabled=h,b.touched=o,p.elements[p.count++]=b)}p.count>0&&(s.boundArray(p,n,h,e),this.buildDrawCalls(p,m,this._bufferSize),++d,++h);for(let v=0;v<n.length;v++)n[v]=null;Se._globalBatch=h}buildDrawCalls(t,e,i){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:h}=this,d=Er._drawCallPool;let p=this._dcIndex,m=this._aIndex,v=this._iIndex,b=d[p];b.start=this._iIndex,b.texArray=t;for(let y=e;y<i;++y){const P=s[y],M=P._texture.baseTexture,z=g0[M.alphaMode?1:0][P.blendMode];s[y]=null,e<y&&b.blend!==z&&(b.size=v-b.start,e=y,b=d[++p],b.texArray=t,b.start=v),this.packInterleavedGeometry(P,n,o,m,v),m+=P.vertexData.length/2*h,v+=P.indices.length,b.blend=z}e<i&&(b.size=v-b.start,++p),this._dcIndex=p,this._aIndex=m,this._iIndex=v}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Er.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,s=Er._drawCallPool;let n=null;for(let o=0;o<t;o++){const{texArray:h,type:d,size:p,start:m,blend:v}=s[o];n!==h&&(n=h,this.bindAndClearTexArray(h)),this.state.blendMode=v,i.set(this.state),e.drawElements(d,p,e.UNSIGNED_SHORT,m*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Er.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=$l(Math.ceil(t/8)),i=mp(e),s=e*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new fc(s*this.vertexSize*4)),n}getIndexBuffer(t){const e=$l(Math.ceil(t/12)),i=mp(e),s=e*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,i,s,n){const{uint32View:o,float32View:h}=e,d=s/this.vertexSize,p=t.uvs,m=t.indices,v=t.vertexData,b=t._texture.baseTexture._batchLocation,y=Math.min(t.worldAlpha,1),P=Je.shared.setValue(t._tintRGB).toPremultiplied(y,t._texture.baseTexture.alphaMode>0);for(let M=0;M<v.length;M+=2)h[s++]=v[M],h[s++]=v[M+1],h[s++]=p[M],h[s++]=p[M+1],o[s++]=P,h[s++]=b;for(let M=0;M<m.length;M++)i[n++]=d+m[M]}};qa.defaultBatchSize=4096,qa.extension={name:"batch",type:Xt.RendererPlugin},qa._drawCallPool=[],qa._textureArrayPool=[];let wn=qa;te.add(wn);var nb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,ab=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const bc=class Za extends Jr{constructor(t,e,i){const s=ps.from(t||Za.defaultVertexSrc,e||Za.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=Za.defaultResolution,this.multisample=Za.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Zs}apply(t,e,i,s,n){t.applyFilter(this,e,i,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return ab}static get defaultFragmentSrc(){return nb}};bc.defaultResolution=1,bc.defaultMultisample=Pi.NONE;let tr=bc;class Zl{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Je(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:i,backgroundAlpha:s}=t,n=i??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Zl.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Zl.extension={type:[Xt.RendererSystem,Xt.CanvasRendererSystem],name:"background"};te.add(Zl);class A0{constructor(t){this.renderer=t,this.emptyRenderer=new xh(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){const{elements:n,ids:o,count:h}=t;let d=0;for(let p=0;p<h;p++){const m=n[p],v=m._batchLocation;if(v>=0&&v<s&&e[v]===m){o[p]=v;continue}for(;d<s;){const b=e[d];if(b&&b._batchEnabled===i&&b._batchLocation===d){d++;continue}o[p]=d,m._batchLocation=d,e[d]=m;break}}}destroy(){this.renderer=null}}A0.extension={type:Xt.RendererSystem,name:"batch"};te.add(A0);let Tp=0;class Kl{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Tp++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Tp++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(qt.PREFER_ENV>=Nn.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Kl.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Kl.extension={type:Xt.RendererSystem,name:"context"};te.add(Kl);class wc{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Rr("disposeFramebuffer"),this.multisample=Pi.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Se(null,{scaleMode:cs.NEAREST,resolution:1,mipmap:ts.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Se(null,{scaleMode:cs.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ts.OFF,format:Ft.DEPTH_COMPONENT,type:oe.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class M0 extends Se{constructor(t={}){if(typeof t=="number"){const e=arguments[0],i=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:i,scaleMode:s,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Pi.NONE),super(null,t),this.mipmap=ts.OFF,this.valid=!0,this._clear=new Je([0,0,0,0]),this.framebuffer=new wc(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class ys extends mo{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,s=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(i,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=A1(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,s){const n=t.gl,o=e.realWidth,h=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ar.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&i.width===o&&i.height===h?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,i.type,s):(i.width=o,i.height=h,n.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class k0 extends ys{constructor(t,e){if(e=e||{},typeof t=="string"){const i=new Image;ys.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??qt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ar.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let s=!0;const n=e._glTextures;for(const o in n){const h=n[o];if(h!==i&&h.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class md{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const s=e.width,n=e.height;if(i){const o=t.width/2/s,h=t.height/2/n,d=t.x/s+o,p=t.y/n+h;i=ai.add(i,ai.NW),this.x0=d+o*ai.uX(i),this.y0=p+h*ai.uY(i),i=ai.add(i,2),this.x1=d+o*ai.uX(i),this.y1=p+h*ai.uY(i),i=ai.add(i,2),this.x2=d+o*ai.uX(i),this.y2=p+h*ai.uY(i),i=ai.add(i,2),this.x3=d+o*ai.uX(i),this.y3=p+h*ai.uY(i)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}md.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Ip=new md;function Ko(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class Jt extends yo{constructor(t,e,i,s,n,o,h){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Pe(0,0,1,1)),t instanceof Jt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=Ip,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new Ue(o.x,o.y):new Ue(0,0),this.defaultBorders=h,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&zr[e.url]&&Jt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Jt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var s;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Jt(this.baseTexture,!this.noFrame&&t,e,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Ip&&(this._uvs=new md),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=qt.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else if(t instanceof Se){if(!t.cacheId){const h=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${h}-${Dn()}`,Se.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const h=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${Dn()}`}n=t._pixiId}let o=zr[n];if(s&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(t instanceof Se)?(e.resolution||(e.resolution=vs(t)),o=new Jt(new Se(t,e)),o.baseTexture.cacheId=n,Se.addToCache(o.baseTexture,n),Jt.addToCache(o,n)):!o&&t instanceof Se&&(o=new Jt(t),Jt.addToCache(o,n)),o}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),s=Jt.from(t,Object.assign({resourceOptions:i},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,i,s){return new Jt(Se.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){const n=new Se(t,Object.assign({scaleMode:Se.defaultOptions.scaleMode,resolution:vs(e)},s)),{resource:o}=n;o instanceof k0&&(o.url=e);const h=new Jt(n);return i||(i=e),Se.addToCache(h.baseTexture,i),Jt.addToCache(h,i),i!==e&&(Se.addToCache(h.baseTexture,e),Jt.addToCache(h,e)),h.baseTexture.valid?Promise.resolve(h):new Promise(d=>{h.baseTexture.once("loaded",()=>d(h))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),zr[e]&&zr[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),zr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=zr[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete zr[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)zr[t.textureCacheIds[e]]===t&&delete zr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:s,height:n}=t,o=e+s>this.baseTexture.width,h=i+n>this.baseTexture.height;if(o||h){const d=o&&h?"and":"or",p=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,m=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${p} ${d} ${m}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Jt._EMPTY||(Jt._EMPTY=new Jt(new Se),Ko(Jt._EMPTY),Ko(Jt._EMPTY.baseTexture)),Jt._EMPTY}static get WHITE(){if(!Jt._WHITE){const t=qt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Jt._WHITE=new Jt(Se.from(t)),Ko(Jt._WHITE),Ko(Jt._WHITE.baseTexture)}return Jt._WHITE}}class Ks extends Jt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,o=Math.round(e*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ks(new M0(t))}}class R0{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=Pi.NONE){const s=new M0(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Ks(s)}getOptimalTexture(t,e,i=1,s=Pi.NONE){let n;t=Math.max(Math.ceil(t*i-1e-6),1),e=Math.max(Math.ceil(e*i-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=$l(t),e=$l(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(t,e,s)),o.filterPoolKey=n,o.setResolution(i),o}getFilterTexture(t,e,i){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||Pi.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}R0.SCREEN_KEY=-1;class ob extends $s{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class B0 extends $s{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new wi(this.vertices),this.uvBuffer=new wi(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class lb{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Pi.NONE,this.sourceFrame=new Pe,this.destinationFrame=new Pe,this.bindingSourceFrame=new Pe,this.bindingDestinationFrame=new Pe,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Qo=[new Ue,new Ue,new Ue,new Ue],_u=new gi;class L0{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new R0,this.statePool=[],this.quad=new ob,this.quadUv=new B0,this.tempRect=new Pe,this.activeState={},this.globalUniforms=new Br({outputFrame:new Pe,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new lb,o=i.renderTexture;let h,d;if(o.current){const z=o.current;h=z.resolution,d=z.multisample}else h=i.resolution,d=i.multisample;let p=e[0].resolution||h,m=e[0].multisample??d,v=e[0].padding,b=e[0].autoFit,y=e[0].legacy??!0;for(let z=1;z<e.length;z++){const q=e[z];p=Math.min(p,q.resolution||h),m=Math.min(m,q.multisample??d),v=this.useMaxPadding?Math.max(v,q.padding):v+q.padding,b=b&&q.autoFit,y=y||(q.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=p,n.multisample=m,n.legacy=y,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(v);const P=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(_u.copyFrom(i.projection.transform).invert(),P),b?(n.sourceFrame.fit(P),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(P)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,p,m),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const M=this.tempRect;M.x=0,M.y=0,M.width=n.sourceFrame.width,M.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,M),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const n=s.inputSize,o=s.inputPixel,h=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*e.resolution),o[1]=Math.round(n[1]*e.resolution),o[2]=1/o[0],o[3]=1/o[1],h[0]=.5*o[2],h[1]=.5*o[3],h[2]=e.sourceFrame.width*n[2]-.5*o[2],h[3]=e.sourceFrame.height*n[3]-.5*o[3],e.legacy){const p=s.filterArea;p[0]=e.destinationFrame.width,p[1]=e.destinationFrame.height,p[2]=e.sourceFrame.x,p[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const d=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,d.renderTexture,$r.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let p=e.renderTexture,m=this.getOptimalFilterTexture(p.width,p.height,e.resolution);m.filterFrame=p.filterFrame;let v=0;for(v=0;v<i.length-1;++v){v===1&&e.multisample>1&&(m=this.getOptimalFilterTexture(p.width,p.height,e.resolution),m.filterFrame=p.filterFrame),i[v].apply(this,p,m,$r.CLEAR,e);const b=p;p=m,m=b}i[v].apply(this,p,d.renderTexture,$r.BLEND,e),v>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(p),this.returnFilterTexture(m)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=$r.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=t.filterFrame.width,o.height=t.filterFrame.height,i.bind(t,t.filterFrame,o)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(e===$r.CLEAR||e===$r.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Zr.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Zr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:n}=e._texture,o=t.set(s.width,0,0,s.height,i.x,i.y),h=e.worldTransform.copyTo(gi.TEMP_MATRIX);return h.invert(),o.prepend(h),o.scale(1/n.width,1/n.height),o.translate(e.anchor.x,e.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=Pi.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||Pi.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=Qo[0],s=Qo[1],n=Qo[2],o=Qo[3];i.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),o.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(n,n),t.apply(o,o);const h=Math.min(i.x,s.x,n.x,o.x),d=Math.min(i.y,s.y,n.y,o.y),p=Math.max(i.x,s.x,n.x,o.x),m=Math.max(i.y,s.y,n.y,o.y);e.x=h,e.y=d,e.width=p-h,e.height=m-d}roundFrame(t,e,i,s,n){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(n){const{a:o,b:h,c:d,d:p}=n;if((Math.abs(h)>1e-4||Math.abs(d)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(p)>1e-4))return}n=n?_u.copyFrom(n):_u.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}L0.extension={type:Xt.RendererSystem,name:"filter"};te.add(L0);class hb{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Pi.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const ub=new Pe;class D0{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new wc(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Pe,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;qt.PREFER_ENV===Nn.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=i),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let o=0;o<t.colorTextures.length;o++){const h=t.colorTextures[o];this.renderer.texture.unbind(h.parentTextureArray||h)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const o=e.width>>i,h=e.height>>i,d=o/e.width;this.setViewport(e.x*d,e.y*d,o,h)}else{const o=t.width>>i,h=t.height>>i;this.setViewport(0,0,o,h)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){const n=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),(n.width!==i||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=i,n.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,n=Yu.COLOR|Yu.DEPTH){const{gl:o}=this;o.clearColor(t,e,i,s),o.clear(n)}initFramebuffer(t){const{gl:e}=this,i=new hb(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];if(i.stencil){e.bindRenderbuffer(e.RENDERBUFFER,i.stencil);let o;this.renderer.context.webGLVersion===1?o=e.DEPTH_STENCIL:t.depth&&t.stencil?o=e.DEPTH24_STENCIL8:t.depth?o=e.DEPTH_COMPONENT24:o=e.STENCIL_INDEX8,i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,o,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,o,t.width,t.height)}const s=t.colorTextures;let n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const h=s[o],d=h.parentTextureArray||h;this.renderer.texture.bind(d,0),o===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let o=n.length;i.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const h=[];for(let d=0;d<o;d++){const p=n[d],m=p.parentTextureArray||p;this.renderer.texture.bind(m,0),d===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,m._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+d,p.target,m._glTextures[this.CONTEXT_UID].texture,e),h.push(i.COLOR_ATTACHMENT0+d))}if(h.length>1&&i.drawBuffers(h),t.depthTexture&&this.writeDepthTexture){const d=t.depthTexture;this.renderer.texture.bind(d,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();let d,p;this.renderer.context.webGLVersion===1?(d=i.DEPTH_STENCIL_ATTACHMENT,p=i.DEPTH_STENCIL):t.depth&&t.stencil?(d=i.DEPTH_STENCIL_ATTACHMENT,p=i.DEPTH24_STENCIL8):t.depth?(d=i.DEPTH_ATTACHMENT,p=i.DEPTH_COMPONENT24):(d=i.STENCIL_ATTACHMENT,p=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,p,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,p,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,d,i.RENDERBUFFER,s.stencil)}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=Pi.NONE;if(t<=1||e===null)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return i===1&&(i=Pi.NONE),i}blit(t,e,i){const{current:s,renderer:n,gl:o,CONTEXT_UID:h}=this;if(n.context.webGLVersion!==2||!s)return;const d=s.glFramebuffers[h];if(!d)return;if(!t){if(!d.msaaBuffer)return;const m=s.colorTextures[0];if(!m)return;d.blitFramebuffer||(d.blitFramebuffer=new wc(s.width,s.height),d.blitFramebuffer.addColorTexture(0,m)),t=d.blitFramebuffer,t.colorTextures[0]!==m&&(t.colorTextures[0]=m,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=ub,e.width=s.width,e.height=s.height),i||(i=e);const p=e.width===i.width&&e.height===i.height;this.bind(t),o.bindFramebuffer(o.READ_FRAMEBUFFER,d.framebuffer),o.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,p?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const i=t.width,s=t.height,n=this.gl,o=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);let h,d;this.renderer.context.webGLVersion===1?(h=n.DEPTH_STENCIL_ATTACHMENT,d=n.DEPTH_STENCIL):t.depth?(h=n.DEPTH_STENCIL_ATTACHMENT,d=n.DEPTH24_STENCIL8):(h=n.STENCIL_ATTACHMENT,d=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,d,i,s):n.renderbufferStorage(n.RENDERBUFFER,d,i,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,h,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Pe}destroy(){this.renderer=null}}D0.extension={type:Xt.RendererSystem,name:"framebuffer"};te.add(D0);const vu={5126:4,5123:2,5121:1};class F0{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;qt.PREFER_ENV===Nn.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=s=>i.bindVertexArrayOES(s),t.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(s,n)=>i.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,o,h,d)=>i.drawElementsInstancedANGLE(s,n,o,h,d),t.drawArraysInstanced=(s,n,o,h)=>i.drawArraysInstancedANGLE(s,n,o,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const o=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];e.update(s)}}checkCompatibility(t,e){const i=t.attributes,s=e.attributeData;for(const n in s)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const i=t.attributes,s=e.attributeData,n=["g",t.id];for(const o in i)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(t,e,i=!0){const s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,h=e.program;h.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,h);const d=this.getSignature(t,h),p=t.glVertexArrayObjects[this.CONTEXT_UID];let m=p[d];if(m)return p[h.id]=m,m;const v=t.buffers,b=t.attributes,y={},P={};for(const M in v)y[M]=0,P[M]=0;for(const M in b)!b[M].size&&h.attributeData[M]?b[M].size=h.attributeData[M].size:b[M].size||console.warn(`PIXI Geometry attribute '${M}' size cannot be determined (likely the bound shader does not have the attribute)`),y[b[M].buffer]+=b[M].size*vu[b[M].type];for(const M in b){const z=b[M],q=z.size;z.stride===void 0&&(y[z.buffer]===q*vu[z.type]?z.stride=0:z.stride=y[z.buffer]),z.start===void 0&&(z.start=P[z.buffer],P[z.buffer]+=q*vu[z.type])}m=s.createVertexArray(),s.bindVertexArray(m);for(let M=0;M<v.length;M++){const z=v[M];o.bind(z),i&&z._glBuffers[n].refCount++}return this.activateVao(t,h),p[h.id]=m,p[d]=m,s.bindVertexArray(null),o.unbind(Qr.ARRAY_BUFFER),m}disposeGeometry(t,e){var h;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,o=(h=this.renderer)==null?void 0:h.buffer;if(t.disposeRunner.remove(this),!!i){if(o)for(let d=0;d<n.length;d++){const p=n[d]._glBuffers[this.CONTEXT_UID];p&&(p.refCount--,p.refCount===0&&!e&&o.dispose(n[d],e))}if(!e){for(const d in i)if(d[0]==="g"){const p=i[d];this._activeVao===p&&this.unbind(),s.deleteVertexArray(p)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=t.buffers,h=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let d=null;for(const p in h){const m=h[p],v=o[m.buffer],b=v._glBuffers[s];if(e.attributeData[p]){d!==b&&(n.bind(v),d=b);const y=e.attributeData[p].location;if(i.enableVertexAttribArray(y),i.vertexAttribPointer(y,m.size,m.type||i.FLOAT,m.normalized,m.stride,m.start),m.instance)if(this.hasInstance)i.vertexAttribDivisor(y,m.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,s){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const h=o.indexBuffer.data.BYTES_PER_ELEMENT,d=h===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(t,e||o.indexBuffer.data.length,d,(i||0)*h,s||1):n.drawElements(t,e||o.indexBuffer.data.length,d,(i||0)*h):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(t,i,e||o.getSize(),s||1):n.drawArrays(t,i,e||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}F0.extension={type:Xt.RendererSystem,name:"geometry"};te.add(F0);const Ap=new gi;class O0{constructor(t,e){this._texture=t,this.mapCoord=new gi,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],o=t[s+1];e[s]=n*i.a+o*i.c+i.tx,e[s+1]=n*i.b+o*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=e.orig,n=e.trim;n&&(Ap.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Ap));const o=e.baseTexture,h=this.uClampFrame,d=this.clampMargin/o.resolution,p=this.clampOffset;return h[0]=(e._frame.x+d+p)/o.width,h[1]=(e._frame.y+d+p)/o.height,h[2]=(e._frame.x+e._frame.width-d+p)/o.width,h[3]=(e._frame.y+e._frame.height-d+p)/o.height,this.uClampOffset[0]=p/o.realWidth,this.uClampOffset[1]=p/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0}}var cb=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,db=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class fb extends tr{constructor(t,e,i){let s=null;typeof t!="string"&&e===void 0&&i===void 0&&(s=t,t=void 0,e=void 0,i=void 0),super(t||db,e||cb,i),this.maskSprite=s,this.maskMatrix=new gi}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){const n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new O0(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}}class pb{constructor(t=null){this.type=ki.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=tr.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ki.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class N0{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const n=this.maskDataPool.pop()||new pb;n.pooled=!0,n.maskObject=e,i=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==ki.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case ki.SCISSOR:this.renderer.scissor.push(i);break;case ki.STENCIL:this.renderer.stencil.push(i);break;case ki.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case ki.COLOR:this.pushColorMask(i);break}i.type===ki.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case ki.SCISSOR:this.renderer.scissor.pop(e);break;case ki.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case ki.SPRITE:this.popSpriteMask(e);break;case ki.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===ki.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=ki.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ki.SCISSOR:t.type=ki.STENCIL:t.type=ki.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new fb])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;const n=i.filterArea;i.filterArea=e.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}N0.extension={type:Xt.RendererSystem,name:"mask"};te.add(N0);class U0{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==i&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Mp=new gi,kp=[],z0=class Tl extends U0{constructor(t){super(t),this.glConst=qt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,n=s.renderTexture,o=i.getBounds(!0,kp.pop()??new Pe);this.roundFrameToPixels(o,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&o.fit(e),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:s,d:n}=t;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Tl.isMatrixRotated(e.worldTransform)||Tl.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,s,n){Tl.isMatrixRotated(n)||(n=n?Mp.copyFrom(n):Mp.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&kp.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};z0.extension={type:Xt.RendererSystem,name:"scissor"};let gb=z0;te.add(gb);class G0 extends U0{constructor(t){super(t),this.glConst=qt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(i._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}G0.extension={type:Xt.RendererSystem,name:"stencil"};te.add(G0);class V0{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Be("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Be("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Be("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}V0.extension={type:[Xt.RendererSystem,Xt.CanvasRendererSystem],name:"_plugin"};te.add(V0);class H0{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new gi,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){const n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=o*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-o-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}H0.extension={type:Xt.RendererSystem,name:"projection"};te.add(H0);const mb=new gd,Rp=new Pe;class W0{constructor(t){this.renderer=t,this._tempMatrix=new gi}generateTexture(t,e){const{region:i,...s}=e||{},n=(i==null?void 0:i.copyTo(Rp))||t.getLocalBounds(Rp,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,s.multisample??(s.multisample=this.renderer.multisample);const h=Ks.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const d=t.transform;return t.transform=mb,this.renderer.render(t,{renderTexture:h,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=d,h}destroy(){}}W0.extension={type:[Xt.RendererSystem,Xt.CanvasRendererSystem],name:"textureGenerator"};te.add(W0);const cn=new Pe,Xa=new Pe;class X0{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Pe,this.destinationFrame=new Pe,this.viewportFrame=new Pe}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,i){const s=this.renderer;this.current=t;let n,o,h;t?(n=t.baseTexture,h=n.resolution,e||(cn.width=t.frame.width,cn.height=t.frame.height,e=cn),i||(Xa.x=t.frame.x,Xa.y=t.frame.y,Xa.width=e.width,Xa.height=e.height,i=Xa),o=n.framebuffer):(h=s.resolution,e||(cn.width=s._view.screen.width,cn.height=s._view.screen.height,e=cn),i||(i=cn,i.width=e.width,i.height=e.height));const d=this.viewportFrame;d.x=i.x*h,d.y=i.y*h,d.width=i.width*h,d.height=i.height*h,t||(d.y=s.view.height-(d.y+d.height)),d.ceil(),this.renderer.framebuffer.bind(o,d),this.renderer.projection.update(i,e,h,!o),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=Je.shared.setValue(t||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,h=n.width!==o.width||n.height!==o.height;if(h){let{x:d,y:p,width:m,height:v}=this.viewportFrame;d=Math.round(d),p=Math.round(p),m=Math.round(m),v=Math.round(v),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(d,p,m,v)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),h&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}X0.extension={type:Xt.RendererSystem,name:"renderTexture"};te.add(X0);class _b{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function vb(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const n=t.getActiveAttrib(r,s);if(n.name.startsWith("gl_"))continue;const o=I0(t,n.type),h={type:o,name:n.name,size:T0(o),location:t.getAttribLocation(r,n.name)};e[n.name]=h}return e}function yb(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const n=t.getActiveUniform(r,s),o=n.name.replace(/\[.*?\]$/,""),h=!!n.name.match(/\[.*?\]$/),d=I0(t,n.type);e[o]={name:o,index:s,type:d,size:n.size,isArray:h,value:E0(d,n.size)}}return e}function xb(r,t){var h;const e=Sp(r,r.VERTEX_SHADER,t.vertexSrc),i=Sp(r,r.FRAGMENT_SHADER,t.fragmentSrc),s=r.createProgram();r.attachShader(s,e),r.attachShader(s,i);const n=(h=t.extra)==null?void 0:h.transformFeedbackVaryings;if(n&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||q1(r,s,e,i),t.attributeData=vb(s,r),t.uniformData=yb(s,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const d=Object.keys(t.attributeData);d.sort((p,m)=>p>m?1:-1);for(let p=0;p<d.length;p++)t.attributeData[d[p]].location=p,r.bindAttribLocation(s,p,d[p]);r.linkProgram(s)}r.deleteShader(e),r.deleteShader(i);const o={};for(const d in t.uniformData){const p=t.uniformData[d];o[d]={location:r.getUniformLocation(s,d),value:E0(p.type,p.size)}}return new _b(s,o)}function bb(r,t,e,i,s){e.buffer.update(s)}const wb={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},j0={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Sb(r){const t=r.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,i=0,s=0;for(let n=0;n<t.length;n++){const o=t[n];if(e=j0[o.data.type],o.data.size>1&&(e=Math.max(e,16)*o.data.size),o.dataLen=e,i%e!==0&&i<16){const h=i%e%16;i+=h,s+=h}i+e>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=e,i=e):(o.offset=s,i+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function Cb(r,t){const e=[];for(const i in r)t[i]&&e.push(t[i]);return e.sort((i,s)=>i.index-s.index),e}function Eb(r,t){if(!r.autoManage)return{size:0,syncFunc:bb};const e=Cb(r.uniforms,t),{uboElements:i,size:s}=Sb(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const h=i[o],d=r.uniforms[h.data.name],p=h.data.name;let m=!1;for(let v=0;v<ma.length;v++){const b=ma[v];if(b.codeUbo&&b.test(h.data,d)){n.push(`offset = ${h.offset/4};`,ma[v].codeUbo(h.data.name,d)),m=!0;break}}if(!m)if(h.data.size>1){const v=T0(h.data.type),b=Math.max(j0[h.data.type]/16,1),y=v/b,P=(4-y%4)%4;n.push(`
                cv = ud.${p}.value;
                v = uv.${p};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*b}; i++)
                {
                    for(var j = 0; j < ${y}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${P};
                }

                `)}else{const v=wb[h.data.type];n.push(`
                cv = ud.${p}.value;
                v = uv.${p};
                offset = ${h.offset/4};
                ${v};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Pb=0;const Jo={textureCount:0,uboCount:0};class $0{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Pb++}systemCheck(){if(!K1())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(Jo.textureCount=0,Jo.uboCount=0,this.syncUniformGroup(t.uniformGroup,Jo)),s}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=j1(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,Jo,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(t,this.shader.program.uniformData,"ubo");let h=this._uboCache[o];if(h||(h=this._uboCache[o]=Eb(t,this.shader.program.uniformData)),t.autoManage){const d=new Float32Array(h.size/4);t.buffer.update(d)}return e.uniformGroups[t.id]=h.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const s=t.uniforms,n=[`${i}-`];for(const o in s)n.push(o),e[o]&&n.push(e[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,s=xb(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}$0.extension={type:Xt.RendererSystem,name:"shader"};te.add($0);class Ql{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Ql.defaultOptions={hello:!1},Ql.extension={type:[Xt.RendererSystem,Xt.CanvasRendererSystem],name:"startup"};te.add(Ql);function Tb(r,t=[]){return t[fe.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.ADD]=[r.ONE,r.ONE],t[fe.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.NONE]=[0,0],t[fe.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[fe.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[fe.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[fe.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[fe.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[fe.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[fe.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[fe.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[fe.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[fe.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[fe.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}const Ib=0,Ab=1,Mb=2,kb=3,Rb=4,Bb=5,Y0=class Sc{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=fe.NONE,this._blendEq=!1,this.map=[],this.map[Ib]=this.setBlend,this.map[Ab]=this.setOffset,this.map[Mb]=this.setCullFace,this.map[kb]=this.setDepthTest,this.map[Rb]=this.setFrontFace,this.map[Bb]=this.setDepthMask,this.checks=[],this.defaultState=new Zs,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=Tb(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)e&1&&this.map[i].call(this,!!(t.data&1<<i)),e=e>>1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Sc.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Sc.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;e.length===2?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&i===-1?this.checks.push(t):!e&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Y0.extension={type:Xt.RendererSystem,name:"state"};let Lb=Y0;te.add(Lb);class Db extends yo{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Rr(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=i.find(o=>this._systemsHash[o]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Ka=class Il{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Il.defaultMaxIdle,this.checkCountMax=Il.defaultCheckCountMax,this.mode=Il.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==ad.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let s=0;s<e.length;s++){const n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,i=!0)}if(i){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};Ka.defaultMode=ad.AUTO,Ka.defaultMaxIdle=60*60,Ka.defaultCheckCountMax=60*10,Ka.extension={type:Xt.RendererSystem,name:"textureGC"};let Sn=Ka;te.add(Sn);class yu{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=oe.UNSIGNED_BYTE,this.internalFormat=Ft.RGBA,this.samplerType=0}}function Fb(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[r.RGB]:Yt.FLOAT,[r.RGBA]:Yt.FLOAT,[r.ALPHA]:Yt.FLOAT,[r.LUMINANCE]:Yt.FLOAT,[r.LUMINANCE_ALPHA]:Yt.FLOAT,[r.R8]:Yt.FLOAT,[r.R8_SNORM]:Yt.FLOAT,[r.RG8]:Yt.FLOAT,[r.RG8_SNORM]:Yt.FLOAT,[r.RGB8]:Yt.FLOAT,[r.RGB8_SNORM]:Yt.FLOAT,[r.RGB565]:Yt.FLOAT,[r.RGBA4]:Yt.FLOAT,[r.RGB5_A1]:Yt.FLOAT,[r.RGBA8]:Yt.FLOAT,[r.RGBA8_SNORM]:Yt.FLOAT,[r.RGB10_A2]:Yt.FLOAT,[r.RGB10_A2UI]:Yt.FLOAT,[r.SRGB8]:Yt.FLOAT,[r.SRGB8_ALPHA8]:Yt.FLOAT,[r.R16F]:Yt.FLOAT,[r.RG16F]:Yt.FLOAT,[r.RGB16F]:Yt.FLOAT,[r.RGBA16F]:Yt.FLOAT,[r.R32F]:Yt.FLOAT,[r.RG32F]:Yt.FLOAT,[r.RGB32F]:Yt.FLOAT,[r.RGBA32F]:Yt.FLOAT,[r.R11F_G11F_B10F]:Yt.FLOAT,[r.RGB9_E5]:Yt.FLOAT,[r.R8I]:Yt.INT,[r.R8UI]:Yt.UINT,[r.R16I]:Yt.INT,[r.R16UI]:Yt.UINT,[r.R32I]:Yt.INT,[r.R32UI]:Yt.UINT,[r.RG8I]:Yt.INT,[r.RG8UI]:Yt.UINT,[r.RG16I]:Yt.INT,[r.RG16UI]:Yt.UINT,[r.RG32I]:Yt.INT,[r.RG32UI]:Yt.UINT,[r.RGB8I]:Yt.INT,[r.RGB8UI]:Yt.UINT,[r.RGB16I]:Yt.INT,[r.RGB16UI]:Yt.UINT,[r.RGB32I]:Yt.INT,[r.RGB32UI]:Yt.UINT,[r.RGBA8I]:Yt.INT,[r.RGBA8UI]:Yt.UINT,[r.RGBA16I]:Yt.INT,[r.RGBA16UI]:Yt.UINT,[r.RGBA32I]:Yt.INT,[r.RGBA32UI]:Yt.UINT,[r.DEPTH_COMPONENT16]:Yt.FLOAT,[r.DEPTH_COMPONENT24]:Yt.FLOAT,[r.DEPTH_COMPONENT32F]:Yt.FLOAT,[r.DEPTH_STENCIL]:Yt.FLOAT,[r.DEPTH24_STENCIL8]:Yt.FLOAT,[r.DEPTH32F_STENCIL8]:Yt.FLOAT}:t={[r.RGB]:Yt.FLOAT,[r.RGBA]:Yt.FLOAT,[r.ALPHA]:Yt.FLOAT,[r.LUMINANCE]:Yt.FLOAT,[r.LUMINANCE_ALPHA]:Yt.FLOAT,[r.DEPTH_STENCIL]:Yt.FLOAT},t}function Ob(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[oe.UNSIGNED_BYTE]:{[Ft.RGBA]:r.RGBA8,[Ft.RGB]:r.RGB8,[Ft.RG]:r.RG8,[Ft.RED]:r.R8,[Ft.RGBA_INTEGER]:r.RGBA8UI,[Ft.RGB_INTEGER]:r.RGB8UI,[Ft.RG_INTEGER]:r.RG8UI,[Ft.RED_INTEGER]:r.R8UI,[Ft.ALPHA]:r.ALPHA,[Ft.LUMINANCE]:r.LUMINANCE,[Ft.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[oe.BYTE]:{[Ft.RGBA]:r.RGBA8_SNORM,[Ft.RGB]:r.RGB8_SNORM,[Ft.RG]:r.RG8_SNORM,[Ft.RED]:r.R8_SNORM,[Ft.RGBA_INTEGER]:r.RGBA8I,[Ft.RGB_INTEGER]:r.RGB8I,[Ft.RG_INTEGER]:r.RG8I,[Ft.RED_INTEGER]:r.R8I},[oe.UNSIGNED_SHORT]:{[Ft.RGBA_INTEGER]:r.RGBA16UI,[Ft.RGB_INTEGER]:r.RGB16UI,[Ft.RG_INTEGER]:r.RG16UI,[Ft.RED_INTEGER]:r.R16UI,[Ft.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[oe.SHORT]:{[Ft.RGBA_INTEGER]:r.RGBA16I,[Ft.RGB_INTEGER]:r.RGB16I,[Ft.RG_INTEGER]:r.RG16I,[Ft.RED_INTEGER]:r.R16I},[oe.UNSIGNED_INT]:{[Ft.RGBA_INTEGER]:r.RGBA32UI,[Ft.RGB_INTEGER]:r.RGB32UI,[Ft.RG_INTEGER]:r.RG32UI,[Ft.RED_INTEGER]:r.R32UI,[Ft.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[oe.INT]:{[Ft.RGBA_INTEGER]:r.RGBA32I,[Ft.RGB_INTEGER]:r.RGB32I,[Ft.RG_INTEGER]:r.RG32I,[Ft.RED_INTEGER]:r.R32I},[oe.FLOAT]:{[Ft.RGBA]:r.RGBA32F,[Ft.RGB]:r.RGB32F,[Ft.RG]:r.RG32F,[Ft.RED]:r.R32F,[Ft.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[oe.HALF_FLOAT]:{[Ft.RGBA]:r.RGBA16F,[Ft.RGB]:r.RGB16F,[Ft.RG]:r.RG16F,[Ft.RED]:r.R16F},[oe.UNSIGNED_SHORT_5_6_5]:{[Ft.RGB]:r.RGB565},[oe.UNSIGNED_SHORT_4_4_4_4]:{[Ft.RGBA]:r.RGBA4},[oe.UNSIGNED_SHORT_5_5_5_1]:{[Ft.RGBA]:r.RGB5_A1},[oe.UNSIGNED_INT_2_10_10_10_REV]:{[Ft.RGBA]:r.RGB10_A2,[Ft.RGBA_INTEGER]:r.RGB10_A2UI},[oe.UNSIGNED_INT_10F_11F_11F_REV]:{[Ft.RGB]:r.R11F_G11F_B10F},[oe.UNSIGNED_INT_5_9_9_9_REV]:{[Ft.RGB]:r.RGB9_E5},[oe.UNSIGNED_INT_24_8]:{[Ft.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[oe.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[Ft.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[oe.UNSIGNED_BYTE]:{[Ft.RGBA]:r.RGBA,[Ft.RGB]:r.RGB,[Ft.ALPHA]:r.ALPHA,[Ft.LUMINANCE]:r.LUMINANCE,[Ft.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[oe.UNSIGNED_SHORT_5_6_5]:{[Ft.RGB]:r.RGB},[oe.UNSIGNED_SHORT_4_4_4_4]:{[Ft.RGBA]:r.RGBA},[oe.UNSIGNED_SHORT_5_5_5_1]:{[Ft.RGBA]:r.RGBA}},t}class q0{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Se,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Ob(t),this.samplerTypes=Fb(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const i=new yu(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new yu(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let n=t-1;n>=0;--n){const o=e[n];o&&o._glTextures[s].samplerType!==Yt.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(t){const e=new yu(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var i;e.internalFormat=((i=this.internalFormats[t.type])==null?void 0:i[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??Yt.FLOAT,this.webGLVersion===2&&t.type===oe.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var s;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),(s=t.resource)==null?void 0:s.upload(i,t,e))e.samplerType!==Yt.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,o=t.realHeight,h=i.gl;(e.width!==n||e.height!==o||e.dirtyId<0)&&(e.width=n,e.height=o,h.texImage2D(t.target,0,e.internalFormat,n,o,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);s!==-1&&ga(this.managedTextures,s,1)}}updateTextureStyle(t){var i;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===ts.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Xs.CLAMP:e.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==ts.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===cs.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===cs.LINEAR){const n=Math.min(t.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===cs.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===cs.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}q0.extension={type:Xt.RendererSystem,name:"texture"};te.add(q0);class Z0{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let o=0;o<t.buffers.length;o++){const h=t.buffers[o];h&&(i.buffer.update(h),h._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,o,h._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<t.buffers.length;o++){const h=t.buffers[o];if(!h)continue;const d=h._glBuffers[this.CONTEXT_UID];d&&(d.refCount--,d.refCount===0&&!e&&n.dispose(h,e))}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Z0.extension={type:Xt.RendererSystem,name:"transformFeedback"};te.add(Z0);class Jl{constructor(t){this.renderer=t}init(t){this.screen=new Pe(0,0,t.width,t.height),this.element=t.view||qt.ADAPTER.createCanvas(),this.resolution=t.resolution||qt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Jl.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Jl.extension={type:[Xt.RendererSystem,Xt.CanvasRendererSystem],name:"_view"};te.add(Jl);qt.PREFER_ENV=Nn.WEBGL2;qt.STRICT_TEXTURE_CACHE=!1;qt.RENDER_OPTIONS={...Kl.defaultOptions,...Zl.defaultOptions,...Jl.defaultOptions,...Ql.defaultOptions};Object.defineProperties(qt,{WRAP_MODE:{get(){return Se.defaultOptions.wrapMode},set(r){Be("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Se.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return Se.defaultOptions.scaleMode},set(r){Be("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Se.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return Se.defaultOptions.mipmap},set(r){Be("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Se.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return Se.defaultOptions.anisotropicLevel},set(r){Be("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Se.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return Be("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),tr.defaultResolution},set(r){tr.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return Be("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),tr.defaultMultisample},set(r){tr.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return wn.defaultMaxTextures},set(r){Be("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),wn.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return wn.defaultBatchSize},set(r){Be("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),wn.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return wn.canUploadSameBuffer},set(r){Be("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),wn.canUploadSameBuffer=r}},GC_MODE:{get(){return Sn.defaultMode},set(r){Be("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Sn.defaultMode=r}},GC_MAX_IDLE:{get(){return Sn.defaultMaxIdle},set(r){Be("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Sn.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return Sn.defaultCheckCountMax},set(r){Be("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Sn.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return ps.defaultVertexPrecision},set(r){Be("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ps.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return ps.defaultFragmentPrecision},set(r){Be("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ps.defaultFragmentPrecision=r}}});var Fn=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(Fn||{});class xu{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const K0=class cr{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new xu(null,null,1/0),this.deltaMS=1/cr.targetFPMS,this.elapsedMS=1/cr.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Fn.NORMAL){return this._addListener(new xu(t,e,i))}addOnce(t,e,i=Fn.NORMAL){return this._addListener(new xu(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*cr.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,cr.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!cr._shared){const t=cr._shared=new cr;t.autoStart=!0,t._protected=!0}return cr._shared}static get system(){if(!cr._system){const t=cr._system=new cr;t.autoStart=!0,t._protected=!0}return cr._system}};K0.targetFPMS=.06;let dr=K0;Object.defineProperties(qt,{TARGET_FPMS:{get(){return dr.targetFPMS},set(r){Be("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),dr.targetFPMS=r}}});class Q0{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Fn.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?dr.shared:new dr,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Q0.extension=Xt.Application;te.add(Q0);const J0=[];te.handleByList(Xt.Renderer,J0);function Nb(r){for(const t of J0)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var Ub=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,zb=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Gb=Ub,tm=zb;class em{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=Pi.HIGH?this.multisample=Pi.HIGH:e>=Pi.MEDIUM?this.multisample=Pi.MEDIUM:e>=Pi.LOW?this.multisample=Pi.LOW:this.multisample=Pi.NONE}destroy(){}}em.extension={type:Xt.RendererSystem,name:"_multisample"};te.add(em);class Vb{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class im{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,i){const{gl:s,CONTEXT_UID:n}=this;i=i||0;const o=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,o.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new Vb(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}im.extension={type:Xt.RendererSystem,name:"buffer"};te.add(im);class rm{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let s,n,o,h;if(e&&(s=e.renderTexture,n=e.clear,o=e.transform,h=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(s||(this.lastObjectRendered=t),!h){const d=t.enableTempParent();t.updateTransform(),t.disableTempParent(d)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}rm.extension={type:Xt.RendererSystem,name:"objectRenderer"};te.add(rm);const Al=class Cc extends Db{constructor(t){super(),this.type=zg.WEBGL,t=Object.assign({},qt.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Br({projectionMatrix:new gi},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Cc.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Be("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Cc.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:c1()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Be("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Be("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Be("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Be("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Be("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Be("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Be("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Be("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Al.extension={type:Xt.Renderer,priority:1},Al.__plugins={},Al.__systems={};let _d=Al;te.handleByMap(Xt.RendererPlugin,_d.__plugins);te.handleByMap(Xt.RendererSystem,_d.__systems);te.add(_d);class sm extends mo{constructor(t,e){const{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const o=new Se;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof mo?this.addResourceAt(t[i],i):this.addResourceAt(y0(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:i}=this.items[0];return this.resize(e,i),this.update(),Promise.resolve(this)}),this._load}}class Hb extends sm{constructor(t,e){const{width:i,height:s}=e||{};let n,o;Array.isArray(t)?(n=t,o=t.length):o=t,super(o,{width:i,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=da.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:s,itemDirtyIds:n,items:o}=this,{gl:h}=t;i.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let d=0;d<s;d++){const p=o[d];n[d]<p.dirtyId&&(n[d]=p.dirtyId,p.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,d,p.resource.width,p.resource.height,1,e.format,i.type,p.resource.source))}return!0}}class Wb extends ys{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const nm=class Qa extends sm{constructor(t,e){const{width:i,height:s,autoLoad:n,linkBaseTexture:o}=e||{};if(t&&t.length!==Qa.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let h=0;h<Qa.SIDES;h++)this.items[h].target=da.TEXTURE_CUBE_MAP_POSITIVE_X+h;this.linkBaseTexture=o!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=da.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=da.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const s=this.itemDirtyIds;for(let n=0;n<Qa.SIDES;n++){const o=this.items[n];(s[n]<o.dirtyId||i.dirtyId<e.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(t,o,i),s[n]=o.dirtyId):s[n]<-1&&(t.gl.texImage2D(o.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Qa.SIDES}};nm.SIDES=6;let Xb=nm;class ha extends ys{constructor(t,e){e=e||{};let i,s,n;typeof t=="string"?(i=ha.EMPTY,s=t,n=!0):(i=t,s=null,n=!1),super(i),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await qt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await i.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ar.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return ha._EMPTY=ha._EMPTY??qt.ADAPTER.createCanvas(0,0),ha._EMPTY}}const Ec=class Ml extends ys{constructor(t,e){e=e||{},super(qt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Ml.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;ys.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,n=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*e,n=this._overrideHeight||this._overrideWidth/e*i),s=Math.round(s),n=Math.round(n);const o=this.source;o.width=s,o.height=n,o._pixiId=`canvas_${Dn()}`,o.getContext("2d").drawImage(t,0,0,e,i,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){const e=Ml.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Ml.SVG_XML.test(t)}};Ec.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Ec.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Pc=Ec;class jb extends ys{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const Tc=class Ic extends ys{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");e.autoLoad!==!1&&i.setAttribute("preload","auto"),e.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),e.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),e.loop===!0&&i.setAttribute("loop",""),e.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const s=t[0].src||t[0];ys.crossOrigin(i,s,e.crossorigin);for(let n=0;n<t.length;++n){const o=document.createElement("source");let{src:h,mime:d}=t[n];if(h=h||t[n],h.startsWith("data:"))d=h.slice(5,h.indexOf(";"));else if(!h.startsWith("blob:")){const p=h.split("?").shift().toLowerCase(),m=p.slice(p.lastIndexOf(".")+1);d=d||Ic.MIME_TYPES[m]||`video/${m}`}o.src=h,d&&(o.type=d),i.appendChild(o)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=dr.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,i)=>{this.valid?e(this):(this._resolve=e,this._reject=i,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(dr.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(dr.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Ic.TYPES.includes(e)}};Tc.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Tc.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let am=Tc;pc.push(ha,k0,Wb,am,jb,Pc,_h,Xb,Hb);class th{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Pe.EMPTY:(t=t||new Pe(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:s,c:n,d:o,tx:h,ty:d}=t,p=i*e.x+n*e.y+h,m=s*e.x+o*e.y+d;this.minX=Math.min(this.minX,p),this.maxX=Math.max(this.maxX,p),this.minY=Math.min(this.minY,m),this.maxY=Math.max(this.maxY,m)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,n=this.maxY,o=t[0],h=t[1];e=o<e?o:e,i=h<i?h:i,s=o>s?o:s,n=h>n?h:n,o=t[2],h=t[3],e=o<e?o:e,i=h<i?h:i,s=o>s?o:s,n=h>n?h:n,o=t[4],h=t[5],e=o<e?o:e,i=h<i?h:i,s=o>s?o:s,n=h>n?h:n,o=t[6],h=t[7],e=o<e?o:e,i=h<i?h:i,s=o>s?o:s,n=h>n?h:n,this.minX=e,this.minY=i,this.maxX=s,this.maxY=n}addFrame(t,e,i,s,n){this.addFrameMatrix(t.worldTransform,e,i,s,n)}addFrameMatrix(t,e,i,s,n){const o=t.a,h=t.b,d=t.c,p=t.d,m=t.tx,v=t.ty;let b=this.minX,y=this.minY,P=this.maxX,M=this.maxY,z=o*e+d*i+m,q=h*e+p*i+v;b=z<b?z:b,y=q<y?q:y,P=z>P?z:P,M=q>M?q:M,z=o*s+d*i+m,q=h*s+p*i+v,b=z<b?z:b,y=q<y?q:y,P=z>P?z:P,M=q>M?q:M,z=o*e+d*n+m,q=h*e+p*n+v,b=z<b?z:b,y=q<y?q:y,P=z>P?z:P,M=q>M?q:M,z=o*s+d*n+m,q=h*s+p*n+v,b=z<b?z:b,y=q<y?q:y,P=z>P?z:P,M=q>M?q:M,this.minX=b,this.minY=y,this.maxX=P,this.maxY=M}addVertexData(t,e,i){let s=this.minX,n=this.minY,o=this.maxX,h=this.maxY;for(let d=e;d<i;d+=2){const p=t[d],m=t[d+1];s=p<s?p:s,n=m<n?m:n,o=p>o?p:o,h=m>h?m:h}this.minX=s,this.minY=n,this.maxX=o,this.maxY=h}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,n=0,o=n){const h=t.a,d=t.b,p=t.c,m=t.d,v=t.tx,b=t.ty;let y=this.minX,P=this.minY,M=this.maxX,z=this.maxY;for(let q=i;q<s;q+=2){const V=e[q],I=e[q+1],Y=h*V+p*I+v,K=m*I+d*V+b;y=Math.min(y,Y-n),M=Math.max(M,Y+n),P=Math.min(P,K-o),z=Math.max(z,K+o)}this.minX=y,this.minY=P,this.maxX=M,this.maxY=z}addBounds(t){const e=this.minX,i=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=n&&s<=o){const h=this.minX,d=this.minY,p=this.maxX,m=this.maxY;this.minX=i<h?i:h,this.minY=s<d?s:d,this.maxX=n>p?n:p,this.maxY=o>m?o:m}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=n&&s<=o){const h=this.minX,d=this.minY,p=this.maxX,m=this.maxY;this.minX=i<h?i:h,this.minY=s<d?s:d,this.maxX=n>p?n:p,this.maxY=o>m?o:m}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,n,o){t-=n,e-=o,i+=n,s+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class ui extends yo{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new gd,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new th,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const s=e[i];Object.defineProperty(ui.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Pe),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Pe),t=this._localBoundsRect),this._localBounds||(this._localBounds=new th);const e=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(i==null?void 0:i.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,n=0,o=0,h=0,d=0,p=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=h,this.pivot.x=d,this.pivot.y=p,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new $b),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*U1}set angle(t){this.transform.rotation=t*z1}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class $b extends ui{constructor(){super(...arguments),this.sortDirty=null}}ui.prototype.displayObjectUpdateTransform=ui.prototype.updateTransform;const Yb=new gi;function qb(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}const om=class Ac extends ui{constructor(){super(),this.children=[],this.sortableChildren=Ac.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);ga(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,ga(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,ga(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,s=e,n=s-i;let o;if(n>0&&n<=s){o=this.children.splice(i,n);for(let h=0;h<o.length;++h)o[h].parent=null,o[h].transform&&(o[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let h=0;h<o.length;++h)o[h].emit("removed",this),this.emit("childRemoved",o[h],this,h);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(qb),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){const o=this.children[s];o.visible&&o.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==Ac.prototype._render&&(i=this.getBounds(!0));const n=t.projection.transform;if(n&&(s?(s=Yb.copyFrom(s),s.prepend(n)):s=n),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(let o=0,h=this.children.length;o<h;++o){const d=this.children[o],p=d.cullable;d.cullable=p||!this.cullArea,d.render(t),d.cullable=p}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let i=0,s=this.children.length;i<s;++i)this.children[i].render(t)}}renderAdvanced(t){var n,o,h;const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let d=0;d<e.length;d++)e[d].enabled&&this._enabledFilters.push(e[d])}const s=e&&((n=this._enabledFilters)==null?void 0:n.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==ki.NONE));if(s&&t.batch.flush(),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let d=0,p=this.children.length;d<p;++d)this.children[d].render(t)}s&&t.batch.flush(),i&&t.mask.pop(this),e&&((h=this._enabledFilters)!=null&&h.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<i.length;++s)i[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};om.defaultSortableChildren=!1;let Ui=om;Ui.prototype.containerUpdateTransform=Ui.prototype.updateTransform;Object.defineProperties(qt,{SORTABLE_CHILDREN:{get(){return Ui.defaultSortableChildren},set(r){Be("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ui.defaultSortableChildren=r}}});const ja=new Ue,Zb=new Uint16Array([0,1,2,0,2,3]);class Ia extends Ui{constructor(t){super(),this._anchor=new fs(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Je(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=fe.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Jt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Zb,this.pluginName="batch",this.isSprite=!0,this._roundPixels=qt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Gs(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Gs(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,o=e.d,h=e.tx,d=e.ty,p=this.vertexData,m=t.trim,v=t.orig,b=this._anchor;let y=0,P=0,M=0,z=0;if(m?(P=m.x-b._x*v.width,y=P+m.width,z=m.y-b._y*v.height,M=z+m.height):(P=-b._x*v.width,y=P+v.width,z=-b._y*v.height,M=z+v.height),p[0]=i*P+n*z+h,p[1]=o*z+s*P+d,p[2]=i*y+n*z+h,p[3]=o*z+s*y+d,p[4]=i*y+n*M+h,p[5]=o*M+s*y+d,p[6]=i*P+n*M+h,p[7]=o*M+s*P+d,this._roundPixels){const q=qt.RESOLUTION;for(let V=0;V<p.length;++V)p[V]=Math.round(p[V]*q)/q}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,h=n.b,d=n.c,p=n.d,m=n.tx,v=n.ty,b=-s._x*i.width,y=b+i.width,P=-s._y*i.height,M=P+i.height;if(e[0]=o*b+d*P+m,e[1]=p*P+h*b+v,e[2]=o*y+d*P+m,e[3]=p*P+h*y+v,e[4]=o*y+d*M+m,e[5]=p*M+h*y+v,e[6]=o*b+d*M+m,e[7]=p*M+h*b+v,this._roundPixels){const z=qt.RESOLUTION;for(let q=0;q<e.length;++q)e[q]=Math.round(e[q]*z)/z}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new th),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Pe),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ja);const e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x;let n=0;return ja.x>=s&&ja.x<s+e&&(n=-i*this.anchor.y,ja.y>=n&&ja.y<n+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof Jt?t:Jt.from(t,e);return new Ia(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Gs(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Gs(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Jt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const lm=new gi;ui.prototype._cacheAsBitmap=!1;ui.prototype._cacheData=null;ui.prototype._cacheAsBitmapResolution=null;ui.prototype._cacheAsBitmapMultisample=null;class Kb{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ui.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new Kb),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});ui.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};ui.prototype._initCachedDisplayObject=function(r){var b,y;if((b=this._cacheData)!=null&&b.sprite)return;const t=this.alpha;this.alpha=1,r.batch.flush();const e=this.getLocalBounds(new Pe,!0);if((y=this.filters)!=null&&y.length){const P=this.filters[0].padding;e.pad(P)}const i=this.cacheAsBitmapResolution||r.resolution;e.ceil(i),e.width=Math.max(e.width,1/i),e.height=Math.max(e.height,1/i);const s=r.renderTexture.current,n=r.renderTexture.sourceFrame.clone(),o=r.renderTexture.destinationFrame.clone(),h=r.projection.transform,d=Ks.create({width:e.width,height:e.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),p=`cacheAsBitmap_${Dn()}`;this._cacheData.textureCacheId=p,Se.addToCache(d.baseTexture,p),Jt.addToCache(d,p);const m=this.transform.localTransform.copyTo(lm).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:d,clear:!0,transform:m,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=h,r.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const v=new Ia(d);v.transform.worldTransform=this.transform.worldTransform,v.anchor.x=-(e.x/e.width),v.anchor.y=-(e.y/e.height),v.alpha=t,v._bounds=this._bounds,this._cacheData.sprite=v,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=v.containsPoint.bind(v)};ui.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};ui.prototype._initCachedDisplayObjectCanvas=function(r){var m;if((m=this._cacheData)!=null&&m.sprite)return;const t=this.getLocalBounds(new Pe,!0),e=this.alpha;this.alpha=1;const i=r.canvasContext.activeContext,s=r._projTransform,n=this.cacheAsBitmapResolution||r.resolution;t.ceil(n),t.width=Math.max(t.width,1/n),t.height=Math.max(t.height,1/n);const o=Ks.create({width:t.width,height:t.height,resolution:n}),h=`cacheAsBitmap_${Dn()}`;this._cacheData.textureCacheId=h,Se.addToCache(o.baseTexture,h),Jt.addToCache(o,h);const d=lm;this.transform.localTransform.copyTo(d),d.invert(),d.tx-=t.x,d.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:o,clear:!0,transform:d,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const p=new Ia(o);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-(t.x/t.width),p.anchor.y=-(t.y/t.height),p.alpha=e,p._bounds=this._bounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=p.containsPoint.bind(p)};ui.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ui.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ui.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Se.removeFromCache(this._cacheData.textureCacheId),Jt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ui.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};ui.prototype.name=null;Ui.prototype.getChildByName=function(r,t){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===r)return this.children[e];if(t)for(let e=0,i=this.children.length;e<i;e++){const s=this.children[e];if(!s.getChildByName)continue;const n=s.getChildByName(r,!0);if(n)return n}return null};ui.prototype.getGlobalPosition=function(r=new Ue,t=!1){return this.parent?this.parent.toGlobal(this.position,r,t):(r.x=this.position.x,r.y=this.position.y),r};var Qb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class Jb extends tr{constructor(t=1){super(Gb,Qb,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const tw={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},ew=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function iw(r){const t=tw[r],e=t.length;let i=ew,s="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let h=0;h<r;h++){let d=n.replace("%index%",h.toString());o=h,h>=e&&(o=r-h-1),d=d.replace("%value%",t[o].toString()),s+=d,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}const rw=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function sw(r,t){const e=Math.ceil(r/2);let i=rw,s="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<r;o++){let h=n.replace("%index%",o.toString());h=h.replace("%sampleIndex%",`${o-(e-1)}.0`),s+=h,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}class Mc extends tr{constructor(t,e=8,i=4,s=tr.defaultResolution,n=5){const o=sw(n,t),h=iw(n);super(o,h),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=i,this.blur=e}apply(t,e,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/e.width):this.uniforms.strength=1/i.height*(i.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,i,s);else{const n=t.getFilterTexture(),o=t.renderer;let h=e,d=n;this.state.blend=!1,t.applyFilter(this,h,d,$r.CLEAR);for(let p=1;p<this.passes-1;p++){t.bindAndClear(h,$r.BLIT),this.uniforms.uSampler=d;const m=d;d=h,h=m,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,d,i,s),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class nw extends tr{constructor(t=8,e=4,i=tr.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Mc(!0,t,e,i,s),this.blurYFilter=new Mc(!1,t,e,i,s),this.resolution=i,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,i,s){const n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){const h=t.getFilterTexture();this.blurXFilter.apply(t,e,h,$r.CLEAR),this.blurYFilter.apply(t,h,i,s),t.returnFilterTexture(h)}else o?this.blurYFilter.apply(t,e,i,s):this.blurXFilter.apply(t,e,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var aw=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class kc extends tr{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(tm,aw,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const[i,s,n]=Je.shared.setValue(t).toArray(),o=[i,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),s=Math.sin(t),n=Math.sqrt,o=1/3,h=n(o),d=i+(1-i)*o,p=o*(1-i)-h*s,m=o*(1-i)+h*s,v=o*(1-i)+h*s,b=i+o*(1-i),y=o*(1-i)-h*s,P=o*(1-i)-h*s,M=o*(1-i)+h*s,z=i+o*(1-i),q=[d,p,m,0,0,v,b,y,0,0,P,M,z,0,0,0,0,0,1,0];this._loadMatrix(q,e)}contrast(t,e){const i=(t||0)+1,s=-.5*(i-1),n=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const i=t*2/3+1,s=(i-1)*-.5,n=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,s,n){t=t||.2,e=e||.15,i=i||16770432,s=s||3375104;const o=Je.shared,[h,d,p]=o.setValue(i).toArray(),[m,v,b]=o.setValue(s).toArray(),y=[.3,.59,.11,0,0,h,d,p,t,0,m,v,b,e,0,h-m,d-v,p-b,0,0];this._loadMatrix(y,n)}night(t,e){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}kc.prototype.grayscale=kc.prototype.greyscale;var ow=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,lw=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class hw extends tr{constructor(t,e){const i=new gi;t.renderable=!1,super(lw,ow,{mapSampler:t._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=i,e==null&&(e=20),this.scale=new Ue(e,e)}apply(t,e,i,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),h=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&h!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/h,this.uniforms.rotation[3]=n.d/h),t.applyFilter(this,e,i,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var uw=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,cw=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class dw extends tr{constructor(){super(cw,uw)}}var fw=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class pw extends tr{constructor(t=.5,e=Math.random()){super(tm,fw,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const Bp={AlphaFilter:Jb,BlurFilter:nw,BlurFilterPass:Mc,ColorMatrixFilter:kc,DisplacementFilter:hw,FXAAFilter:dw,NoiseFilter:pw};Object.entries(Bp).forEach(([r,t])=>{Object.defineProperty(Bp,r,{get(){return Be("7.1.0",`filters.${r} has moved to ${r}`),t}})});class gw{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(dr.system.add(this.tickerUpdate,this,Fn.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(dr.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Fs=new gw;class wo{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=wo.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ue,this.page=new Ue,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class eh extends wo{constructor(){super(...arguments),this.client=new Ue,this.movement=new Ue,this.offset=new Ue,this.global=new Ue,this.screen=new Ue}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,n,o,h,d,p,m,v,b,y,P,M){throw new Error("Method not implemented.")}}class Pr extends eh{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class _a extends eh{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}_a.DOM_DELTA_PIXEL=0,_a.DOM_DELTA_LINE=1,_a.DOM_DELTA_PAGE=2;const mw=2048,_w=new Ue,bu=new Ue;class vw{constructor(t){this.dispatch=new yo,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){Fs.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,_w.set(t,e),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,n=i.length-1;s<n;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this._allInteractiveElements){if(i.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const s=Array.isArray(e)?e:[e];for(let n=i.length-1;n>=0;n--)s.forEach(o=>{t.currentTarget=i[n],this.notifyTarget(t,o)})}propagationPath(t){const e=[t];for(let i=0;i<mw&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,i,s,n,o=!1){let h=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Fs.pauseUpdate=!1),t.interactiveChildren&&t.children){const m=t.children;for(let v=m.length-1;v>=0;v--){const b=m[v],y=this.hitTestMoveRecursive(b,this._isInteractive(e)?e:b.eventMode,i,s,n,o||n(t,i));if(y){if(y.length>0&&!y[y.length-1].parent)continue;const P=t.isInteractive();(y.length>0||P)&&(P&&this._allInteractiveElements.push(t),y.push(t)),this._hitElements.length===0&&(this._hitElements=y),h=!0}}}const d=this._isInteractive(e),p=t.isInteractive();return d&&p&&this._allInteractiveElements.push(t),o||this._hitElements.length>0?null:h?this._hitElements:d&&!n(t,i)&&s(t,i)?p?[t]:[]:null}hitTestRecursive(t,e,i,s,n){if(this._interactivePrune(t)||n(t,i))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(Fs.pauseUpdate=!1),t.interactiveChildren&&t.children){const d=t.children;for(let p=d.length-1;p>=0;p--){const m=d[p],v=this.hitTestRecursive(m,this._isInteractive(e)?e:m.eventMode,i,s,n);if(v){if(v.length>0&&!v[v.length-1].parent)continue;const b=t.isInteractive();return(v.length>0||b)&&v.push(t),v}}}const o=this._isInteractive(e),h=t.isInteractive();return o&&s(t,i)?h?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var i;if(t.hitArea&&(t.worldTransform.applyInverse(e,bu),!t.hitArea.contains(bu.x,bu.y)))return!0;if(t._mask){const s=t._mask.isMaskData?t._mask.maskObject:t._mask;if(s&&!((i=s.containsPoint)!=null&&i.call(s,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var n,o;e=e??t.type;const i=`on${e}`;(o=(n=t.currentTarget)[i])==null||o.call(n,t);const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Pr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const s=e.button===2;this.dispatchEvent(e,s?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var d,p;if(!(t instanceof Pr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const i=e.pointerType==="mouse"||e.pointerType==="pen",s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.overTargets);if(((d=s.overTargets)==null?void 0:d.length)>0&&n!==e.target){const m=t.type==="mousemove"?"mouseout":"pointerout",v=this.createPointerEvent(t,m,n);if(this.dispatchEvent(v,"pointerout"),i&&this.dispatchEvent(v,"mouseout"),!e.composedPath().includes(n)){const b=this.createPointerEvent(t,"pointerleave",n);for(b.eventPhase=b.AT_TARGET;b.target&&!e.composedPath().includes(b.target);)b.currentTarget=b.target,this.notifyTarget(b),i&&this.notifyTarget(b,"mouseleave"),b.target=b.target.parent;this.freeEvent(b)}this.freeEvent(v)}if(n!==e.target){const m=t.type==="mousemove"?"mouseover":"pointerover",v=this.clonePointerEvent(e,m);this.dispatchEvent(v,"pointerover"),i&&this.dispatchEvent(v,"mouseover");let b=n==null?void 0:n.parent;for(;b&&b!==this.rootTarget.parent&&b!==e.target;)b=b.parent;if(!b||b===this.rootTarget.parent){const y=this.clonePointerEvent(e,"pointerenter");for(y.eventPhase=y.AT_TARGET;y.target&&y.target!==n&&y.target!==this.rootTarget.parent;)y.currentTarget=y.target,this.notifyTarget(y),i&&this.notifyTarget(y,"mouseenter"),y.target=y.target.parent;this.freeEvent(y)}this.freeEvent(v)}const o=[],h=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(e,"pointermove"),h&&o.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),h&&o.push("globaltouchmove")),i&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),h&&o.push("globalmousemove"),this.cursor=(p=e.target)==null?void 0:p.cursor),o.length>0&&this.all(e,o),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var o;if(!(t instanceof Pr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(o=i.target)==null?void 0:o.cursor);const n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof Pr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(e.overTargets),n=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(t,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;e.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Pr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.dispatchEvent(i,h?"rightup":"mouseup")}const s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[t.button]);let o=n;if(n&&!i.composedPath().includes(n)){let h=n;for(;h&&!i.composedPath().includes(h);){if(i.currentTarget=h,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const d=i.button===2;this.notifyTarget(i,d?"rightupoutside":"mouseupoutside")}h=h.parent}delete s.pressTargetsByButton[t.button],o=h}if(o){const h=this.clonePointerEvent(i,"click");h.target=o,h.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:e});const d=s.clicksByButton[t.button];if(d.target===h.target&&e-d.timeStamp<200?++d.clickCount:d.clickCount=1,d.target=h.target,d.timeStamp=e,h.detail=d.clickCount,h.pointerType==="mouse"){const p=h.button===2;this.dispatchEvent(h,p?"rightclick":"click")}else h.pointerType==="touch"&&this.dispatchEvent(h,"tap");this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Pr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let n=i;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof _a)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const s=this.allocateEvent(Pr);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof e=="string"&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(_a);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Pr);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Pr&&e instanceof Pr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof eh&&e instanceof eh&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i&&t.currentTarget.isInteractive())if("fn"in i)i.once&&t.currentTarget.removeListener(e,i.fn,void 0,!0),i.fn.call(i.context,t);else for(let s=0,n=i.length;s<n&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeListener(e,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,t)}}const yw=1,xw={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Rc=class Bc{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new vw(null),Fs.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Pr(null),this.rootWheelEvent=new _a(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Bc.defaultEventFeatures},{set:(e,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),e[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:i}=this.renderer;this.setTargetElement(e),this.resolution=i,Bc._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,s=e.length;i<s;i++){const n=e[i],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Fs.pointerMoved();const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let n=0,o=s.length;n<o;n++){const h=this.bootstrapEvent(this.rootPointerEvent,s[n]);h.type+=i,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let i=0,s=e.length;i<s;i++){const n=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,Fs.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Fs.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Fs.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*n,t.y=(i-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){const n=t.changedTouches[i];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=yw),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=xw[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Rc.extension={name:"events",type:[Xt.RendererSystem,Xt.CanvasRendererSystem]},Rc.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Lc=Rc;te.add(Lc);function Lp(r){return r==="dynamic"||r==="static"}const bw={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Lp(Lc.defaultEventMode)},set interactive(r){Be("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??Lc.defaultEventMode},set eventMode(r){this._internalInteractive=Lp(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof e=="object"?e.signal:void 0,n=typeof e=="object"?e.once===!0:!1,o=typeof t=="function"?void 0:t;r=i?`${r}capture`:r;const h=typeof t=="function"?t:t.handleEvent,d=this;s&&s.addEventListener("abort",()=>{d.off(r,h,o)}),n?d.once(r,h,o):d.on(r,h,o)},removeEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,s=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,s)},dispatchEvent(r){if(!(r instanceof wo))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};ui.mixin(bw);const ww={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ui.mixin(ww);const Sw=9,tl=100,Cw=0,Ew=0,Dp=2,Fp=1,Pw=-1e3,Tw=-1e3,Iw=2;class hm{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(ds.tablet||ds.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${tl}px`,e.style.height=`${tl}px`,e.style.position="absolute",e.style.top=`${Cw}px`,e.style.left=`${Ew}px`,e.style.zIndex=Dp.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Fp}px`,t.style.height=`${Fp}px`,t.style.position="absolute",t.style.top=`${Pw}px`,t.style.left=`${Tw}px`,t.style.zIndex=Iw.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(ds.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:h,resolution:d}=this.renderer,p=s/o*d,m=n/h*d;let v=this.div;v.style.left=`${e}px`,v.style.top=`${i}px`,v.style.width=`${o}px`,v.style.height=`${h}px`;for(let b=0;b<this.children.length;b++){const y=this.children[b];if(y.renderId!==this.renderId)y._accessibleActive=!1,ga(this.children,b,1),this.div.removeChild(y._accessibleDiv),this.pool.push(y._accessibleDiv),y._accessibleDiv=null,b--;else{v=y._accessibleDiv;let P=y.hitArea;const M=y.worldTransform;y.hitArea?(v.style.left=`${(M.tx+P.x*M.a)*p}px`,v.style.top=`${(M.ty+P.y*M.d)*m}px`,v.style.width=`${P.width*M.a*p}px`,v.style.height=`${P.height*M.d*m}px`):(P=y.getBounds(),this.capHitArea(P),v.style.left=`${P.x*p}px`,v.style.top=`${P.y*m}px`,v.style.width=`${P.width*p}px`,v.style.height=`${P.height*m}px`,v.title!==y.accessibleTitle&&y.accessibleTitle!==null&&(v.title=y.accessibleTitle),v.getAttribute("aria-label")!==y.accessibleHint&&y.accessibleHint!==null&&v.setAttribute("aria-label",y.accessibleHint)),(y.accessibleTitle!==v.title||y.tabIndex!==v.tabIndex)&&(v.title=y.accessibleTitle,v.tabIndex=y.tabIndex,this.debug&&this.updateDebugHTML(v))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${tl}px`,e.style.height=`${tl}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Dp.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,n=Object.assign(new wo(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach(o=>s.dispatchEvent(n,o))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Sw&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}hm.extension={name:"accessibility",type:[Xt.RendererPlugin,Xt.CanvasRendererPlugin]};te.add(hm);const um=class Dc{constructor(t){this.stage=new Ui,t=Object.assign({forceCanvas:!1},t),this.renderer=Nb(t),Dc._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const i=Dc._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};um._plugins=[];let bh=um;te.handleByList(Xt.Application,bh._plugins);class dm{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;e=s,i=n}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}dm.extension=Xt.Application;te.add(dm);const Op={loader:Xt.LoadParser,resolver:Xt.ResolveParser,cache:Xt.CacheParser,detection:Xt.DetectionParser};te.handle(Xt.Asset,r=>{const t=r.ref;Object.entries(Op).filter(([e])=>!!t[e]).forEach(([e,i])=>te.add(Object.assign(t[e],{extension:t[e].extension??i})))},r=>{const t=r.ref;Object.keys(Op).filter(e=>!!t[e]).forEach(e=>te.remove(t[e]))});class Aw{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Aa(r,t){if(Array.isArray(t)){for(const e of t)if(r.startsWith(`data:${e}`))return!0;return!1}return r.startsWith(`data:${t}`)}function Qs(r,t){const e=r.split("?")[0],i=Ni.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Ar=(r,t,e=!1)=>(Array.isArray(r)||(r=[r]),t?r.map(i=>typeof i=="string"||e?t(i):i):r),Fc=(r,t)=>{const e=t.split("?")[1];return e&&(r+=`?${e}`),r};function fm(r,t,e,i,s){const n=t[e];for(let o=0;o<n.length;o++){const h=n[o];e<t.length-1?fm(r.replace(i[e],h),t,e+1,i,s):s.push(r.replace(i[e],h))}}function Mw(r){const t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){const s=[];e.forEach(n=>{const o=n.substring(1,n.length-1).split(",");s.push(o)}),fm(r,s,0,e,i)}else i.push(r);return i}const ih=r=>!Array.isArray(r);class kw{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=Ar(t);let s;for(let h=0;h<this.parsers.length;h++){const d=this.parsers[h];if(d.test(e)){s=d.getCacheableAssets(i,e);break}}s||(s={},i.forEach(h=>{s[h]=e}));const n=Object.keys(s),o={cacheKeys:n,keys:i};if(i.forEach(h=>{this._cacheMap.set(h,o)}),n.forEach(h=>{this._cache.has(h)&&this._cache.get(h)!==e&&console.warn("[Cache] already has key:",h),this._cache.set(h,s[h])}),e instanceof Jt){const h=e;i.forEach(d=>{h.baseTexture!==Jt.EMPTY.baseTexture&&Se.addToCache(h.baseTexture,d),Jt.addToCache(h,d)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const In=new kw;class Rw{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var o,h;let s=null,n=null;if(e.loadParser&&(n=this._parserHash[e.loadParser],n||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!n){for(let d=0;d<this.parsers.length;d++){const p=this.parsers[d];if(p.load&&((o=p.test)!=null&&o.call(p,t,e,this))){n=p;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await n.load(t,e,this),i.parser=n;for(let d=0;d<this.parsers.length;d++){const p=this.parsers[d];p.parse&&p.parse&&await((h=p.testParse)==null?void 0:h.call(p,s,e,this))&&(s=await p.parse(s,e,this)||s,i.parser=p)}return s})(),i}async load(t,e){this._parsersValidated||this._validateParsers();let i=0;const s={},n=ih(t),o=Ar(t,p=>({alias:[p],src:p})),h=o.length,d=o.map(async p=>{const m=Ni.toAbsolute(p.src);if(!s[p.src])try{this.promiseCache[m]||(this.promiseCache[m]=this._getLoadPromiseAndParser(m,p)),s[p.src]=await this.promiseCache[m].promise,e&&e(++i/h)}catch(v){throw delete this.promiseCache[m],delete s[p.src],new Error(`[Loader.load] Failed to load ${m}.
${v}`)}});return await Promise.all(d),n?s[o[0].src]:s}async unload(t){const e=Ar(t,i=>({alias:[i],src:i})).map(async i=>{var o,h;const s=Ni.toAbsolute(i.src),n=this.promiseCache[s];if(n){const d=await n.promise;delete this.promiseCache[s],(h=(o=n.parser)==null?void 0:o.unload)==null||h.call(o,d,i,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Dr=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(Dr||{});const Bw=".json",Lw="application/json",Dw={extension:{type:Xt.LoadParser,priority:Dr.Low},name:"loadJson",test(r){return Aa(r,Lw)||Qs(r,Bw)},async load(r){return await(await qt.ADAPTER.fetch(r)).json()}};te.add(Dw);const Fw=".txt",Ow="text/plain",Nw={name:"loadTxt",extension:{type:Xt.LoadParser,priority:Dr.Low},test(r){return Aa(r,Ow)||Qs(r,Fw)},async load(r){return await(await qt.ADAPTER.fetch(r)).text()}};te.add(Nw);const Uw=["normal","bold","100","200","300","400","500","600","700","800","900"],zw=[".ttf",".otf",".woff",".woff2"],Gw=["font/ttf","font/otf","font/woff","font/woff2"],Vw=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Hw(r){const t=Ni.extname(r),e=Ni.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let i=e.length>0;for(const n of e)if(!n.match(Vw)){i=!1;break}let s=e.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}const Ww=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Xw(r){return Ww.test(r)?r:encodeURI(r)}const jw={extension:{type:Xt.LoadParser,priority:Dr.Low},name:"loadWebFont",test(r){return Aa(r,Gw)||Qs(r,zw)},async load(r,t){var i,s,n;const e=qt.ADAPTER.getFontFaceSet();if(e){const o=[],h=((i=t.data)==null?void 0:i.family)??Hw(r),d=((n=(s=t.data)==null?void 0:s.weights)==null?void 0:n.filter(m=>Uw.includes(m)))??["normal"],p=t.data??{};for(let m=0;m<d.length;m++){const v=d[m],b=new FontFace(h,`url(${Xw(r)})`,{...p,weight:v});await b.load(),e.add(b),o.push(b)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>qt.ADAPTER.getFontFaceSet().delete(t))}};te.add(jw);const $w=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let va=null,Oc=class{constructor(){va||(va=URL.createObjectURL(new Blob([$w],{type:"application/javascript"}))),this.worker=new Worker(va)}};Oc.revokeObjectURL=function(){va&&(URL.revokeObjectURL(va),va=null)};const Yw=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let ya=null;class pm{constructor(){ya||(ya=URL.createObjectURL(new Blob([Yw],{type:"application/javascript"}))),this.worker=new Worker(ya)}}pm.revokeObjectURL=function(){ya&&(URL.revokeObjectURL(ya),ya=null)};let Np=0,wu;class qw{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Oc;e.addEventListener("message",i=>{e.terminate(),Oc.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){wu===void 0&&(wu=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<wu&&(this._createdWorkers++,t=new pm().worker,t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((s,n)=>{this.queue.push({id:t,arguments:e,resolve:s,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Np]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Np++,id:i})}}const Up=new qw;function So(r,t,e){r.resource.internal=!0;const i=new Jt(r),s=()=>{delete t.promiseCache[e],In.has(e)&&In.remove(e)};return i.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),i}const Zw=[".jpeg",".jpg",".png",".webp",".avif"],Kw=["image/jpeg","image/png","image/webp","image/avif"];async function Qw(r){const t=await qt.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const wh={name:"loadTextures",extension:{type:Xt.LoadParser,priority:Dr.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return Aa(r,Kw)||Qs(r,Zw)},async load(r,t,e){var h;const i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let s;i?this.config.preferWorkers&&await Up.isImageBitmapSupported()?s=await Up.loadImageBitmap(r):s=await Qw(r):s=await new Promise((d,p)=>{const m=new Image;m.crossOrigin=this.config.crossOrigin,m.src=r,m.complete?d(m):(m.onload=()=>d(m),m.onerror=v=>p(v))});const n={...t.data};n.resolution??(n.resolution=vs(r)),i&&((h=n.resourceOptions)==null?void 0:h.ownsImageBitmap)===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);const o=new Se(s,n);return o.resource.src=r,So(o,e,r)},unload(r){r.destroy(!0)}};te.add(wh);const Jw=".svg",tS="image/svg+xml",eS={extension:{type:Xt.LoadParser,priority:Dr.High},name:"loadSVG",test(r){return Aa(r,tS)||Qs(r,Jw)},async testParse(r){return Pc.test(r)},async parse(r,t,e){var n;const i=new Pc(r,(n=t==null?void 0:t.data)==null?void 0:n.resourceOptions);await i.load();const s=new Se(i,{resolution:vs(r),...t==null?void 0:t.data});return s.resource.src=t.src,So(s,e,t.src)},async load(r,t){return(await qt.ADAPTER.fetch(r)).text()},unload:wh.unload};te.add(eS);const iS=[".mp4",".m4v",".webm",".ogv"],rS=["video/mp4","video/webm","video/ogg"],sS={name:"loadVideo",extension:{type:Xt.LoadParser,priority:Dr.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(r){return Aa(r,rS)||Qs(r,iS)},async load(r,t,e){var o;let i;const s=await(await qt.ADAPTER.fetch(r)).blob(),n=URL.createObjectURL(s);try{const h={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions,autoLoad:!0},d=new am(n,h);await d.load();const p=new Se(d,{alphaMode:await u1(),resolution:vs(r),...t==null?void 0:t.data});p.resource.src=r,i=So(p,e,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(h){throw URL.revokeObjectURL(n),h}return i},unload(r){r.destroy(!0)}};te.add(sS);class nS{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,name:i,src:s,srcs:n}=t;return Ar(e||i||s||n,o=>typeof o=="string"?o:Array.isArray(o)?o.map(h=>(h==null?void 0:h.src)??(h==null?void 0:h.srcs)??h):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(s=>{const n=s.src??s.srcs,o=s.alias??s.name;let h;if(typeof o=="string"){const d=this._createBundleAssetId(t,o);i.push(d),h=[o,d]}else{const d=o.map(p=>this._createBundleAssetId(t,p));i.push(...d),h=[...o,...d]}this.add({...s,alias:h,src:n})}):Object.keys(e).forEach(s=>{const n=[s,this._createBundleAssetId(t,s)];if(typeof e[s]=="string")this.add({alias:n,src:e[s]});else if(Array.isArray(e[s]))this.add({alias:n,src:e[s]});else{const o=e[s],h=o.src??o.srcs;this.add({...o,alias:n,src:Array.isArray(h)?h:[h]})}i.push(...n)}),this._bundles[t]=i}add(t,e,i,s,n){const o=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(Be("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:t,src:e,data:i,format:s,loadParser:n})):Array.isArray(t)?o.push(...t):o.push(t);let h;h=d=>{this.hasKey(d)&&console.warn(`[Resolver] already has key: ${d} overwriting`)},Ar(o).forEach(d=>{const{src:p,srcs:m}=d;let{data:v,format:b,loadParser:y}=d;const P=Ar(p||m).map(q=>typeof q=="string"?Mw(q):Array.isArray(q)?q:[q]),M=this.getAlias(d);Array.isArray(M)?M.forEach(h):h(M);const z=[];P.forEach(q=>{q.forEach(V=>{let I={};if(typeof V!="object"){I.src=V;for(let Y=0;Y<this._parsers.length;Y++){const K=this._parsers[Y];if(K.test(V)){I=K.parse(V);break}}}else v=V.data??v,b=V.format??b,y=V.loadParser??y,I={...I,...V};if(!M)throw new Error(`[Resolver] alias is undefined for this asset: ${I.src}`);I=this.buildResolvedAsset(I,{aliases:M,data:v,format:b,loadParser:y}),z.push(I)})}),M.forEach(q=>{this._assetMap[q]=z})})}resolveBundle(t){const e=ih(t);t=Ar(t);const i={};return t.forEach(s=>{const n=this._bundles[s];if(n){const o=this.resolve(n),h={};for(const d in o){const p=o[d];h[this._extractAssetIdFromBundle(s,d)]=p}i[s]=h}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const s in e)i[s]=e[s].src;return i}return e.src}resolve(t){const e=ih(t);t=Ar(t);const i={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let n=this._assetMap[s];const o=n[0],h=this._getPreferredOrder(n);h==null||h.priority.forEach(d=>{h.params[d].forEach(p=>{const m=n.filter(v=>v[d]?v[d]===p:!1);m.length&&(n=m)})}),this._resolverHash[s]=n[0]??o}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});i[s]=this._resolverHash[s]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],s=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:i,data:s,loadParser:n,format:o}=e;return(this._basePath||this._rootPath)&&(t.src=Ni.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...s||{},...t.data},t.loadParser=n??t.loadParser,t.format=o??t.format??Ni.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class aS{constructor(){this._detections=[],this._initialized=!1,this.resolver=new nS,this.loader=new Rw,this.cache=In,this._backgroundLoader=new Aw(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const e=((n=t.texturePreference)==null?void 0:n.resolution)??1,i=typeof e=="number"?[e]:e,s=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:i}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,i,s,n){this.resolver.add(t,e,i,s,n)}async load(t,e){this._initialized||await this.init();const i=ih(t),s=Ar(t).map(h=>{if(typeof h!="string"){const d=this.resolver.getAlias(h);return d.some(p=>!this.resolver.hasKey(p))&&this.add(h),Array.isArray(d)?d[0]:d}return this.resolver.hasKey(h)||this.add({alias:h,src:h}),h}),n=this.resolver.resolve(s),o=await this._mapLoadToResolve(n,e);return i?o[s[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const s=this.resolver.resolveBundle(t),n={},o=Object.keys(s);let h=0,d=0;const p=()=>{e==null||e(++h/d)},m=o.map(v=>{const b=s[v];return d+=Object.keys(b).length,this._mapLoadToResolve(b,p).then(y=>{n[v]=y})});return await Promise.all(m),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return In.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=In.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(i,e);this._backgroundLoader.active=!0;const o={};return i.forEach((h,d)=>{const p=n[h.src],m=[h.src];h.alias&&m.push(...h.alias),o[s[d]]=p,In.set(m,p)}),o}async unload(t){this._initialized||await this.init();const e=Ar(t).map(s=>typeof s!="string"?s.src:s),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Ar(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(s=>this._unloadFromResolved(e[s]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{In.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,s)=>e.indexOf(i)===s),e}get detections(){return this._detections}get preferWorkers(){return wh.config.preferWorkers}set preferWorkers(t){Be("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const el=new aS;te.handleByList(Xt.LoadParser,el.loader.parsers).handleByList(Xt.ResolveParser,el.resolver.parsers).handleByList(Xt.CacheParser,el.cache.parsers).handleByList(Xt.DetectionParser,el.detections);const oS={extension:Xt.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof Jt),getCacheableAssets:(r,t)=>{const e={};return r.forEach(i=>{t.forEach((s,n)=>{e[i+(n===0?"":n+1)]=s})}),e}};te.add(oS);async function gm(r){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(r)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const lS={extension:{type:Xt.DetectionParser,priority:1},test:async()=>gm("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};te.add(lS);const hS={extension:{type:Xt.DetectionParser,priority:0},test:async()=>gm("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};te.add(hS);const zp=["png","jpg","jpeg"],uS={extension:{type:Xt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...zp],remove:async r=>r.filter(t=>!zp.includes(t))};te.add(uS);const cS="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function vd(r){return cS?!1:document.createElement("video").canPlayType(r)!==""}const dS={extension:{type:Xt.DetectionParser,priority:0},test:async()=>vd("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(t=>t!=="webm")};te.add(dS);const fS={extension:{type:Xt.DetectionParser,priority:0},test:async()=>vd("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(t=>t!=="mp4"&&t!=="m4v")};te.add(fS);const pS={extension:{type:Xt.DetectionParser,priority:0},test:async()=>vd("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(t=>t!=="ogv")};te.add(pS);const gS={extension:Xt.ResolveParser,test:wh.test,parse:r=>{var t;return{resolution:parseFloat(((t=qt.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:Ni.extname(r).slice(1),src:r}}};te.add(gS);var Wi=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r))(Wi||{});const rh={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Gr,sa;function Gp(){sa={bptc:Gr.getExtension("EXT_texture_compression_bptc"),astc:Gr.getExtension("WEBGL_compressed_texture_astc"),etc:Gr.getExtension("WEBGL_compressed_texture_etc"),s3tc:Gr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Gr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Gr.getExtension("WEBGL_compressed_texture_pvrtc")||Gr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Gr.getExtension("WEBGL_compressed_texture_etc1"),atc:Gr.getExtension("WEBGL_compressed_texture_atc")}}const mS={extension:{type:Xt.DetectionParser,priority:2},test:async()=>{const r=qt.ADAPTER.createCanvas().getContext("webgl");return r?(Gr=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{sa||Gp();const t=[];for(const e in sa)sa[e]&&t.push(e);return[...t,...r]},remove:async r=>(sa||Gp(),r.filter(t=>!(t in sa)))};te.add(mS);class _S extends _h{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;typeof t=="string"?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new fc(s):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new fc(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Bn extends _S{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Bn._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Bn._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let n=0,o=this.levels;n<o;n++){const{levelID:h,levelWidth:d,levelHeight:p,levelBuffer:m}=this._levelBuffers[n];s.compressedTexImage2D(s.TEXTURE_2D,h,this.format,d,p,0,m)}return!0}onBlobLoaded(){this._levelBuffers=Bn._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,i,s,n,o,h){const d=new Array(i);let p=t.byteOffset,m=o,v=h,b=m+s-1&~(s-1),y=v+n-1&~(n-1),P=b*y*rh[e];for(let M=0;M<i;M++)d[M]={levelID:M,levelWidth:i>1?m:b,levelHeight:i>1?v:y,levelBuffer:new Uint8Array(t.buffer,p,P)},p+=P,m=m>>1||1,v=v>>1||1,b=m+s-1&~(s-1),y=v+n-1&~(n-1),P=b*y*rh[e];return d}}const Su=4,il=124,vS=32,Vp=20,yS=542327876,rl={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},xS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},sl={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},bS=1,wS=2,SS=4,CS=64,ES=512,PS=131072,TS=827611204,IS=861165636,AS=894720068,MS=808540228,kS=4,RS={[TS]:Wi.COMPRESSED_RGBA_S3TC_DXT1_EXT,[IS]:Wi.COMPRESSED_RGBA_S3TC_DXT3_EXT,[AS]:Wi.COMPRESSED_RGBA_S3TC_DXT5_EXT},BS={70:Wi.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Wi.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Wi.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Wi.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Wi.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Wi.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Wi.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Wi.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Wi.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Wi.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Wi.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Wi.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Wi.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function LS(r){const t=new Uint32Array(r);if(t[0]!==yS)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(r,0,il/Uint32Array.BYTES_PER_ELEMENT),i=e[rl.HEIGHT],s=e[rl.WIDTH],n=e[rl.MIPMAP_COUNT],o=new Uint32Array(r,rl.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,vS/Uint32Array.BYTES_PER_ELEMENT),h=o[bS];if(h&SS){const d=o[xS.FOURCC];if(d!==MS){const V=RS[d],I=Su+il,Y=new Uint8Array(r,I);return[new Bn(Y,{format:V,width:s,height:i,levels:n})]}const p=Su+il,m=new Uint32Array(t.buffer,p,Vp/Uint32Array.BYTES_PER_ELEMENT),v=m[sl.DXGI_FORMAT],b=m[sl.RESOURCE_DIMENSION],y=m[sl.MISC_FLAG],P=m[sl.ARRAY_SIZE],M=BS[v];if(M===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${v}`);if(y===kS)throw new Error("DDSParser does not support cubemap textures");if(b===6)throw new Error("DDSParser does not supported 3D texture data");const z=new Array,q=Su+il+Vp;if(P===1)z.push(new Uint8Array(r,q));else{const V=rh[M];let I=0,Y=s,K=i;for(let at=0;at<n;at++){const ct=Math.max(1,Y+3&-4),pt=Math.max(1,K+3&-4),wt=ct*pt*V;I+=wt,Y=Y>>>1,K=K>>>1}let T=q;for(let at=0;at<P;at++)z.push(new Uint8Array(r,T,I)),T+=I}return z.map(V=>new Bn(V,{format:M,width:s,height:i,levels:n}))}throw h&CS?new Error("DDSParser does not support uncompressed texture data."):h&ES?new Error("DDSParser does not supported YUV uncompressed texture data."):h&PS?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&wS?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Hp=[171,75,84,88,32,49,49,187,13,10,26,10],DS=67305985,wr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Nc=64,Wp={[oe.UNSIGNED_BYTE]:1,[oe.UNSIGNED_SHORT]:2,[oe.INT]:4,[oe.UNSIGNED_INT]:4,[oe.FLOAT]:4,[oe.HALF_FLOAT]:8},FS={[Ft.RGBA]:4,[Ft.RGB]:3,[Ft.RG]:2,[Ft.RED]:1,[Ft.LUMINANCE]:1,[Ft.LUMINANCE_ALPHA]:2,[Ft.ALPHA]:1},OS={[oe.UNSIGNED_SHORT_4_4_4_4]:2,[oe.UNSIGNED_SHORT_5_5_5_1]:2,[oe.UNSIGNED_SHORT_5_6_5]:2};function NS(r,t,e=!1){const i=new DataView(t);if(!US(r,i))return null;const s=i.getUint32(wr.ENDIANNESS,!0)===DS,n=i.getUint32(wr.GL_TYPE,s),o=i.getUint32(wr.GL_FORMAT,s),h=i.getUint32(wr.GL_INTERNAL_FORMAT,s),d=i.getUint32(wr.PIXEL_WIDTH,s),p=i.getUint32(wr.PIXEL_HEIGHT,s)||1,m=i.getUint32(wr.PIXEL_DEPTH,s)||1,v=i.getUint32(wr.NUMBER_OF_ARRAY_ELEMENTS,s)||1,b=i.getUint32(wr.NUMBER_OF_FACES,s),y=i.getUint32(wr.NUMBER_OF_MIPMAP_LEVELS,s),P=i.getUint32(wr.BYTES_OF_KEY_VALUE_DATA,s);if(p===0||m!==1)throw new Error("Only 2D textures are supported");if(b!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(v!==1)throw new Error("WebGL does not support array textures");const M=4,z=4,q=d+3&-4,V=p+3&-4,I=new Array(v);let Y=d*p;n===0&&(Y=q*V);let K;if(n!==0?Wp[n]?K=Wp[n]*FS[o]:K=OS[n]:K=rh[h],K===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const T=e?GS(i,P,s):null;let at=Y*K,ct=d,pt=p,wt=q,It=V,bt=Nc+P;for(let dt=0;dt<y;dt++){const ht=i.getUint32(bt,s);let Mt=bt+4;for(let _t=0;_t<v;_t++){let Rt=I[_t];Rt||(Rt=I[_t]=new Array(y)),Rt[dt]={levelID:dt,levelWidth:y>1||n!==0?ct:wt,levelHeight:y>1||n!==0?pt:It,levelBuffer:new Uint8Array(t,Mt,at)},Mt+=at}bt+=ht+4,bt=bt%4!==0?bt+4-bt%4:bt,ct=ct>>1||1,pt=pt>>1||1,wt=ct+M-1&~(M-1),It=pt+z-1&~(z-1),at=wt*It*K}return n!==0?{uncompressed:I.map(dt=>{let ht=dt[0].levelBuffer,Mt=!1;return n===oe.FLOAT?ht=new Float32Array(dt[0].levelBuffer.buffer,dt[0].levelBuffer.byteOffset,dt[0].levelBuffer.byteLength/4):n===oe.UNSIGNED_INT?(Mt=!0,ht=new Uint32Array(dt[0].levelBuffer.buffer,dt[0].levelBuffer.byteOffset,dt[0].levelBuffer.byteLength/4)):n===oe.INT&&(Mt=!0,ht=new Int32Array(dt[0].levelBuffer.buffer,dt[0].levelBuffer.byteOffset,dt[0].levelBuffer.byteLength/4)),{resource:new _h(ht,{width:dt[0].levelWidth,height:dt[0].levelHeight}),type:n,format:Mt?zS(o):o}}),kvData:T}:{compressed:I.map(dt=>new Bn(null,{format:h,width:d,height:p,levels:y,levelBuffers:dt})),kvData:T}}function US(r,t){for(let e=0;e<Hp.length;e++)if(t.getUint8(e)!==Hp[e])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function zS(r){switch(r){case Ft.RGBA:return Ft.RGBA_INTEGER;case Ft.RGB:return Ft.RGB_INTEGER;case Ft.RG:return Ft.RG_INTEGER;case Ft.RED:return Ft.RED_INTEGER;default:return r}}function GS(r,t,e){const i=new Map;let s=0;for(;s<t;){const n=r.getUint32(Nc+s,e),o=Nc+s+4,h=3-(n+3)%4;if(n===0||n>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let d=0;for(;d<n&&r.getUint8(o+d)!==0;d++);if(d===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const p=new TextDecoder().decode(new Uint8Array(r.buffer,o,d)),m=new DataView(r.buffer,o+d+1,n-d-1);i.set(p,m),s+=4+n+h}return i}const VS={extension:{type:Xt.LoadParser,priority:Dr.High},name:"loadDDS",test(r){return Qs(r,".dds")},async load(r,t,e){const i=await(await qt.ADAPTER.fetch(r)).arrayBuffer(),s=LS(i).map(n=>{const o=new Se(n,{mipmap:ts.OFF,alphaMode:ar.NO_PREMULTIPLIED_ALPHA,resolution:vs(r),...t.data});return So(o,e,r)});return s.length===1?s[0]:s},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};te.add(VS);const HS={extension:{type:Xt.LoadParser,priority:Dr.High},name:"loadKTX",test(r){return Qs(r,".ktx")},async load(r,t,e){const i=await(await qt.ADAPTER.fetch(r)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:o}=NS(r,i),h=s??n,d={mipmap:ts.OFF,alphaMode:ar.NO_PREMULTIPLIED_ALPHA,resolution:vs(r),...t.data},p=h.map(m=>{h===n&&Object.assign(d,{type:m.type,format:m.format});const v=m.resource??m,b=new Se(v,d);return b.ktxKeyValueData=o,So(b,e,r)});return p.length===1?p[0]:p},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};te.add(HS);const WS=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],XS={extension:Xt.ResolveParser,test:r=>{const t=Ni.extname(r).slice(1);return["basis","ktx","dds"].includes(t)},parse:r=>{var i,s;const t=r.split("."),e=t.pop();if(["ktx","dds"].includes(e)){const n=t.pop();if(WS.includes(n))return{resolution:parseFloat(((i=qt.RETINA_PREFIX.exec(r))==null?void 0:i[1])??"1"),format:n,src:r}}return{resolution:parseFloat(((s=qt.RETINA_PREFIX.exec(r))==null?void 0:s[1])??"1"),format:e,src:r}}};te.add(XS);const nl=new Pe,jS=4,mm=class Ja{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,i,s){const n=new Image;return n.src=await this.base64(t,e,i,s),n}async base64(t,e,i,s){const n=this.canvas(t,s);if(n.toBlob!==void 0)return new Promise((o,h)=>{n.toBlob(d=>{if(!d){h(new Error("ICanvas.toBlob failed!"));return}const p=new FileReader;p.onload=()=>o(p.result),p.onerror=h,p.readAsDataURL(d)},e,i)});if(n.toDataURL!==void 0)return n.toDataURL(e,i);if(n.convertToBlob!==void 0){const o=await n.convertToBlob({type:e,quality:i});return new Promise((h,d)=>{const p=new FileReader;p.onload=()=>h(p.result),p.onerror=d,p.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:i,width:s,height:n,flipY:o,premultipliedAlpha:h}=this._rawPixels(t,e);o&&Ja._flipY(i,s,n),h&&Ja._unpremultiplyAlpha(i);const d=new P1(s,n,1),p=new ImageData(new Uint8ClampedArray(i.buffer),s,n);return d.context.putImageData(p,0,0),d.canvas}pixels(t,e){const{pixels:i,width:s,height:n,flipY:o,premultipliedAlpha:h}=this._rawPixels(t,e);return o&&Ja._flipY(i,s,n),h&&Ja._unpremultiplyAlpha(i),i}_rawPixels(t,e){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,n=!1,o=!1,h,d=!1;t&&(t instanceof Ks?h=t:(h=i.generateTexture(t,{region:e,resolution:i.resolution,multisample:i.multisample}),d=!0,e&&(nl.width=e.width,nl.height=e.height,e=nl)));const p=i.gl;if(h){if(s=h.baseTexture.resolution,e=e??h.frame,n=!1,o=h.baseTexture.alphaMode>0&&h.baseTexture.format===Ft.RGBA,!d){i.renderTexture.bind(h);const y=h.framebuffer.glFramebuffers[i.CONTEXT_UID];y.blitFramebuffer&&i.framebuffer.bind(y.blitFramebuffer)}}else s=i.resolution,e||(e=nl,e.width=i.width/s,e.height=i.height/s),n=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const m=Math.max(Math.round(e.width*s),1),v=Math.max(Math.round(e.height*s),1),b=new Uint8Array(jS*m*v);return p.readPixels(Math.round(e.x*s),Math.round(e.y*s),m,v,p.RGBA,p.UNSIGNED_BYTE,b),d&&(h==null||h.destroy(!0)),{pixels:b,width:m,height:v,flipY:n,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,i){const s=e<<2,n=i>>1,o=new Uint8Array(s);for(let h=0;h<n;h++){const d=h*s,p=(i-h-1)*s;o.set(t.subarray(d,d+s)),t.copyWithin(d,p,p+s),t.set(o,p)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let i=0;i<e;i+=4){const s=t[i+3];if(s!==0){const n=255.001/s;t[i]=t[i]*n+.5,t[i+1]=t[i+1]*n+.5,t[i+2]=t[i+2]*n+.5}}}};mm.extension={name:"extract",type:Xt.RendererSystem};let $S=mm;te.add($S);const sh={build(r){const t=r.points;let e,i,s,n,o,h;if(r.type===Xi.CIRC){const P=r.shape;e=P.x,i=P.y,o=h=P.radius,s=n=0}else if(r.type===Xi.ELIP){const P=r.shape;e=P.x,i=P.y,o=P.width,h=P.height,s=n=0}else{const P=r.shape,M=P.width/2,z=P.height/2;e=P.x+M,i=P.y+z,o=h=Math.max(0,Math.min(P.radius,Math.min(M,z))),s=M-o,n=z-h}if(!(o>=0&&h>=0&&s>=0&&n>=0)){t.length=0;return}const d=Math.ceil(2.3*Math.sqrt(o+h)),p=d*8+(s?4:0)+(n?4:0);if(t.length=p,p===0)return;if(d===0){t.length=8,t[0]=t[6]=e+s,t[1]=t[3]=i+n,t[2]=t[4]=e-s,t[5]=t[7]=i-n;return}let m=0,v=d*4+(s?2:0)+2,b=v,y=p;{const P=s+o,M=n,z=e+P,q=e-P,V=i+M;if(t[m++]=z,t[m++]=V,t[--v]=V,t[--v]=q,n){const I=i-M;t[b++]=q,t[b++]=I,t[--y]=I,t[--y]=z}}for(let P=1;P<d;P++){const M=Math.PI/2*(P/d),z=s+Math.cos(M)*o,q=n+Math.sin(M)*h,V=e+z,I=e-z,Y=i+q,K=i-q;t[m++]=V,t[m++]=Y,t[--v]=Y,t[--v]=I,t[b++]=I,t[b++]=K,t[--y]=K,t[--y]=V}{const P=s,M=n+h,z=e+P,q=e-P,V=i+M,I=i-M;t[m++]=z,t[m++]=V,t[--y]=I,t[--y]=z,s&&(t[m++]=q,t[m++]=V,t[--y]=I,t[--y]=q)}},triangulate(r,t){const e=r.points,i=t.points,s=t.indices;if(e.length===0)return;let n=i.length/2;const o=n;let h,d;if(r.type!==Xi.RREC){const m=r.shape;h=m.x,d=m.y}else{const m=r.shape;h=m.x+m.width/2,d=m.y+m.height/2}const p=r.matrix;i.push(r.matrix?p.a*h+p.c*d+p.tx:h,r.matrix?p.b*h+p.d*d+p.ty:d),n++,i.push(e[0],e[1]);for(let m=2;m<e.length;m+=2)i.push(e[m],e[m+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function Xp(r,t=!1){const e=r.length;if(e<6)return;let i=0;for(let s=0,n=r[e-2],o=r[e-1];s<e;s+=2){const h=r[s],d=r[s+1];i+=(h-n)*(d+o),n=h,o=d}if(!t&&i>0||t&&i<=0){const s=e/2;for(let n=s+s%2;n<e;n+=2){const o=e-n-2,h=e-n-1,d=n,p=n+1;[r[o],r[d]]=[r[d],r[o]],[r[h],r[p]]=[r[p],r[h]]}}}const _m={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points;const i=r.holes,s=t.points,n=t.indices;if(e.length>=6){Xp(e,!1);const o=[];for(let p=0;p<i.length;p++){const m=i[p];Xp(m.points,!0),o.push(e.length/2),e=e.concat(m.points)}const h=Rv(e,o,2);if(!h)return;const d=s.length/2;for(let p=0;p<h.length;p+=3)n.push(h[p]+d),n.push(h[p+1]+d),n.push(h[p+2]+d);for(let p=0;p<e.length;p++)s.push(e[p])}}},YS={build(r){const t=r.shape,e=t.x,i=t.y,s=t.width,n=t.height,o=r.points;o.length=0,s>=0&&n>=0&&o.push(e,i,e+s,i,e+s,i+n,e,i+n)},triangulate(r,t){const e=r.points,i=t.points;if(e.length===0)return;const s=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},qS={build(r){sh.build(r)},triangulate(r,t){sh.triangulate(r,t)}};var gr=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(gr||{}),Vs=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(Vs||{});const On={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}},Uc=On;class jp{static curveTo(t,e,i,s,n,o){const h=o[o.length-2],d=o[o.length-1]-e,p=h-t,m=s-e,v=i-t,b=Math.abs(d*v-p*m);if(b<1e-8||n===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;const y=d*d+p*p,P=m*m+v*v,M=d*m+p*v,z=n*Math.sqrt(y)/b,q=n*Math.sqrt(P)/b,V=z*M/y,I=q*M/P,Y=z*v+q*p,K=z*m+q*d,T=p*(q+V),at=d*(q+V),ct=v*(z+I),pt=m*(z+I),wt=Math.atan2(at-K,T-Y),It=Math.atan2(pt-K,ct-Y);return{cx:Y+t,cy:K+e,radius:n,startAngle:wt,endAngle:It,anticlockwise:p*m>v*d}}static arc(t,e,i,s,n,o,h,d,p){const m=h-o,v=On._segmentsCount(Math.abs(m)*n,Math.ceil(Math.abs(m)/ql)*40),b=m/(v*2),y=b*2,P=Math.cos(b),M=Math.sin(b),z=v-1,q=z%1/z;for(let V=0;V<=z;++V){const I=V+q*V,Y=b+o+y*I,K=Math.cos(Y),T=-Math.sin(Y);p.push((P*K+M*T)*n+i,(P*-T+M*K)*n+s)}}}class ZS{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class yd{static curveLength(t,e,i,s,n,o,h,d){let p=0,m=0,v=0,b=0,y=0,P=0,M=0,z=0,q=0,V=0,I=0,Y=t,K=e;for(let T=1;T<=10;++T)m=T/10,v=m*m,b=v*m,y=1-m,P=y*y,M=P*y,z=M*t+3*P*m*i+3*y*v*n+b*h,q=M*e+3*P*m*s+3*y*v*o+b*d,V=Y-z,I=K-q,Y=z,K=q,p+=Math.sqrt(V*V+I*I);return p}static curveTo(t,e,i,s,n,o,h){const d=h[h.length-2],p=h[h.length-1];h.length-=2;const m=On._segmentsCount(yd.curveLength(d,p,t,e,i,s,n,o));let v=0,b=0,y=0,P=0,M=0;h.push(d,p);for(let z=1,q=0;z<=m;++z)q=z/m,v=1-q,b=v*v,y=b*v,P=q*q,M=P*q,h.push(y*d+3*b*q*t+3*v*P*i+M*n,y*p+3*b*q*e+3*v*P*s+M*o)}}function $p(r,t,e,i,s,n,o,h){const d=r-e*s,p=t-i*s,m=r+e*n,v=t+i*n;let b,y;o?(b=i,y=-e):(b=-i,y=e);const P=d+b,M=p+y,z=m+b,q=v+y;return h.push(P,M,z,q),2}function dn(r,t,e,i,s,n,o,h){const d=e-r,p=i-t;let m=Math.atan2(d,p),v=Math.atan2(s-r,n-t);h&&m<v?m+=Math.PI*2:!h&&m>v&&(v+=Math.PI*2);let b=m;const y=v-m,P=Math.abs(y),M=Math.sqrt(d*d+p*p),z=(15*P*Math.sqrt(M)/Math.PI>>0)+1,q=y/z;if(b+=q,h){o.push(r,t,e,i);for(let V=1,I=b;V<z;V++,I+=q)o.push(r,t,r+Math.sin(I)*M,t+Math.cos(I)*M);o.push(r,t,s,n)}else{o.push(e,i,r,t);for(let V=1,I=b;V<z;V++,I+=q)o.push(r+Math.sin(I)*M,t+Math.cos(I)*M,r,t);o.push(s,n,r,t)}return z*2}function KS(r,t){const e=r.shape;let i=r.points||e.points.slice();const s=t.closePointEps;if(i.length===0)return;const n=r.lineStyle,o=new Ue(i[0],i[1]),h=new Ue(i[i.length-2],i[i.length-1]),d=e.type!==Xi.POLY||e.closeStroke,p=Math.abs(o.x-h.x)<s&&Math.abs(o.y-h.y)<s;if(d){i=i.slice(),p&&(i.pop(),i.pop(),h.set(i[i.length-2],i[i.length-1]));const Rt=(o.x+h.x)*.5,kt=(h.y+o.y)*.5;i.unshift(Rt,kt),i.push(Rt,kt)}const m=t.points,v=i.length/2;let b=i.length;const y=m.length/2,P=n.width/2,M=P*P,z=n.miterLimit*n.miterLimit;let q=i[0],V=i[1],I=i[2],Y=i[3],K=0,T=0,at=-(V-Y),ct=q-I,pt=0,wt=0,It=Math.sqrt(at*at+ct*ct);at/=It,ct/=It,at*=P,ct*=P;const bt=n.alignment,dt=(1-bt)*2,ht=bt*2;d||(n.cap===Vs.ROUND?b+=dn(q-at*(dt-ht)*.5,V-ct*(dt-ht)*.5,q-at*dt,V-ct*dt,q+at*ht,V+ct*ht,m,!0)+2:n.cap===Vs.SQUARE&&(b+=$p(q,V,at,ct,dt,ht,!0,m))),m.push(q-at*dt,V-ct*dt,q+at*ht,V+ct*ht);for(let Rt=1;Rt<v-1;++Rt){q=i[(Rt-1)*2],V=i[(Rt-1)*2+1],I=i[Rt*2],Y=i[Rt*2+1],K=i[(Rt+1)*2],T=i[(Rt+1)*2+1],at=-(V-Y),ct=q-I,It=Math.sqrt(at*at+ct*ct),at/=It,ct/=It,at*=P,ct*=P,pt=-(Y-T),wt=I-K,It=Math.sqrt(pt*pt+wt*wt),pt/=It,wt/=It,pt*=P,wt*=P;const kt=I-q,Gt=V-Y,vt=I-K,Pt=T-Y,Vt=kt*vt+Gt*Pt,le=Gt*vt-Pt*kt,re=le<0;if(Math.abs(le)<.001*Math.abs(Vt)){m.push(I-at*dt,Y-ct*dt,I+at*ht,Y+ct*ht),Vt>=0&&(n.join===gr.ROUND?b+=dn(I,Y,I-at*dt,Y-ct*dt,I-pt*dt,Y-wt*dt,m,!1)+4:b+=2,m.push(I-pt*ht,Y-wt*ht,I+pt*dt,Y+wt*dt));continue}const ee=(-at+q)*(-ct+Y)-(-at+I)*(-ct+V),Qt=(-pt+K)*(-wt+Y)-(-pt+I)*(-wt+T),xe=(kt*Qt-vt*ee)/le,Fe=(Pt*ee-Gt*Qt)/le,se=(xe-I)*(xe-I)+(Fe-Y)*(Fe-Y),ne=I+(xe-I)*dt,Zt=Y+(Fe-Y)*dt,Oe=I-(xe-I)*ht,Ae=Y-(Fe-Y)*ht,Xe=Math.min(kt*kt+Gt*Gt,vt*vt+Pt*Pt),Ve=re?dt:ht,ci=Xe+Ve*Ve*M,mi=se<=ci;let Ii=n.join;if(Ii===gr.MITER&&se/M>z&&(Ii=gr.BEVEL),mi)switch(Ii){case gr.MITER:{m.push(ne,Zt,Oe,Ae);break}case gr.BEVEL:{re?m.push(ne,Zt,I+at*ht,Y+ct*ht,ne,Zt,I+pt*ht,Y+wt*ht):m.push(I-at*dt,Y-ct*dt,Oe,Ae,I-pt*dt,Y-wt*dt,Oe,Ae),b+=2;break}case gr.ROUND:{re?(m.push(ne,Zt,I+at*ht,Y+ct*ht),b+=dn(I,Y,I+at*ht,Y+ct*ht,I+pt*ht,Y+wt*ht,m,!0)+4,m.push(ne,Zt,I+pt*ht,Y+wt*ht)):(m.push(I-at*dt,Y-ct*dt,Oe,Ae),b+=dn(I,Y,I-at*dt,Y-ct*dt,I-pt*dt,Y-wt*dt,m,!1)+4,m.push(I-pt*dt,Y-wt*dt,Oe,Ae));break}}else{switch(m.push(I-at*dt,Y-ct*dt,I+at*ht,Y+ct*ht),Ii){case gr.MITER:{re?m.push(Oe,Ae,Oe,Ae):m.push(ne,Zt,ne,Zt),b+=2;break}case gr.ROUND:{re?b+=dn(I,Y,I+at*ht,Y+ct*ht,I+pt*ht,Y+wt*ht,m,!0)+2:b+=dn(I,Y,I-at*dt,Y-ct*dt,I-pt*dt,Y-wt*dt,m,!1)+2;break}}m.push(I-pt*dt,Y-wt*dt,I+pt*ht,Y+wt*ht),b+=2}}q=i[(v-2)*2],V=i[(v-2)*2+1],I=i[(v-1)*2],Y=i[(v-1)*2+1],at=-(V-Y),ct=q-I,It=Math.sqrt(at*at+ct*ct),at/=It,ct/=It,at*=P,ct*=P,m.push(I-at*dt,Y-ct*dt,I+at*ht,Y+ct*ht),d||(n.cap===Vs.ROUND?b+=dn(I-at*(dt-ht)*.5,Y-ct*(dt-ht)*.5,I-at*dt,Y-ct*dt,I+at*ht,Y+ct*ht,m,!1)+2:n.cap===Vs.SQUARE&&(b+=$p(I,Y,at,ct,dt,ht,!1,m)));const Mt=t.indices,_t=On.epsilon*On.epsilon;for(let Rt=y;Rt<b+y-2;++Rt)q=m[Rt*2],V=m[Rt*2+1],I=m[(Rt+1)*2],Y=m[(Rt+1)*2+1],K=m[(Rt+2)*2],T=m[(Rt+2)*2+1],!(Math.abs(q*(Y-T)+I*(T-V)+K*(V-Y))<_t)&&Mt.push(Rt,Rt+1,Rt+2)}function QS(r,t){let e=0;const i=r.shape,s=r.points||i.points,n=i.type!==Xi.POLY||i.closeStroke;if(s.length===0)return;const o=t.points,h=t.indices,d=s.length/2,p=o.length/2;let m=p;for(o.push(s[0],s[1]),e=1;e<d;e++)o.push(s[e*2],s[e*2+1]),h.push(m,m+1),m++;n&&h.push(m,p)}function Yp(r,t){r.lineStyle.native?QS(r,t):KS(r,t)}class xd{static curveLength(t,e,i,s,n,o){const h=t-2*i+n,d=e-2*s+o,p=2*i-2*t,m=2*s-2*e,v=4*(h*h+d*d),b=4*(h*p+d*m),y=p*p+m*m,P=2*Math.sqrt(v+b+y),M=Math.sqrt(v),z=2*v*M,q=2*Math.sqrt(y),V=b/M;return(z*P+M*b*(P-q)+(4*y*v-b*b)*Math.log((2*M+V+P)/(V+q)))/(4*z)}static curveTo(t,e,i,s,n){const o=n[n.length-2],h=n[n.length-1],d=On._segmentsCount(xd.curveLength(o,h,t,e,i,s));let p=0,m=0;for(let v=1;v<=d;++v){const b=v/d;p=o+(t-o)*b,m=h+(e-h)*b,n.push(p+(t+(i-t)*b-p)*b,m+(e+(s-e)*b-m)*b)}}}const Cu={[Xi.POLY]:_m,[Xi.CIRC]:sh,[Xi.ELIP]:sh,[Xi.RECT]:YS,[Xi.RREC]:qS},qp=[],al=[];class nh{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new nh(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Zn=new Ue,vm=class ym extends x0{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new th,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),al.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),qp.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,s=null){const n=new nh(t,e,i,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new nh(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const s=e[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,Zn):Zn.copyFrom(t),s.shape.contains(Zn.x,Zn.y))){let n=!1;if(s.holes){for(let o=0;o<s.holes.length;o++)if(s.holes[o].shape.contains(Zn.x,Zn.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let d=this.shapeIndex;d<e.length;d++){this.shapeIndex++;const p=e[d],m=p.fillStyle,v=p.lineStyle;Cu[p.type].build(p),p.matrix&&this.transformPoints(p.points,p.matrix),(m.visible||v.visible)&&this.processHoles(p.holes);for(let b=0;b<2;b++){const y=b===0?m:v;if(!y.visible)continue;const P=y.texture.baseTexture,M=this.indices.length,z=this.points.length/2;P.wrapMode=Xs.REPEAT,b===0?this.processFill(p):this.processLine(p);const q=this.points.length/2-z;q!==0&&(i&&!this._compareStyles(s,y)&&(i.end(M,z),i=null),i||(i=qp.pop()||new ZS,i.begin(y,M,z),this.batches.push(i),s=y),this.addUvs(this.points,t,y.texture,z,q,y.matrix))}}const n=this.indices.length,o=this.points.length/2;if(i&&i.end(n,o),this.batches.length===0){this.batchable=!0;return}const h=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&h===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=h?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const i=this.graphicsData[t],s=i.fillStyle,n=i.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const s=t[e];for(let n=0;n<s.size;n++){const o=s.start+n;this.indicesUint16[o]=this.indicesUint16[o]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<ym.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++Se._globalBatch;for(let v=0;v<this.drawCalls.length;v++)this.drawCalls[v].texArray.clear(),al.push(this.drawCalls[v]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let s=al.pop();s||(s=new mc,s.texArray=new xc),s.texArray.count=0,s.start=0,s.size=0,s.type=Zr.TRIANGLES;let n=0,o=null,h=0,d=!1,p=Zr.TRIANGLES,m=0;this.drawCalls.push(s);for(let v=0;v<this.batches.length;v++){const b=this.batches[v],y=8,P=b.style,M=P.texture.baseTexture;d!==!!P.native&&(d=!!P.native,p=d?Zr.LINES:Zr.TRIANGLES,o=null,n=y,t++),o!==M&&(o=M,M._batchEnabled!==t&&(n===y&&(t++,n=0,s.size>0&&(s=al.pop(),s||(s=new mc,s.texArray=new xc),this.drawCalls.push(s)),s.start=m,s.size=0,s.texArray.count=0,s.type=p),M.touched=1,M._batchEnabled=t,M._batchLocation=n,M.wrapMode=Xs.REPEAT,s.texArray.elements[s.texArray.count++]=M,n++)),s.size+=b.size,m+=b.size,h=M._batchLocation,this.addColors(e,P.color,P.alpha,b.attribSize,b.attribStart),this.addTextureIds(i,h,b.attribSize,b.attribStart)}Se._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,n=new ArrayBuffer(t.length*3*4),o=new Float32Array(n),h=new Uint32Array(n);let d=0;for(let p=0;p<t.length/2;p++)o[d++]=t[p*2],o[d++]=t[p*2+1],o[d++]=e[p*2],o[d++]=e[p*2+1],h[d++]=i[p],o[d++]=s[p];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?_m.triangulate(t,this):Cu[t.type].triangulate(t,this)}processLine(t){Yp(t,this);for(let e=0;e<t.holes.length;e++)Yp(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];Cu[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const s=t[i*2],n=t[i*2+1];t[i*2]=e.a*s+e.c*n+e.tx,t[i*2+1]=e.b*s+e.d*n+e.ty}}addColors(t,e,i,s,n=0){const o=Je.shared.setValue(e).toLittleEndianNumber(),h=Je.shared.setValue(o).toPremultiplied(i);t.length=Math.max(t.length,n+s);for(let d=0;d<s;d++)t[n+d]=h}addTextureIds(t,e,i,s=0){t.length=Math.max(t.length,s+i);for(let n=0;n<i;n++)t[s+n]=e}addUvs(t,e,i,s,n,o=null){let h=0;const d=e.length,p=i.frame;for(;h<n;){let v=t[(s+h)*2],b=t[(s+h)*2+1];if(o){const y=o.a*v+o.c*b+o.tx;b=o.b*v+o.d*b+o.ty,v=y}h++,e.push(v/p.width,b/p.height)}const m=i.baseTexture;(p.width<m.width||p.height<m.height)&&this.adjustUvs(e,i,d,n)}adjustUvs(t,e,i,s){const n=e.baseTexture,o=1e-6,h=i+s*2,d=e.frame,p=d.width/n.width,m=d.height/n.height;let v=d.x/d.width,b=d.y/d.height,y=Math.floor(t[i]+o),P=Math.floor(t[i+1]+o);for(let M=i+2;M<h;M+=2)y=Math.min(y,Math.floor(t[M]+o)),P=Math.min(P,Math.floor(t[M+1]+o));v-=y,b-=P;for(let M=i;M<h;M+=2)t[M]=(t[M]+v)*p,t[M+1]=(t[M+1]+b)*m}};vm.BATCHABLE_SIZE=100;let JS=vm;class Sh{constructor(){this.color=16777215,this.alpha=1,this.texture=Jt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Sh;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Jt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class bd extends Sh{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Vs.BUTT,this.join=gr.MITER,this.miterLimit=10}clone(){const t=new bd;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Vs.BUTT,this.join=gr.MITER,this.miterLimit=10}}const Eu={},zc=class kl extends Ui{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Sh,this._lineStyle=new bd,this._matrix=null,this._holeMode=!1,this.state=Zs.for2d(),this._geometry=t||new JS,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Je(16777215),this.blendMode=fe.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new kl(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i,s=.5,n=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:i,alignment:s,native:n}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Jt.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Vs.BUTT,join:gr.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.width>0&&t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:i},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Rn,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Rn,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],n=i[i.length-1];return(s!==t||n!==e)&&i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),xd.curveTo(t,e,i,s,n),this}bezierCurveTo(t,e,i,s,n,o){return this._initCurve(),yd.curveTo(t,e,i,s,n,o,this.currentPath.points),this}arcTo(t,e,i,s,n){this._initCurve(t,e);const o=this.currentPath.points,h=jp.curveTo(t,e,i,s,n,o);if(h){const{cx:d,cy:p,radius:m,startAngle:v,endAngle:b,anticlockwise:y}=h;this.arc(d,p,m,v,b,y)}return this}arc(t,e,i,s,n,o=!1){if(s===n)return this;if(!o&&n<=s?n+=ql:o&&s<=n&&(s+=ql),n-s===0)return this;const h=t+Math.cos(s)*i,d=e+Math.sin(s)*i,p=this._geometry.closePointEps;let m=this.currentPath?this.currentPath.points:null;if(m){const v=Math.abs(m[m.length-2]-h),b=Math.abs(m[m.length-1]-d);v<p&&b<p||m.push(h,d)}else this.moveTo(h,d),m=this.currentPath.points;return jp.arc(h,d,t,e,i,s,n,o,m),this}beginFill(t=0,e){return this.beginTextureFill({texture:Jt.WHITE,color:t,alpha:e})}normalizeColor(t){const e=Je.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Jt.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const i=t.alpha>0;return i?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:i},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,s){return this.drawShape(new Pe(t,e,i,s))}drawRoundedRect(t,e,i,s,n){return this.drawShape(new yh(t,e,i,s,n))}drawCircle(t,e,i){return this.drawShape(new vh(t,e,i))}drawEllipse(t,e,i,s){return this.drawShape(new w0(t,e,i,s))}drawPolygon(...t){let e,i=!0;const s=t[0];s.points?(i=s.closeStroke,e=s.points):Array.isArray(t[0])?e=t[0]:e=t;const n=new Rn(e);return n.closeStroke=i,this.drawShape(n),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===Xi.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let s=0;s<i;s++){const n=t.batches[s],o=n.style.color,h=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),d=new Float32Array(t.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),p=new Uint16Array(t.indicesUint16.buffer,n.start*2,n.size),m={vertexData:h,blendMode:e,indices:p,uvs:d,_batchRGB:Je.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=m}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const s=this.batches[e];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,s=this.worldAlpha,n=e.uniforms,o=i.drawCalls;n.translationMatrix=this.transform.worldTransform,Je.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let h=0,d=o.length;h<d;h++)this._renderDrawCallDirect(t,i.drawCalls[h])}_renderDrawCallDirect(t,e){const{texArray:i,type:s,size:n,start:o}=e,h=i.count;for(let d=0;d<h;d++)t.texture.bind(i.elements[d],d);t.geometry.draw(s,n,o)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!Eu[i]){const{maxTextures:s}=t.plugins[i],n=new Int32Array(s);for(let d=0;d<s;d++)n[d]=d;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new gi,default:Br.from({uSamplers:n},!0)},h=t.plugins[i]._shader.program;Eu[i]=new Jr(h,o)}e=Eu[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:s,maxY:n}=t.bounds;this._bounds.addFrame(this.transform,e,i,s,n)}containsPoint(t){return this.worldTransform.applyInverse(t,kl._TEMP_POINT),this._geometry.containsPoint(kl._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Je.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,s=e.b,n=e.c,o=e.d,h=e.tx,d=e.ty,p=this._geometry.points,m=this.vertexData;let v=0;for(let b=0;b<p.length;b+=2){const y=p[b],P=p[b+1];m[v++]=i*y+n*P+h,m[v++]=o*P+s*y+d}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};zc.curves=On,zc._TEMP_POINT=new Ue;let Ri=zc;class tC{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const Pu=new Ue,Zp=new Rn,xm=class bm extends Ui{constructor(t,e,i,s=Zr.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||Zs.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=qt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Zr.TRIANGLES&&e.length<bm.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,n=s.a,o=s.b,h=s.c,d=s.d,p=s.tx,m=s.ty,v=this.vertexData;for(let b=0;b<v.length/2;b++){const y=e[b*2],P=e[b*2+1];v[b*2]=n*y+h*P+p,v[b*2+1]=o*y+d*P+m}if(this._roundPixels){const b=qt.RESOLUTION;for(let y=0;y<v.length;++y)v[y]=Math.round(v[y]*b)/b}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new tC(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Pu);const e=this.geometry.getBuffer("aVertexPosition").data,i=Zp.points,s=this.geometry.getIndex().data,n=s.length,o=this.drawMode===4?3:1;for(let h=0;h+2<n;h+=o){const d=s[h]*2,p=s[h+1]*2,m=s[h+2]*2;if(i[0]=e[d],i[1]=e[d+1],i[2]=e[p],i[3]=e[p+1],i[4]=e[m],i[5]=e[m+1],Zp.contains(Pu.x,Pu.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};xm.BATCHABLE_SIZE=100;let Kp=xm;class eC extends $s{constructor(t,e,i){super();const s=new wi(t),n=new wi(e,!0),o=new wi(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,oe.FLOAT).addAttribute("aTextureCoord",n,2,!1,oe.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var iC=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,rC=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Qp extends Jr{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:gi.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||ps.from(rC,iC),i),this._colorDirty=!1,this.uvMatrix=new O0(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new Je(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Je.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Jp{constructor(t,e,i){this.geometry=new $s,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let n=t[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||oe.FLOAT,offset:n.offset},e[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new wi(C1(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const h=this.dynamicProperties[o];h.offset=e,e+=h.size,this.dynamicStride+=h.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new wi(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const h=this.staticProperties[o];h.offset=s,s+=h.size,this.staticStride+=h.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new wi(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const h=this.dynamicProperties[o];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===oe.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const h=this.staticProperties[o];t.addAttribute(h.attributeName,this.staticBuffer,0,h.type===oe.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){const n=this.dynamicProperties[s];n.uploadFunction(t,e,i,n.type===oe.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){const n=this.staticProperties[s];n.uploadFunction(t,e,i,n.type===oe.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var sC=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,nC=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class wm extends xh{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new gi,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:oe.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Jr.from(nC,sC,{}),this.state=Zs.for2d()}render(t){const e=t.children,i=t._maxSize,s=t._batchSize,n=this.renderer;let o=e.length;if(o===0)return;o>i&&!t.autoResize&&(o=i);let h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));const d=e[0]._texture.baseTexture,p=d.alphaMode>0;this.state.blendMode=m0(t.blendMode,p),n.state.set(this.state);const m=n.gl,v=t.worldTransform.copyTo(this.tempMatrix);v.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=v.toArray(!0),this.shader.uniforms.uColor=Je.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,p).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=d,this.renderer.shader.bind(this.shader);let b=!1;for(let y=0,P=0;y<o;y+=s,P+=1){let M=o-y;M>s&&(M=s),P>=h.length&&h.push(this._generateOneMoreBuffer(t));const z=h[P];z.uploadDynamic(e,y,M);const q=t._bufferUpdateIDs[P]||0;b=b||z._updateID<q,b&&(z._updateID=t._updateID,z.uploadStatic(e,y,M)),n.geometry.bind(z.geometry),m.drawElements(m.TRIANGLES,M*6,m.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,s=t._batchSize,n=t._properties;for(let o=0;o<i;o+=s)e.push(new Jp(this.properties,n,s));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new Jp(this.properties,i,e)}uploadVertices(t,e,i,s,n,o){let h=0,d=0,p=0,m=0;for(let v=0;v<i;++v){const b=t[e+v],y=b._texture,P=b.scale.x,M=b.scale.y,z=y.trim,q=y.orig;z?(d=z.x-b.anchor.x*q.width,h=d+z.width,m=z.y-b.anchor.y*q.height,p=m+z.height):(h=q.width*(1-b.anchor.x),d=q.width*-b.anchor.x,p=q.height*(1-b.anchor.y),m=q.height*-b.anchor.y),s[o]=d*P,s[o+1]=m*M,s[o+n]=h*P,s[o+n+1]=m*M,s[o+n*2]=h*P,s[o+n*2+1]=p*M,s[o+n*3]=d*P,s[o+n*3+1]=p*M,o+=n*4}}uploadPosition(t,e,i,s,n,o){for(let h=0;h<i;h++){const d=t[e+h].position;s[o]=d.x,s[o+1]=d.y,s[o+n]=d.x,s[o+n+1]=d.y,s[o+n*2]=d.x,s[o+n*2+1]=d.y,s[o+n*3]=d.x,s[o+n*3+1]=d.y,o+=n*4}}uploadRotation(t,e,i,s,n,o){for(let h=0;h<i;h++){const d=t[e+h].rotation;s[o]=d,s[o+n]=d,s[o+n*2]=d,s[o+n*3]=d,o+=n*4}}uploadUvs(t,e,i,s,n,o){for(let h=0;h<i;++h){const d=t[e+h]._texture._uvs;d?(s[o]=d.x0,s[o+1]=d.y0,s[o+n]=d.x1,s[o+n+1]=d.y1,s[o+n*2]=d.x2,s[o+n*2+1]=d.y2,s[o+n*3]=d.x3,s[o+n*3+1]=d.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4)}}uploadTint(t,e,i,s,n,o){for(let h=0;h<i;++h){const d=t[e+h],p=Je.shared.setValue(d._tintRGB).toPremultiplied(d.alpha,d.texture.baseTexture.alphaMode>0);s[o]=p,s[o+n]=p,s[o+n*2]=p,s[o+n*3]=p,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}wm.extension={name:"particle",type:Xt.RendererPlugin};te.add(wm);var Ch=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(Ch||{});const ol={willReadFrequently:!0},Vr=class ie{static get experimentalLetterSpacingSupported(){let t=ie._experimentalLetterSpacingSupported;if(t!==void 0){const e=qt.ADAPTER.getCanvasRenderingContext2D().prototype;t=ie._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,s,n,o,h,d,p){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=h,this.maxLineWidth=d,this.fontProperties=p}static measureText(t,e,i,s=ie._canvas){i=i??e.wordWrap;const n=e.toFontString(),o=ie.measureFont(n);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const h=s.getContext("2d",ol);h.font=n;const d=(i?ie.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),p=new Array(d.length);let m=0;for(let P=0;P<d.length;P++){const M=ie._measureText(d[P],e.letterSpacing,h);p[P]=M,m=Math.max(m,M)}let v=m+e.strokeThickness;e.dropShadow&&(v+=e.dropShadowDistance);const b=e.lineHeight||o.fontSize+e.strokeThickness;let y=Math.max(b,o.fontSize+e.strokeThickness*2)+e.leading+(d.length-1)*(b+e.leading);return e.dropShadow&&(y+=e.dropShadowDistance),new ie(t,e,v,y,d,p,b+e.leading,m,o)}static _measureText(t,e,i){let s=!1;ie.experimentalLetterSpacingSupported&&(ie.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(t).width;return n>0&&(s?n-=e:n+=(ie.graphemeSegmenter(t).length-1)*e),n}static wordWrap(t,e,i=ie._canvas){const s=i.getContext("2d",ol);let n=0,o="",h="";const d=Object.create(null),{letterSpacing:p,whiteSpace:m}=e,v=ie.collapseSpaces(m),b=ie.collapseNewlines(m);let y=!v;const P=e.wordWrapWidth+p,M=ie.tokenize(t);for(let z=0;z<M.length;z++){let q=M[z];if(ie.isNewline(q)){if(!b){h+=ie.addLine(o),y=!v,o="",n=0;continue}q=" "}if(v){const I=ie.isBreakingSpace(q),Y=ie.isBreakingSpace(o[o.length-1]);if(I&&Y)continue}const V=ie.getFromCache(q,p,d,s);if(V>P)if(o!==""&&(h+=ie.addLine(o),o="",n=0),ie.canBreakWords(q,e.breakWords)){const I=ie.wordWrapSplit(q);for(let Y=0;Y<I.length;Y++){let K=I[Y],T=K,at=1;for(;I[Y+at];){const pt=I[Y+at];if(!ie.canBreakChars(T,pt,q,Y,e.breakWords))K+=pt;else break;T=pt,at++}Y+=at-1;const ct=ie.getFromCache(K,p,d,s);ct+n>P&&(h+=ie.addLine(o),y=!1,o="",n=0),o+=K,n+=ct}}else{o.length>0&&(h+=ie.addLine(o),o="",n=0);const I=z===M.length-1;h+=ie.addLine(q,!I),y=!1,o="",n=0}else V+n>P&&(y=!1,h+=ie.addLine(o),o="",n=0),(o.length>0||!ie.isBreakingSpace(q)||y)&&(o+=q,n+=V)}return h+=ie.addLine(o,!1),h}static addLine(t,e=!0){return t=ie.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,s){let n=i[t];return typeof n!="number"&&(n=ie._measureText(t,e,s)+e,i[t]=n),n}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!ie.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:ie._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:ie._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let s=0;s<t.length;s++){const n=t[s],o=t[s+1];if(ie.isBreakingSpace(n,o)||ie.isNewline(n)){i!==""&&(e.push(i),i=""),e.push(n);continue}i+=n}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,n){return!0}static wordWrapSplit(t){return ie.graphemeSegmenter(t)}static measureFont(t){if(ie._fonts[t])return ie._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=ie._canvas,s=ie._context;s.font=t;const n=ie.METRICS_STRING+ie.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width);let h=Math.ceil(s.measureText(ie.BASELINE_SYMBOL).width);const d=Math.ceil(ie.HEIGHT_MULTIPLIER*h);if(h=h*ie.BASELINE_MULTIPLIER|0,o===0||d===0)return ie._fonts[t]=e,e;i.width=o,i.height=d,s.fillStyle="#f00",s.fillRect(0,0,o,d),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,h);const p=s.getImageData(0,0,o,d).data,m=p.length,v=o*4;let b=0,y=0,P=!1;for(b=0;b<h;++b){for(let M=0;M<v;M+=4)if(p[y+M]!==255){P=!0;break}if(!P)y+=v;else break}for(e.ascent=h-b,y=m-v,P=!1,b=d;b>h;--b){for(let M=0;M<v;M+=4)if(p[y+M]!==255){P=!0;break}if(!P)y-=v;else break}return e.descent=b-h,e.fontSize=e.ascent+e.descent,ie._fonts[t]=e,e}static clearMetrics(t=""){t?delete ie._fonts[t]:ie._fonts={}}static get _canvas(){var t;if(!ie.__canvas){let e;try{const i=new OffscreenCanvas(0,0);if((t=i.getContext("2d",ol))!=null&&t.measureText)return ie.__canvas=i,i;e=qt.ADAPTER.createCanvas()}catch{e=qt.ADAPTER.createCanvas()}e.width=e.height=10,ie.__canvas=e}return ie.__canvas}static get _context(){return ie.__context||(ie.__context=ie._canvas.getContext("2d",ol)),ie.__context}};Vr.METRICS_STRING="|q",Vr.BASELINE_SYMBOL="M",Vr.BASELINE_MULTIPLIER=1.4,Vr.HEIGHT_MULTIPLIER=2,Vr.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const r=new Intl.Segmenter;return t=>[...r.segment(t)].map(e=>e.segment)}return r=>[...r]})(),Vr.experimentalLetterSpacing=!1,Vr._fonts={},Vr._newlines=[10,13],Vr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Ds=Vr;const aC=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Sm=class to{constructor(t){this.styleID=0,this.reset(),Iu(this,t,t)}clone(){const t={};return Iu(t,this,to.defaultStyle),new to(t)}reset(){Iu(this,to.defaultStyle,to.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Tu(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Tu(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){oC(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Tu(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let s=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!aC.includes(s)&&(s=`"${s}"`),e[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Sm.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ch.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Ys=Sm;function Tu(r){const t=Je.shared,e=i=>{const s=t.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(r)?r.map(e):e(r)}function oC(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function Iu(r,t,e){for(const i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}const lC={texture:!0,children:!1,baseTexture:!0},Cm=class Gc extends Ia{constructor(t,e,i){let s=!1;i||(i=qt.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const n=Jt.from(i);n.orig=new Pe,n.trim=new Pe,super(n),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Gc.defaultResolution??qt.RESOLUTION,this._autoResolution=Gc.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ds.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Be("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ds.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,s=Ds.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,o=s.height,h=s.lines,d=s.lineHeight,p=s.lineWidths,m=s.maxLineWidth,v=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+e.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;let b,y;const P=e.dropShadow?2:1;for(let M=0;M<P;++M){const z=e.dropShadow&&M===0,q=z?Math.ceil(Math.max(1,o)+e.padding*2):0,V=q*this._resolution;if(z){i.fillStyle="black",i.strokeStyle="black";const Y=e.dropShadowColor,K=e.dropShadowBlur*this._resolution,T=e.dropShadowDistance*this._resolution;i.shadowColor=Je.shared.setValue(Y).setAlpha(e.dropShadowAlpha).toRgbaString(),i.shadowBlur=K,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*T,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*T+V}else i.fillStyle=this._generateFillStyle(e,h,s),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let I=(d-v.fontSize)/2;d-v.fontSize<0&&(I=0);for(let Y=0;Y<h.length;Y++)b=e.strokeThickness/2,y=e.strokeThickness/2+Y*d+v.ascent+I,e.align==="right"?b+=m-p[Y]:e.align==="center"&&(b+=(m-p[Y])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(h[Y],b+e.padding,y+e.padding-q,!0),e.fill&&this.drawLetterSpacing(h[Y],b+e.padding,y+e.padding-q)}this.updateTexture()}drawLetterSpacing(t,e,i,s=!1){const n=this._style.letterSpacing;let o=!1;if(Ds.experimentalLetterSpacingSupported&&(Ds.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i);return}let h=e;const d=Ds.graphemeSegmenter(t);let p=this.context.measureText(t).width,m=0;for(let v=0;v<d.length;++v){const b=d[v];s?this.context.strokeText(b,h,i):this.context.fillText(b,h,i);let y="";for(let P=v+1;P<d.length;++P)y+=d[P];m=this.context.measureText(y).width,h+=p-m+n,p=m}}updateTexture(){const t=this.canvas;if(this._style.trim){const o=I1(t);o.data&&(t.width=o.width,t.height=o.height,this.context.putImageData(o.data,0,0))}const e=this._texture,i=this._style,s=i.trim?0:i.padding,n=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n;const o=t.dropShadow?t.dropShadowDistance:0,h=t.padding||0,d=this.canvas.width/this._resolution-o-h*2,p=this.canvas.height/this._resolution-o-h*2,m=s.slice(),v=t.fillGradientStops.slice();if(!v.length){const b=m.length+1;for(let y=1;y<b;++y)v.push(y/b)}if(m.unshift(s[0]),v.unshift(0),m.push(s[s.length-1]),v.push(1),t.fillGradientType===Ch.LINEAR_VERTICAL){n=this.context.createLinearGradient(d/2,h,d/2,p+h);const b=i.fontProperties.fontSize+t.strokeThickness;for(let y=0;y<e.length;y++){const P=i.lineHeight*(y-1)+b,M=i.lineHeight*y;let z=M;y>0&&P>M&&(z=(M+P)/2);const q=M+b,V=i.lineHeight*(y+1);let I=q;y+1<e.length&&V<q&&(I=(q+V)/2);const Y=(I-z)/p;for(let K=0;K<m.length;K++){let T=0;typeof v[K]=="number"?T=v[K]:T=K/m.length;let at=Math.min(1,Math.max(0,z/p+T*Y));at=Number(at.toFixed(5)),n.addColorStop(at,m[K])}}}else{n=this.context.createLinearGradient(h,p/2,d+h,p/2);const b=m.length+1;let y=1;for(let P=0;P<m.length;P++){let M;typeof v[P]=="number"?M=v[P]:M=y/b,n.addColorStop(M,m[P]),y++}}return n}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},lC,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Gs(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Gs(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof Ys?this._style=t:this._style=new Ys(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Cm.defaultAutoResolution=!0;let $i=Cm;class hC{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function uC(r,t){var i;let e=!1;if((i=r==null?void 0:r._textures)!=null&&i.length){for(let s=0;s<r._textures.length;s++)if(r._textures[s]instanceof Jt){const n=r._textures[s].baseTexture;t.includes(n)||(t.push(n),e=!0)}}return e}function cC(r,t){if(r.baseTexture instanceof Se){const e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function dC(r,t){if(r._texture&&r._texture instanceof Jt){const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function fC(r,t){return t instanceof $i?(t.updateText(!0),!0):!1}function pC(r,t){if(t instanceof Ys){const e=t.toFontString();return Ds.measureFont(e),!0}return!1}function gC(r,t){if(r instanceof $i){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function mC(r,t){return r instanceof Ys?(t.includes(r)||t.push(r),!0):!1}const Em=class Pm{constructor(t){this.limiter=new hC(Pm.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(gC),this.registerFindHook(mC),this.registerFindHook(uC),this.registerFindHook(cC),this.registerFindHook(dC),this.registerUploadHook(fC),this.registerUploadHook(pC)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,dr.system.addOnce(this.tick,this,Fn.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)dr.system.addOnce(this.tick,this,Fn.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Ui)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&dr.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Em.uploadsPerFrame=4;let Vc=Em;Object.defineProperties(qt,{UPLOADS_PER_FRAME:{get(){return Vc.uploadsPerFrame},set(r){Be("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Vc.uploadsPerFrame=r}}});function Tm(r,t){return t instanceof Se?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function _C(r,t){if(!(t instanceof Ri))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let s=0;s<i.length;s++){const{texture:n}=i[s].style;n&&Tm(r,n.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function vC(r,t){return r instanceof Ri?(t.push(r),!0):!1}class Im extends Vc{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(vC),this.registerUploadHook(Tm),this.registerUploadHook(_C)}}Im.extension={name:"prepare",type:Xt.RendererSystem};te.add(Im);var yC=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,xC=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,bC=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,tg=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,wC=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const ll=new gi;class Am extends xh{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new B0,this.state=Zs.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Jr.from(tg,wC,e),this.shader=t.context.webGLVersion>1?Jr.from(xC,yC,e):Jr.from(tg,bC,e)}render(t){const e=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,o=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,i.invalidate();const h=t._texture,d=h.baseTexture,p=d.alphaMode>0,m=t.tileTransform.localTransform,v=t.uvMatrix;let b=d.isPowerOfTwo&&h.frame.width===d.width&&h.frame.height===d.height;b&&(d._glTextures[e.CONTEXT_UID]?b=d.wrapMode!==Xs.CLAMP:d.wrapMode===Xs.CLAMP&&(d.wrapMode=Xs.REPEAT));const y=b?this.simpleShader:this.shader,P=h.width,M=h.height,z=t._width,q=t._height;ll.set(m.a*P/z,m.b*P/q,m.c*M/z,m.d*M/q,m.tx/z,m.ty/q),ll.invert(),b?ll.prepend(v.mapCoord):(y.uniforms.uMapCoord=v.mapCoord.toArray(!0),y.uniforms.uClampFrame=v.uClampFrame,y.uniforms.uClampOffset=v.uClampOffset),y.uniforms.uTransform=ll.toArray(!0),y.uniforms.uColor=Je.shared.setValue(t.tint).premultiply(t.worldAlpha,p).toArray(y.uniforms.uColor),y.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),y.uniforms.uSampler=h,e.shader.bind(y),e.geometry.bind(i),this.state.blendMode=m0(t.blendMode,p),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Am.extension={name:"tilingSprite",type:Xt.RendererPlugin};te.add(Am);const Mm=class eo{constructor(t,e,i){this.linkedSheets=[],(t instanceof Se||t instanceof Jt)&&(t={texture:t,data:e,resolutionFilename:i});const{texture:s,data:n,resolutionFilename:o=null,cachePrefix:h=""}=t;this.cachePrefix=h,this._texture=s instanceof Jt?s:null,this.baseTexture=s instanceof Se?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const d=this.baseTexture.resource;this.resolution=this._updateResolution(o||(d?d.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=vs(t,null);return i===null&&(i=typeof e=="number"?e:parseFloat(e??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=eo.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=eo.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const s=this._frameKeys[e],n=this._frames[s],o=n.frame;if(o){let h=null,d=null;const p=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,m=new Pe(0,0,Math.floor(p.w)/this.resolution,Math.floor(p.h)/this.resolution);n.rotated?h=new Pe(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):h=new Pe(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(d=new Pe(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[s]=new Jt(this.baseTexture,h,m,d,n.rotated?2:0,n.anchor,n.borders),Jt.addToCache(this.textures[s],this.cachePrefix+s.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*eo.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*eo.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Mm.BATCH_SIZE=1e3;let eg=Mm;const SC=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function km(r,t,e){const i={};if(r.forEach(s=>{i[s]=t}),Object.keys(t.textures).forEach(s=>{i[`${t.cachePrefix}${s}`]=t.textures[s]}),!e){const s=Ni.dirname(r[0]);t.linkedSheets.forEach((n,o)=>{Object.assign(i,km([`${s}/${t.data.meta.related_multi_packs[o]}`],n,!0))})}return i}const CC={extension:Xt.Asset,cache:{test:r=>r instanceof eg,getCacheableAssets:(r,t)=>km(r,t,!1)},resolver:{test:r=>{const t=r.split("?")[0].split("."),e=t.pop(),i=t.pop();return e==="json"&&SC.includes(i)},parse:r=>{var e;const t=r.split(".");return{resolution:parseFloat(((e=qt.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:t[t.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:Xt.LoadParser,priority:Dr.Normal},async testParse(r,t){return Ni.extname(t.src).toLowerCase()===".json"&&!!r.frames},async parse(r,t,e){var m,v;const{texture:i,imageFilename:s,cachePrefix:n}=(t==null?void 0:t.data)??{};let o=Ni.dirname(t.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let h;if(i&&i.baseTexture)h=i;else{const b=Fc(o+(s??r.meta.image),t.src);h=(await e.load([b]))[b]}const d=new eg({texture:h.baseTexture,data:r,resolutionFilename:t.src,cachePrefix:n});await d.parse();const p=(m=r==null?void 0:r.meta)==null?void 0:m.related_multi_packs;if(Array.isArray(p)){const b=[];for(const P of p){if(typeof P!="string")continue;let M=o+P;(v=t.data)!=null&&v.ignoreMultiPack||(M=Fc(M,t.src),b.push(e.load({src:M,data:{ignoreMultiPack:!0}})))}const y=await Promise.all(b);d.linkedSheets=y,y.forEach(P=>{P.linkedSheets=[d].concat(d.linkedSheets.filter(M=>M!==P))})}return d},unload(r){r.destroy(!0)}}};te.add(CC);class ah{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Rl{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in e){const o=e[n].match(/^[a-z]+/gm)[0],h=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),d={};for(const p in h){const m=h[p].split("="),v=m[0],b=m[1].replace(/"/gm,""),y=parseFloat(b),P=isNaN(y)?b:y;d[v]=P}i[o].push(d)}const s=new ah;return i.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),i.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),i.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),i.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),i.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),i.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}}class Hc{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new ah,i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning"),d=t.getElementsByTagName("distanceField");for(let p=0;p<i.length;p++)e.info.push({face:i[p].getAttribute("face"),size:parseInt(i[p].getAttribute("size"),10)});for(let p=0;p<s.length;p++)e.common.push({lineHeight:parseInt(s[p].getAttribute("lineHeight"),10)});for(let p=0;p<n.length;p++)e.page.push({id:parseInt(n[p].getAttribute("id"),10)||0,file:n[p].getAttribute("file")});for(let p=0;p<o.length;p++){const m=o[p];e.char.push({id:parseInt(m.getAttribute("id"),10),page:parseInt(m.getAttribute("page"),10)||0,x:parseInt(m.getAttribute("x"),10),y:parseInt(m.getAttribute("y"),10),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10),xoffset:parseInt(m.getAttribute("xoffset"),10),yoffset:parseInt(m.getAttribute("yoffset"),10),xadvance:parseInt(m.getAttribute("xadvance"),10)})}for(let p=0;p<h.length;p++)e.kerning.push({first:parseInt(h[p].getAttribute("first"),10),second:parseInt(h[p].getAttribute("second"),10),amount:parseInt(h[p].getAttribute("amount"),10)});for(let p=0;p<d.length;p++)e.distanceField.push({fieldType:d[p].getAttribute("fieldType"),distanceRange:parseInt(d[p].getAttribute("distanceRange"),10)});return e}}class Wc{static test(t){return typeof t=="string"&&t.includes("<font>")?Hc.test(qt.ADAPTER.parseXML(t)):!1}static parse(t){return Hc.parse(qt.ADAPTER.parseXML(t))}}const Au=[Rl,Hc,Wc];function EC(r){for(let t=0;t<Au.length;t++)if(Au[t].test(r))return Au[t];return null}function PC(r,t,e,i,s,n){const o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let h;const d=e.dropShadow?e.dropShadowDistance:0,p=e.padding||0,m=r.width/i-d-p*2,v=r.height/i-d-p*2,b=o.slice(),y=e.fillGradientStops.slice();if(!y.length){const P=b.length+1;for(let M=1;M<P;++M)y.push(M/P)}if(b.unshift(o[0]),y.unshift(0),b.push(o[o.length-1]),y.push(1),e.fillGradientType===Ch.LINEAR_VERTICAL){h=t.createLinearGradient(m/2,p,m/2,v+p);let P=0;const M=(n.fontProperties.fontSize+e.strokeThickness)/v;for(let z=0;z<s.length;z++){const q=n.lineHeight*z;for(let V=0;V<b.length;V++){let I=0;typeof y[V]=="number"?I=y[V]:I=V/b.length;const Y=q/v+I*M;let K=Math.max(P,Y);K=Math.min(K,1),h.addColorStop(K,b[V]),P=K}}}else{h=t.createLinearGradient(p,v/2,m+p,v/2);const P=b.length+1;let M=1;for(let z=0;z<b.length;z++){let q;typeof y[z]=="number"?q=y[z]:q=M/P,h.addColorStop(q,b[z]),M++}}return h}function TC(r,t,e,i,s,n,o){const h=e.text,d=e.fontProperties;t.translate(i,s),t.scale(n,n);const p=o.strokeThickness/2,m=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=PC(r,t,o,n,[h],e),t.strokeStyle=o.stroke,o.dropShadow){const v=o.dropShadowColor,b=o.dropShadowBlur*n,y=o.dropShadowDistance*n;t.shadowColor=Je.shared.setValue(v).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=b,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*y,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*y}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(h,p,m+e.lineHeight-d.descent),o.fill&&t.fillText(h,p,m+e.lineHeight-d.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Bl(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function Rm(r){return Array.from?Array.from(r):r.split("")}function IC(r){typeof r=="string"&&(r=[r]);const t=[];for(let e=0,i=r.length;e<i;e++){const s=r[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let h=n,d=o;h<=d;h++)t.push(String.fromCharCode(h))}else t.push(...Rm(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const ks=class Hr{constructor(t,e,i){var m;const[s]=t.info,[n]=t.common,[o]=t.page,[h]=t.distanceField,d=vs(o.file),p={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/d,this.chars={},this.pageTextures=p;for(let v=0;v<t.page.length;v++){const{id:b,file:y}=t.page[v];p[b]=e instanceof Array?e[v]:e[y],h!=null&&h.fieldType&&h.fieldType!=="none"&&(p[b].baseTexture.alphaMode=ar.NO_PREMULTIPLIED_ALPHA,p[b].baseTexture.mipmap=ts.OFF)}for(let v=0;v<t.char.length;v++){const{id:b,page:y}=t.char[v];let{x:P,y:M,width:z,height:q,xoffset:V,yoffset:I,xadvance:Y}=t.char[v];P/=d,M/=d,z/=d,q/=d,V/=d,I/=d,Y/=d;const K=new Pe(P+p[y].frame.x/d,M+p[y].frame.y/d,z,q);this.chars[b]={xOffset:V,yOffset:I,xAdvance:Y,kerning:{},texture:new Jt(p[y].baseTexture,K),page:y}}for(let v=0;v<t.kerning.length;v++){let{first:b,second:y,amount:P}=t.kerning[v];b/=d,y/=d,P/=d,this.chars[y]&&(this.chars[y].kerning[b]=P)}this.distanceFieldRange=h==null?void 0:h.distanceRange,this.distanceFieldType=((m=h==null?void 0:h.fieldType)==null?void 0:m.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let s;if(t instanceof ah)s=t;else{const o=EC(t);if(!o)throw new Error("Unrecognized data format for font.");s=o.parse(t)}e instanceof Jt&&(e=[e]);const n=new Hr(s,e,i);return Hr.available[n.font]=n,n}static uninstall(t){const e=Hr.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Hr.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:n,resolution:o,textureWidth:h,textureHeight:d,...p}=Object.assign({},Hr.defaultOptions,i),m=IC(s),v=e instanceof Ys?e:new Ys(e),b=h,y=new ah;y.info[0]={face:v.fontFamily,size:v.fontSize},y.common[0]={lineHeight:v.fontSize};let P=0,M=0,z,q,V,I=0;const Y=[];for(let T=0;T<m.length;T++){z||(z=qt.ADAPTER.createCanvas(),z.width=h,z.height=d,q=z.getContext("2d"),V=new Se(z,{resolution:o,...p}),Y.push(new Jt(V)),y.page.push({id:Y.length-1,file:""}));const at=m[T],ct=Ds.measureText(at,v,!1,z),pt=ct.width,wt=Math.ceil(ct.height),It=Math.ceil((v.fontStyle==="italic"?2:1)*pt);if(M>=d-wt*o){if(M===0)throw new Error(`[BitmapFont] textureHeight ${d}px is too small (fontFamily: '${v.fontFamily}', fontSize: ${v.fontSize}px, char: '${at}')`);--T,z=null,q=null,V=null,M=0,P=0,I=0;continue}if(I=Math.max(wt+ct.fontProperties.descent,I),It*o+P>=b){if(P===0)throw new Error(`[BitmapFont] textureWidth ${h}px is too small (fontFamily: '${v.fontFamily}', fontSize: ${v.fontSize}px, char: '${at}')`);--T,M+=I*o,M=Math.ceil(M),P=0,I=0;continue}TC(z,q,ct,P,M,o,v);const bt=Bl(ct.text);y.char.push({id:bt,page:Y.length-1,x:P/o,y:M/o,width:It,height:wt,xoffset:0,yoffset:0,xadvance:pt-(v.dropShadow?v.dropShadowDistance:0)-(v.stroke?v.strokeThickness:0)}),P+=(It+2*n)*o,P=Math.ceil(P)}if(!(i!=null&&i.skipKerning))for(let T=0,at=m.length;T<at;T++){const ct=m[T];for(let pt=0;pt<at;pt++){const wt=m[pt],It=q.measureText(ct).width,bt=q.measureText(wt).width,dt=q.measureText(ct+wt).width-(It+bt);dt&&y.kerning.push({first:Bl(ct),second:Bl(wt),amount:dt})}}const K=new Hr(y,Y,!0);return Hr.available[t]!==void 0&&Hr.uninstall(t),Hr.available[t]=K,K}};ks.ALPHA=[["a","z"],["A","Z"]," "],ks.NUMERIC=[["0","9"]],ks.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],ks.ASCII=[[" ","~"]],ks.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:ks.ALPHANUMERIC},ks.available={};let Rs=ks;var AC=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,MC=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const ig=[],rg=[],sg=[],kC=class Bm extends Ui{constructor(t,e={}){super();const{align:i,tint:s,maxWidth:n,letterSpacing:o,fontName:h,fontSize:d}=Object.assign({},Bm.styleDefaults,e);if(!Rs.available[h])throw new Error(`Missing BitmapFont "${h}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new Je(s),this._font=void 0,this._fontName=h,this._fontSize=d,this.text=t,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new fs(()=>{this.dirty=!0},this,0,0),this._roundPixels=qt.ROUND_PIXELS,this.dirty=!0,this._resolution=qt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var It;const t=Rs.available[this._fontName],e=this.fontSize,i=e/t.size,s=new Ue,n=[],o=[],h=[],d=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",p=Rm(d),m=this._maxWidth*t.size/e,v=t.distanceFieldType==="none"?ig:rg;let b=null,y=0,P=0,M=0,z=-1,q=0,V=0,I=0,Y=0;for(let bt=0;bt<p.length;bt++){const dt=p[bt],ht=Bl(dt);if(/(?:\s)/.test(dt)&&(z=bt,q=y,Y++),dt==="\r"||dt===`
`){o.push(y),h.push(-1),P=Math.max(P,y),++M,++V,s.x=0,s.y+=t.lineHeight,b=null,Y=0;continue}const Mt=t.chars[ht];if(!Mt)continue;b&&Mt.kerning[b]&&(s.x+=Mt.kerning[b]);const _t=sg.pop()||{texture:Jt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ue};_t.texture=Mt.texture,_t.line=M,_t.charCode=ht,_t.position.x=Math.round(s.x+Mt.xOffset+this._letterSpacing/2),_t.position.y=Math.round(s.y+Mt.yOffset),_t.prevSpaces=Y,n.push(_t),y=_t.position.x+Math.max(Mt.xAdvance-Mt.xOffset,Mt.texture.orig.width),s.x+=Mt.xAdvance+this._letterSpacing,I=Math.max(I,Mt.yOffset+Mt.texture.height),b=ht,z!==-1&&m>0&&s.x>m&&(++V,ga(n,1+z-V,1+bt-z),bt=z,z=-1,o.push(q),h.push(n.length>0?n[n.length-1].prevSpaces:0),P=Math.max(P,q),M++,s.x=0,s.y+=t.lineHeight,b=null,Y=0)}const K=p[p.length-1];K!=="\r"&&K!==`
`&&(/(?:\s)/.test(K)&&(y=q),o.push(y),P=Math.max(P,y),h.push(-1));const T=[];for(let bt=0;bt<=M;bt++){let dt=0;this._align==="right"?dt=P-o[bt]:this._align==="center"?dt=(P-o[bt])/2:this._align==="justify"&&(dt=h[bt]<0?0:(P-o[bt])/h[bt]),T.push(dt)}const at=n.length,ct={},pt=[],wt=this._activePagesMeshData;v.push(...wt);for(let bt=0;bt<at;bt++){const dt=n[bt].texture,ht=dt.baseTexture.uid;if(!ct[ht]){let Mt=v.pop();if(!Mt){const Rt=new eC;let kt,Gt;t.distanceFieldType==="none"?(kt=new Qp(Jt.EMPTY),Gt=fe.NORMAL):(kt=new Qp(Jt.EMPTY,{program:ps.from(MC,AC),uniforms:{uFWidth:0}}),Gt=fe.NORMAL_NPM);const vt=new Kp(Rt,kt);vt.blendMode=Gt,Mt={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:vt,vertices:null,uvs:null,indices:null}}Mt.index=0,Mt.indexCount=0,Mt.vertexCount=0,Mt.uvsCount=0,Mt.total=0;const{_textureCache:_t}=this;_t[ht]=_t[ht]||new Jt(dt.baseTexture),Mt.mesh.texture=_t[ht],Mt.mesh.tint=this._tintColor.value,pt.push(Mt),ct[ht]=Mt}ct[ht].total++}for(let bt=0;bt<wt.length;bt++)pt.includes(wt[bt])||this.removeChild(wt[bt].mesh);for(let bt=0;bt<pt.length;bt++)pt[bt].mesh.parent!==this&&this.addChild(pt[bt].mesh);this._activePagesMeshData=pt;for(const bt in ct){const dt=ct[bt],ht=dt.total;if(!(((It=dt.indices)==null?void 0:It.length)>6*ht)||dt.vertices.length<Kp.BATCHABLE_SIZE*2)dt.vertices=new Float32Array(4*2*ht),dt.uvs=new Float32Array(4*2*ht),dt.indices=new Uint16Array(6*ht);else{const Mt=dt.total,_t=dt.vertices;for(let Rt=Mt*4*2;Rt<_t.length;Rt++)_t[Rt]=0}dt.mesh.size=6*ht}for(let bt=0;bt<at;bt++){const dt=n[bt];let ht=dt.position.x+T[dt.line]*(this._align==="justify"?dt.prevSpaces:1);this._roundPixels&&(ht=Math.round(ht));const Mt=ht*i,_t=dt.position.y*i,Rt=dt.texture,kt=ct[Rt.baseTexture.uid],Gt=Rt.frame,vt=Rt._uvs,Pt=kt.index++;kt.indices[Pt*6+0]=0+Pt*4,kt.indices[Pt*6+1]=1+Pt*4,kt.indices[Pt*6+2]=2+Pt*4,kt.indices[Pt*6+3]=0+Pt*4,kt.indices[Pt*6+4]=2+Pt*4,kt.indices[Pt*6+5]=3+Pt*4,kt.vertices[Pt*8+0]=Mt,kt.vertices[Pt*8+1]=_t,kt.vertices[Pt*8+2]=Mt+Gt.width*i,kt.vertices[Pt*8+3]=_t,kt.vertices[Pt*8+4]=Mt+Gt.width*i,kt.vertices[Pt*8+5]=_t+Gt.height*i,kt.vertices[Pt*8+6]=Mt,kt.vertices[Pt*8+7]=_t+Gt.height*i,kt.uvs[Pt*8+0]=vt.x0,kt.uvs[Pt*8+1]=vt.y0,kt.uvs[Pt*8+2]=vt.x1,kt.uvs[Pt*8+3]=vt.y1,kt.uvs[Pt*8+4]=vt.x2,kt.uvs[Pt*8+5]=vt.y2,kt.uvs[Pt*8+6]=vt.x3,kt.uvs[Pt*8+7]=vt.y3}this._textWidth=P*i,this._textHeight=(s.y+t.lineHeight)*i;for(const bt in ct){const dt=ct[bt];if(this.anchor.x!==0||this.anchor.y!==0){let Rt=0;const kt=this._textWidth*this.anchor.x,Gt=this._textHeight*this.anchor.y;for(let vt=0;vt<dt.total;vt++)dt.vertices[Rt++]-=kt,dt.vertices[Rt++]-=Gt,dt.vertices[Rt++]-=kt,dt.vertices[Rt++]-=Gt,dt.vertices[Rt++]-=kt,dt.vertices[Rt++]-=Gt,dt.vertices[Rt++]-=kt,dt.vertices[Rt++]-=Gt}this._maxLineHeight=I*i;const ht=dt.mesh.geometry.getBuffer("aVertexPosition"),Mt=dt.mesh.geometry.getBuffer("aTextureCoord"),_t=dt.mesh.geometry.getIndex();ht.data=dt.vertices,Mt.data=dt.uvs,_t.data=dt.indices,ht.update(),Mt.update(),_t.update()}for(let bt=0;bt<n.length;bt++)sg.push(n[bt]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:s}=Rs.available[this._fontName];if(i!=="none"){const{a:n,b:o,c:h,d}=this.worldTransform,p=Math.sqrt(n*n+o*o),m=Math.sqrt(h*h+d*d),v=(Math.abs(p)+Math.abs(m))/2,b=this.fontSize/s,y=t._view.resolution;for(const P of this._activePagesMeshData)P.mesh.shader.uniforms.uFWidth=v*e*b*y}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Rs.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Rs.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Rs.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i=Rs.available[this._fontName].distanceFieldType==="none"?ig:rg;i.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=Jt.EMPTY});for(const s in e)e[s].destroy(),delete e[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};kC.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const RC=[".xml",".fnt"],BC={extension:{type:Xt.LoadParser,priority:Dr.Normal},name:"loadBitmapFont",test(r){return RC.includes(Ni.extname(r).toLowerCase())},async testParse(r){return Rl.test(r)||Wc.test(r)},async parse(r,t,e){const i=Rl.test(r)?Rl.parse(r):Wc.parse(r),{src:s}=t,{page:n}=i,o=[];for(let p=0;p<n.length;++p){const m=n[p].file;let v=Ni.join(Ni.dirname(s),m);v=Fc(v,s),o.push(v)}const h=await e.load(o),d=o.map(p=>h[p]);return Rs.install(i,d,!0)},async load(r,t){return(await qt.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};te.add(BC);const Xc=class na extends Ys{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new na(Object.keys(na.defaultOptions).reduce((e,i)=>({...e,[i]:t[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete na.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:i}=na;if(i[t]){const s=i[t];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return qt.ADAPTER.fetch(t).then(s=>s.blob()).then(async s=>new Promise((n,o)=>{const h=URL.createObjectURL(s),d=new FileReader;d.onload=()=>n([h,d.result]),d.onerror=o,d.readAsDataURL(s)})).then(async([s,n])=>{const o=Object.assign({family:Ni.basename(t,Ni.extname(t)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:n,refs:1,originalUrl:t,fontFace:null},e);i[t]=o,this._fonts.push(o),this.styleID++;const h=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=h,await h.load(),document.fonts.add(h),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(i=>!this._overrides.includes(i));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(i=>this._overrides.includes(i));e.length>0&&(this._overrides=this._overrides.filter(i=>!e.includes(i)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=w1(t)),typeof t=="number"?b1(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const n=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${n} ${t}`}reset(){Object.assign(this,na.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=qt.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Xc.availableFonts={},Xc.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Mu=Xc;const hl=class aa extends Ia{constructor(t="",e={}){super(Jt.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,s=Jt.from(i,{scaleMode:qt.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new Pe,s.trim=new Pe,this.texture=s;const n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",h=document.createElementNS(n,"svg"),d=document.createElementNS(n,"foreignObject"),p=document.createElementNS(o,"div"),m=document.createElementNS(o,"style");d.setAttribute("width","10000"),d.setAttribute("height","10000"),d.style.overflow="hidden",h.appendChild(d),this.maxWidth=aa.defaultMaxWidth,this.maxHeight=aa.defaultMaxHeight,this._domElement=p,this._styleElement=m,this._svgRoot=h,this._foreignObject=d,this._foreignObject.appendChild(m),this._foreignObject.appendChild(p),this._image=i,this._loadImage=new Image,this._autoResolution=aa.defaultAutoResolution,this._resolution=aa.defaultResolution??qt.RESOLUTION,this.text=t,this.style=e}measureText(t){var m,v;const{text:e,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:o,height:h}=n;(o>this.maxWidth||h>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const d=Math.min(this.maxWidth,Math.ceil(o)),p=Math.min(this.maxHeight,Math.ceil(h));return this._svgRoot.setAttribute("width",d.toString()),this._svgRoot.setAttribute("height",p.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:(m=this._style)==null?void 0:m.toCSS(s)}),this._styleElement.textContent=(v=this._style)==null?void 0:v.toGlobalCSS()),{width:d+i.padding*2,height:p+i.padding*2}}async updateText(t=!0){const{style:e,_image:i,_loadImage:s}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:n,height:o}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,n)),i.height=s.height=Math.ceil(Math.max(1,o)),this._updateID++;const h=this._updateID;await new Promise(d=>{s.onload=async()=>{if(h<this._updateID){d();return}await e.onBeforeDraw(),i.src=s.src,s.onload=null,s.src="",this.updateTexture(),d()};const p=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(p)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:i,resolution:s}=this,{padding:n}=t,{baseTexture:o}=e;e.trim.width=e._frame.width=i.width/s,e.trim.height=e._frame.height=i.height/s,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(i.width,i.height,s),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var i,s,n,o,h;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},aa.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((i=this._style)==null||i.cleanFonts()),this._style=e,(s=this._svgRoot)==null||s.remove(),this._svgRoot=e,(n=this._domElement)==null||n.remove(),this._domElement=e,(o=this._foreignObject)==null||o.remove(),this._foreignObject=e,(h=this._styleElement)==null||h.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Gs(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Gs(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof Mu?(this.ownsStyle=!1,this._style=t):t instanceof Ys?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Mu.from(t)):(this.ownsStyle=!0,this._style=new Mu(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};hl.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},hl.defaultMaxWidth=2024,hl.defaultMaxHeight=2024,hl.defaultAutoResolution=!0;const LC=/^[\t\n\f\r ]*([MLHVZCSQTAmlhvzcsqta])[\t\n\f\r ]*/,ng=/^[01]/,jc=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,Ze=jc,DC=/^(([\t\n\f\r ]+,?[\t\n\f\r ]*)|(,[\t\n\f\r ]*))/,FC={M:[Ze,Ze],L:[Ze,Ze],H:[Ze],V:[Ze],Z:[],C:[Ze,Ze,Ze,Ze,Ze,Ze],S:[Ze,Ze,Ze,Ze],Q:[Ze,Ze,Ze,Ze],T:[Ze,Ze],A:[jc,jc,Ze,ng,ng,Ze,Ze]};class wd{static components(t,e,i){const s=FC[t.toUpperCase()],n=[];for(;i<=e.length;){const o=[t];for(const h of s){const d=e.slice(i).match(h);if(d!==null){o.push(d[0]),i+=d[0].length;const p=e.slice(i).match(DC);p!==null&&(i+=p[0].length)}else{if(o.length===1)return[i,n];throw new Error("malformed path (first error at "+i+")")}}if(n.push(o),s.length===0)return[i,n];t==="m"&&(t="l"),t==="M"&&(t="L")}throw new Error("malformed path (first error at "+i+")")}static parse(t){let e=0,i=[];for(;e<t.length;){const s=t.slice(e).match(LC);if(s!==null){const n=s[1];e+=s[0].length;const o=wd.components(n,t,e);e=o[0],i=[...i,...o[1]]}else throw new Error("malformed path (first error at "+e+")")}return i}}function Lm(r,t,e=!1){let i=r.toFixed(t).replace(/^(-?[0-9]*\.([0-9]*[1-9])?)0*$/,"$1").replace(/\.$/,"");return e&&(i=i.replace(/^(-?)0\./,"$1.")),i}class pi{constructor(t,e){this.x=t,this.y=e}}class xs extends pi{constructor(e,i,s=!0){super(e,i);tt(this,"itemReference",new OC);tt(this,"movable",!0);this.movable=s}}class _s extends xs{constructor(e,i,s=!0){super(e.x,e.y,s);tt(this,"subIndex",0);this.relations=i}}class er{constructor(t,e){tt(this,"relative");tt(this,"values");tt(this,"previousPoint",new pi(0,0));tt(this,"absolutePoints",[]);tt(this,"absoluteControlPoints",[]);this.values=t,this.relative=e}get absolutePointsOnly(){return this.absolutePoints.filter(t=>this.absoluteControlPoints.every(e=>e.x!==t.x&&e.y!==t.y))}static Make(t){let e;const i=t[0].toUpperCase()!==t[0],s=t.slice(1).map(n=>parseFloat(n));switch(t[0].toUpperCase()){case Hs.key:e=new Hs(s,i);break;case Kr.key:e=new Kr(s,i);break;case Mr.key:e=new Mr(s,i);break;case kr.key:e=new kr(s,i);break;case An.key:e=new An(s,i);break;case Tr.key:e=new Tr(s,i);break;case Xr.key:e=new Xr(s,i);break;case qr.key:e=new qr(s,i);break;case Os.key:e=new Os(s,i);break;case ua.key:e=new ua(s,i);break}if(!e)throw"Invalid RawVector Item";return e}static MakeFrom(t,e,i){const s=t.targetLocation(),n=s.x.toString(),o=s.y.toString();let h=[];const d=i.toUpperCase();switch(d){case Hs.key:h=[Hs.key,n,o];break;case Kr.key:h=[Kr.key,n,o];break;case Mr.key:h=[Mr.key,n];break;case kr.key:h=[kr.key,o];break;case An.key:h=[An.key];break;case Tr.key:h=[Tr.key,"0","0","0","0",n,o];break;case Xr.key:h=[Xr.key,"0","0",n,o];break;case qr.key:h=[qr.key,"0","0",n,o];break;case Os.key:h=[Os.key,n,o];break;case ua.key:h=[ua.key,"1","1","0","0","0",n,o];break}const p=er.Make(h),m=t.absoluteControlPoints;return p.previousPoint=e.targetLocation(),p.absolutePoints=[s],p.resetControlPoints(e),(t instanceof Tr||t instanceof Xr)&&(p instanceof Tr||p instanceof Xr)&&(p instanceof Tr&&(p.values[0]=m[0].x,p.values[1]=m[0].y,p.values[2]=m[1].x,p.values[3]=m[1].y),p instanceof Xr&&(p.values[0]=m[1].x,p.values[1]=m[1].y)),(t instanceof qr||t instanceof Os)&&p instanceof qr&&(p.values[0]=m[0].x,p.values[1]=m[0].y),i!==d&&p.setRelative(!0),p}refreshAbsolutePoints(t,e){this.previousPoint=e?e.targetLocation():new pi(0,0),this.absolutePoints=[];let i=e?e.targetLocation():new pi(0,0);this.relative||(i=new pi(0,0));for(let s=0;s<this.values.length-1;s+=2)this.absolutePoints.push(new xs(i.x+this.values[s],i.y+this.values[s+1]))}setRelative(t){this.relative!==t&&(this.relative=!1,t?(this.translate(-this.previousPoint.x,-this.previousPoint.y),this.relative=!0):this.translate(this.previousPoint.x,this.previousPoint.y))}refreshAbsoluteControlPoints(t,e){this.absoluteControlPoints=[]}resetControlPoints(t){}translate(t,e,i=!1){(!this.relative||i)&&this.values.forEach((s,n)=>{this.values[n]=s+(n%2===0?t:e)})}scale(t,e){this.values.forEach((i,s)=>{this.values[s]=i*(s%2===0?t:e)})}rotate(t,e,i,s=!1){const n=i*Math.PI/180,o=Math.cos(n),h=Math.sin(n);for(let d=0;d<this.values.length;d+=2){const p=this.values[d],m=this.values[d+1],v=this.relative&&!s?0:t,b=this.relative&&!s?0:e,y=v+(p-v)*o-(m-b)*h,P=b+(p-v)*h+(m-b)*o;this.values[d]=y,this.values[d+1]=P}}targetLocation(){const t=this.absolutePoints.length;return this.absolutePoints[t-1]}setTargetLocation(t){const e=this.targetLocation(),i=t.x-e.x,s=t.y-e.y,n=this.values.length;this.values[n-2]+=i,this.values[n-1]+=s}setControlLocation(t,e){const i=this.absolutePoints[t],s=e.x-i.x,n=e.y-i.y;this.values[2*t]+=s,this.values[2*t+1]+=n}controlLocations(){return this.absoluteControlPoints}getType(){let t=this.constructor.key;return this.relative&&(t=t.toLowerCase()),t}asStandaloneString(){return["M",this.previousPoint.x,this.previousPoint.y,this.getType(),...this.values].join(" ")}asString(t=4,e=!1,i=[]){const s=[this.values,...i.map(n=>n.values)].reduce((n,o)=>n.concat(o),[]).map(n=>Lm(n,t,e));return[this.getType(),...s].join(" ")}}class OC extends er{constructor(){super([],!1)}}class Hs extends er{}tt(Hs,"key","M");class Kr extends er{constructor(){super(...arguments);tt(this,"isRed",!1)}}tt(Kr,"key","L");class Tr extends er{refreshAbsoluteControlPoints(t,e){if(!e)throw"Invalid path";this.absoluteControlPoints=[new _s(this.absolutePoints[0],[e.targetLocation()]),new _s(this.absolutePoints[1],[this.targetLocation()])]}resetControlPoints(t){const e=t.targetLocation(),i=this.targetLocation(),s=this.relative?e:new pi(0,0);this.values[0]=2*e.x/3+i.x/3-s.x,this.values[1]=2*e.y/3+i.y/3-s.y,this.values[2]=e.x/3+2*i.x/3-s.x,this.values[3]=e.y/3+2*i.y/3-s.y}}tt(Tr,"key","C");const dh=class dh extends er{refreshAbsoluteControlPoints(t,e){if(this.absoluteControlPoints=[],e instanceof Tr||e instanceof dh){const i=e.targetLocation(),s=e.absoluteControlPoints[1],n=new pi(2*i.x-s.x,2*i.y-s.y);this.absoluteControlPoints.push(new _s(n,[i],!1))}else{const i=e?e.targetLocation():new pi(0,0),s=new pi(i.x,i.y);this.absoluteControlPoints.push(new _s(s,[],!1))}this.absoluteControlPoints.push(new _s(this.absolutePoints[0],[this.targetLocation()]))}asStandaloneString(){return["M",this.previousPoint.x,this.previousPoint.y,"C",this.absoluteControlPoints[0].x,this.absoluteControlPoints[0].y,this.absoluteControlPoints[1].x,this.absoluteControlPoints[1].y,this.absolutePoints[1].x,this.absolutePoints[1].y].join(" ")}resetControlPoints(t){const e=t.targetLocation(),i=this.targetLocation(),s=this.relative?e:new pi(0,0);this.values[0]=e.x/3+2*i.x/3-s.x,this.values[1]=e.y/3+2*i.y/3-s.y}setControlLocation(t,e){const i=this.absoluteControlPoints[1],s=e.x-i.x,n=e.y-i.y;this.values[0]+=s,this.values[1]+=n}};tt(dh,"key","S");let Xr=dh;class qr extends er{refreshAbsoluteControlPoints(t,e){if(!e)throw"Invalid path";this.absoluteControlPoints=[new _s(this.absolutePoints[0],[e.targetLocation(),this.targetLocation()])]}resetControlPoints(t){const e=t.targetLocation(),i=this.targetLocation(),s=this.relative?e:new pi(0,0);this.values[0]=e.x/2+i.x/2-s.x,this.values[1]=e.y/2+i.y/2-s.y}}tt(qr,"key","Q");const fh=class fh extends er{refreshAbsoluteControlPoints(t,e){if(e instanceof qr||e instanceof fh){const i=e.targetLocation(),s=e.absoluteControlPoints[0],n=new pi(2*i.x-s.x,2*i.y-s.y);this.absoluteControlPoints=[new _s(n,[i,this.targetLocation()],!1)]}else{const i=e?e.targetLocation():new pi(0,0),s=new pi(i.x,i.y);this.absoluteControlPoints=[new _s(s,[],!1)]}}asStandaloneString(){return["M",this.previousPoint.x,this.previousPoint.y,"Q",this.absoluteControlPoints[0].x,this.absoluteControlPoints[0].y,this.absolutePoints[0].x,this.absolutePoints[0].y].join(" ")}};tt(fh,"key","T");let Os=fh;class An extends er{refreshAbsolutePoints(t,e){this.previousPoint=e?e.targetLocation():new pi(0,0),this.absolutePoints=[new xs(t.x,t.y,!1)]}}tt(An,"key","Z");class Mr extends er{rotate(t,e,i,s=!1){i==180&&(this.values[0]=-this.values[0])}refreshAbsolutePoints(t,e){this.previousPoint=e?e.targetLocation():new pi(0,0),this.relative?this.absolutePoints=[new xs(this.values[0]+this.previousPoint.x,this.previousPoint.y)]:this.absolutePoints=[new xs(this.values[0],this.previousPoint.y)]}setTargetLocation(t){const e=this.targetLocation(),i=t.x-e.x;this.values[0]+=i}}tt(Mr,"key","H");class kr extends er{rotate(t,e,i,s=!1){i==180&&(this.values[0]=-this.values[0])}translate(t,e,i=!1){this.relative||(this.values[0]+=e)}scale(t,e){this.values[0]*=e}refreshAbsolutePoints(t,e){this.previousPoint=e?e.targetLocation():new pi(0,0),this.relative?this.absolutePoints=[new xs(this.previousPoint.x,this.values[0]+this.previousPoint.y)]:this.absolutePoints=[new xs(this.previousPoint.x,this.values[0])]}setTargetLocation(t){const e=this.targetLocation(),i=t.y-e.y;this.values[0]+=i}}tt(kr,"key","V");class ua extends er{translate(t,e,i=!1){this.relative||(this.values[5]+=t,this.values[6]+=e)}rotate(t,e,i,s=!1){this.values[2]=(this.values[2]+i)%360;const n=i*Math.PI/180,o=Math.cos(n),h=Math.sin(n),d=this.values[5],p=this.values[6],m=this.relative&&!s?0:t,v=this.relative&&!s?0:e,b=(d-m)*o-(p-v)*h+m,y=(d-m)*h+(p-v)*o+v;this.values[5]=b,this.values[6]=y}scale(t,e){const i=this.values[0],s=this.values[1],n=Math.PI*this.values[2]/180,o=Math.cos(n),h=Math.sin(n),d=s*s*e*e*o*o+i*i*e*e*h*h,p=2*t*e*o*h*(s*s-i*i),m=i*i*t*t*o*o+s*s*t*t*h*h,v=-(i*i*s*s*t*t*e*e),b=p*p-4*d*m,y=Math.sqrt((d-m)*(d-m)+p*p);this.values[2]=p!==0?Math.atan((m-d-y)/p)*180/Math.PI:d<m?0:90,b!==0&&(this.values[0]=-Math.sqrt(2*b*v*(d+m+y))/b,this.values[1]=-Math.sqrt(2*b*v*(d+m-y))/b),this.values[5]*=t,this.values[6]*=e,this.values[4]=t*e>=0?this.values[4]:1-this.values[4]}refreshAbsolutePoints(t,e){this.previousPoint=e?e.targetLocation():new pi(0,0),this.relative?this.absolutePoints=[new xs(this.values[5]+this.previousPoint.x,this.values[6]+this.previousPoint.y)]:this.absolutePoints=[new xs(this.values[5],this.values[6])]}asString(t=4,e=!1,i=[]){if(e){const s=[this.values,...i.map(n=>n.values)].map(n=>n.map(o=>Lm(o,t,e))).map(n=>`${n[0]} ${n[1]} ${n[2]} ${n[3]}${n[4]}${n[5]} ${n[6]}`);return[this.getType(),...s].join(" ")}else return super.asString(t,e,i)}}tt(ua,"key","A");class Ws{constructor(t){tt(this,"paths",[]);tt(this,"x",0);tt(this,"y",0);tt(this,"rotation",0);tt(this,"onDispose");tt(this,"onUpdate");this.rebuild(t)}get rawX(){return this.paths[0].values[0]}get rawY(){return this.paths[0].values[1]}clone(){return new Ws(this.asString())}normalize(){}rebuild(t){const e=wd.parse(t);this.paths=e.map(i=>er.Make(i)),this.refreshAbsolutePositions()}getCenter(){const t=this.paths.map(h=>h.absolutePointsOnly.map(d=>d.x)).reduce((h,d)=>h.concat(d),[]),e=this.paths.map(h=>h.absolutePointsOnly.map(d=>d.y)).reduce((h,d)=>h.concat(d),[]),i=Math.min(...t),s=Math.max(...t),n=Math.min(...e),o=Math.max(...e);return new pi((i+s)/2,(n+o)/2)}getBounds(){const t=this.paths.map(h=>h.absolutePointsOnly.map(d=>d.x)).reduce((h,d)=>h.concat(d),[]),e=this.paths.map(h=>h.absolutePointsOnly.map(d=>d.y)).reduce((h,d)=>h.concat(d),[]),i=Math.min(...t),s=Math.max(...t),n=Math.min(...e),o=Math.max(...e);return{x:i,y:n,width:s-i,height:o-n}}translate(t,e){return this.paths.forEach((i,s)=>{i.translate(t,e,s===0)}),this.refreshAbsolutePositions(),this}scale(t,e){return this.paths.forEach(i=>{i.scale(t,e)}),this.refreshAbsolutePositions(),this}centeredRotate(t){const e=this.getCenter();return this.rotate(e.x,e.y,t),this}rotate(t,e,i){return i%=360,i==0?this:(this.paths.forEach((s,n)=>{const o=s.constructor;if(i!==180&&(s instanceof Mr||s instanceof kr)){const h=s.relative?Kr.key.toLowerCase():Kr.key;s=this.changeType(s,h)||s}if(s.rotate(t,e,i,n===0),i===90||i===270){if(o===Mr){this.refreshAbsolutePositions();const h=s.relative?kr.key.toLowerCase():kr.key;this.changeType(s,h)}else if(o===kr){this.refreshAbsolutePositions();const h=s.relative?Mr.key.toLowerCase():Mr.key;this.changeType(s,h)}}}),this.refreshAbsolutePositions(),this)}setRelative(t){return this.paths.forEach(e=>{e.setRelative(t)}),this.refreshAbsolutePositions(),this}delete(t){const e=this.paths.indexOf(t);return e!==-1&&(this.paths.splice(e,1),this.refreshAbsolutePositions()),this}getByIndex(t){return t>=0&&t<this.paths.length?this.paths[t]:null}insertBefore(t,e){const i=e?this.paths.indexOf(e):-1;return i!==-1?this.paths.splice(i,0,t):this.paths.unshift(t),this.refreshAbsolutePositions(),i}insert(t,e){const i=e?this.paths.indexOf(e):-1;return i!==-1?this.paths.splice(i+1,0,t):this.paths.push(t),this.refreshAbsolutePositions(),i}changeType(t,e){const i=this.paths.indexOf(t);if(i>0){const s=this.paths[i-1];return this.paths[i]=er.MakeFrom(t,s,e),this.refreshAbsolutePositions(),this.paths[i]}return null}asString(t=4,e=!1){return this.paths.reduce((i,s)=>{const n=s.getType();if(e&&i.length>0){const o=i[i.length-1];if(o.type===n)return o.trailing.push(s),i}return i.push({type:n==="m"?"l":n==="M"?"L":n,item:s,trailing:[]}),i},[]).map(i=>{const s=i.item.asString(t,e,i.trailing);return e?s.replace(/^([a-z]) /i,"$1").replace(/ -/g,"-").replace(/(\.[0-9]+) (?=\.)/g,"$1"):s}).join(e?"":" ")}targetLocations(){return this.paths.map(t=>t.targetLocation())}controlLocations(){let t=[];for(let e=1;e<this.paths.length;++e){const i=this.paths[e].controlLocations();i.forEach((s,n)=>{s.subIndex=n}),t=[...t,...i]}return t}setLocation(t,e){t instanceof _s?t.itemReference.setControlLocation(t.subIndex,e):t.itemReference.setTargetLocation(e),this.refreshAbsolutePositions()}refreshAbsolutePositions(){let t=null,e=new pi(0,0);for(const i of this.paths)i.refreshAbsolutePoints(e,t),i.refreshAbsoluteControlPoints(e,t),i.absolutePoints.forEach(s=>s.itemReference=i),i.absoluteControlPoints.forEach(s=>s.itemReference=i),(i instanceof Hs||i instanceof An)&&(e=i.targetLocation()),t=i}}function Ut(r){return r*_e.zoomFactor}const NC={calculateArcLength(r,t,e,i,s=.05){const n=Math.sign(i),o=Math.abs(i),h=r*r,p=t*t-h;let m=0;for(let v=e+s*.5,b=0;b<o;v+=n*s,b+=s){const y=Math.cos(v),P=y*y,M=Math.sqrt(h+p*P);m+=s*M}return m}},UC=Uc._segmentsCount.bind(Uc),$c=new gi;function zC(r,t,e,i,s,n,o=0,h=!1,d=!1){if(s===0||n===0)return[{x:e,y:i}];const p=(r+e)/2,m=(t+i)/2,v=$c.identity().translate(-p,-m).rotate(-o),{x:b,y}=v.apply({x:r,y:t}),P=Math.pow(b/s,2)+Math.pow(y/n,2);P>1&&(s=Math.sqrt(P)*s,n=Math.sqrt(P)*n);const M=s*s,z=n*n,V=(h===d?1:-1)*Math.sqrt(Math.abs(M*z-M*y*y-z*b*b)/(M*y*y+z*b*b)),I=V*(s*y/n),Y=-V*(n*b/s),{x:K,y:T}=v.applyInverse({x:I,y:Y}),at=(b-I)/s,ct=(y-Y)/n,pt=Math.sqrt(at**2+ct**2),wt=(ct>=0?1:-1)*Math.acos(at/pt),It=(-b-I)/s,bt=(-y-Y)/n,dt=Math.sqrt(It**2+bt**2);let ht=(bt>=0?1:-1)*Math.acos(It/dt);return ht>wt&&h?ht-=Math.PI*2:wt>ht&&!h&&(ht+=Math.PI*2),GC(K,T,s,n,wt,ht,o,h)}function GC(r,t,e,i,s,n,o=0,h=!1){const d=[],p=n-s,m=Uc.adaptive?UC(NC.calculateArcLength(e,i,s,n-s))*4:20,v=(h?-1:1)*Math.abs(p)/(m-1);$c.identity().translate(-r,-t).rotate(o).translate(r,t);for(let b=0;b<m;b++){const y=s+b*v,P=r+e*Math.cos(y),M=t+i*Math.sin(y),{x:z,y:q}=o!==0?$c.apply({x:P,y:M}):{x:P,y:M};d.push({x:z,y:q})}return d}const Ai=class Ai{static moveTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y;i.relative?(Ai.showLogs&&console.log("MoveTo relative",Ut(s+i.values[0]),Ut(n+i.values[1])),t.moveTo(Ut(s+i.values[0]),Ut(n+i.values[1]))):(Ai.showLogs&&console.log("MoveTo absolute",Ut(i.values[0]),Ut(i.values[1])),t.moveTo(Ut(i.values[0]),Ut(i.values[1])))}static closePath(t,e,i){Ai.showLogs&&console.log("ClosePath"),t.closePath()}static horizontalLineTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y;i.relative?(Ai.showLogs&&console.log("HorizontalLineTo relative",Ut(s+i.values[0]),Ut(n)),t.lineTo(Ut(s+i.values[0]),Ut(n))):(Ai.showLogs&&console.log("HorizontalLineTo absolute",Ut(i.values[0]),Ut(n)),t.lineTo(Ut(i.values[0]),Ut(n)))}static ellipticalArcTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y,o=i.values[0],h=i.values[1],d=i.values[5],p=i.values[6],m=i.values[2],v=i.values[3]===1,b=i.values[4]===1;zC(s,n,s+d,n+p,o,h,m,!b,v).forEach((P,M)=>{M===0||t.lineTo(Ut(P.x),Ut(P.y))})}static verticalLineTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y;i.relative?(Ai.showLogs&&console.log("VerticalLineTo relative",Ut(s),Ut(n+i.values[0])),t.lineTo(Ut(s),Ut(n+i.values[0]))):(Ai.showLogs&&console.log("VerticalLineTo absolute",Ut(s),Ut(i.values[0])),t.lineTo(Ut(s),Ut(i.values[0])))}static lineTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y;i.relative?(Ai.showLogs&&console.log("LineTo relative",Ut(s+i.values[0]),Ut(n+i.values[1])),t.lineTo(Ut(s+i.values[0]),Ut(n+i.values[1]))):(Ai.showLogs&&console.log("LineTo absolute",Ut(i.values[0]),Ut(i.values[1])),t.lineTo(Ut(i.values[0]),Ut(i.values[1])))}static cubicBezierCurveTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y;i.relative?(Ai.showLogs&&console.log("CubicBezierCurveTo relative",Ut(s+i.values[0]),Ut(n+i.values[1]),Ut(s+i.values[2]),Ut(n+i.values[3]),Ut(s+i.values[4]),Ut(n+i.values[5])),t.bezierCurveTo(Ut(s+i.values[0]),Ut(n+i.values[1]),Ut(s+i.values[2]),Ut(n+i.values[3]),Ut(s+i.values[4]),Ut(n+i.values[5]))):(Ai.showLogs&&console.log("CubicBezierCurveTo absolute",Ut(i.values[0]),Ut(i.values[1]),Ut(i.values[2]),Ut(i.values[3]),Ut(i.values[4]),Ut(i.values[5])),t.bezierCurveTo(Ut(i.values[0]),Ut(i.values[1]),Ut(i.values[2]),Ut(i.values[3]),Ut(i.values[4]),Ut(i.values[5])))}static quadraticBezierCurveTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y;i.relative?(Ai.showLogs&&console.log("QuadraticBezierCurveTo relative",Ut(s+i.values[0]),Ut(n+i.values[1]),Ut(s+i.values[2]),Ut(n+i.values[3])),t.quadraticCurveTo(Ut(s+i.values[0]),Ut(n+i.values[1]),Ut(s+i.values[2]),Ut(n+i.values[3]))):(Ai.showLogs&&console.log("QuadraticBezierCurveTo absolute",Ut(i.values[0]),Ut(i.values[1]),Ut(i.values[2]),Ut(i.values[3])),t.quadraticCurveTo(Ut(i.values[0]),Ut(i.values[1]),Ut(i.values[2]),Ut(i.values[3])))}static arcTo(t,e,i){const s=i.previousPoint.x,n=i.previousPoint.y;i.relative?(Ai.showLogs&&console.log("ArcTo relative",Ut(s+i.values[0]),Ut(n+i.values[1]),Ut(i.values[2]),Ut(i.values[3]),Ut(i.values[4])),this.ellipticalArcTo(t,e,i)):Ai.showLogs&&console.log("ArcTo absolute",Ut(i.values[0]),Ut(i.values[1]),Ut(i.values[2]),Ut(i.values[3]),Ut(i.values[4]))}};tt(Ai,"zoomFactor",.2),tt(Ai,"showLogs",!1);let _e=Ai;class Yc{constructor(t){tt(this,"_mainContainer");tt(this,"_mainGraphics");tt(this,"_selectedGraphics");tt(this,"_segmentGraphics",[]);tt(this,"_x",0);tt(this,"_y",0);tt(this,"_isDisposed",!1);tt(this,"lineStyle",3);tt(this,"lineColor",65280);tt(this,"_isSelected",!1);tt(this,"_isDraggable",!1);tt(this,"_isDragging",!1);tt(this,"_previousX",null);tt(this,"_previousY",null);tt(this,"_isHovered",!1);this.rawVector=t,this._mainContainer=new Ui,t.onDispose=()=>this.dispose(),t.onUpdate=()=>this.rebuild(!0),this._x=t.x,this._y=t.y,this.getContainer().on("pointerover",e=>{this._isHovered=!0}),this.getContainer().on("pointerout",e=>{this._isHovered=!1}),this.getContainer().on("pointermove",e=>{if(!this._isDraggable)return;const i=e.data.global.x,s=e.data.global.y;if(this._previousX===null||this._previousY===null){this._previousX=i,this._previousY=s;return}if(console.log("Moving",i,s),this._isDragging){const n=i-this._previousX,o=s-this._previousY;this.getContainer().x+=n,this.getContainer().y+=o,this._previousX=i,this._previousY=s,this.rebuild(!0)}})}get isSelected(){return this._isSelected}displayBbox(){const t=this.getContainer().getBounds(),e=new Ri;e.lineStyle(1,16711680,1),e.drawRect(t.x,t.y,t.width,t.height),this._mainContainer.addChild(e);const i=new Ri;i.lineStyle(1,65280,1),i.drawRect(0,0,this.getContainer().width,this.getContainer().height),this._mainContainer.addChild(i)}set isSelected(t){this._isSelected=t,t?(this._mainGraphics.tint=255,console.log("Selected",this.rawVector.asString(),this)):(this._mainGraphics.tint=16777215,console.log("Unselected",this.rawVector.asString(),this))}get isDisposed(){return this._isDisposed}getContainer(){return this._mainContainer}rebuild(t=!1,e=0,i=1,s=.5){this._mainGraphics||(this._mainGraphics=new Ri,this._mainContainer.addChild(this._mainGraphics),this._selectedGraphics=new Ri,this._mainContainer.addChild(this._selectedGraphics)),this._mainGraphics.clear(),this._selectedGraphics.clear(),this._mainGraphics.moveTo(0,0),this._selectedGraphics.moveTo(0,0),this._segmentGraphics.forEach(n=>{n.destroy(),n.removeFromParent()}),this._mainGraphics.lineStyle(i,e,.5,0),this._mainGraphics.beginFill(10592673,s),this.rawVector.paths.forEach(n=>{n instanceof Hs&&_e.moveTo(this._mainGraphics,this.rawVector,n),n instanceof Kr&&_e.lineTo(this._mainGraphics,this.rawVector,n),n instanceof Mr&&_e.horizontalLineTo(this._mainGraphics,this.rawVector,n),n instanceof kr&&_e.verticalLineTo(this._mainGraphics,this.rawVector,n),n instanceof Tr&&_e.cubicBezierCurveTo(this._mainGraphics,this.rawVector,n),n instanceof qr&&_e.quadraticBezierCurveTo(this._mainGraphics,this.rawVector,n),n instanceof ua&&_e.arcTo(this._mainGraphics,this.rawVector,n),n instanceof An&&_e.closePath(this._mainGraphics,this.rawVector,n)})}render(){}dispose(){this._mainGraphics&&(this._segmentGraphics.forEach(t=>{t.destroy(),t.removeFromParent()}),this._mainGraphics.destroy(),this._mainGraphics.removeFromParent(),this._mainContainer.destroy(),this._mainContainer.removeFromParent(),this._isDisposed=!0)}}const Sd=new Map;Lt.on("uow:register",r=>{Sd.set(r.key,r.data)});Lt.on("uow:unregister",r=>{Sd.delete(r.key)});function Ie(r){return Sd.get(r)}function yi(r){Lt.emit("uow:register",r)}const ag=.05,qc=.2,og=.05,lg=3,hg=45/2,ug=609898,VC=.5,HC=.5,cg=16711680,WC=.5,XC=.5;let ve={boardWidth:1600,boardLenght:5e3,nesting:{polyognTolerance:10,spaceBetweenParts:10,rotationSteps:4,geneticAlgorithm:{populationSize:10,mutationRate:4,generation:1}},cut:{target:"IP",printer:{name:"SummaCut"},summa:{model:"",blade:""},network:{ip:"127.0.0.1",port:9001}}};class jC{constructor(){tt(this,"_wrapDistance",20);tt(this,"doubleCut",!1);tt(this,"unitOfMeasure",2)}get wrapDistance(){return this._wrapDistance}set wrapDistance(t){this.unitOfMeasure===3&&(t=t*25.4),t<5&&(t=5),t>100&&(t=100),this.unitOfMeasure===3&&(t=t/25.4),this._wrapDistance=Number(t.toFixed(2))}}const Ye=new jC;function As(r,t){const e=typeof r=="string"?parseFloat(r):r,i=.0393701,s=.00328084;let n;if(t==="inches")n=e*i;else if(t==="feet")n=e*s;else throw new Error("Invalid unit. Please specify 'inches' or 'feet'.");const o=Ye.unitOfMeasure;return[parseFloat(o===3?n.toFixed(2):Number(r).toFixed(2)),o===3?"Imperial":"Metric"]}class bs extends ri{constructor(){super("Popup");tt(this,"width",500);tt(this,"height",400);tt(this,"isPrompt",!1);tt(this,"content","");tt(this,"isVisible",!1);tt(this,"title","Popup");tt(this,"actions",[]);tt(this,"currentresolver",()=>{});this.registerTemplate("default",$C)}show(){return this.isVisible=!0,this.update(),new Promise(e=>{this.currentresolver=e})}hide(){this.isVisible=!1,this.update()}}const $C=r=>{var t;return Z(Re,null,Z("div",{style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"#00000055",display:r.isVisible?"flex":"none",justifyContent:"center",alignItems:"center",zIndex:"1000"}}),Z("div",{style:{width:r.width,height:r.height,backgroundColor:"white",borderRadius:"10px",boxShadow:"0px 0px 10px 0px #00000055",display:r.isVisible?"flex":"none",flexDirection:"column",justifyContent:"stretch",alignItems:"stretch",zIndex:"1001",position:"fixed",top:`calc(50% - (${r.height}px)/2)`,left:`calc(50% - (${r.width}px)/2)`}},Z("div",{style:{width:"100%",minHeight:"60px",maxHeight:"60px",backgroundColor:"black",color:"white",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",fontWeight:"bold",borderTopLeftRadius:"10px",borderTopRightRadius:"10px"}},r.title),Z("div",{style:{flex:"1",display:"flex",flexDirection:"column",justifyContent:"stretch",alignItems:"stretch",padding:"20px"}},((t=r.content)==null?void 0:t.vdom)??r.content),Z("div",{style:{width:"100%",height:"80px",minHeight:"80px",color:"white",display:"flex",justifyContent:"center",alignItems:"center"}},r.actions)))};async function YC(){const r=new bs,t=Ie("mainFrame");t.children.push(r),t.update();const e="Do you want to apply nesting to the selected items? this may take a while.";let i="Nesting in progress, please wait...",s=0;const n=Z("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:"20px"}},Z("div",{style:{marginBottom:"20px"}},e)),o=()=>Z("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:"20px"}},Z("div",{style:{marginBottom:"20px"}},i),Z("div",{style:{width:"80%",height:"30px",backgroundColor:"#e0e0df",borderRadius:"5px",overflow:"hidden"}},Z("div",{style:{width:`${s}%`,height:"100%",backgroundColor:"#25a8df",transition:"width 0.5s"}})));return r.title="Super Nesting",r.height=250,r.content=n,r.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer",marginRight:"10px"},onClick:()=>{r.content=o(),r.update(),r.actions.shift();let h=[];h.push(Lt.on(Kt.BoardSurface.onNestingProgress,d=>{s=d[0],i=`Nesting in progress, please wait... Iteration ${d[1]+1}/${ve.nesting.geneticAlgorithm.generation+1}`,r.content=o(),r.update()})),h.push(Lt.on(Kt.BoardSurface.onNestingComplete,d=>{r.hide(),h.forEach(p=>{p.off()})})),Lt.emit(Kt.BoardSurface.onNesting)}},"Ok"),Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer"},onClick:()=>{r.hide(),r.currentresolver(void 0)}},"Cancel")],r.update(),r.show()}async function qC(){const r=new bs,t=Ie("mainFrame");t.children.push(r),t.update();const e="There is a new version of the software available. Would you like to update?",i="Updating software... Please wait.",s="Software updated successfully. Please restart the application.";let n=0;const o=Z("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:"20px"}},Z("div",{style:{marginBottom:"20px"}},e)),h=()=>Z("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:"20px"}},Z("div",{style:{marginBottom:"20px"}},i),Z("div",{style:{width:"80%",height:"30px",backgroundColor:"#e0e0df",borderRadius:"5px",overflow:"hidden"}},Z("div",{style:{width:`${n}%`,height:"100%",backgroundColor:"#25a8df",transition:"width 0.5s"}}))),d=()=>Z("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:"20px"}},Z("div",{style:{marginBottom:"20px"}},s));return r.title="Software Update",r.height=250,r.content=o,r.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer",marginRight:"10px"},onClick:()=>{r.content=h(),r.update(),window.installUpdate();const p=setInterval(async()=>{n=await window.updateProgress(),r.content=h(),r.update(),console.log("pct",n),r.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer",marginRight:"10px",opacity:.3}},"Ok")],n>=100&&(clearInterval(p),r.content=d(),r.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer",marginRight:"10px",opacity:1},onClick:()=>{window.close()}},"Ok")],r.update())},200)}},"Ok"),Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer"},onClick:()=>{r.hide(),r.currentresolver(void 0);const p=Ie("profile");Lt.emit(je.ButtonBar.Click,{id:p.guid,name:"profile"}),window.forceMaximize()}},"Cancel")],r.update(),r.show()}async function ZC(){console.log("ppLogin"),Ir.clear(),localStorage.clear();const r=new bs,t=Ie("mainFrame");t.children.push(r),t.update();let e="sorkemepsi@gufum.com",i="P@ssw0rd1";return r.update(),t.update(),r.title="Sign In",r.height=430,r.content=Z("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",gap:"30px"}},Z("div",null,"Please log in with your credentials"),Z("div",{style:{display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"start",gap:"10px",flex:1}},Z("span",null,"Login"),Z("input",{type:"text",style:{height:"30px",fontSize:"20px",width:"100%",value:e},onKeyUp:s=>{e=s.target.value}})),Z("div",{style:{display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"start",gap:"10px"}},Z("span",null,"Password"),Z("input",{type:"password",style:{height:"30px",fontSize:"20px",value:i},onKeyUp:s=>{i=s.target.value}}))),r.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer"},onClick:async()=>{try{const s=await Ce("authentication/signin/client","POST",{email:e,password:i},!0);if(s){console.log("user",s),localStorage.setItem("token",s.payload.token),console.log("token",localStorage.getItem("token")),localStorage.setItem("user",s.payload.user_id);try{const h=await Ce("account/subscriptionvalidity","POST",{value:"000001.3657qvfmrck",hash:-542307620});if(console.log("subscription",h),h.statusCode!==200){await Qe("Error","No valid subscription found"),window.close();return}}catch{await Qe("Error","No valid subscription found"),window.close();return}try{const h=await Ce("user/settings","GET",null);console.log("user-settings",h),Ye.unitOfMeasure=3}catch{await Qe("Error","No valid subscription found"),window.close();return}if(await window.checkForUpdate(localStorage.getItem("token"))){qC(),r.hide(),r.currentresolver(void 0);return}r.hide(),r.currentresolver(void 0);const o=Ie("profile");Lt.emit(je.ButtonBar.Click,{id:o.guid,name:"profile"}),window.forceMaximize()}else console.log("error"),Qe("Error","Invalid credentials")}catch{Qe("Error","Invalid credentials")}}},"Sign In"),Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer",marginLeft:"10px"},onClick:async()=>{try{window.close()}catch{Qe("Error","Invalid credentials")}}},"Close")],r.update(),await r.show()}async function KC(){const r=new bs,t=Ie("mainFrame");t.children.push(r),t.update();let e=1;const i=(await Ce("userproject/projectstatus","GET",null)).payload;return r.title="Project Status",r.height=210,r.content=Z("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px"}},"Select the status of your project",Z("select",{style:{height:"30px",marginLeft:"10px",fontSize:"20px",marginTop:"3px"},onChange:s=>{e=parseInt(s.target.value)}},i.map(s=>Z("option",{value:s.id},s.statusName)))),r.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer"},onClick:()=>{r.hide(),r.currentresolver(e.toString())}},"Ok"),Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",marginLeft:"10px",cursor:"pointer"},onClick:()=>{r.hide(),r.currentresolver("")}},"Cancel")],r.update(),await r.show()}async function QC(){const r=new bs,t=Ie("mainFrame");t.children.push(r),t.update();let e=1;const i=(await Ce("usercuttes/feedback/statuses","GET",null)).payload;return r.title="Project Status",r.height=210,r.content=Z("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px"}},"Select the status of your project",Z("select",{style:{height:"30px",marginLeft:"10px",fontSize:"20px",marginTop:"3px"},onChange:s=>{e=parseInt(s.target.value)}},i.map(s=>Z("option",{value:s.id},s.status)))),r.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer"},onClick:()=>{r.hide(),r.currentresolver(e.toString())}},"Ok"),Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",marginLeft:"10px",cursor:"pointer"},onClick:()=>{r.hide(),r.currentresolver("")}},"Cancel")],r.update(),await r.show()}function Qe(r,t,e="Ok",i=500,s=230){const n=new bs,o=Ie("mainFrame");return o.children.push(n),o.update(),n.title=r,n.width=i,n.height=s,n.content=Z("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px"}},t),n.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer"},onClick:()=>{n.hide(),n.currentresolver("ok")}},e)],n.update(),n.show()}function Co(r,t,e="Ok",i="Cancel"){const s=new bs,n=Ie("mainFrame");return n.children.push(s),n.update(),s.title=r,s.height=210,s.content=Z("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px"}},t),s.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",cursor:"pointer"},onClick:()=>{s.hide(),s.currentresolver("ok")}},e),Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",marginLeft:"10px",cursor:"pointer"},onClick:()=>{s.hide(),s.currentresolver("cancel")}},i)],s.update(),s.show()}function Cd(r,t,e,i){const s=new bs;let n=t;const o=Ie("mainFrame");return o.children.push(s),o.update(),s.title=r,s.height=210,s.content=Z("div",{style:{display:"flex"}},Z("input",{type:"text",defaultValue:t,style:{border:"1px solid",borderColor:"#cccccc",height:"30px",flex:1,color:"black",fontSize:"20px",paddingLeft:"10px",paddingRight:"10px"},onChange:h=>{n=h.target.value}})),s.actions=[Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",marginLeft:"10px",cursor:"pointer"},onClick:()=>{s.hide(),s.currentresolver(n)}},e),Z("div",{style:{width:"100px",textAlign:"center",backgroundColor:"black",color:"white",borderRadius:"10px",padding:"10px",marginLeft:"10px",cursor:"pointer"},onClick:()=>{s.hide(),s.currentresolver("")}},i)],s.update(),s.show()}async function Ea(r){return new Promise((t,e)=>{const i=document.querySelector(r);if(i)t(i);else{const s=new MutationObserver(()=>{console.log("MutationObserver");const o=document.querySelector(r);o&&(s.disconnect(),t(o),clearTimeout(n))});s.observe(document.body,{childList:!0,subtree:!0});const n=setTimeout(()=>{s.disconnect(),e(new Error(`Element with selector "${r}" not found within the timeout.`))},1e4)}})}var Ll={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},JC=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function tE(r){return r===10||r===13||r===8232||r===8233||r===32||r===9||r===11||r===12||r===160||r>=5760&&JC.indexOf(r)>=0}function eE(r){switch(r|32){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}function iE(r){return(r|32)===97}function Kn(r){return r>=48&&r<=57}function rE(r){return r>=48&&r<=57||r===43||r===45||r===46}function sE(r){this.index=0,this.path=r,this.max=r.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}function Dl(r){for(;r.index<r.max&&tE(r.path.charCodeAt(r.index));)r.index++}function nE(r){var t=r.path.charCodeAt(r.index);if(t===48){r.param=0,r.index++;return}if(t===49){r.param=1,r.index++;return}r.err="SvgPath: arc flag can be 0 or 1 only (at pos "+r.index+")"}function aE(r){var t=r.index,e=t,i=r.max,s=!1,n=!1,o=!1,h=!1,d;if(e>=i){r.err="SvgPath: missed param (at pos "+e+")";return}if(d=r.path.charCodeAt(e),(d===43||d===45)&&(e++,d=e<i?r.path.charCodeAt(e):0),!Kn(d)&&d!==46){r.err="SvgPath: param should start with 0..9 or `.` (at pos "+e+")";return}if(d!==46){if(s=d===48,e++,d=e<i?r.path.charCodeAt(e):0,s&&e<i&&d&&Kn(d)){r.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+t+")";return}for(;e<i&&Kn(r.path.charCodeAt(e));)e++,n=!0;d=e<i?r.path.charCodeAt(e):0}if(d===46){for(h=!0,e++;Kn(r.path.charCodeAt(e));)e++,o=!0;d=e<i?r.path.charCodeAt(e):0}if(d===101||d===69){if(h&&!n&&!o){r.err="SvgPath: invalid float exponent (at pos "+e+")";return}if(e++,d=e<i?r.path.charCodeAt(e):0,(d===43||d===45)&&e++,e<i&&Kn(r.path.charCodeAt(e)))for(;e<i&&Kn(r.path.charCodeAt(e));)e++;else{r.err="SvgPath: invalid float exponent (at pos "+e+")";return}}r.index=e,r.param=parseFloat(r.path.slice(t,e))+0}function ku(r){var t,e;t=r.path[r.segmentStart],e=t.toLowerCase();var i=r.data;if(e==="m"&&i.length>2&&(r.result.push([t,i[0],i[1]]),i=i.slice(2),e="l",t=t==="m"?"l":"L"),e==="r")r.result.push([t].concat(i));else for(;i.length>=Ll[e]&&(r.result.push([t].concat(i.splice(0,Ll[e]))),!!Ll[e]););}function oE(r){var t=r.max,e,i,s,n,o;if(r.segmentStart=r.index,e=r.path.charCodeAt(r.index),i=iE(e),!eE(e)){r.err="SvgPath: bad command "+r.path[r.index]+" (at pos "+r.index+")";return}if(n=Ll[r.path[r.index].toLowerCase()],r.index++,Dl(r),r.data=[],!n){ku(r);return}for(s=!1;;){for(o=n;o>0;o--){if(i&&(o===3||o===4)?nE(r):aE(r),r.err.length){ku(r);return}r.data.push(r.param),Dl(r),s=!1,r.index<t&&r.path.charCodeAt(r.index)===44&&(r.index++,Dl(r),s=!0)}if(!s&&(r.index>=r.max||!rE(r.path.charCodeAt(r.index))))break}ku(r)}var lE=function(t){var e=new sE(t),i=e.max;for(Dl(e);e.index<i&&!e.err.length;)oE(e);return e.result.length&&("mM".indexOf(e.result[0][0])<0?(e.err="SvgPath: string should start with `M` or `m`",e.result=[]):e.result[0][0]="M"),{err:e.err,segments:e.result}};function hE(r,t){return[r[0]*t[0]+r[2]*t[1],r[1]*t[0]+r[3]*t[1],r[0]*t[2]+r[2]*t[3],r[1]*t[2]+r[3]*t[3],r[0]*t[4]+r[2]*t[5]+r[4],r[1]*t[4]+r[3]*t[5]+r[5]]}function Lr(){if(!(this instanceof Lr))return new Lr;this.queue=[],this.cache=null}Lr.prototype.matrix=function(r){return r[0]===1&&r[1]===0&&r[2]===0&&r[3]===1&&r[4]===0&&r[5]===0?this:(this.cache=null,this.queue.push(r),this)};Lr.prototype.translate=function(r,t){return(r!==0||t!==0)&&(this.cache=null,this.queue.push([1,0,0,1,r,t])),this};Lr.prototype.scale=function(r,t){return(r!==1||t!==1)&&(this.cache=null,this.queue.push([r,0,0,t,0,0])),this};Lr.prototype.rotate=function(r,t,e){var i,s,n;return r!==0&&(this.translate(t,e),i=r*Math.PI/180,s=Math.cos(i),n=Math.sin(i),this.queue.push([s,n,-n,s,0,0]),this.cache=null,this.translate(-t,-e)),this};Lr.prototype.skewX=function(r){return r!==0&&(this.cache=null,this.queue.push([1,0,Math.tan(r*Math.PI/180),1,0,0])),this};Lr.prototype.skewY=function(r){return r!==0&&(this.cache=null,this.queue.push([1,Math.tan(r*Math.PI/180),0,1,0,0])),this};Lr.prototype.toArray=function(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],this.queue.length===1)return this.cache;for(var r=1;r<this.queue.length;r++)this.cache=hE(this.cache,this.queue[r]);return this.cache};Lr.prototype.calc=function(r,t,e){var i;return this.queue.length?(this.cache||(this.cache=this.toArray()),i=this.cache,[r*i[0]+t*i[2]+(e?0:i[4]),r*i[1]+t*i[3]+(e?0:i[5])]):[r,t]};var Dm=Lr,uE=Dm,cE={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},dE=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,fE=/[\s,]+/,pE=function(t){var e=new uE,i,s;return t.split(dE).forEach(function(n){if(n.length){if(typeof cE[n]<"u"){i=n;return}switch(s=n.split(fE).map(function(o){return+o||0}),i){case"matrix":s.length===6&&e.matrix(s);return;case"scale":s.length===1?e.scale(s[0],s[0]):s.length===2&&e.scale(s[0],s[1]);return;case"rotate":s.length===1?e.rotate(s[0],0,0):s.length===3&&e.rotate(s[0],s[1],s[2]);return;case"translate":s.length===1?e.translate(s[0],0):s.length===2&&e.translate(s[0],s[1]);return;case"skewX":s.length===1&&e.skewX(s[0]);return;case"skewY":s.length===1&&e.skewY(s[0]);return}}}),e},oo=Math.PI*2;function dg(r,t,e,i){var s=r*i-t*e<0?-1:1,n=r*e+t*i;return n>1&&(n=1),n<-1&&(n=-1),s*Math.acos(n)}function gE(r,t,e,i,s,n,o,h,d,p){var m=p*(r-e)/2+d*(t-i)/2,v=-d*(r-e)/2+p*(t-i)/2,b=o*o,y=h*h,P=m*m,M=v*v,z=b*y-b*M-y*P;z<0&&(z=0),z/=b*M+y*P,z=Math.sqrt(z)*(s===n?-1:1);var q=z*o/h*v,V=z*-h/o*m,I=p*q-d*V+(r+e)/2,Y=d*q+p*V+(t+i)/2,K=(m-q)/o,T=(v-V)/h,at=(-m-q)/o,ct=(-v-V)/h,pt=dg(1,0,K,T),wt=dg(K,T,at,ct);return n===0&&wt>0&&(wt-=oo),n===1&&wt<0&&(wt+=oo),[I,Y,pt,wt]}function mE(r,t){var e=1.3333333333333333*Math.tan(t/4),i=Math.cos(r),s=Math.sin(r),n=Math.cos(r+t),o=Math.sin(r+t);return[i,s,i-s*e,s+i*e,n+o*e,o-n*e,n,o]}var _E=function(t,e,i,s,n,o,h,d,p){var m=Math.sin(p*oo/360),v=Math.cos(p*oo/360),b=v*(t-i)/2+m*(e-s)/2,y=-m*(t-i)/2+v*(e-s)/2;if(b===0&&y===0)return[];if(h===0||d===0)return[];h=Math.abs(h),d=Math.abs(d);var P=b*b/(h*h)+y*y/(d*d);P>1&&(h*=Math.sqrt(P),d*=Math.sqrt(P));var M=gE(t,e,i,s,n,o,h,d,m,v),z=[],q=M[2],V=M[3],I=Math.max(Math.ceil(Math.abs(V)/(oo/4)),1);V/=I;for(var Y=0;Y<I;Y++)z.push(mE(q,V)),q+=V;return z.map(function(K){for(var T=0;T<K.length;T+=2){var at=K[T+0],ct=K[T+1];at*=h,ct*=d;var pt=v*at-m*ct,wt=m*at+v*ct;K[T+0]=pt+M[0],K[T+1]=wt+M[1]}return K})},lo=1e-10,fg=Math.PI/180;function _o(r,t,e){if(!(this instanceof _o))return new _o(r,t,e);this.rx=r,this.ry=t,this.ax=e}_o.prototype.transform=function(r){var t=Math.cos(this.ax*fg),e=Math.sin(this.ax*fg),i=[this.rx*(r[0]*t+r[2]*e),this.rx*(r[1]*t+r[3]*e),this.ry*(-r[0]*e+r[2]*t),this.ry*(-r[1]*e+r[3]*t)],s=i[0]*i[0]+i[2]*i[2],n=i[1]*i[1]+i[3]*i[3],o=((i[0]-i[3])*(i[0]-i[3])+(i[2]+i[1])*(i[2]+i[1]))*((i[0]+i[3])*(i[0]+i[3])+(i[2]-i[1])*(i[2]-i[1])),h=(s+n)/2;if(o<lo*h)return this.rx=this.ry=Math.sqrt(h),this.ax=0,this;var d=i[0]*i[1]+i[2]*i[3];o=Math.sqrt(o);var p=h+o/2,m=h-o/2;return this.ax=Math.abs(d)<lo&&Math.abs(p-n)<lo?90:Math.atan(Math.abs(d)>Math.abs(p-n)?(p-s)/d:d/(p-n))*180/Math.PI,this.ax>=0?(this.rx=Math.sqrt(p),this.ry=Math.sqrt(m)):(this.ax+=90,this.rx=Math.sqrt(m),this.ry=Math.sqrt(p)),this};_o.prototype.isDegenerate=function(){return this.rx<lo*this.ry||this.ry<lo*this.rx};var vE=_o,yE=lE,xE=pE,Js=Dm,bE=_E,wE=vE;function hi(r){if(!(this instanceof hi))return new hi(r);var t=yE(r);this.segments=t.segments,this.err=t.err,this.__stack=[]}hi.from=function(r){if(typeof r=="string")return new hi(r);if(r instanceof hi){var t=new hi("");return t.err=r.err,t.segments=r.segments.map(function(e){return e.slice()}),t.__stack=r.__stack.map(function(e){return Js().matrix(e.toArray())}),t}throw new Error("SvgPath.from: invalid param type "+r)};hi.prototype.__matrix=function(r){var t=this,e;r.queue.length&&this.iterate(function(i,s,n,o){var h,d,p,m;switch(i[0]){case"v":h=r.calc(0,i[1],!0),d=h[0]===0?["v",h[1]]:["l",h[0],h[1]];break;case"V":h=r.calc(n,i[1],!1),d=h[0]===r.calc(n,o,!1)[0]?["V",h[1]]:["L",h[0],h[1]];break;case"h":h=r.calc(i[1],0,!0),d=h[1]===0?["h",h[0]]:["l",h[0],h[1]];break;case"H":h=r.calc(i[1],o,!1),d=h[1]===r.calc(n,o,!1)[1]?["H",h[0]]:["L",h[0],h[1]];break;case"a":case"A":var v=r.toArray(),b=wE(i[1],i[2],i[3]).transform(v);if(v[0]*v[3]-v[1]*v[2]<0&&(i[5]=i[5]?"0":"1"),h=r.calc(i[6],i[7],i[0]==="a"),i[0]==="A"&&i[6]===n&&i[7]===o||i[0]==="a"&&i[6]===0&&i[7]===0){d=[i[0]==="a"?"l":"L",h[0],h[1]];break}b.isDegenerate()?d=[i[0]==="a"?"l":"L",h[0],h[1]]:d=[i[0],b.rx,b.ry,b.ax,i[4],i[5],h[0],h[1]];break;case"m":m=s>0,h=r.calc(i[1],i[2],m),d=["m",h[0],h[1]];break;default:for(p=i[0],d=[p],m=p.toLowerCase()===p,e=1;e<i.length;e+=2)h=r.calc(i[e],i[e+1],m),d.push(h[0],h[1])}t.segments[s]=d},!0)};hi.prototype.__evaluateStack=function(){var r,t;if(this.__stack.length){if(this.__stack.length===1){this.__matrix(this.__stack[0]),this.__stack=[];return}for(r=Js(),t=this.__stack.length;--t>=0;)r.matrix(this.__stack[t].toArray());this.__matrix(r),this.__stack=[]}};hi.prototype.toString=function(){var r="",t="",e=!1;this.__evaluateStack();for(var i=0,s=this.segments.length;i<s;i++){var n=this.segments[i],o=n[0];o!==t||o==="m"||o==="M"?(o==="m"&&t==="z"&&(r+=" "),r+=o,e=!1):e=!0;for(var h=1;h<n.length;h++){var d=n[h];h===1?e&&d>=0&&(r+=" "):d>=0&&(r+=" "),r+=d}t=o}return r};hi.prototype.translate=function(r,t){return this.__stack.push(Js().translate(r,t||0)),this};hi.prototype.scale=function(r,t){return this.__stack.push(Js().scale(r,!t&&t!==0?r:t)),this};hi.prototype.rotate=function(r,t,e){return this.__stack.push(Js().rotate(r,t||0,e||0)),this};hi.prototype.skewX=function(r){return this.__stack.push(Js().skewX(r)),this};hi.prototype.skewY=function(r){return this.__stack.push(Js().skewY(r)),this};hi.prototype.matrix=function(r){return this.__stack.push(Js().matrix(r)),this};hi.prototype.transform=function(r){return r.trim()?(this.__stack.push(xE(r)),this):this};hi.prototype.round=function(r){var t=0,e=0,i=0,s=0,n;return r=r||0,this.__evaluateStack(),this.segments.forEach(function(o){var h=o[0].toLowerCase()===o[0];switch(o[0]){case"H":case"h":h&&(o[1]+=i),i=o[1]-o[1].toFixed(r),o[1]=+o[1].toFixed(r);return;case"V":case"v":h&&(o[1]+=s),s=o[1]-o[1].toFixed(r),o[1]=+o[1].toFixed(r);return;case"Z":case"z":i=t,s=e;return;case"M":case"m":h&&(o[1]+=i,o[2]+=s),i=o[1]-o[1].toFixed(r),s=o[2]-o[2].toFixed(r),t=i,e=s,o[1]=+o[1].toFixed(r),o[2]=+o[2].toFixed(r);return;case"A":case"a":h&&(o[6]+=i,o[7]+=s),i=o[6]-o[6].toFixed(r),s=o[7]-o[7].toFixed(r),o[1]=+o[1].toFixed(r),o[2]=+o[2].toFixed(r),o[3]=+o[3].toFixed(r+2),o[6]=+o[6].toFixed(r),o[7]=+o[7].toFixed(r);return;default:n=o.length,h&&(o[n-2]+=i,o[n-1]+=s),i=o[n-2]-o[n-2].toFixed(r),s=o[n-1]-o[n-1].toFixed(r),o.forEach(function(d,p){p&&(o[p]=+o[p].toFixed(r))});return}}),this};hi.prototype.iterate=function(r,t){var e=this.segments,i={},s=!1,n=0,o=0,h=0,d=0,p,m,v;if(t||this.__evaluateStack(),e.forEach(function(b,y){var P=r(b,y,n,o);Array.isArray(P)&&(i[y]=P,s=!0);var M=b[0]===b[0].toLowerCase();switch(b[0]){case"m":case"M":n=b[1]+(M?n:0),o=b[2]+(M?o:0),h=n,d=o;return;case"h":case"H":n=b[1]+(M?n:0);return;case"v":case"V":o=b[1]+(M?o:0);return;case"z":case"Z":n=h,o=d;return;default:n=b[b.length-2]+(M?n:0),o=b[b.length-1]+(M?o:0)}}),!s)return this;for(v=[],p=0;p<e.length;p++)if(typeof i[p]<"u")for(m=0;m<i[p].length;m++)v.push(i[p][m]);else v.push(e[p]);return this.segments=v,this};hi.prototype.abs=function(){return this.iterate(function(r,t,e,i){var s=r[0],n=s.toUpperCase(),o;if(s!==n)switch(r[0]=n,s){case"v":r[1]+=i;return;case"a":r[6]+=e,r[7]+=i;return;default:for(o=1;o<r.length;o++)r[o]+=o%2?e:i}},!0),this};hi.prototype.rel=function(){return this.iterate(function(r,t,e,i){var s=r[0],n=s.toLowerCase(),o;if(s!==n&&!(t===0&&s==="M"))switch(r[0]=n,s){case"V":r[1]-=i;return;case"A":r[6]-=e,r[7]-=i;return;default:for(o=1;o<r.length;o++)r[o]-=o%2?e:i}},!0),this};hi.prototype.unarc=function(){return this.iterate(function(r,t,e,i){var s,n,o,h=[],d=r[0];return d!=="A"&&d!=="a"?null:(d==="a"?(n=e+r[6],o=i+r[7]):(n=r[6],o=r[7]),s=bE(e,i,n,o,r[4],r[5],r[1],r[2],r[3]),s.length===0?[[r[0]==="a"?"l":"L",r[6],r[7]]]:(s.forEach(function(p){h.push(["C",p[2],p[3],p[4],p[5],p[6],p[7]])}),h))}),this};hi.prototype.unshort=function(){var r=this.segments,t,e,i,s,n;return this.iterate(function(o,h,d,p){var m=o[0],v=m.toUpperCase(),b;h&&(v==="T"?(b=m==="t",i=r[h-1],i[0]==="Q"?(t=i[1]-d,e=i[2]-p):i[0]==="q"?(t=i[1]-i[3],e=i[2]-i[4]):(t=0,e=0),s=-t,n=-e,b||(s+=d,n+=p),r[h]=[b?"q":"Q",s,n,o[1],o[2]]):v==="S"&&(b=m==="s",i=r[h-1],i[0]==="C"?(t=i[3]-d,e=i[4]-p):i[0]==="c"?(t=i[3]-i[5],e=i[4]-i[6]):(t=0,e=0),s=-t,n=-e,b||(s+=d,n+=p),r[h]=[b?"c":"C",s,n,o[1],o[2],o[3],o[4]]))}),this};var SE=hi,Fl=SE;function CE(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Fm={exports:{}},ul={exports:{}},pg;function EE(){return pg||(pg=1,function(r,t){(function(e,i){i(t)})(js,function(e){var i=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,81,2,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,9,5351,0,7,14,13835,9,87,9,39,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,4706,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,983,6,110,6,6,9,4759,9,787719,239],s=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,68,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,4026,582,8634,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,757,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],n="-----------------------------------------------------------------------------------------------------------------------------------------------------",o="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",h={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},d="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",p={5:d,"5module":d+" export import",6:d+" const class extends export import super"},m=/^in(stanceof)?$/,v=new RegExp("["+o+"]"),b=new RegExp("["+o+n+"]");function y(u,x){for(var F=65536,j=0;j<x.length;j+=2){if(F+=x[j],F>u)return!1;if(F+=x[j+1],F>=u)return!0}return!1}function P(u,x){return u<65?u===36:u<91?!0:u<97?u===95:u<123?!0:u<=65535?u>=170&&v.test(String.fromCharCode(u)):x===!1?!1:y(u,s)}function M(u,x){return u<48?u===36:u<58?!0:u<65?!1:u<91?!0:u<97?u===95:u<123?!0:u<=65535?u>=170&&b.test(String.fromCharCode(u)):x===!1?!1:y(u,s)||y(u,i)}var z=function(x,F){F===void 0&&(F={}),this.label=x,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function q(u,x){return new z(u,{beforeExpr:!0,binop:x})}var V={beforeExpr:!0},I={startsExpr:!0},Y={};function K(u,x){return x===void 0&&(x={}),x.keyword=u,Y[u]=new z(u,x)}var T={num:new z("num",I),regexp:new z("regexp",I),string:new z("string",I),name:new z("name",I),privateId:new z("privateId",I),eof:new z("eof"),bracketL:new z("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new z("]"),braceL:new z("{",{beforeExpr:!0,startsExpr:!0}),braceR:new z("}"),parenL:new z("(",{beforeExpr:!0,startsExpr:!0}),parenR:new z(")"),comma:new z(",",V),semi:new z(";",V),colon:new z(":",V),dot:new z("."),question:new z("?",V),questionDot:new z("?."),arrow:new z("=>",V),template:new z("template"),invalidTemplate:new z("invalidTemplate"),ellipsis:new z("...",V),backQuote:new z("`",I),dollarBraceL:new z("${",{beforeExpr:!0,startsExpr:!0}),eq:new z("=",{beforeExpr:!0,isAssign:!0}),assign:new z("_=",{beforeExpr:!0,isAssign:!0}),incDec:new z("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new z("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:q("||",1),logicalAND:q("&&",2),bitwiseOR:q("|",3),bitwiseXOR:q("^",4),bitwiseAND:q("&",5),equality:q("==/!=/===/!==",6),relational:q("</>/<=/>=",7),bitShift:q("<</>>/>>>",8),plusMin:new z("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:q("%",10),star:q("*",10),slash:q("/",10),starstar:new z("**",{beforeExpr:!0}),coalesce:q("??",1),_break:K("break"),_case:K("case",V),_catch:K("catch"),_continue:K("continue"),_debugger:K("debugger"),_default:K("default",V),_do:K("do",{isLoop:!0,beforeExpr:!0}),_else:K("else",V),_finally:K("finally"),_for:K("for",{isLoop:!0}),_function:K("function",I),_if:K("if"),_return:K("return",V),_switch:K("switch"),_throw:K("throw",V),_try:K("try"),_var:K("var"),_const:K("const"),_while:K("while",{isLoop:!0}),_with:K("with"),_new:K("new",{beforeExpr:!0,startsExpr:!0}),_this:K("this",I),_super:K("super",I),_class:K("class",I),_extends:K("extends",V),_export:K("export"),_import:K("import",I),_null:K("null",I),_true:K("true",I),_false:K("false",I),_in:K("in",{beforeExpr:!0,binop:7}),_instanceof:K("instanceof",{beforeExpr:!0,binop:7}),_typeof:K("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:K("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:K("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},at=/\r\n?|\n|\u2028|\u2029/,ct=new RegExp(at.source,"g");function pt(u){return u===10||u===13||u===8232||u===8233}function wt(u,x,F){F===void 0&&(F=u.length);for(var j=x;j<F;j++){var it=u.charCodeAt(j);if(pt(it))return j<F-1&&it===13&&u.charCodeAt(j+1)===10?j+2:j+1}return-1}var It=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,bt=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,dt=Object.prototype,ht=dt.hasOwnProperty,Mt=dt.toString,_t=Object.hasOwn||function(u,x){return ht.call(u,x)},Rt=Array.isArray||function(u){return Mt.call(u)==="[object Array]"},kt=Object.create(null);function Gt(u){return kt[u]||(kt[u]=new RegExp("^(?:"+u.replace(/ /g,"|")+")$"))}function vt(u){return u<=65535?String.fromCharCode(u):(u-=65536,String.fromCharCode((u>>10)+55296,(u&1023)+56320))}var Pt=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Vt=function(x,F){this.line=x,this.column=F};Vt.prototype.offset=function(x){return new Vt(this.line,this.column+x)};var le=function(x,F,j){this.start=F,this.end=j,x.sourceFile!==null&&(this.source=x.sourceFile)};function re(u,x){for(var F=1,j=0;;){var it=wt(u,j,x);if(it<0)return new Vt(F,x-j);++F,j=it}}var ee={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},Qt=!1;function xe(u){var x={};for(var F in ee)x[F]=u&&_t(u,F)?u[F]:ee[F];if(x.ecmaVersion==="latest"?x.ecmaVersion=1e8:x.ecmaVersion==null?(!Qt&&typeof console=="object"&&console.warn&&(Qt=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),x.ecmaVersion=11):x.ecmaVersion>=2015&&(x.ecmaVersion-=2009),x.allowReserved==null&&(x.allowReserved=x.ecmaVersion<5),(!u||u.allowHashBang==null)&&(x.allowHashBang=x.ecmaVersion>=14),Rt(x.onToken)){var j=x.onToken;x.onToken=function(it){return j.push(it)}}return Rt(x.onComment)&&(x.onComment=Fe(x,x.onComment)),x}function Fe(u,x){return function(F,j,it,mt,xt,Dt){var Ht={type:F?"Block":"Line",value:j,start:it,end:mt};u.locations&&(Ht.loc=new le(this,xt,Dt)),u.ranges&&(Ht.range=[it,mt]),x.push(Ht)}}var se=1,ne=2,Zt=4,Oe=8,Ae=16,Xe=32,Ve=64,ci=128,mi=256,Ii=se|ne|mi;function vr(u,x){return ne|(u?Zt:0)|(x?Oe:0)}var es=0,qe=1,Zi=2,$e=3,ws=4,be=5,a=function(x,F,j){this.options=x=xe(x),this.sourceFile=x.sourceFile,this.keywords=Gt(p[x.ecmaVersion>=6?6:x.sourceType==="module"?"5module":5]);var it="";x.allowReserved!==!0&&(it=h[x.ecmaVersion>=6?6:x.ecmaVersion===5?5:3],x.sourceType==="module"&&(it+=" await")),this.reservedWords=Gt(it);var mt=(it?it+" ":"")+h.strict;this.reservedWordsStrict=Gt(mt),this.reservedWordsStrictBind=Gt(mt+" "+h.strictBind),this.input=String(F),this.containsEsc=!1,j?(this.pos=j,this.lineStart=this.input.lastIndexOf(`
`,j-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(at).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=T.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=x.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&x.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(se),this.regexpState=null,this.privateNameStack=[]},l={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};a.prototype.parse=function(){var x=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(x)},l.inFunction.get=function(){return(this.currentVarScope().flags&ne)>0},l.inGenerator.get=function(){return(this.currentVarScope().flags&Oe)>0&&!this.currentVarScope().inClassFieldInit},l.inAsync.get=function(){return(this.currentVarScope().flags&Zt)>0&&!this.currentVarScope().inClassFieldInit},l.canAwait.get=function(){for(var u=this.scopeStack.length-1;u>=0;u--){var x=this.scopeStack[u];if(x.inClassFieldInit||x.flags&mi)return!1;if(x.flags&ne)return(x.flags&Zt)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},l.allowSuper.get=function(){var u=this.currentThisScope(),x=u.flags,F=u.inClassFieldInit;return(x&Ve)>0||F||this.options.allowSuperOutsideMethod},l.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ci)>0},l.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},l.allowNewDotTarget.get=function(){var u=this.currentThisScope(),x=u.flags,F=u.inClassFieldInit;return(x&(ne|mi))>0||F},l.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&mi)>0},a.extend=function(){for(var x=[],F=arguments.length;F--;)x[F]=arguments[F];for(var j=this,it=0;it<x.length;it++)j=x[it](j);return j},a.parse=function(x,F){return new this(F,x).parse()},a.parseExpressionAt=function(x,F,j){var it=new this(j,x,F);return it.nextToken(),it.parseExpression()},a.tokenizer=function(x,F){return new this(F,x)},Object.defineProperties(a.prototype,l);var c=a.prototype,f=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;c.strictDirective=function(u){if(this.options.ecmaVersion<5)return!1;for(;;){bt.lastIndex=u,u+=bt.exec(this.input)[0].length;var x=f.exec(this.input.slice(u));if(!x)return!1;if((x[1]||x[2])==="use strict"){bt.lastIndex=u+x[0].length;var F=bt.exec(this.input),j=F.index+F[0].length,it=this.input.charAt(j);return it===";"||it==="}"||at.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(it)||it==="!"&&this.input.charAt(j+1)==="=")}u+=x[0].length,bt.lastIndex=u,u+=bt.exec(this.input)[0].length,this.input[u]===";"&&u++}},c.eat=function(u){return this.type===u?(this.next(),!0):!1},c.isContextual=function(u){return this.type===T.name&&this.value===u&&!this.containsEsc},c.eatContextual=function(u){return this.isContextual(u)?(this.next(),!0):!1},c.expectContextual=function(u){this.eatContextual(u)||this.unexpected()},c.canInsertSemicolon=function(){return this.type===T.eof||this.type===T.braceR||at.test(this.input.slice(this.lastTokEnd,this.start))},c.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},c.semicolon=function(){!this.eat(T.semi)&&!this.insertSemicolon()&&this.unexpected()},c.afterTrailingComma=function(u,x){if(this.type===u)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),x||this.next(),!0},c.expect=function(u){this.eat(u)||this.unexpected()},c.unexpected=function(u){this.raise(u??this.start,"Unexpected token")};var g=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};c.checkPatternErrors=function(u,x){if(u){u.trailingComma>-1&&this.raiseRecoverable(u.trailingComma,"Comma is not permitted after the rest element");var F=x?u.parenthesizedAssign:u.parenthesizedBind;F>-1&&this.raiseRecoverable(F,x?"Assigning to rvalue":"Parenthesized pattern")}},c.checkExpressionErrors=function(u,x){if(!u)return!1;var F=u.shorthandAssign,j=u.doubleProto;if(!x)return F>=0||j>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),j>=0&&this.raiseRecoverable(j,"Redefinition of __proto__ property")},c.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},c.isSimpleAssignTarget=function(u){return u.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(u.expression):u.type==="Identifier"||u.type==="MemberExpression"};var _=a.prototype;_.parseTopLevel=function(u){var x=Object.create(null);for(u.body||(u.body=[]);this.type!==T.eof;){var F=this.parseStatement(null,!0,x);u.body.push(F)}if(this.inModule)for(var j=0,it=Object.keys(this.undefinedExports);j<it.length;j+=1){var mt=it[j];this.raiseRecoverable(this.undefinedExports[mt].start,"Export '"+mt+"' is not defined")}return this.adaptDirectivePrologue(u.body),this.next(),u.sourceType=this.options.sourceType,this.finishNode(u,"Program")};var S={kind:"loop"},w={kind:"switch"};_.isLet=function(u){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;bt.lastIndex=this.pos;var x=bt.exec(this.input),F=this.pos+x[0].length,j=this.input.charCodeAt(F);if(j===91||j===92)return!0;if(u)return!1;if(j===123||j>55295&&j<56320)return!0;if(P(j,!0)){for(var it=F+1;M(j=this.input.charCodeAt(it),!0);)++it;if(j===92||j>55295&&j<56320)return!0;var mt=this.input.slice(F,it);if(!m.test(mt))return!0}return!1},_.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;bt.lastIndex=this.pos;var u=bt.exec(this.input),x=this.pos+u[0].length,F;return!at.test(this.input.slice(this.pos,x))&&this.input.slice(x,x+8)==="function"&&(x+8===this.input.length||!(M(F=this.input.charCodeAt(x+8))||F>55295&&F<56320))},_.parseStatement=function(u,x,F){var j=this.type,it=this.startNode(),mt;switch(this.isLet(u)&&(j=T._var,mt="let"),j){case T._break:case T._continue:return this.parseBreakContinueStatement(it,j.keyword);case T._debugger:return this.parseDebuggerStatement(it);case T._do:return this.parseDoStatement(it);case T._for:return this.parseForStatement(it);case T._function:return u&&(this.strict||u!=="if"&&u!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(it,!1,!u);case T._class:return u&&this.unexpected(),this.parseClass(it,!0);case T._if:return this.parseIfStatement(it);case T._return:return this.parseReturnStatement(it);case T._switch:return this.parseSwitchStatement(it);case T._throw:return this.parseThrowStatement(it);case T._try:return this.parseTryStatement(it);case T._const:case T._var:return mt=mt||this.value,u&&mt!=="var"&&this.unexpected(),this.parseVarStatement(it,mt);case T._while:return this.parseWhileStatement(it);case T._with:return this.parseWithStatement(it);case T.braceL:return this.parseBlock(!0,it);case T.semi:return this.parseEmptyStatement(it);case T._export:case T._import:if(this.options.ecmaVersion>10&&j===T._import){bt.lastIndex=this.pos;var xt=bt.exec(this.input),Dt=this.pos+xt[0].length,Ht=this.input.charCodeAt(Dt);if(Ht===40||Ht===46)return this.parseExpressionStatement(it,this.parseExpression())}return this.options.allowImportExportEverywhere||(x||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),j===T._import?this.parseImport(it):this.parseExport(it,F);default:if(this.isAsyncFunction())return u&&this.unexpected(),this.next(),this.parseFunctionStatement(it,!0,!u);var Ee=this.value,Me=this.parseExpression();return j===T.name&&Me.type==="Identifier"&&this.eat(T.colon)?this.parseLabeledStatement(it,Ee,Me,u):this.parseExpressionStatement(it,Me)}},_.parseBreakContinueStatement=function(u,x){var F=x==="break";this.next(),this.eat(T.semi)||this.insertSemicolon()?u.label=null:this.type!==T.name?this.unexpected():(u.label=this.parseIdent(),this.semicolon());for(var j=0;j<this.labels.length;++j){var it=this.labels[j];if((u.label==null||it.name===u.label.name)&&(it.kind!=null&&(F||it.kind==="loop")||u.label&&F))break}return j===this.labels.length&&this.raise(u.start,"Unsyntactic "+x),this.finishNode(u,F?"BreakStatement":"ContinueStatement")},_.parseDebuggerStatement=function(u){return this.next(),this.semicolon(),this.finishNode(u,"DebuggerStatement")},_.parseDoStatement=function(u){return this.next(),this.labels.push(S),u.body=this.parseStatement("do"),this.labels.pop(),this.expect(T._while),u.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(T.semi):this.semicolon(),this.finishNode(u,"DoWhileStatement")},_.parseForStatement=function(u){this.next();var x=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(S),this.enterScope(0),this.expect(T.parenL),this.type===T.semi)return x>-1&&this.unexpected(x),this.parseFor(u,null);var F=this.isLet();if(this.type===T._var||this.type===T._const||F){var j=this.startNode(),it=F?"let":this.value;return this.next(),this.parseVar(j,!0,it),this.finishNode(j,"VariableDeclaration"),(this.type===T._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&j.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===T._in?x>-1&&this.unexpected(x):u.await=x>-1),this.parseForIn(u,j)):(x>-1&&this.unexpected(x),this.parseFor(u,j))}var mt=this.isContextual("let"),xt=!1,Dt=new g,Ht=this.parseExpression(x>-1?"await":!0,Dt);return this.type===T._in||(xt=this.options.ecmaVersion>=6&&this.isContextual("of"))?(this.options.ecmaVersion>=9&&(this.type===T._in?x>-1&&this.unexpected(x):u.await=x>-1),mt&&xt&&this.raise(Ht.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(Ht,!1,Dt),this.checkLValPattern(Ht),this.parseForIn(u,Ht)):(this.checkExpressionErrors(Dt,!0),x>-1&&this.unexpected(x),this.parseFor(u,Ht))},_.parseFunctionStatement=function(u,x,F){return this.next(),this.parseFunction(u,E|(F?0:B),!1,x)},_.parseIfStatement=function(u){return this.next(),u.test=this.parseParenExpression(),u.consequent=this.parseStatement("if"),u.alternate=this.eat(T._else)?this.parseStatement("if"):null,this.finishNode(u,"IfStatement")},_.parseReturnStatement=function(u){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(T.semi)||this.insertSemicolon()?u.argument=null:(u.argument=this.parseExpression(),this.semicolon()),this.finishNode(u,"ReturnStatement")},_.parseSwitchStatement=function(u){this.next(),u.discriminant=this.parseParenExpression(),u.cases=[],this.expect(T.braceL),this.labels.push(w),this.enterScope(0);for(var x,F=!1;this.type!==T.braceR;)if(this.type===T._case||this.type===T._default){var j=this.type===T._case;x&&this.finishNode(x,"SwitchCase"),u.cases.push(x=this.startNode()),x.consequent=[],this.next(),j?x.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,x.test=null),this.expect(T.colon)}else x||this.unexpected(),x.consequent.push(this.parseStatement(null));return this.exitScope(),x&&this.finishNode(x,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(u,"SwitchStatement")},_.parseThrowStatement=function(u){return this.next(),at.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),u.argument=this.parseExpression(),this.semicolon(),this.finishNode(u,"ThrowStatement")};var C=[];_.parseCatchClauseParam=function(){var u=this.parseBindingAtom(),x=u.type==="Identifier";return this.enterScope(x?Xe:0),this.checkLValPattern(u,x?ws:Zi),this.expect(T.parenR),u},_.parseTryStatement=function(u){if(this.next(),u.block=this.parseBlock(),u.handler=null,this.type===T._catch){var x=this.startNode();this.next(),this.eat(T.parenL)?x.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),x.param=null,this.enterScope(0)),x.body=this.parseBlock(!1),this.exitScope(),u.handler=this.finishNode(x,"CatchClause")}return u.finalizer=this.eat(T._finally)?this.parseBlock():null,!u.handler&&!u.finalizer&&this.raise(u.start,"Missing catch or finally clause"),this.finishNode(u,"TryStatement")},_.parseVarStatement=function(u,x,F){return this.next(),this.parseVar(u,!1,x,F),this.semicolon(),this.finishNode(u,"VariableDeclaration")},_.parseWhileStatement=function(u){return this.next(),u.test=this.parseParenExpression(),this.labels.push(S),u.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(u,"WhileStatement")},_.parseWithStatement=function(u){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),u.object=this.parseParenExpression(),u.body=this.parseStatement("with"),this.finishNode(u,"WithStatement")},_.parseEmptyStatement=function(u){return this.next(),this.finishNode(u,"EmptyStatement")},_.parseLabeledStatement=function(u,x,F,j){for(var it=0,mt=this.labels;it<mt.length;it+=1){var xt=mt[it];xt.name===x&&this.raise(F.start,"Label '"+x+"' is already declared")}for(var Dt=this.type.isLoop?"loop":this.type===T._switch?"switch":null,Ht=this.labels.length-1;Ht>=0;Ht--){var Ee=this.labels[Ht];if(Ee.statementStart===u.start)Ee.statementStart=this.start,Ee.kind=Dt;else break}return this.labels.push({name:x,kind:Dt,statementStart:this.start}),u.body=this.parseStatement(j?j.indexOf("label")===-1?j+"label":j:"label"),this.labels.pop(),u.label=F,this.finishNode(u,"LabeledStatement")},_.parseExpressionStatement=function(u,x){return u.expression=x,this.semicolon(),this.finishNode(u,"ExpressionStatement")},_.parseBlock=function(u,x,F){for(u===void 0&&(u=!0),x===void 0&&(x=this.startNode()),x.body=[],this.expect(T.braceL),u&&this.enterScope(0);this.type!==T.braceR;){var j=this.parseStatement(null);x.body.push(j)}return F&&(this.strict=!1),this.next(),u&&this.exitScope(),this.finishNode(x,"BlockStatement")},_.parseFor=function(u,x){return u.init=x,this.expect(T.semi),u.test=this.type===T.semi?null:this.parseExpression(),this.expect(T.semi),u.update=this.type===T.parenR?null:this.parseExpression(),this.expect(T.parenR),u.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(u,"ForStatement")},_.parseForIn=function(u,x){var F=this.type===T._in;return this.next(),x.type==="VariableDeclaration"&&x.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||x.kind!=="var"||x.declarations[0].id.type!=="Identifier")&&this.raise(x.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"),u.left=x,u.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(T.parenR),u.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(u,F?"ForInStatement":"ForOfStatement")},_.parseVar=function(u,x,F,j){for(u.declarations=[],u.kind=F;;){var it=this.startNode();if(this.parseVarId(it,F),this.eat(T.eq)?it.init=this.parseMaybeAssign(x):!j&&F==="const"&&!(this.type===T._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!j&&it.id.type!=="Identifier"&&!(x&&(this.type===T._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):it.init=null,u.declarations.push(this.finishNode(it,"VariableDeclarator")),!this.eat(T.comma))break}return u},_.parseVarId=function(u,x){u.id=this.parseBindingAtom(),this.checkLValPattern(u.id,x==="var"?qe:Zi,!1)};var E=1,B=2,D=4;_.parseFunction=function(u,x,F,j,it){this.initFunction(u),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!j)&&(this.type===T.star&&x&B&&this.unexpected(),u.generator=this.eat(T.star)),this.options.ecmaVersion>=8&&(u.async=!!j),x&E&&(u.id=x&D&&this.type!==T.name?null:this.parseIdent(),u.id&&!(x&B)&&this.checkLValSimple(u.id,this.strict||u.generator||u.async?this.treatFunctionsAsVar?qe:Zi:$e));var mt=this.yieldPos,xt=this.awaitPos,Dt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(vr(u.async,u.generator)),x&E||(u.id=this.type===T.name?this.parseIdent():null),this.parseFunctionParams(u),this.parseFunctionBody(u,F,!1,it),this.yieldPos=mt,this.awaitPos=xt,this.awaitIdentPos=Dt,this.finishNode(u,x&E?"FunctionDeclaration":"FunctionExpression")},_.parseFunctionParams=function(u){this.expect(T.parenL),u.params=this.parseBindingList(T.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},_.parseClass=function(u,x){this.next();var F=this.strict;this.strict=!0,this.parseClassId(u,x),this.parseClassSuper(u);var j=this.enterClassBody(),it=this.startNode(),mt=!1;for(it.body=[],this.expect(T.braceL);this.type!==T.braceR;){var xt=this.parseClassElement(u.superClass!==null);xt&&(it.body.push(xt),xt.type==="MethodDefinition"&&xt.kind==="constructor"?(mt&&this.raiseRecoverable(xt.start,"Duplicate constructor in the same class"),mt=!0):xt.key&&xt.key.type==="PrivateIdentifier"&&R(j,xt)&&this.raiseRecoverable(xt.key.start,"Identifier '#"+xt.key.name+"' has already been declared"))}return this.strict=F,this.next(),u.body=this.finishNode(it,"ClassBody"),this.exitClassBody(),this.finishNode(u,x?"ClassDeclaration":"ClassExpression")},_.parseClassElement=function(u){if(this.eat(T.semi))return null;var x=this.options.ecmaVersion,F=this.startNode(),j="",it=!1,mt=!1,xt="method",Dt=!1;if(this.eatContextual("static")){if(x>=13&&this.eat(T.braceL))return this.parseClassStaticBlock(F),F;this.isClassElementNameStart()||this.type===T.star?Dt=!0:j="static"}if(F.static=Dt,!j&&x>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===T.star)&&!this.canInsertSemicolon()?mt=!0:j="async"),!j&&(x>=9||!mt)&&this.eat(T.star)&&(it=!0),!j&&!mt&&!it){var Ht=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?xt=Ht:j=Ht)}if(j?(F.computed=!1,F.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),F.key.name=j,this.finishNode(F.key,"Identifier")):this.parseClassElementName(F),x<13||this.type===T.parenL||xt!=="method"||it||mt){var Ee=!F.static&&k(F,"constructor"),Me=Ee&&u;Ee&&xt!=="method"&&this.raise(F.key.start,"Constructor can't have get/set modifier"),F.kind=Ee?"constructor":xt,this.parseClassMethod(F,it,mt,Me)}else this.parseClassField(F);return F},_.isClassElementNameStart=function(){return this.type===T.name||this.type===T.privateId||this.type===T.num||this.type===T.string||this.type===T.bracketL||this.type.keyword},_.parseClassElementName=function(u){this.type===T.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),u.computed=!1,u.key=this.parsePrivateIdent()):this.parsePropertyName(u)},_.parseClassMethod=function(u,x,F,j){var it=u.key;u.kind==="constructor"?(x&&this.raise(it.start,"Constructor can't be a generator"),F&&this.raise(it.start,"Constructor can't be an async method")):u.static&&k(u,"prototype")&&this.raise(it.start,"Classes may not have a static property named prototype");var mt=u.value=this.parseMethod(x,F,j);return u.kind==="get"&&mt.params.length!==0&&this.raiseRecoverable(mt.start,"getter should have no params"),u.kind==="set"&&mt.params.length!==1&&this.raiseRecoverable(mt.start,"setter should have exactly one param"),u.kind==="set"&&mt.params[0].type==="RestElement"&&this.raiseRecoverable(mt.params[0].start,"Setter cannot use rest params"),this.finishNode(u,"MethodDefinition")},_.parseClassField=function(u){if(k(u,"constructor")?this.raise(u.key.start,"Classes can't have a field named 'constructor'"):u.static&&k(u,"prototype")&&this.raise(u.key.start,"Classes can't have a static field named 'prototype'"),this.eat(T.eq)){var x=this.currentThisScope(),F=x.inClassFieldInit;x.inClassFieldInit=!0,u.value=this.parseMaybeAssign(),x.inClassFieldInit=F}else u.value=null;return this.semicolon(),this.finishNode(u,"PropertyDefinition")},_.parseClassStaticBlock=function(u){u.body=[];var x=this.labels;for(this.labels=[],this.enterScope(mi|Ve);this.type!==T.braceR;){var F=this.parseStatement(null);u.body.push(F)}return this.next(),this.exitScope(),this.labels=x,this.finishNode(u,"StaticBlock")},_.parseClassId=function(u,x){this.type===T.name?(u.id=this.parseIdent(),x&&this.checkLValSimple(u.id,Zi,!1)):(x===!0&&this.unexpected(),u.id=null)},_.parseClassSuper=function(u){u.superClass=this.eat(T._extends)?this.parseExprSubscripts(null,!1):null},_.enterClassBody=function(){var u={declared:Object.create(null),used:[]};return this.privateNameStack.push(u),u.declared},_.exitClassBody=function(){var u=this.privateNameStack.pop(),x=u.declared,F=u.used;if(this.options.checkPrivateFields)for(var j=this.privateNameStack.length,it=j===0?null:this.privateNameStack[j-1],mt=0;mt<F.length;++mt){var xt=F[mt];_t(x,xt.name)||(it?it.used.push(xt):this.raiseRecoverable(xt.start,"Private field '#"+xt.name+"' must be declared in an enclosing class"))}};function R(u,x){var F=x.key.name,j=u[F],it="true";return x.type==="MethodDefinition"&&(x.kind==="get"||x.kind==="set")&&(it=(x.static?"s":"i")+x.kind),j==="iget"&&it==="iset"||j==="iset"&&it==="iget"||j==="sget"&&it==="sset"||j==="sset"&&it==="sget"?(u[F]="true",!1):j?!0:(u[F]=it,!1)}function k(u,x){var F=u.computed,j=u.key;return!F&&(j.type==="Identifier"&&j.name===x||j.type==="Literal"&&j.value===x)}_.parseExportAllDeclaration=function(u,x){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(u.exported=this.parseModuleExportName(),this.checkExport(x,u.exported,this.lastTokStart)):u.exported=null),this.expectContextual("from"),this.type!==T.string&&this.unexpected(),u.source=this.parseExprAtom(),this.semicolon(),this.finishNode(u,"ExportAllDeclaration")},_.parseExport=function(u,x){if(this.next(),this.eat(T.star))return this.parseExportAllDeclaration(u,x);if(this.eat(T._default))return this.checkExport(x,"default",this.lastTokStart),u.declaration=this.parseExportDefaultDeclaration(),this.finishNode(u,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())u.declaration=this.parseExportDeclaration(u),u.declaration.type==="VariableDeclaration"?this.checkVariableExport(x,u.declaration.declarations):this.checkExport(x,u.declaration.id,u.declaration.id.start),u.specifiers=[],u.source=null;else{if(u.declaration=null,u.specifiers=this.parseExportSpecifiers(x),this.eatContextual("from"))this.type!==T.string&&this.unexpected(),u.source=this.parseExprAtom();else{for(var F=0,j=u.specifiers;F<j.length;F+=1){var it=j[F];this.checkUnreserved(it.local),this.checkLocalExport(it.local),it.local.type==="Literal"&&this.raise(it.local.start,"A string literal cannot be used as an exported binding without `from`.")}u.source=null}this.semicolon()}return this.finishNode(u,"ExportNamedDeclaration")},_.parseExportDeclaration=function(u){return this.parseStatement(null)},_.parseExportDefaultDeclaration=function(){var u;if(this.type===T._function||(u=this.isAsyncFunction())){var x=this.startNode();return this.next(),u&&this.next(),this.parseFunction(x,E|D,!1,u)}else if(this.type===T._class){var F=this.startNode();return this.parseClass(F,"nullableID")}else{var j=this.parseMaybeAssign();return this.semicolon(),j}},_.checkExport=function(u,x,F){u&&(typeof x!="string"&&(x=x.type==="Identifier"?x.name:x.value),_t(u,x)&&this.raiseRecoverable(F,"Duplicate export '"+x+"'"),u[x]=!0)},_.checkPatternExport=function(u,x){var F=x.type;if(F==="Identifier")this.checkExport(u,x,x.start);else if(F==="ObjectPattern")for(var j=0,it=x.properties;j<it.length;j+=1){var mt=it[j];this.checkPatternExport(u,mt)}else if(F==="ArrayPattern")for(var xt=0,Dt=x.elements;xt<Dt.length;xt+=1){var Ht=Dt[xt];Ht&&this.checkPatternExport(u,Ht)}else F==="Property"?this.checkPatternExport(u,x.value):F==="AssignmentPattern"?this.checkPatternExport(u,x.left):F==="RestElement"&&this.checkPatternExport(u,x.argument)},_.checkVariableExport=function(u,x){if(u)for(var F=0,j=x;F<j.length;F+=1){var it=j[F];this.checkPatternExport(u,it.id)}},_.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},_.parseExportSpecifier=function(u){var x=this.startNode();return x.local=this.parseModuleExportName(),x.exported=this.eatContextual("as")?this.parseModuleExportName():x.local,this.checkExport(u,x.exported,x.exported.start),this.finishNode(x,"ExportSpecifier")},_.parseExportSpecifiers=function(u){var x=[],F=!0;for(this.expect(T.braceL);!this.eat(T.braceR);){if(F)F=!1;else if(this.expect(T.comma),this.afterTrailingComma(T.braceR))break;x.push(this.parseExportSpecifier(u))}return x},_.parseImport=function(u){return this.next(),this.type===T.string?(u.specifiers=C,u.source=this.parseExprAtom()):(u.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),u.source=this.type===T.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(u,"ImportDeclaration")},_.parseImportSpecifier=function(){var u=this.startNode();return u.imported=this.parseModuleExportName(),this.eatContextual("as")?u.local=this.parseIdent():(this.checkUnreserved(u.imported),u.local=u.imported),this.checkLValSimple(u.local,Zi),this.finishNode(u,"ImportSpecifier")},_.parseImportDefaultSpecifier=function(){var u=this.startNode();return u.local=this.parseIdent(),this.checkLValSimple(u.local,Zi),this.finishNode(u,"ImportDefaultSpecifier")},_.parseImportNamespaceSpecifier=function(){var u=this.startNode();return this.next(),this.expectContextual("as"),u.local=this.parseIdent(),this.checkLValSimple(u.local,Zi),this.finishNode(u,"ImportNamespaceSpecifier")},_.parseImportSpecifiers=function(){var u=[],x=!0;if(this.type===T.name&&(u.push(this.parseImportDefaultSpecifier()),!this.eat(T.comma)))return u;if(this.type===T.star)return u.push(this.parseImportNamespaceSpecifier()),u;for(this.expect(T.braceL);!this.eat(T.braceR);){if(x)x=!1;else if(this.expect(T.comma),this.afterTrailingComma(T.braceR))break;u.push(this.parseImportSpecifier())}return u},_.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===T.string){var u=this.parseLiteral(this.value);return Pt.test(u.value)&&this.raise(u.start,"An export name cannot include a lone surrogate."),u}return this.parseIdent(!0)},_.adaptDirectivePrologue=function(u){for(var x=0;x<u.length&&this.isDirectiveCandidate(u[x]);++x)u[x].directive=u[x].expression.raw.slice(1,-1)},_.isDirectiveCandidate=function(u){return this.options.ecmaVersion>=5&&u.type==="ExpressionStatement"&&u.expression.type==="Literal"&&typeof u.expression.value=="string"&&(this.input[u.start]==='"'||this.input[u.start]==="'")};var H=a.prototype;H.toAssignable=function(u,x,F){if(this.options.ecmaVersion>=6&&u)switch(u.type){case"Identifier":this.inAsync&&u.name==="await"&&this.raise(u.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":u.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var j=0,it=u.properties;j<it.length;j+=1){var mt=it[j];this.toAssignable(mt,x),mt.type==="RestElement"&&(mt.argument.type==="ArrayPattern"||mt.argument.type==="ObjectPattern")&&this.raise(mt.argument.start,"Unexpected token")}break;case"Property":u.kind!=="init"&&this.raise(u.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(u.value,x);break;case"ArrayExpression":u.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(u.elements,x);break;case"SpreadElement":u.type="RestElement",this.toAssignable(u.argument,x),u.argument.type==="AssignmentPattern"&&this.raise(u.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":u.operator!=="="&&this.raise(u.left.end,"Only '=' operator can be used for specifying default value."),u.type="AssignmentPattern",delete u.operator,this.toAssignable(u.left,x);break;case"ParenthesizedExpression":this.toAssignable(u.expression,x,F);break;case"ChainExpression":this.raiseRecoverable(u.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!x)break;default:this.raise(u.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return u},H.toAssignableList=function(u,x){for(var F=u.length,j=0;j<F;j++){var it=u[j];it&&this.toAssignable(it,x)}if(F){var mt=u[F-1];this.options.ecmaVersion===6&&x&&mt&&mt.type==="RestElement"&&mt.argument.type!=="Identifier"&&this.unexpected(mt.argument.start)}return u},H.parseSpread=function(u){var x=this.startNode();return this.next(),x.argument=this.parseMaybeAssign(!1,u),this.finishNode(x,"SpreadElement")},H.parseRestBinding=function(){var u=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==T.name&&this.unexpected(),u.argument=this.parseBindingAtom(),this.finishNode(u,"RestElement")},H.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case T.bracketL:var u=this.startNode();return this.next(),u.elements=this.parseBindingList(T.bracketR,!0,!0),this.finishNode(u,"ArrayPattern");case T.braceL:return this.parseObj(!0)}return this.parseIdent()},H.parseBindingList=function(u,x,F,j){for(var it=[],mt=!0;!this.eat(u);)if(mt?mt=!1:this.expect(T.comma),x&&this.type===T.comma)it.push(null);else{if(F&&this.afterTrailingComma(u))break;if(this.type===T.ellipsis){var xt=this.parseRestBinding();this.parseBindingListItem(xt),it.push(xt),this.type===T.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(u);break}else it.push(this.parseAssignableListItem(j))}return it},H.parseAssignableListItem=function(u){var x=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(x),x},H.parseBindingListItem=function(u){return u},H.parseMaybeDefault=function(u,x,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(T.eq))return F;var j=this.startNodeAt(u,x);return j.left=F,j.right=this.parseMaybeAssign(),this.finishNode(j,"AssignmentPattern")},H.checkLValSimple=function(u,x,F){x===void 0&&(x=es);var j=x!==es;switch(u.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(u.name)&&this.raiseRecoverable(u.start,(j?"Binding ":"Assigning to ")+u.name+" in strict mode"),j&&(x===Zi&&u.name==="let"&&this.raiseRecoverable(u.start,"let is disallowed as a lexically bound name"),F&&(_t(F,u.name)&&this.raiseRecoverable(u.start,"Argument name clash"),F[u.name]=!0),x!==be&&this.declareName(u.name,x,u.start));break;case"ChainExpression":this.raiseRecoverable(u.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":j&&this.raiseRecoverable(u.start,"Binding member expression");break;case"ParenthesizedExpression":return j&&this.raiseRecoverable(u.start,"Binding parenthesized expression"),this.checkLValSimple(u.expression,x,F);default:this.raise(u.start,(j?"Binding":"Assigning to")+" rvalue")}},H.checkLValPattern=function(u,x,F){switch(x===void 0&&(x=es),u.type){case"ObjectPattern":for(var j=0,it=u.properties;j<it.length;j+=1){var mt=it[j];this.checkLValInnerPattern(mt,x,F)}break;case"ArrayPattern":for(var xt=0,Dt=u.elements;xt<Dt.length;xt+=1){var Ht=Dt[xt];Ht&&this.checkLValInnerPattern(Ht,x,F)}break;default:this.checkLValSimple(u,x,F)}},H.checkLValInnerPattern=function(u,x,F){switch(x===void 0&&(x=es),u.type){case"Property":this.checkLValInnerPattern(u.value,x,F);break;case"AssignmentPattern":this.checkLValPattern(u.left,x,F);break;case"RestElement":this.checkLValPattern(u.argument,x,F);break;default:this.checkLValPattern(u,x,F)}};var N=function(x,F,j,it,mt){this.token=x,this.isExpr=!!F,this.preserveSpace=!!j,this.override=it,this.generator=!!mt},G={b_stat:new N("{",!1),b_expr:new N("{",!0),b_tmpl:new N("${",!1),p_stat:new N("(",!1),p_expr:new N("(",!0),q_tmpl:new N("`",!0,!0,function(u){return u.tryReadTemplateToken()}),f_stat:new N("function",!1),f_expr:new N("function",!0),f_expr_gen:new N("function",!0,!1,null,!0),f_gen:new N("function",!1,!1,null,!0)},L=a.prototype;L.initialContext=function(){return[G.b_stat]},L.curContext=function(){return this.context[this.context.length-1]},L.braceIsBlock=function(u){var x=this.curContext();return x===G.f_expr||x===G.f_stat?!0:u===T.colon&&(x===G.b_stat||x===G.b_expr)?!x.isExpr:u===T._return||u===T.name&&this.exprAllowed?at.test(this.input.slice(this.lastTokEnd,this.start)):u===T._else||u===T.semi||u===T.eof||u===T.parenR||u===T.arrow?!0:u===T.braceL?x===G.b_stat:u===T._var||u===T._const||u===T.name?!1:!this.exprAllowed},L.inGeneratorContext=function(){for(var u=this.context.length-1;u>=1;u--){var x=this.context[u];if(x.token==="function")return x.generator}return!1},L.updateContext=function(u){var x,F=this.type;F.keyword&&u===T.dot?this.exprAllowed=!1:(x=F.updateContext)?x.call(this,u):this.exprAllowed=F.beforeExpr},L.overrideContext=function(u){this.curContext()!==u&&(this.context[this.context.length-1]=u)},T.parenR.updateContext=T.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var u=this.context.pop();u===G.b_stat&&this.curContext().token==="function"&&(u=this.context.pop()),this.exprAllowed=!u.isExpr},T.braceL.updateContext=function(u){this.context.push(this.braceIsBlock(u)?G.b_stat:G.b_expr),this.exprAllowed=!0},T.dollarBraceL.updateContext=function(){this.context.push(G.b_tmpl),this.exprAllowed=!0},T.parenL.updateContext=function(u){var x=u===T._if||u===T._for||u===T._with||u===T._while;this.context.push(x?G.p_stat:G.p_expr),this.exprAllowed=!0},T.incDec.updateContext=function(){},T._function.updateContext=T._class.updateContext=function(u){u.beforeExpr&&u!==T._else&&!(u===T.semi&&this.curContext()!==G.p_stat)&&!(u===T._return&&at.test(this.input.slice(this.lastTokEnd,this.start)))&&!((u===T.colon||u===T.braceL)&&this.curContext()===G.b_stat)?this.context.push(G.f_expr):this.context.push(G.f_stat),this.exprAllowed=!1},T.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0},T.backQuote.updateContext=function(){this.curContext()===G.q_tmpl?this.context.pop():this.context.push(G.q_tmpl),this.exprAllowed=!1},T.star.updateContext=function(u){if(u===T._function){var x=this.context.length-1;this.context[x]===G.f_expr?this.context[x]=G.f_expr_gen:this.context[x]=G.f_gen}this.exprAllowed=!0},T.name.updateContext=function(u){var x=!1;this.options.ecmaVersion>=6&&u!==T.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(x=!0),this.exprAllowed=x};var O=a.prototype;O.checkPropClash=function(u,x,F){if(!(this.options.ecmaVersion>=9&&u.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(u.computed||u.method||u.shorthand))){var j=u.key,it;switch(j.type){case"Identifier":it=j.name;break;case"Literal":it=String(j.value);break;default:return}var mt=u.kind;if(this.options.ecmaVersion>=6){it==="__proto__"&&mt==="init"&&(x.proto&&(F?F.doubleProto<0&&(F.doubleProto=j.start):this.raiseRecoverable(j.start,"Redefinition of __proto__ property")),x.proto=!0);return}it="$"+it;var xt=x[it];if(xt){var Dt;mt==="init"?Dt=this.strict&&xt.init||xt.get||xt.set:Dt=xt.init||xt[mt],Dt&&this.raiseRecoverable(j.start,"Redefinition of property")}else xt=x[it]={init:!1,get:!1,set:!1};xt[mt]=!0}},O.parseExpression=function(u,x){var F=this.start,j=this.startLoc,it=this.parseMaybeAssign(u,x);if(this.type===T.comma){var mt=this.startNodeAt(F,j);for(mt.expressions=[it];this.eat(T.comma);)mt.expressions.push(this.parseMaybeAssign(u,x));return this.finishNode(mt,"SequenceExpression")}return it},O.parseMaybeAssign=function(u,x,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(u);this.exprAllowed=!1}var j=!1,it=-1,mt=-1,xt=-1;x?(it=x.parenthesizedAssign,mt=x.trailingComma,xt=x.doubleProto,x.parenthesizedAssign=x.trailingComma=-1):(x=new g,j=!0);var Dt=this.start,Ht=this.startLoc;(this.type===T.parenL||this.type===T.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=u==="await");var Ee=this.parseMaybeConditional(u,x);if(F&&(Ee=F.call(this,Ee,Dt,Ht)),this.type.isAssign){var Me=this.startNodeAt(Dt,Ht);return Me.operator=this.value,this.type===T.eq&&(Ee=this.toAssignable(Ee,!1,x)),j||(x.parenthesizedAssign=x.trailingComma=x.doubleProto=-1),x.shorthandAssign>=Ee.start&&(x.shorthandAssign=-1),this.type===T.eq?this.checkLValPattern(Ee):this.checkLValSimple(Ee),Me.left=Ee,this.next(),Me.right=this.parseMaybeAssign(u),xt>-1&&(x.doubleProto=xt),this.finishNode(Me,"AssignmentExpression")}else j&&this.checkExpressionErrors(x,!0);return it>-1&&(x.parenthesizedAssign=it),mt>-1&&(x.trailingComma=mt),Ee},O.parseMaybeConditional=function(u,x){var F=this.start,j=this.startLoc,it=this.parseExprOps(u,x);if(this.checkExpressionErrors(x))return it;if(this.eat(T.question)){var mt=this.startNodeAt(F,j);return mt.test=it,mt.consequent=this.parseMaybeAssign(),this.expect(T.colon),mt.alternate=this.parseMaybeAssign(u),this.finishNode(mt,"ConditionalExpression")}return it},O.parseExprOps=function(u,x){var F=this.start,j=this.startLoc,it=this.parseMaybeUnary(x,!1,!1,u);return this.checkExpressionErrors(x)||it.start===F&&it.type==="ArrowFunctionExpression"?it:this.parseExprOp(it,F,j,-1,u)},O.parseExprOp=function(u,x,F,j,it){var mt=this.type.binop;if(mt!=null&&(!it||this.type!==T._in)&&mt>j){var xt=this.type===T.logicalOR||this.type===T.logicalAND,Dt=this.type===T.coalesce;Dt&&(mt=T.logicalAND.binop);var Ht=this.value;this.next();var Ee=this.start,Me=this.startLoc,di=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,it),Ee,Me,mt,it),ss=this.buildBinary(x,F,u,di,Ht,xt||Dt);return(xt&&this.type===T.coalesce||Dt&&(this.type===T.logicalOR||this.type===T.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ss,x,F,j,it)}return u},O.buildBinary=function(u,x,F,j,it,mt){j.type==="PrivateIdentifier"&&this.raise(j.start,"Private identifier can only be left side of binary expression");var xt=this.startNodeAt(u,x);return xt.left=F,xt.operator=it,xt.right=j,this.finishNode(xt,mt?"LogicalExpression":"BinaryExpression")},O.parseMaybeUnary=function(u,x,F,j){var it=this.start,mt=this.startLoc,xt;if(this.isContextual("await")&&this.canAwait)xt=this.parseAwait(j),x=!0;else if(this.type.prefix){var Dt=this.startNode(),Ht=this.type===T.incDec;Dt.operator=this.value,Dt.prefix=!0,this.next(),Dt.argument=this.parseMaybeUnary(null,!0,Ht,j),this.checkExpressionErrors(u,!0),Ht?this.checkLValSimple(Dt.argument):this.strict&&Dt.operator==="delete"&&Dt.argument.type==="Identifier"?this.raiseRecoverable(Dt.start,"Deleting local variable in strict mode"):Dt.operator==="delete"&&A(Dt.argument)?this.raiseRecoverable(Dt.start,"Private fields can not be deleted"):x=!0,xt=this.finishNode(Dt,Ht?"UpdateExpression":"UnaryExpression")}else if(!x&&this.type===T.privateId)(j||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),xt=this.parsePrivateIdent(),this.type!==T._in&&this.unexpected();else{if(xt=this.parseExprSubscripts(u,j),this.checkExpressionErrors(u))return xt;for(;this.type.postfix&&!this.canInsertSemicolon();){var Ee=this.startNodeAt(it,mt);Ee.operator=this.value,Ee.prefix=!1,Ee.argument=xt,this.checkLValSimple(xt),this.next(),xt=this.finishNode(Ee,"UpdateExpression")}}if(!F&&this.eat(T.starstar))if(x)this.unexpected(this.lastTokStart);else return this.buildBinary(it,mt,xt,this.parseMaybeUnary(null,!1,!1,j),"**",!1);else return xt};function A(u){return u.type==="MemberExpression"&&u.property.type==="PrivateIdentifier"||u.type==="ChainExpression"&&A(u.expression)}O.parseExprSubscripts=function(u,x){var F=this.start,j=this.startLoc,it=this.parseExprAtom(u,x);if(it.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return it;var mt=this.parseSubscripts(it,F,j,!1,x);return u&&mt.type==="MemberExpression"&&(u.parenthesizedAssign>=mt.start&&(u.parenthesizedAssign=-1),u.parenthesizedBind>=mt.start&&(u.parenthesizedBind=-1),u.trailingComma>=mt.start&&(u.trailingComma=-1)),mt},O.parseSubscripts=function(u,x,F,j,it){for(var mt=this.options.ecmaVersion>=8&&u.type==="Identifier"&&u.name==="async"&&this.lastTokEnd===u.end&&!this.canInsertSemicolon()&&u.end-u.start===5&&this.potentialArrowAt===u.start,xt=!1;;){var Dt=this.parseSubscript(u,x,F,j,mt,xt,it);if(Dt.optional&&(xt=!0),Dt===u||Dt.type==="ArrowFunctionExpression"){if(xt){var Ht=this.startNodeAt(x,F);Ht.expression=Dt,Dt=this.finishNode(Ht,"ChainExpression")}return Dt}u=Dt}},O.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(T.arrow)},O.parseSubscriptAsyncArrow=function(u,x,F,j){return this.parseArrowExpression(this.startNodeAt(u,x),F,!0,j)},O.parseSubscript=function(u,x,F,j,it,mt,xt){var Dt=this.options.ecmaVersion>=11,Ht=Dt&&this.eat(T.questionDot);j&&Ht&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Ee=this.eat(T.bracketL);if(Ee||Ht&&this.type!==T.parenL&&this.type!==T.backQuote||this.eat(T.dot)){var Me=this.startNodeAt(x,F);Me.object=u,Ee?(Me.property=this.parseExpression(),this.expect(T.bracketR)):this.type===T.privateId&&u.type!=="Super"?Me.property=this.parsePrivateIdent():Me.property=this.parseIdent(this.options.allowReserved!=="never"),Me.computed=!!Ee,Dt&&(Me.optional=Ht),u=this.finishNode(Me,"MemberExpression")}else if(!j&&this.eat(T.parenL)){var di=new g,ss=this.yieldPos,an=this.awaitPos,Ss=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Gn=this.parseExprList(T.parenR,this.options.ecmaVersion>=8,!1,di);if(it&&!Ht&&this.shouldParseAsyncArrow())return this.checkPatternErrors(di,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=ss,this.awaitPos=an,this.awaitIdentPos=Ss,this.parseSubscriptAsyncArrow(x,F,Gn,xt);this.checkExpressionErrors(di,!0),this.yieldPos=ss||this.yieldPos,this.awaitPos=an||this.awaitPos,this.awaitIdentPos=Ss||this.awaitIdentPos;var Cs=this.startNodeAt(x,F);Cs.callee=u,Cs.arguments=Gn,Dt&&(Cs.optional=Ht),u=this.finishNode(Cs,"CallExpression")}else if(this.type===T.backQuote){(Ht||mt)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Es=this.startNodeAt(x,F);Es.tag=u,Es.quasi=this.parseTemplate({isTagged:!0}),u=this.finishNode(Es,"TaggedTemplateExpression")}return u},O.parseExprAtom=function(u,x,F){this.type===T.slash&&this.readRegexp();var j,it=this.potentialArrowAt===this.start;switch(this.type){case T._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),j=this.startNode(),this.next(),this.type===T.parenL&&!this.allowDirectSuper&&this.raise(j.start,"super() call outside constructor of a subclass"),this.type!==T.dot&&this.type!==T.bracketL&&this.type!==T.parenL&&this.unexpected(),this.finishNode(j,"Super");case T._this:return j=this.startNode(),this.next(),this.finishNode(j,"ThisExpression");case T.name:var mt=this.start,xt=this.startLoc,Dt=this.containsEsc,Ht=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Dt&&Ht.name==="async"&&!this.canInsertSemicolon()&&this.eat(T._function))return this.overrideContext(G.f_expr),this.parseFunction(this.startNodeAt(mt,xt),0,!1,!0,x);if(it&&!this.canInsertSemicolon()){if(this.eat(T.arrow))return this.parseArrowExpression(this.startNodeAt(mt,xt),[Ht],!1,x);if(this.options.ecmaVersion>=8&&Ht.name==="async"&&this.type===T.name&&!Dt&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return Ht=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(T.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(mt,xt),[Ht],!0,x)}return Ht;case T.regexp:var Ee=this.value;return j=this.parseLiteral(Ee.value),j.regex={pattern:Ee.pattern,flags:Ee.flags},j;case T.num:case T.string:return this.parseLiteral(this.value);case T._null:case T._true:case T._false:return j=this.startNode(),j.value=this.type===T._null?null:this.type===T._true,j.raw=this.type.keyword,this.next(),this.finishNode(j,"Literal");case T.parenL:var Me=this.start,di=this.parseParenAndDistinguishExpression(it,x);return u&&(u.parenthesizedAssign<0&&!this.isSimpleAssignTarget(di)&&(u.parenthesizedAssign=Me),u.parenthesizedBind<0&&(u.parenthesizedBind=Me)),di;case T.bracketL:return j=this.startNode(),this.next(),j.elements=this.parseExprList(T.bracketR,!0,!0,u),this.finishNode(j,"ArrayExpression");case T.braceL:return this.overrideContext(G.b_expr),this.parseObj(!1,u);case T._function:return j=this.startNode(),this.next(),this.parseFunction(j,0);case T._class:return this.parseClass(this.startNode(),!1);case T._new:return this.parseNew();case T.backQuote:return this.parseTemplate();case T._import:return this.options.ecmaVersion>=11?this.parseExprImport(F):this.unexpected();default:return this.parseExprAtomDefault()}},O.parseExprAtomDefault=function(){this.unexpected()},O.parseExprImport=function(u){var x=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===T.parenL&&!u)return this.parseDynamicImport(x);if(this.type===T.dot){var F=this.startNodeAt(x.start,x.loc&&x.loc.start);return F.name="import",x.meta=this.finishNode(F,"Identifier"),this.parseImportMeta(x)}else this.unexpected()},O.parseDynamicImport=function(u){if(this.next(),u.source=this.parseMaybeAssign(),!this.eat(T.parenR)){var x=this.start;this.eat(T.comma)&&this.eat(T.parenR)?this.raiseRecoverable(x,"Trailing comma is not allowed in import()"):this.unexpected(x)}return this.finishNode(u,"ImportExpression")},O.parseImportMeta=function(u){this.next();var x=this.containsEsc;return u.property=this.parseIdent(!0),u.property.name!=="meta"&&this.raiseRecoverable(u.property.start,"The only valid meta property for import is 'import.meta'"),x&&this.raiseRecoverable(u.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(u.start,"Cannot use 'import.meta' outside a module"),this.finishNode(u,"MetaProperty")},O.parseLiteral=function(u){var x=this.startNode();return x.value=u,x.raw=this.input.slice(this.start,this.end),x.raw.charCodeAt(x.raw.length-1)===110&&(x.bigint=x.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(x,"Literal")},O.parseParenExpression=function(){this.expect(T.parenL);var u=this.parseExpression();return this.expect(T.parenR),u},O.shouldParseArrow=function(u){return!this.canInsertSemicolon()},O.parseParenAndDistinguishExpression=function(u,x){var F=this.start,j=this.startLoc,it,mt=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var xt=this.start,Dt=this.startLoc,Ht=[],Ee=!0,Me=!1,di=new g,ss=this.yieldPos,an=this.awaitPos,Ss;for(this.yieldPos=0,this.awaitPos=0;this.type!==T.parenR;)if(Ee?Ee=!1:this.expect(T.comma),mt&&this.afterTrailingComma(T.parenR,!0)){Me=!0;break}else if(this.type===T.ellipsis){Ss=this.start,Ht.push(this.parseParenItem(this.parseRestBinding())),this.type===T.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else Ht.push(this.parseMaybeAssign(!1,di,this.parseParenItem));var Gn=this.lastTokEnd,Cs=this.lastTokEndLoc;if(this.expect(T.parenR),u&&this.shouldParseArrow(Ht)&&this.eat(T.arrow))return this.checkPatternErrors(di,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=ss,this.awaitPos=an,this.parseParenArrowList(F,j,Ht,x);(!Ht.length||Me)&&this.unexpected(this.lastTokStart),Ss&&this.unexpected(Ss),this.checkExpressionErrors(di,!0),this.yieldPos=ss||this.yieldPos,this.awaitPos=an||this.awaitPos,Ht.length>1?(it=this.startNodeAt(xt,Dt),it.expressions=Ht,this.finishNodeAt(it,"SequenceExpression",Gn,Cs)):it=Ht[0]}else it=this.parseParenExpression();if(this.options.preserveParens){var Es=this.startNodeAt(F,j);return Es.expression=it,this.finishNode(Es,"ParenthesizedExpression")}else return it},O.parseParenItem=function(u){return u},O.parseParenArrowList=function(u,x,F,j){return this.parseArrowExpression(this.startNodeAt(u,x),F,!1,j)};var U=[];O.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var u=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===T.dot){var x=this.startNodeAt(u.start,u.loc&&u.loc.start);x.name="new",u.meta=this.finishNode(x,"Identifier"),this.next();var F=this.containsEsc;return u.property=this.parseIdent(!0),u.property.name!=="target"&&this.raiseRecoverable(u.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(u.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(u.start,"'new.target' can only be used in functions and class static block"),this.finishNode(u,"MetaProperty")}var j=this.start,it=this.startLoc;return u.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),j,it,!0,!1),this.eat(T.parenL)?u.arguments=this.parseExprList(T.parenR,this.options.ecmaVersion>=8,!1):u.arguments=U,this.finishNode(u,"NewExpression")},O.parseTemplateElement=function(u){var x=u.isTagged,F=this.startNode();return this.type===T.invalidTemplate?(x||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===T.backQuote,this.finishNode(F,"TemplateElement")},O.parseTemplate=function(u){u===void 0&&(u={});var x=u.isTagged;x===void 0&&(x=!1);var F=this.startNode();this.next(),F.expressions=[];var j=this.parseTemplateElement({isTagged:x});for(F.quasis=[j];!j.tail;)this.type===T.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(T.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(T.braceR),F.quasis.push(j=this.parseTemplateElement({isTagged:x}));return this.next(),this.finishNode(F,"TemplateLiteral")},O.isAsyncProp=function(u){return!u.computed&&u.key.type==="Identifier"&&u.key.name==="async"&&(this.type===T.name||this.type===T.num||this.type===T.string||this.type===T.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===T.star)&&!at.test(this.input.slice(this.lastTokEnd,this.start))},O.parseObj=function(u,x){var F=this.startNode(),j=!0,it={};for(F.properties=[],this.next();!this.eat(T.braceR);){if(j)j=!1;else if(this.expect(T.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(T.braceR))break;var mt=this.parseProperty(u,x);u||this.checkPropClash(mt,it,x),F.properties.push(mt)}return this.finishNode(F,u?"ObjectPattern":"ObjectExpression")},O.parseProperty=function(u,x){var F=this.startNode(),j,it,mt,xt;if(this.options.ecmaVersion>=9&&this.eat(T.ellipsis))return u?(F.argument=this.parseIdent(!1),this.type===T.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(F.argument=this.parseMaybeAssign(!1,x),this.type===T.comma&&x&&x.trailingComma<0&&(x.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(u||x)&&(mt=this.start,xt=this.startLoc),u||(j=this.eat(T.star)));var Dt=this.containsEsc;return this.parsePropertyName(F),!u&&!Dt&&this.options.ecmaVersion>=8&&!j&&this.isAsyncProp(F)?(it=!0,j=this.options.ecmaVersion>=9&&this.eat(T.star),this.parsePropertyName(F)):it=!1,this.parsePropertyValue(F,u,j,it,mt,xt,x,Dt),this.finishNode(F,"Property")},O.parseGetterSetter=function(u){u.kind=u.key.name,this.parsePropertyName(u),u.value=this.parseMethod(!1);var x=u.kind==="get"?0:1;if(u.value.params.length!==x){var F=u.value.start;u.kind==="get"?this.raiseRecoverable(F,"getter should have no params"):this.raiseRecoverable(F,"setter should have exactly one param")}else u.kind==="set"&&u.value.params[0].type==="RestElement"&&this.raiseRecoverable(u.value.params[0].start,"Setter cannot use rest params")},O.parsePropertyValue=function(u,x,F,j,it,mt,xt,Dt){(F||j)&&this.type===T.colon&&this.unexpected(),this.eat(T.colon)?(u.value=x?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,xt),u.kind="init"):this.options.ecmaVersion>=6&&this.type===T.parenL?(x&&this.unexpected(),u.kind="init",u.method=!0,u.value=this.parseMethod(F,j)):!x&&!Dt&&this.options.ecmaVersion>=5&&!u.computed&&u.key.type==="Identifier"&&(u.key.name==="get"||u.key.name==="set")&&this.type!==T.comma&&this.type!==T.braceR&&this.type!==T.eq?((F||j)&&this.unexpected(),this.parseGetterSetter(u)):this.options.ecmaVersion>=6&&!u.computed&&u.key.type==="Identifier"?((F||j)&&this.unexpected(),this.checkUnreserved(u.key),u.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=it),u.kind="init",x?u.value=this.parseMaybeDefault(it,mt,this.copyNode(u.key)):this.type===T.eq&&xt?(xt.shorthandAssign<0&&(xt.shorthandAssign=this.start),u.value=this.parseMaybeDefault(it,mt,this.copyNode(u.key))):u.value=this.copyNode(u.key),u.shorthand=!0):this.unexpected()},O.parsePropertyName=function(u){if(this.options.ecmaVersion>=6){if(this.eat(T.bracketL))return u.computed=!0,u.key=this.parseMaybeAssign(),this.expect(T.bracketR),u.key;u.computed=!1}return u.key=this.type===T.num||this.type===T.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},O.initFunction=function(u){u.id=null,this.options.ecmaVersion>=6&&(u.generator=u.expression=!1),this.options.ecmaVersion>=8&&(u.async=!1)},O.parseMethod=function(u,x,F){var j=this.startNode(),it=this.yieldPos,mt=this.awaitPos,xt=this.awaitIdentPos;return this.initFunction(j),this.options.ecmaVersion>=6&&(j.generator=u),this.options.ecmaVersion>=8&&(j.async=!!x),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(vr(x,j.generator)|Ve|(F?ci:0)),this.expect(T.parenL),j.params=this.parseBindingList(T.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(j,!1,!0,!1),this.yieldPos=it,this.awaitPos=mt,this.awaitIdentPos=xt,this.finishNode(j,"FunctionExpression")},O.parseArrowExpression=function(u,x,F,j){var it=this.yieldPos,mt=this.awaitPos,xt=this.awaitIdentPos;return this.enterScope(vr(F,!1)|Ae),this.initFunction(u),this.options.ecmaVersion>=8&&(u.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,u.params=this.toAssignableList(x,!0),this.parseFunctionBody(u,!0,!1,j),this.yieldPos=it,this.awaitPos=mt,this.awaitIdentPos=xt,this.finishNode(u,"ArrowFunctionExpression")},O.parseFunctionBody=function(u,x,F,j){var it=x&&this.type!==T.braceL,mt=this.strict,xt=!1;if(it)u.body=this.parseMaybeAssign(j),u.expression=!0,this.checkParams(u,!1);else{var Dt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(u.params);(!mt||Dt)&&(xt=this.strictDirective(this.end),xt&&Dt&&this.raiseRecoverable(u.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Ht=this.labels;this.labels=[],xt&&(this.strict=!0),this.checkParams(u,!mt&&!xt&&!x&&!F&&this.isSimpleParamList(u.params)),this.strict&&u.id&&this.checkLValSimple(u.id,be),u.body=this.parseBlock(!1,void 0,xt&&!mt),u.expression=!1,this.adaptDirectivePrologue(u.body.body),this.labels=Ht}this.exitScope()},O.isSimpleParamList=function(u){for(var x=0,F=u;x<F.length;x+=1){var j=F[x];if(j.type!=="Identifier")return!1}return!0},O.checkParams=function(u,x){for(var F=Object.create(null),j=0,it=u.params;j<it.length;j+=1){var mt=it[j];this.checkLValInnerPattern(mt,qe,x?null:F)}},O.parseExprList=function(u,x,F,j){for(var it=[],mt=!0;!this.eat(u);){if(mt)mt=!1;else if(this.expect(T.comma),x&&this.afterTrailingComma(u))break;var xt=void 0;F&&this.type===T.comma?xt=null:this.type===T.ellipsis?(xt=this.parseSpread(j),j&&this.type===T.comma&&j.trailingComma<0&&(j.trailingComma=this.start)):xt=this.parseMaybeAssign(!1,j),it.push(xt)}return it},O.checkUnreserved=function(u){var x=u.start,F=u.end,j=u.name;if(this.inGenerator&&j==="yield"&&this.raiseRecoverable(x,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&j==="await"&&this.raiseRecoverable(x,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&j==="arguments"&&this.raiseRecoverable(x,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(j==="arguments"||j==="await")&&this.raise(x,"Cannot use "+j+" in class static initialization block"),this.keywords.test(j)&&this.raise(x,"Unexpected keyword '"+j+"'"),!(this.options.ecmaVersion<6&&this.input.slice(x,F).indexOf("\\")!==-1)){var it=this.strict?this.reservedWordsStrict:this.reservedWords;it.test(j)&&(!this.inAsync&&j==="await"&&this.raiseRecoverable(x,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(x,"The keyword '"+j+"' is reserved"))}},O.parseIdent=function(u){var x=this.parseIdentNode();return this.next(!!u),this.finishNode(x,"Identifier"),u||(this.checkUnreserved(x),x.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=x.start)),x},O.parseIdentNode=function(){var u=this.startNode();return this.type===T.name?u.name=this.value:this.type.keyword?(u.name=this.type.keyword,(u.name==="class"||u.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=T.name):this.unexpected(),u},O.parsePrivateIdent=function(){var u=this.startNode();return this.type===T.privateId?u.name=this.value:this.unexpected(),this.next(),this.finishNode(u,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(u.start,"Private field '#"+u.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(u)),u},O.parseYield=function(u){this.yieldPos||(this.yieldPos=this.start);var x=this.startNode();return this.next(),this.type===T.semi||this.canInsertSemicolon()||this.type!==T.star&&!this.type.startsExpr?(x.delegate=!1,x.argument=null):(x.delegate=this.eat(T.star),x.argument=this.parseMaybeAssign(u)),this.finishNode(x,"YieldExpression")},O.parseAwait=function(u){this.awaitPos||(this.awaitPos=this.start);var x=this.startNode();return this.next(),x.argument=this.parseMaybeUnary(null,!0,!1,u),this.finishNode(x,"AwaitExpression")};var X=a.prototype;X.raise=function(u,x){var F=re(this.input,u);x+=" ("+F.line+":"+F.column+")";var j=new SyntaxError(x);throw j.pos=u,j.loc=F,j.raisedAt=this.pos,j},X.raiseRecoverable=X.raise,X.curPosition=function(){if(this.options.locations)return new Vt(this.curLine,this.pos-this.lineStart)};var $=a.prototype,W=function(x){this.flags=x,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};$.enterScope=function(u){this.scopeStack.push(new W(u))},$.exitScope=function(){this.scopeStack.pop()},$.treatFunctionsAsVarInScope=function(u){return u.flags&ne||!this.inModule&&u.flags&se},$.declareName=function(u,x,F){var j=!1;if(x===Zi){var it=this.currentScope();j=it.lexical.indexOf(u)>-1||it.functions.indexOf(u)>-1||it.var.indexOf(u)>-1,it.lexical.push(u),this.inModule&&it.flags&se&&delete this.undefinedExports[u]}else if(x===ws){var mt=this.currentScope();mt.lexical.push(u)}else if(x===$e){var xt=this.currentScope();this.treatFunctionsAsVar?j=xt.lexical.indexOf(u)>-1:j=xt.lexical.indexOf(u)>-1||xt.var.indexOf(u)>-1,xt.functions.push(u)}else for(var Dt=this.scopeStack.length-1;Dt>=0;--Dt){var Ht=this.scopeStack[Dt];if(Ht.lexical.indexOf(u)>-1&&!(Ht.flags&Xe&&Ht.lexical[0]===u)||!this.treatFunctionsAsVarInScope(Ht)&&Ht.functions.indexOf(u)>-1){j=!0;break}if(Ht.var.push(u),this.inModule&&Ht.flags&se&&delete this.undefinedExports[u],Ht.flags&Ii)break}j&&this.raiseRecoverable(F,"Identifier '"+u+"' has already been declared")},$.checkLocalExport=function(u){this.scopeStack[0].lexical.indexOf(u.name)===-1&&this.scopeStack[0].var.indexOf(u.name)===-1&&(this.undefinedExports[u.name]=u)},$.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},$.currentVarScope=function(){for(var u=this.scopeStack.length-1;;u--){var x=this.scopeStack[u];if(x.flags&Ii)return x}},$.currentThisScope=function(){for(var u=this.scopeStack.length-1;;u--){var x=this.scopeStack[u];if(x.flags&Ii&&!(x.flags&Ae))return x}};var Q=function(x,F,j){this.type="",this.start=F,this.end=0,x.options.locations&&(this.loc=new le(x,j)),x.options.directSourceFile&&(this.sourceFile=x.options.directSourceFile),x.options.ranges&&(this.range=[F,0])},et=a.prototype;et.startNode=function(){return new Q(this,this.start,this.startLoc)},et.startNodeAt=function(u,x){return new Q(this,u,x)};function rt(u,x,F,j){return u.type=x,u.end=F,this.options.locations&&(u.loc.end=j),this.options.ranges&&(u.range[1]=F),u}et.finishNode=function(u,x){return rt.call(this,u,x,this.lastTokEnd,this.lastTokEndLoc)},et.finishNodeAt=function(u,x,F,j){return rt.call(this,u,x,F,j)},et.copyNode=function(u){var x=new Q(this,u.start,this.startLoc);for(var F in u)x[F]=u[F];return x};var ot="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",J=ot+" Extended_Pictographic",nt=J,lt=nt+" EBase EComp EMod EPres ExtPict",ft=lt,gt=ft,yt={9:ot,10:J,11:nt,12:lt,13:ft,14:gt},At="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",Bt={9:"",10:"",11:"",12:"",13:"",14:At},Ot="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Wt="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ct=Wt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Et=Ct+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Nt=Et+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",jt=Nt+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",$t=jt+" Hrkt Katakana_Or_Hiragana Kawi Nag_Mundari Nagm Unknown Zzzz",ue={9:Wt,10:Ct,11:Et,12:Nt,13:jt,14:$t},he={};function pe(u){var x=he[u]={binary:Gt(yt[u]+" "+Ot),binaryOfStrings:Gt(Bt[u]),nonBinary:{General_Category:Gt(Ot),Script:Gt(ue[u])}};x.nonBinary.Script_Extensions=x.nonBinary.Script,x.nonBinary.gc=x.nonBinary.General_Category,x.nonBinary.sc=x.nonBinary.Script,x.nonBinary.scx=x.nonBinary.Script_Extensions}for(var me=0,ce=[9,10,11,12,13,14];me<ce.length;me+=1){var _i=ce[me];pe(_i)}var zt=a.prototype,He=function(x){this.parser=x,this.validFlags="gim"+(x.options.ecmaVersion>=6?"uy":"")+(x.options.ecmaVersion>=9?"s":"")+(x.options.ecmaVersion>=13?"d":"")+(x.options.ecmaVersion>=15?"v":""),this.unicodeProperties=he[x.options.ecmaVersion>=14?14:x.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};He.prototype.reset=function(x,F,j){var it=j.indexOf("v")!==-1,mt=j.indexOf("u")!==-1;this.start=x|0,this.source=F+"",this.flags=j,it&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=mt&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=mt&&this.parser.options.ecmaVersion>=9)},He.prototype.raise=function(x){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+x)},He.prototype.at=function(x,F){F===void 0&&(F=!1);var j=this.source,it=j.length;if(x>=it)return-1;var mt=j.charCodeAt(x);if(!(F||this.switchU)||mt<=55295||mt>=57344||x+1>=it)return mt;var xt=j.charCodeAt(x+1);return xt>=56320&&xt<=57343?(mt<<10)+xt-56613888:mt},He.prototype.nextIndex=function(x,F){F===void 0&&(F=!1);var j=this.source,it=j.length;if(x>=it)return it;var mt=j.charCodeAt(x),xt;return!(F||this.switchU)||mt<=55295||mt>=57344||x+1>=it||(xt=j.charCodeAt(x+1))<56320||xt>57343?x+1:x+2},He.prototype.current=function(x){return x===void 0&&(x=!1),this.at(this.pos,x)},He.prototype.lookahead=function(x){return x===void 0&&(x=!1),this.at(this.nextIndex(this.pos,x),x)},He.prototype.advance=function(x){x===void 0&&(x=!1),this.pos=this.nextIndex(this.pos,x)},He.prototype.eat=function(x,F){return F===void 0&&(F=!1),this.current(F)===x?(this.advance(F),!0):!1},He.prototype.eatChars=function(x,F){F===void 0&&(F=!1);for(var j=this.pos,it=0,mt=x;it<mt.length;it+=1){var xt=mt[it],Dt=this.at(j,F);if(Dt===-1||Dt!==xt)return!1;j=this.nextIndex(j,F)}return this.pos=j,!0},zt.validateRegExpFlags=function(u){for(var x=u.validFlags,F=u.flags,j=!1,it=!1,mt=0;mt<F.length;mt++){var xt=F.charAt(mt);x.indexOf(xt)===-1&&this.raise(u.start,"Invalid regular expression flag"),F.indexOf(xt,mt+1)>-1&&this.raise(u.start,"Duplicate regular expression flag"),xt==="u"&&(j=!0),xt==="v"&&(it=!0)}this.options.ecmaVersion>=15&&j&&it&&this.raise(u.start,"Invalid regular expression flag")},zt.validateRegExpPattern=function(u){this.regexp_pattern(u),!u.switchN&&this.options.ecmaVersion>=9&&u.groupNames.length>0&&(u.switchN=!0,this.regexp_pattern(u))},zt.regexp_pattern=function(u){u.pos=0,u.lastIntValue=0,u.lastStringValue="",u.lastAssertionIsQuantifiable=!1,u.numCapturingParens=0,u.maxBackReference=0,u.groupNames.length=0,u.backReferenceNames.length=0,this.regexp_disjunction(u),u.pos!==u.source.length&&(u.eat(41)&&u.raise("Unmatched ')'"),(u.eat(93)||u.eat(125))&&u.raise("Lone quantifier brackets")),u.maxBackReference>u.numCapturingParens&&u.raise("Invalid escape");for(var x=0,F=u.backReferenceNames;x<F.length;x+=1){var j=F[x];u.groupNames.indexOf(j)===-1&&u.raise("Invalid named capture referenced")}},zt.regexp_disjunction=function(u){for(this.regexp_alternative(u);u.eat(124);)this.regexp_alternative(u);this.regexp_eatQuantifier(u,!0)&&u.raise("Nothing to repeat"),u.eat(123)&&u.raise("Lone quantifier brackets")},zt.regexp_alternative=function(u){for(;u.pos<u.source.length&&this.regexp_eatTerm(u););},zt.regexp_eatTerm=function(u){return this.regexp_eatAssertion(u)?(u.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(u)&&u.switchU&&u.raise("Invalid quantifier"),!0):(u.switchU?this.regexp_eatAtom(u):this.regexp_eatExtendedAtom(u))?(this.regexp_eatQuantifier(u),!0):!1},zt.regexp_eatAssertion=function(u){var x=u.pos;if(u.lastAssertionIsQuantifiable=!1,u.eat(94)||u.eat(36))return!0;if(u.eat(92)){if(u.eat(66)||u.eat(98))return!0;u.pos=x}if(u.eat(40)&&u.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=u.eat(60)),u.eat(61)||u.eat(33))return this.regexp_disjunction(u),u.eat(41)||u.raise("Unterminated group"),u.lastAssertionIsQuantifiable=!F,!0}return u.pos=x,!1},zt.regexp_eatQuantifier=function(u,x){return x===void 0&&(x=!1),this.regexp_eatQuantifierPrefix(u,x)?(u.eat(63),!0):!1},zt.regexp_eatQuantifierPrefix=function(u,x){return u.eat(42)||u.eat(43)||u.eat(63)||this.regexp_eatBracedQuantifier(u,x)},zt.regexp_eatBracedQuantifier=function(u,x){var F=u.pos;if(u.eat(123)){var j=0,it=-1;if(this.regexp_eatDecimalDigits(u)&&(j=u.lastIntValue,u.eat(44)&&this.regexp_eatDecimalDigits(u)&&(it=u.lastIntValue),u.eat(125)))return it!==-1&&it<j&&!x&&u.raise("numbers out of order in {} quantifier"),!0;u.switchU&&!x&&u.raise("Incomplete quantifier"),u.pos=F}return!1},zt.regexp_eatAtom=function(u){return this.regexp_eatPatternCharacters(u)||u.eat(46)||this.regexp_eatReverseSolidusAtomEscape(u)||this.regexp_eatCharacterClass(u)||this.regexp_eatUncapturingGroup(u)||this.regexp_eatCapturingGroup(u)},zt.regexp_eatReverseSolidusAtomEscape=function(u){var x=u.pos;if(u.eat(92)){if(this.regexp_eatAtomEscape(u))return!0;u.pos=x}return!1},zt.regexp_eatUncapturingGroup=function(u){var x=u.pos;if(u.eat(40)){if(u.eat(63)&&u.eat(58)){if(this.regexp_disjunction(u),u.eat(41))return!0;u.raise("Unterminated group")}u.pos=x}return!1},zt.regexp_eatCapturingGroup=function(u){if(u.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(u):u.current()===63&&u.raise("Invalid group"),this.regexp_disjunction(u),u.eat(41))return u.numCapturingParens+=1,!0;u.raise("Unterminated group")}return!1},zt.regexp_eatExtendedAtom=function(u){return u.eat(46)||this.regexp_eatReverseSolidusAtomEscape(u)||this.regexp_eatCharacterClass(u)||this.regexp_eatUncapturingGroup(u)||this.regexp_eatCapturingGroup(u)||this.regexp_eatInvalidBracedQuantifier(u)||this.regexp_eatExtendedPatternCharacter(u)},zt.regexp_eatInvalidBracedQuantifier=function(u){return this.regexp_eatBracedQuantifier(u,!0)&&u.raise("Nothing to repeat"),!1},zt.regexp_eatSyntaxCharacter=function(u){var x=u.current();return ti(x)?(u.lastIntValue=x,u.advance(),!0):!1};function ti(u){return u===36||u>=40&&u<=43||u===46||u===63||u>=91&&u<=94||u>=123&&u<=125}zt.regexp_eatPatternCharacters=function(u){for(var x=u.pos,F=0;(F=u.current())!==-1&&!ti(F);)u.advance();return u.pos!==x},zt.regexp_eatExtendedPatternCharacter=function(u){var x=u.current();return x!==-1&&x!==36&&!(x>=40&&x<=43)&&x!==46&&x!==63&&x!==91&&x!==94&&x!==124?(u.advance(),!0):!1},zt.regexp_groupSpecifier=function(u){if(u.eat(63)){if(this.regexp_eatGroupName(u)){u.groupNames.indexOf(u.lastStringValue)!==-1&&u.raise("Duplicate capture group name"),u.groupNames.push(u.lastStringValue);return}u.raise("Invalid group")}},zt.regexp_eatGroupName=function(u){if(u.lastStringValue="",u.eat(60)){if(this.regexp_eatRegExpIdentifierName(u)&&u.eat(62))return!0;u.raise("Invalid capture group name")}return!1},zt.regexp_eatRegExpIdentifierName=function(u){if(u.lastStringValue="",this.regexp_eatRegExpIdentifierStart(u)){for(u.lastStringValue+=vt(u.lastIntValue);this.regexp_eatRegExpIdentifierPart(u);)u.lastStringValue+=vt(u.lastIntValue);return!0}return!1},zt.regexp_eatRegExpIdentifierStart=function(u){var x=u.pos,F=this.options.ecmaVersion>=11,j=u.current(F);return u.advance(F),j===92&&this.regexp_eatRegExpUnicodeEscapeSequence(u,F)&&(j=u.lastIntValue),ze(j)?(u.lastIntValue=j,!0):(u.pos=x,!1)};function ze(u){return P(u,!0)||u===36||u===95}zt.regexp_eatRegExpIdentifierPart=function(u){var x=u.pos,F=this.options.ecmaVersion>=11,j=u.current(F);return u.advance(F),j===92&&this.regexp_eatRegExpUnicodeEscapeSequence(u,F)&&(j=u.lastIntValue),si(j)?(u.lastIntValue=j,!0):(u.pos=x,!1)};function si(u){return M(u,!0)||u===36||u===95||u===8204||u===8205}zt.regexp_eatAtomEscape=function(u){return this.regexp_eatBackReference(u)||this.regexp_eatCharacterClassEscape(u)||this.regexp_eatCharacterEscape(u)||u.switchN&&this.regexp_eatKGroupName(u)?!0:(u.switchU&&(u.current()===99&&u.raise("Invalid unicode escape"),u.raise("Invalid escape")),!1)},zt.regexp_eatBackReference=function(u){var x=u.pos;if(this.regexp_eatDecimalEscape(u)){var F=u.lastIntValue;if(u.switchU)return F>u.maxBackReference&&(u.maxBackReference=F),!0;if(F<=u.numCapturingParens)return!0;u.pos=x}return!1},zt.regexp_eatKGroupName=function(u){if(u.eat(107)){if(this.regexp_eatGroupName(u))return u.backReferenceNames.push(u.lastStringValue),!0;u.raise("Invalid named reference")}return!1},zt.regexp_eatCharacterEscape=function(u){return this.regexp_eatControlEscape(u)||this.regexp_eatCControlLetter(u)||this.regexp_eatZero(u)||this.regexp_eatHexEscapeSequence(u)||this.regexp_eatRegExpUnicodeEscapeSequence(u,!1)||!u.switchU&&this.regexp_eatLegacyOctalEscapeSequence(u)||this.regexp_eatIdentityEscape(u)},zt.regexp_eatCControlLetter=function(u){var x=u.pos;if(u.eat(99)){if(this.regexp_eatControlLetter(u))return!0;u.pos=x}return!1},zt.regexp_eatZero=function(u){return u.current()===48&&!en(u.lookahead())?(u.lastIntValue=0,u.advance(),!0):!1},zt.regexp_eatControlEscape=function(u){var x=u.current();return x===116?(u.lastIntValue=9,u.advance(),!0):x===110?(u.lastIntValue=10,u.advance(),!0):x===118?(u.lastIntValue=11,u.advance(),!0):x===102?(u.lastIntValue=12,u.advance(),!0):x===114?(u.lastIntValue=13,u.advance(),!0):!1},zt.regexp_eatControlLetter=function(u){var x=u.current();return zi(x)?(u.lastIntValue=x%32,u.advance(),!0):!1};function zi(u){return u>=65&&u<=90||u>=97&&u<=122}zt.regexp_eatRegExpUnicodeEscapeSequence=function(u,x){x===void 0&&(x=!1);var F=u.pos,j=x||u.switchU;if(u.eat(117)){if(this.regexp_eatFixedHexDigits(u,4)){var it=u.lastIntValue;if(j&&it>=55296&&it<=56319){var mt=u.pos;if(u.eat(92)&&u.eat(117)&&this.regexp_eatFixedHexDigits(u,4)){var xt=u.lastIntValue;if(xt>=56320&&xt<=57343)return u.lastIntValue=(it-55296)*1024+(xt-56320)+65536,!0}u.pos=mt,u.lastIntValue=it}return!0}if(j&&u.eat(123)&&this.regexp_eatHexDigits(u)&&u.eat(125)&&vi(u.lastIntValue))return!0;j&&u.raise("Invalid unicode escape"),u.pos=F}return!1};function vi(u){return u>=0&&u<=1114111}zt.regexp_eatIdentityEscape=function(u){if(u.switchU)return this.regexp_eatSyntaxCharacter(u)?!0:u.eat(47)?(u.lastIntValue=47,!0):!1;var x=u.current();return x!==99&&(!u.switchN||x!==107)?(u.lastIntValue=x,u.advance(),!0):!1},zt.regexp_eatDecimalEscape=function(u){u.lastIntValue=0;var x=u.current();if(x>=49&&x<=57){do u.lastIntValue=10*u.lastIntValue+(x-48),u.advance();while((x=u.current())>=48&&x<=57);return!0}return!1};var Ki=0,Bi=1,ei=2;zt.regexp_eatCharacterClassEscape=function(u){var x=u.current();if(or(x))return u.lastIntValue=-1,u.advance(),Bi;var F=!1;if(u.switchU&&this.options.ecmaVersion>=9&&((F=x===80)||x===112)){u.lastIntValue=-1,u.advance();var j;if(u.eat(123)&&(j=this.regexp_eatUnicodePropertyValueExpression(u))&&u.eat(125))return F&&j===ei&&u.raise("Invalid property name"),j;u.raise("Invalid property name")}return Ki};function or(u){return u===100||u===68||u===115||u===83||u===119||u===87}zt.regexp_eatUnicodePropertyValueExpression=function(u){var x=u.pos;if(this.regexp_eatUnicodePropertyName(u)&&u.eat(61)){var F=u.lastStringValue;if(this.regexp_eatUnicodePropertyValue(u)){var j=u.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(u,F,j),Bi}}if(u.pos=x,this.regexp_eatLoneUnicodePropertyNameOrValue(u)){var it=u.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(u,it)}return Ki},zt.regexp_validateUnicodePropertyNameAndValue=function(u,x,F){_t(u.unicodeProperties.nonBinary,x)||u.raise("Invalid property name"),u.unicodeProperties.nonBinary[x].test(F)||u.raise("Invalid property value")},zt.regexp_validateUnicodePropertyNameOrValue=function(u,x){if(u.unicodeProperties.binary.test(x))return Bi;if(u.switchV&&u.unicodeProperties.binaryOfStrings.test(x))return ei;u.raise("Invalid property name")},zt.regexp_eatUnicodePropertyName=function(u){var x=0;for(u.lastStringValue="";Gi(x=u.current());)u.lastStringValue+=vt(x),u.advance();return u.lastStringValue!==""};function Gi(u){return zi(u)||u===95}zt.regexp_eatUnicodePropertyValue=function(u){var x=0;for(u.lastStringValue="";Qi(x=u.current());)u.lastStringValue+=vt(x),u.advance();return u.lastStringValue!==""};function Qi(u){return Gi(u)||en(u)}zt.regexp_eatLoneUnicodePropertyNameOrValue=function(u){return this.regexp_eatUnicodePropertyValue(u)},zt.regexp_eatCharacterClass=function(u){if(u.eat(91)){var x=u.eat(94),F=this.regexp_classContents(u);return u.eat(93)||u.raise("Unterminated character class"),x&&F===ei&&u.raise("Negated character class may contain strings"),!0}return!1},zt.regexp_classContents=function(u){return u.current()===93?Bi:u.switchV?this.regexp_classSetExpression(u):(this.regexp_nonEmptyClassRanges(u),Bi)},zt.regexp_nonEmptyClassRanges=function(u){for(;this.regexp_eatClassAtom(u);){var x=u.lastIntValue;if(u.eat(45)&&this.regexp_eatClassAtom(u)){var F=u.lastIntValue;u.switchU&&(x===-1||F===-1)&&u.raise("Invalid character class"),x!==-1&&F!==-1&&x>F&&u.raise("Range out of order in character class")}}},zt.regexp_eatClassAtom=function(u){var x=u.pos;if(u.eat(92)){if(this.regexp_eatClassEscape(u))return!0;if(u.switchU){var F=u.current();(F===99||Ba(F))&&u.raise("Invalid class escape"),u.raise("Invalid escape")}u.pos=x}var j=u.current();return j!==93?(u.lastIntValue=j,u.advance(),!0):!1},zt.regexp_eatClassEscape=function(u){var x=u.pos;if(u.eat(98))return u.lastIntValue=8,!0;if(u.switchU&&u.eat(45))return u.lastIntValue=45,!0;if(!u.switchU&&u.eat(99)){if(this.regexp_eatClassControlLetter(u))return!0;u.pos=x}return this.regexp_eatCharacterClassEscape(u)||this.regexp_eatCharacterEscape(u)},zt.regexp_classSetExpression=function(u){var x=Bi,F;if(!this.regexp_eatClassSetRange(u))if(F=this.regexp_eatClassSetOperand(u)){F===ei&&(x=ei);for(var j=u.pos;u.eatChars([38,38]);){if(u.current()!==38&&(F=this.regexp_eatClassSetOperand(u))){F!==ei&&(x=Bi);continue}u.raise("Invalid character in character class")}if(j!==u.pos)return x;for(;u.eatChars([45,45]);)this.regexp_eatClassSetOperand(u)||u.raise("Invalid character in character class");if(j!==u.pos)return x}else u.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(u)){if(F=this.regexp_eatClassSetOperand(u),!F)return x;F===ei&&(x=ei)}},zt.regexp_eatClassSetRange=function(u){var x=u.pos;if(this.regexp_eatClassSetCharacter(u)){var F=u.lastIntValue;if(u.eat(45)&&this.regexp_eatClassSetCharacter(u)){var j=u.lastIntValue;return F!==-1&&j!==-1&&F>j&&u.raise("Range out of order in character class"),!0}u.pos=x}return!1},zt.regexp_eatClassSetOperand=function(u){return this.regexp_eatClassSetCharacter(u)?Bi:this.regexp_eatClassStringDisjunction(u)||this.regexp_eatNestedClass(u)},zt.regexp_eatNestedClass=function(u){var x=u.pos;if(u.eat(91)){var F=u.eat(94),j=this.regexp_classContents(u);if(u.eat(93))return F&&j===ei&&u.raise("Negated character class may contain strings"),j;u.pos=x}if(u.eat(92)){var it=this.regexp_eatCharacterClassEscape(u);if(it)return it;u.pos=x}return null},zt.regexp_eatClassStringDisjunction=function(u){var x=u.pos;if(u.eatChars([92,113])){if(u.eat(123)){var F=this.regexp_classStringDisjunctionContents(u);if(u.eat(125))return F}else u.raise("Invalid escape");u.pos=x}return null},zt.regexp_classStringDisjunctionContents=function(u){for(var x=this.regexp_classString(u);u.eat(124);)this.regexp_classString(u)===ei&&(x=ei);return x},zt.regexp_classString=function(u){for(var x=0;this.regexp_eatClassSetCharacter(u);)x++;return x===1?Bi:ei},zt.regexp_eatClassSetCharacter=function(u){var x=u.pos;if(u.eat(92))return this.regexp_eatCharacterEscape(u)||this.regexp_eatClassSetReservedPunctuator(u)?!0:u.eat(98)?(u.lastIntValue=8,!0):(u.pos=x,!1);var F=u.current();return F<0||F===u.lookahead()&&Fr(F)||lr(F)?!1:(u.advance(),u.lastIntValue=F,!0)};function Fr(u){return u===33||u>=35&&u<=38||u>=42&&u<=44||u===46||u>=58&&u<=64||u===94||u===96||u===126}function lr(u){return u===40||u===41||u===45||u===47||u>=91&&u<=93||u>=123&&u<=125}zt.regexp_eatClassSetReservedPunctuator=function(u){var x=u.current();return zn(x)?(u.lastIntValue=x,u.advance(),!0):!1};function zn(u){return u===33||u===35||u===37||u===38||u===44||u===45||u>=58&&u<=62||u===64||u===96||u===126}zt.regexp_eatClassControlLetter=function(u){var x=u.current();return en(x)||x===95?(u.lastIntValue=x%32,u.advance(),!0):!1},zt.regexp_eatHexEscapeSequence=function(u){var x=u.pos;if(u.eat(120)){if(this.regexp_eatFixedHexDigits(u,2))return!0;u.switchU&&u.raise("Invalid escape"),u.pos=x}return!1},zt.regexp_eatDecimalDigits=function(u){var x=u.pos,F=0;for(u.lastIntValue=0;en(F=u.current());)u.lastIntValue=10*u.lastIntValue+(F-48),u.advance();return u.pos!==x};function en(u){return u>=48&&u<=57}zt.regexp_eatHexDigits=function(u){var x=u.pos,F=0;for(u.lastIntValue=0;ka(F=u.current());)u.lastIntValue=16*u.lastIntValue+Ra(F),u.advance();return u.pos!==x};function ka(u){return u>=48&&u<=57||u>=65&&u<=70||u>=97&&u<=102}function Ra(u){return u>=65&&u<=70?10+(u-65):u>=97&&u<=102?10+(u-97):u-48}zt.regexp_eatLegacyOctalEscapeSequence=function(u){if(this.regexp_eatOctalDigit(u)){var x=u.lastIntValue;if(this.regexp_eatOctalDigit(u)){var F=u.lastIntValue;x<=3&&this.regexp_eatOctalDigit(u)?u.lastIntValue=x*64+F*8+u.lastIntValue:u.lastIntValue=x*8+F}else u.lastIntValue=x;return!0}return!1},zt.regexp_eatOctalDigit=function(u){var x=u.current();return Ba(x)?(u.lastIntValue=x-48,u.advance(),!0):(u.lastIntValue=0,!1)};function Ba(u){return u>=48&&u<=55}zt.regexp_eatFixedHexDigits=function(u,x){var F=u.pos;u.lastIntValue=0;for(var j=0;j<x;++j){var it=u.current();if(!ka(it))return u.pos=F,!1;u.lastIntValue=16*u.lastIntValue+Ra(it),u.advance()}return!0};var rn=function(x){this.type=x.type,this.value=x.value,this.start=x.start,this.end=x.end,x.options.locations&&(this.loc=new le(x,x.startLoc,x.endLoc)),x.options.ranges&&(this.range=[x.start,x.end])},Te=a.prototype;Te.next=function(u){!u&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new rn(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Te.getToken=function(){return this.next(),new rn(this)},typeof Symbol<"u"&&(Te[Symbol.iterator]=function(){var u=this;return{next:function(){var x=u.getToken();return{done:x.type===T.eof,value:x}}}}),Te.nextToken=function(){var u=this.curContext();if((!u||!u.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(T.eof);if(u.override)return u.override(this);this.readToken(this.fullCharCodeAtPos())},Te.readToken=function(u){return P(u,this.options.ecmaVersion>=6)||u===92?this.readWord():this.getTokenFromCode(u)},Te.fullCharCodeAtPos=function(){var u=this.input.charCodeAt(this.pos);if(u<=55295||u>=56320)return u;var x=this.input.charCodeAt(this.pos+1);return x<=56319||x>=57344?u:(u<<10)+x-56613888},Te.skipBlockComment=function(){var u=this.options.onComment&&this.curPosition(),x=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations)for(var j=void 0,it=x;(j=wt(this.input,it,this.pos))>-1;)++this.curLine,it=this.lineStart=j;this.options.onComment&&this.options.onComment(!0,this.input.slice(x+2,F),x,this.pos,u,this.curPosition())},Te.skipLineComment=function(u){for(var x=this.pos,F=this.options.onComment&&this.curPosition(),j=this.input.charCodeAt(this.pos+=u);this.pos<this.input.length&&!pt(j);)j=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(x+u,this.pos),x,this.pos,F,this.curPosition())},Te.skipSpace=function(){t:for(;this.pos<this.input.length;){var u=this.input.charCodeAt(this.pos);switch(u){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(u>8&&u<14||u>=5760&&It.test(String.fromCharCode(u)))++this.pos;else break t}}},Te.finishToken=function(u,x){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=u,this.value=x,this.updateContext(F)},Te.readToken_dot=function(){var u=this.input.charCodeAt(this.pos+1);if(u>=48&&u<=57)return this.readNumber(!0);var x=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&u===46&&x===46?(this.pos+=3,this.finishToken(T.ellipsis)):(++this.pos,this.finishToken(T.dot))},Te.readToken_slash=function(){var u=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):u===61?this.finishOp(T.assign,2):this.finishOp(T.slash,1)},Te.readToken_mult_modulo_exp=function(u){var x=this.input.charCodeAt(this.pos+1),F=1,j=u===42?T.star:T.modulo;return this.options.ecmaVersion>=7&&u===42&&x===42&&(++F,j=T.starstar,x=this.input.charCodeAt(this.pos+2)),x===61?this.finishOp(T.assign,F+1):this.finishOp(j,F)},Te.readToken_pipe_amp=function(u){var x=this.input.charCodeAt(this.pos+1);if(x===u){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(T.assign,3)}return this.finishOp(u===124?T.logicalOR:T.logicalAND,2)}return x===61?this.finishOp(T.assign,2):this.finishOp(u===124?T.bitwiseOR:T.bitwiseAND,1)},Te.readToken_caret=function(){var u=this.input.charCodeAt(this.pos+1);return u===61?this.finishOp(T.assign,2):this.finishOp(T.bitwiseXOR,1)},Te.readToken_plus_min=function(u){var x=this.input.charCodeAt(this.pos+1);return x===u?x===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||at.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(T.incDec,2):x===61?this.finishOp(T.assign,2):this.finishOp(T.plusMin,1)},Te.readToken_lt_gt=function(u){var x=this.input.charCodeAt(this.pos+1),F=1;return x===u?(F=u===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(T.assign,F+1):this.finishOp(T.bitShift,F)):x===33&&u===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(x===61&&(F=2),this.finishOp(T.relational,F))},Te.readToken_eq_excl=function(u){var x=this.input.charCodeAt(this.pos+1);return x===61?this.finishOp(T.equality,this.input.charCodeAt(this.pos+2)===61?3:2):u===61&&x===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(T.arrow)):this.finishOp(u===61?T.eq:T.prefix,1)},Te.readToken_question=function(){var u=this.options.ecmaVersion;if(u>=11){var x=this.input.charCodeAt(this.pos+1);if(x===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(T.questionDot,2)}if(x===63){if(u>=12){var j=this.input.charCodeAt(this.pos+2);if(j===61)return this.finishOp(T.assign,3)}return this.finishOp(T.coalesce,2)}}return this.finishOp(T.question,1)},Te.readToken_numberSign=function(){var u=this.options.ecmaVersion,x=35;if(u>=13&&(++this.pos,x=this.fullCharCodeAtPos(),P(x,!0)||x===92))return this.finishToken(T.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+vt(x)+"'")},Te.getTokenFromCode=function(u){switch(u){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(T.parenL);case 41:return++this.pos,this.finishToken(T.parenR);case 59:return++this.pos,this.finishToken(T.semi);case 44:return++this.pos,this.finishToken(T.comma);case 91:return++this.pos,this.finishToken(T.bracketL);case 93:return++this.pos,this.finishToken(T.bracketR);case 123:return++this.pos,this.finishToken(T.braceL);case 125:return++this.pos,this.finishToken(T.braceR);case 58:return++this.pos,this.finishToken(T.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(T.backQuote);case 48:var x=this.input.charCodeAt(this.pos+1);if(x===120||x===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(x===111||x===79)return this.readRadixNumber(8);if(x===98||x===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(u);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(u);case 124:case 38:return this.readToken_pipe_amp(u);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(u);case 60:case 62:return this.readToken_lt_gt(u);case 61:case 33:return this.readToken_eq_excl(u);case 63:return this.readToken_question();case 126:return this.finishOp(T.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+vt(u)+"'")},Te.finishOp=function(u,x){var F=this.input.slice(this.pos,this.pos+x);return this.pos+=x,this.finishToken(u,F)},Te.readRegexp=function(){for(var u,x,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var j=this.input.charAt(this.pos);if(at.test(j)&&this.raise(F,"Unterminated regular expression"),u)u=!1;else{if(j==="[")x=!0;else if(j==="]"&&x)x=!1;else if(j==="/"&&!x)break;u=j==="\\"}++this.pos}var it=this.input.slice(F,this.pos);++this.pos;var mt=this.pos,xt=this.readWord1();this.containsEsc&&this.unexpected(mt);var Dt=this.regexpState||(this.regexpState=new He(this));Dt.reset(F,it,xt),this.validateRegExpFlags(Dt),this.validateRegExpPattern(Dt);var Ht=null;try{Ht=new RegExp(it,xt)}catch{}return this.finishToken(T.regexp,{pattern:it,flags:xt,value:Ht})},Te.readInt=function(u,x,F){for(var j=this.options.ecmaVersion>=12&&x===void 0,it=F&&this.input.charCodeAt(this.pos)===48,mt=this.pos,xt=0,Dt=0,Ht=0,Ee=x??1/0;Ht<Ee;++Ht,++this.pos){var Me=this.input.charCodeAt(this.pos),di=void 0;if(j&&Me===95){it&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Dt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Ht===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Dt=Me;continue}if(Me>=97?di=Me-97+10:Me>=65?di=Me-65+10:Me>=48&&Me<=57?di=Me-48:di=1/0,di>=u)break;Dt=Me,xt=xt*u+di}return j&&Dt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===mt||x!=null&&this.pos-mt!==x?null:xt};function La(u,x){return x?parseInt(u,8):parseFloat(u.replace(/_/g,""))}function sn(u){return typeof BigInt!="function"?null:BigInt(u.replace(/_/g,""))}Te.readRadixNumber=function(u){var x=this.pos;this.pos+=2;var F=this.readInt(u);return F==null&&this.raise(this.start+2,"Expected number in radix "+u),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=sn(this.input.slice(x,this.pos)),++this.pos):P(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(T.num,F)},Te.readNumber=function(u){var x=this.pos;!u&&this.readInt(10,void 0,!0)===null&&this.raise(x,"Invalid number");var F=this.pos-x>=2&&this.input.charCodeAt(x)===48;F&&this.strict&&this.raise(x,"Invalid number");var j=this.input.charCodeAt(this.pos);if(!F&&!u&&this.options.ecmaVersion>=11&&j===110){var it=sn(this.input.slice(x,this.pos));return++this.pos,P(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(T.num,it)}F&&/[89]/.test(this.input.slice(x,this.pos))&&(F=!1),j===46&&!F&&(++this.pos,this.readInt(10),j=this.input.charCodeAt(this.pos)),(j===69||j===101)&&!F&&(j=this.input.charCodeAt(++this.pos),(j===43||j===45)&&++this.pos,this.readInt(10)===null&&this.raise(x,"Invalid number")),P(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var mt=La(this.input.slice(x,this.pos),F);return this.finishToken(T.num,mt)},Te.readCodePoint=function(){var u=this.input.charCodeAt(this.pos),x;if(u===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;x=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,x>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else x=this.readHexChar(4);return x},Te.readString=function(u){for(var x="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var j=this.input.charCodeAt(this.pos);if(j===u)break;j===92?(x+=this.input.slice(F,this.pos),x+=this.readEscapedChar(!1),F=this.pos):j===8232||j===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(pt(j)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return x+=this.input.slice(F,this.pos++),this.finishToken(T.string,x)};var nn={};Te.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(u){if(u===nn)this.readInvalidTemplateToken();else throw u}this.inTemplateElement=!1},Te.invalidStringToken=function(u,x){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw nn;this.raise(u,x)},Te.readTmplToken=function(){for(var u="",x=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===T.template||this.type===T.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(T.dollarBraceL)):(++this.pos,this.finishToken(T.backQuote)):(u+=this.input.slice(x,this.pos),this.finishToken(T.template,u));if(F===92)u+=this.input.slice(x,this.pos),u+=this.readEscapedChar(!0),x=this.pos;else if(pt(F)){switch(u+=this.input.slice(x,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:u+=`
`;break;default:u+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),x=this.pos}else++this.pos}},Te.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(T.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Te.readEscapedChar=function(u){var x=this.input.charCodeAt(++this.pos);switch(++this.pos,x){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return vt(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),u){var F=this.pos-1;this.invalidStringToken(F,"Invalid escape sequence in template string")}default:if(x>=48&&x<=55){var j=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],it=parseInt(j,8);return it>255&&(j=j.slice(0,-1),it=parseInt(j,8)),this.pos+=j.length-1,x=this.input.charCodeAt(this.pos),(j!=="0"||x===56||x===57)&&(this.strict||u)&&this.invalidStringToken(this.pos-1-j.length,u?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(it)}return pt(x)?"":String.fromCharCode(x)}},Te.readHexChar=function(u){var x=this.pos,F=this.readInt(16,u);return F===null&&this.invalidStringToken(x,"Bad character escape sequence"),F},Te.readWord1=function(){this.containsEsc=!1;for(var u="",x=!0,F=this.pos,j=this.options.ecmaVersion>=6;this.pos<this.input.length;){var it=this.fullCharCodeAtPos();if(M(it,j))this.pos+=it<=65535?1:2;else if(it===92){this.containsEsc=!0,u+=this.input.slice(F,this.pos);var mt=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var xt=this.readCodePoint();(x?P:M)(xt,j)||this.invalidStringToken(mt,"Invalid Unicode escape"),u+=vt(xt),F=this.pos}else break;x=!1}return u+this.input.slice(F,this.pos)},Te.readWord=function(){var u=this.readWord1(),x=T.name;return this.keywords.test(u)&&(x=Y[u]),this.finishToken(x,u)};var is="8.11.3";a.acorn={Parser:a,version:is,defaultOptions:ee,Position:Vt,SourceLocation:le,getLineInfo:re,Node:Q,TokenType:z,tokTypes:T,keywordTypes:Y,TokContext:N,tokContexts:G,isIdentifierChar:M,isIdentifierStart:P,Token:rn,isNewLine:pt,lineBreak:at,lineBreakG:ct,nonASCIIwhitespace:It};function rs(u,x){return a.parse(u,x)}function pr(u,x,F){return a.parseExpressionAt(u,x,F)}function hr(u,x){return a.tokenizer(u,x)}e.Node=Q,e.Parser=a,e.Position=Vt,e.SourceLocation=le,e.TokContext=N,e.Token=rn,e.TokenType=z,e.defaultOptions=ee,e.getLineInfo=re,e.isIdentifierChar=M,e.isIdentifierStart=P,e.isNewLine=pt,e.keywordTypes=Y,e.lineBreak=at,e.lineBreakG=ct,e.nonASCIIwhitespace=It,e.parse=rs,e.parseExpressionAt=pr,e.tokContexts=G,e.tokTypes=T,e.tokenizer=hr,e.version=is})}(ul,ul.exports)),ul.exports}/*!
 * Paper.js v0.12.18 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jrg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Wed Jul 17 14:57:24 2024 +0200
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jrg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */(function(r){(function(t,e){t=t||Ju;var i=t.window,s=t.document,n=new function(){var a=/^(statics|enumerable|beans|preserve)$/,l=[],c=l.slice,f=Object.create,g=Object.getOwnPropertyDescriptor,_=Object.defineProperty,S=l.forEach||function(R,k){for(var H=0,N=this.length;H<N;H++)R.call(k,this[H],H,this)},w=function(R,k){for(var H in this)this.hasOwnProperty(H)&&R.call(k,this[H],H,this)},C=Object.assign||function(R){for(var k=1,H=arguments.length;k<H;k++){var N=arguments[k];for(var G in N)N.hasOwnProperty(G)&&(R[G]=N[G])}return R},E=function(R,k,H){if(R){var N=g(R,"length");(N&&typeof N.value=="number"?S:w).call(R,k,H=H||R)}return H};function B(R,k,H,N,G){var L={};function O(W,Q){Q=Q||(Q=g(k,W))&&(Q.get?Q:Q.value),typeof Q=="string"&&Q[0]==="#"&&(Q=R[Q.substring(1)]||Q);var et=typeof Q=="function",rt=Q,ot=G||et&&!Q.base?Q&&Q.get?W in R:R[W]:null,J;(!G||!ot)&&(et&&ot&&(Q.base=ot),et&&N!==!1&&(J=W.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(L[J[3].toLowerCase()+J[4]]=J[2]),(!rt||et||!rt.get||typeof rt.get!="function"||!D.isPlainObject(rt))&&(rt={value:rt,writable:!0}),(g(R,W)||{configurable:!0}).configurable&&(rt.configurable=!0,rt.enumerable=H??!J),_(R,W,rt))}if(k){for(var A in k)k.hasOwnProperty(A)&&!a.test(A)&&O(A);for(var A in L){var U=L[A],X=R["set"+U],$=R["get"+U]||X&&R["is"+U];$&&(N===!0||$.length===0)&&O(A,{get:$,set:X})}}return R}function D(){for(var R=0,k=arguments.length;R<k;R++){var H=arguments[R];H&&C(this,H)}return this}return B(D,{inject:function(R){if(R){var k=R.statics===!0?R:R.statics,H=R.beans,N=R.preserve;k!==R&&B(this.prototype,R,R.enumerable,H,N),B(this,k,null,H,N)}for(var G=1,L=arguments.length;G<L;G++)this.inject(arguments[G]);return this},extend:function(){for(var R=this,k,H,N=0,G,L=arguments.length;N<L&&!(k&&H);N++)G=arguments[N],k=k||G.initialize,H=H||G.prototype;return k=k||function(){R.apply(this,arguments)},H=k.prototype=H||f(this.prototype),_(H,"constructor",{value:k,writable:!0,configurable:!0}),B(k,this),arguments.length&&this.inject.apply(k,arguments),k.base=R,k}}).inject({enumerable:!1,initialize:D,set:D,inject:function(){for(var R=0,k=arguments.length;R<k;R++){var H=arguments[R];H&&B(this,H,H.enumerable,H.beans,H.preserve)}return this},extend:function(){var R=f(this);return R.inject.apply(R,arguments)},each:function(R,k){return E(this,R,k)},clone:function(){return new this.constructor(this)},statics:{set:C,each:E,create:f,define:_,describe:g,clone:function(R){return C(new R.constructor,R)},isPlainObject:function(R){var k=R!=null&&R.constructor;return k&&(k===Object||k===D||k.name==="Object")},pick:function(R,k){return R!==e?R:k},slice:function(R,k,H){return c.call(R,k,H)}}})};r.exports=n,n.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+n.each(this,function(a,l){if(!/^_/.test(l)){var c=typeof a;this.push(l+": "+(c==="number"?m.instance.number(a):c==="string"?"'"+a+"'":a))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(a){return n.importJSON(a,this)},exportJSON:function(a){return n.exportJSON(this,a)},toJSON:function(){return n.serialize(this)},set:function(a,l){return a&&n.filter(this,a,l,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function a(){var l=a.base.apply(this,arguments),c=l.prototype._class;return c&&!n.exports[c]&&(n.exports[c]=l),l},equals:function(a,l){if(a===l)return!0;if(a&&a.equals)return a.equals(l);if(l&&l.equals)return l.equals(a);if(a&&l&&typeof a=="object"&&typeof l=="object"){if(Array.isArray(a)&&Array.isArray(l)){var c=a.length;if(c!==l.length)return!1;for(;c--;)if(!n.equals(a[c],l[c]))return!1}else{var f=Object.keys(a),c=f.length;if(c!==Object.keys(l).length)return!1;for(;c--;){var g=f[c];if(!(l.hasOwnProperty(g)&&n.equals(a[g],l[g])))return!1}}return!0}return!1},read:function(a,l,c,f){if(this===n){var g=this.peek(a,l);return a.__index++,g}var _=this.prototype,S=_._readIndex,w=l||S&&a.__index||0,C=a.length,E=a[w];if(f=f||C-w,E instanceof this||c&&c.readNull&&E==null&&f<=1)return S&&(a.__index=w+1),E&&c&&c.clone?E.clone():E;if(E=n.create(_),S&&(E.__read=!0),E=E.initialize.apply(E,w>0||w+f<C?n.slice(a,w,w+f):a)||E,S){a.__index=w+E.__read;var B=E.__filtered;B&&(a.__filtered=B,E.__filtered=e),E.__read=e}return E},peek:function(a,l){return a[a.__index=l||a.__index||0]},remain:function(a){return a.length-(a.__index||0)},readList:function(a,l,c,f){for(var g=[],_,S=l||0,w=f?S+f:a.length,C=S;C<w;C++)g.push(Array.isArray(_=a[C])?this.read(_,0,c):this.read(a,C,c,1));return g},readNamed:function(a,l,c,f,g){var _=this.getNamed(a,l),S=_!==e;if(S){var w=a.__filtered;if(!w){var C=this.getSource(a);w=a.__filtered=n.create(C),w.__unfiltered=C}w[l]=e}return this.read(S?[_]:a,c,f,g)},readSupported:function(a,l){var c=this.getSource(a),f=this,g=!1;return c&&Object.keys(c).forEach(function(_){if(_ in l){var S=f.readNamed(a,_);S!==e&&(l[_]=S),g=!0}}),g},getSource:function(a){var l=a.__source;if(l===e){var c=a.length===1&&a[0];l=a.__source=c&&n.isPlainObject(c)?c:null}return l},getNamed:function(a,l){var c=this.getSource(a);if(c)return l?c[l]:a.__filtered||c},hasNamed:function(a,l){return!!this.getNamed(a,l)},filter:function(a,l,c,f){var g;function _(B){if(!(c&&B in c)&&!(g&&B in g)){var D=l[B];D!==e&&(a[B]=D)}}if(f){for(var S={},w=0,C,E=f.length;w<E;w++)(C=f[w])in l&&(_(C),S[C]=!0);g=S}return Object.keys(l.__unfiltered||l).forEach(_),a},isPlainValue:function(a,l){return n.isPlainObject(a)||Array.isArray(a)||l&&typeof a=="string"},serialize:function(a,l,c,f){l=l||{};var g=!f,_;if(g&&(l.formatter=new m(l.precision),f={length:0,definitions:{},references:{},add:function(D,R){var k="#"+D._id,H=this.references[k];if(!H){this.length++;var N=R.call(D),G=D._class;G&&N[0]!==G&&N.unshift(G),this.definitions[k]=N,H=this.references[k]=[k]}return H}}),a&&a._serialize){_=a._serialize(l,f);var S=a._class;S&&!a._compactSerialize&&(g||!c)&&_[0]!==S&&_.unshift(S)}else if(Array.isArray(a)){_=[];for(var w=0,C=a.length;w<C;w++)_[w]=n.serialize(a[w],l,c,f)}else if(n.isPlainObject(a)){_={};for(var E=Object.keys(a),w=0,C=E.length;w<C;w++){var B=E[w];_[B]=n.serialize(a[B],l,c,f)}}else typeof a=="number"?_=l.formatter.number(a,l.precision):_=a;return g&&f.length>0?[["dictionary",f.definitions],_]:_},deserialize:function(a,l,c,f,g){var _=a,S=!c,w=S&&a&&a.length&&a[0][0]==="dictionary";if(c=c||{},Array.isArray(a)){var C=a[0],E=C==="dictionary";if(a.length==1&&/^#/.test(C))return c.dictionary[C];C=n.exports[C],_=[];for(var B=C?1:0,D=a.length;B<D;B++)_.push(n.deserialize(a[B],l,c,E,w));if(C){var R=_;l?_=l(C,R,S||g):_=new C(R)}}else if(n.isPlainObject(a)){_={},f&&(c.dictionary=_);for(var k in a)_[k]=n.deserialize(a[k],l,c)}return w?_[1]:_},exportJSON:function(a,l){var c=n.serialize(a,l);return l&&l.asString==!1?c:JSON.stringify(c)},importJSON:function(a,l){return n.deserialize(typeof a=="string"?JSON.parse(a):a,function(c,f,g){var _=g&&l&&l.constructor===c,S=_?l:n.create(c.prototype);if(f.length===1&&S instanceof T&&(_||!(S instanceof ct))){var w=f[0];n.isPlainObject(w)&&(w.insert=!1,_&&(f=f.concat([T.INSERT])))}return(_?S.set:c).apply(S,f),_&&(l=null),S})},push:function(a,l){var c=l.length;if(c<4096)a.push.apply(a,l);else{var f=a.length;a.length+=c;for(var g=0;g<c;g++)a[f+g]=l[g]}return a},splice:function(a,l,c,f){var g=l&&l.length,_=c===e;c=_?a.length:c,c>a.length&&(c=a.length);for(var S=0;S<g;S++)l[S]._index=c+S;if(_)return n.push(a,l),[];var w=[c,f];l&&n.push(w,l);for(var C=a.splice.apply(a,w),S=0,E=C.length;S<E;S++)C[S]._index=e;for(var S=c+g,E=a.length;S<E;S++)a[S]._index=S;return C},capitalize:function(a){return a.replace(/\b[a-z]/g,function(l){return l.toUpperCase()})},camelize:function(a){return a.replace(/-(.)/g,function(l,c){return c.toUpperCase()})},hyphenate:function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var o={on:function(a,l){if(typeof a!="string")n.each(a,function(_,S){this.on(S,_)},this);else{var c=this._eventTypes,f=c&&c[a],g=this._callbacks=this._callbacks||{};g=g[a]=g[a]||[],g.indexOf(l)===-1&&(g.push(l),f&&f.install&&g.length===1&&f.install.call(this,a))}return this},off:function(a,l){if(typeof a!="string"){n.each(a,function(S,w){this.off(w,S)},this);return}var c=this._eventTypes,f=c&&c[a],g=this._callbacks&&this._callbacks[a],_;return g&&(!l||(_=g.indexOf(l))!==-1&&g.length===1?(f&&f.uninstall&&f.uninstall.call(this,a),delete this._callbacks[a]):_!==-1&&g.splice(_,1)),this},once:function(a,l){return this.on(a,function c(){l.apply(this,arguments),this.off(a,c)})},emit:function(a,l){var c=this._callbacks&&this._callbacks[a];if(!c)return!1;var f=n.slice(arguments,1),g=l&&l.target&&!l.currentTarget;c=c.slice(),g&&(l.currentTarget=this);for(var _=0,S=c.length;_<S;_++)if(c[_].apply(this,f)==!1){l&&l.stop&&l.stop();break}return g&&delete l.currentTarget,!0},responds:function(a){return!!(this._callbacks&&this._callbacks[a])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(a){var l=this._eventTypes,c=this._callbacks,f=a?"install":"uninstall";if(l){for(var g in c)if(c[g].length>0){var _=l[g],S=_&&_[f];S&&S.call(this,g)}}},statics:{inject:function a(l){var c=l._events;if(c){var f={};n.each(c,function(g,_){var S=typeof g=="string",w=S?g:_,C=n.capitalize(w),E=w.substring(2).toLowerCase();f[E]=S?{}:g,w="_"+w,l["get"+C]=function(){return this[w]},l["set"+C]=function(B){var D=this[w];D&&this.off(E,D),B&&this.on(E,B),this[w]=B}}),l._eventTypes=f}return a.base.apply(this,arguments)}}},h=n.extend({_class:"PaperScope",initialize:function a(){be=this,this.settings=new n({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=a._id++,a._scopes[this._id]=this;var l=a.prototype;if(!this.support){var c=qe.getContext(1,1)||{};l.support={nativeDash:"setLineDash"in c||"mozDash"in c,nativeBlendModes:Zi.nativeModes},qe.release(c)}if(!this.agent){var f=t.navigator.userAgent.toLowerCase(),g=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(f)||[])[0],_=g==="darwin"?"mac":g,S=l.agent=l.browser={platform:_};_&&(S[_]=!0),f.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(w,C,E,B,D){if(!S.chrome){var R=C==="opera"?B:/^(node|trident)$/.test(C)?D:E;S.version=R,S.versionNumber=parseFloat(R),C={trident:"msie",jsdom:"node"}[C]||C,S.name=C,S[C]=!0}}),S.chrome&&delete S.webkit,S.atom&&delete S.chrome}},version:"0.12.18",getView:function(){var a=this.project;return a&&a._view},getPaper:function(){return this},execute:function(a,l){var c=be.PaperScript.execute(a,this,l);return Zt.updateFocus(),c},install:function(a){var l=this;n.each(["project","view","tool"],function(f){n.define(a,f,{configurable:!0,get:function(){return l[f]}})});for(var c in this)!/^_/.test(c)&&this[c]&&(a[c]=this[c])},setup:function(a){return be=this,this.project=new K(a),this},createCanvas:function(a,l){return qe.getCanvas(a,l)},activate:function(){be=this},clear:function(){for(var a=this.projects,l=this.tools,c=a.length-1;c>=0;c--)a[c].remove();for(var c=l.length-1;c>=0;c--)l[c].remove()},remove:function(){this.clear(),delete h._scopes[this._id]},statics:new function(){function a(l){return l+="Attribute",function(c,f){return c[l](f)||c[l]("data-paper-"+f)}}return{_scopes:{},_id:0,get:function(l){return this._scopes[l]||null},getAttribute:a("get"),hasAttribute:a("has")}}}),d=n.extend(o,{initialize:function(a){this._scope=be,this._index=this._scope[this._list].push(this)-1,(a||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var a=this._scope[this._reference];return a&&a!==this&&a.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",a),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(n.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),p={findItemBoundsCollisions:function(a,l,c){function f(S){for(var w=new Array(S.length),C=0;C<S.length;C++){var E=S[C].getBounds();w[C]=[E.left,E.top,E.right,E.bottom]}return w}var g=f(a),_=!l||l===a?g:f(l);return this.findBoundsCollisions(g,_,c||0)},findCurveBoundsCollisions:function(a,l,c,f){function g(R){for(var k=Math.min,H=Math.max,N=new Array(R.length),G=0;G<R.length;G++){var L=R[G];N[G]=[k(L[0],L[2],L[4],L[6]),k(L[1],L[3],L[5],L[7]),H(L[0],L[2],L[4],L[6]),H(L[1],L[3],L[5],L[7])]}return N}var _=g(a),S=!l||l===a?_:g(l);if(f){for(var w=this.findBoundsCollisions(_,S,c||0,!1,!0),C=this.findBoundsCollisions(_,S,c||0,!0,!0),E=[],B=0,D=w.length;B<D;B++)E[B]={hor:w[B],ver:C[B]};return E}return this.findBoundsCollisions(_,S,c||0)},findBoundsCollisions:function(a,l,c,f,g){var _=!l||a===l,S=_?a:a.concat(l),w=a.length,C=S.length;function E(Bt,Ot,Wt){for(var Ct=0,Et=Bt.length;Ct<Et;){var Nt=Et+Ct>>>1;S[Bt[Nt]][Ot]<Wt?Ct=Nt+1:Et=Nt}return Ct-1}for(var B=f?1:0,D=B+2,R=f?0:1,k=R+2,H=new Array(C),N=0;N<C;N++)H[N]=N;H.sort(function(Bt,Ot){return S[Bt][B]-S[Ot][B]});for(var G=[],L=new Array(w),N=0;N<C;N++){var O=H[N],A=S[O],U=_?O:O-w,X=O<w,$=_||!X,W=X?[]:null;if(G.length){var Q=E(G,D,A[B]-c)+1;if(G.splice(0,Q),_&&g){W=W.concat(G);for(var et=0;et<G.length;et++){var rt=G[et];L[rt].push(U)}}else for(var ot=A[k],J=A[R],et=0;et<G.length;et++){var rt=G[et],nt=S[rt],lt=rt<w,ft=_||rt>=w;(g||(X&&ft||$&&lt)&&ot>=nt[R]-c&&J<=nt[k]+c)&&(X&&ft&&W.push(_?rt:rt-w),$&&lt&&L[rt].push(U))}}if(X&&(a===l&&W.push(O),L[O]=W),G.length){var gt=A[D],yt=E(G,D,gt);G.splice(yt+1,0,O)}else G.push(O)}for(var N=0;N<L.length;N++){var At=L[N];At&&At.sort(function(Ot,Wt){return Ot-Wt})}return L}},m=n.extend({initialize:function(a){this.precision=n.pick(a,5),this.multiplier=Math.pow(10,this.precision)},number:function(a){return this.precision<16?Math.round(a*this.multiplier)/this.multiplier:a},pair:function(a,l,c){return this.number(a)+(c||",")+this.number(l)},point:function(a,l){return this.number(a.x)+(l||",")+this.number(a.y)},size:function(a,l){return this.number(a.width)+(l||",")+this.number(a.height)},rectangle:function(a,l){return this.point(a,l)+(l||",")+this.size(a,l)}});m.instance=new m;var v=new function(){var a=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],l=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],c=Math.abs,f=Math.sqrt,g=Math.pow,_=Math.log2||function(D){return Math.log(D)*Math.LOG2E},S=1e-12,w=112e-18;function C(D,R,k){return D<R?R:D>k?k:D}function E(D,R,k){function H(Q){var et=Q*134217729,rt=Q-et,ot=rt+et,J=Q-ot;return[ot,J]}var N=R*R-D*k,G=R*R+D*k;if(c(N)*3<G){var L=H(D),O=H(R),A=H(k),U=R*R,X=O[0]*O[0]-U+2*O[0]*O[1]+O[1]*O[1],$=D*k,W=L[0]*A[0]-$+L[0]*A[1]+L[1]*A[0]+L[1]*A[1];N=U-$+(X-W)}return N}function B(){var D=Math.max.apply(Math,arguments);return D&&(D<1e-8||D>1e8)?g(2,-Math.round(_(D))):0}return{EPSILON:S,MACHINE_EPSILON:w,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(f(2)-1)/3,isZero:function(D){return D>=-S&&D<=S},isMachineZero:function(D){return D>=-w&&D<=w},clamp:C,integrate:function(D,R,k,H){for(var N=a[H-2],G=l[H-2],L=(k-R)*.5,O=L+R,A=0,U=H+1>>1,X=H&1?G[A++]*D(O):0;A<U;){var $=L*N[A];X+=G[A++]*(D(O+$)+D(O-$))}return L*X},findRoot:function(D,R,k,H,N,G,L){for(var O=0;O<G;O++){var A=D(k),U=A/R(k),X=k-U;if(c(U)<L){k=X;break}A>0?(N=k,k=X<=H?(H+N)*.5:X):(H=k,k=X>=N?(H+N)*.5:X)}return C(k,H,N)},solveQuadratic:function(D,R,k,H,N,G){var L,O=1/0;if(c(D)<S){if(c(R)<S)return c(k)<S?-1:0;L=-k/R}else{R*=-.5;var A=E(D,R,k);if(A&&c(A)<w){var U=B(c(D),c(R),c(k));U&&(D*=U,R*=U,k*=U,A=E(D,R,k))}if(A>=-w){var X=A<0?0:f(A),$=R+(R<0?-X:X);$===0?(L=k/D,O=-L):(L=$/D,O=k/$)}}var W=0,Q=N==null,et=N-S,rt=G+S;return isFinite(L)&&(Q||L>et&&L<rt)&&(H[W++]=Q?L:C(L,N,G)),O!==L&&isFinite(O)&&(Q||O>et&&O<rt)&&(H[W++]=Q?O:C(O,N,G)),W},solveCubic:function(D,R,k,H,N,G,L){var O=B(c(D),c(R),c(k),c(H)),A,U,X,$,W;O&&(D*=O,R*=O,k*=O,H*=O);function Q(yt){A=yt;var At=D*A;U=At+R,X=U*A+k,$=(At+U)*A+X,W=X*A+H}if(c(D)<S)D=R,U=k,X=H,A=1/0;else if(c(H)<S)U=R,X=k,A=0;else{Q(-(R/D)/3);var et=W/D,rt=g(c(et),1/3),ot=et<0?-1:1,J=-$/D,nt=J>0?1.324717957244746*Math.max(rt,f(J)):rt,lt=A-ot*nt;if(lt!==A){do Q(lt),lt=$===0?A:A-W/$/(1+w);while(ot*lt>ot*A);c(D)*A*A>c(H/A)&&(X=-H/A,U=(X-k)/A)}}var ft=v.solveQuadratic(D,U,X,N,G,L),gt=G==null;return isFinite(A)&&(ft===0||ft>0&&A!==N[0]&&A!==N[1])&&(gt||A>G-S&&A<L+S)&&(N[ft++]=gt?A:C(A,G,L)),ft}}},b={_id:1,_pools:{},get:function(a){if(a){var l=this._pools[a];return l||(l=this._pools[a]={_id:1}),l._id++}else return this._id++}},y=n.extend({_class:"Point",_readIndex:!0,initialize:function(l,c){var f=typeof l,g=this.__read,_=0;if(f==="number"){var S=typeof c=="number";this._set(l,S?c:l),g&&(_=S?2:1)}else if(f==="undefined"||l===null)this._set(0,0),g&&(_=l===null?1:0);else{var w=f==="string"?l.split(/[\s,]+/)||[]:l;_=1,Array.isArray(w)?this._set(+w[0],+(w.length>1?w[1]:w[0])):"x"in w?this._set(w.x||0,w.y||0):"width"in w?this._set(w.width||0,w.height||0):"angle"in w?(this._set(w.length||0,0),this.setAngle(w.angle||0)):(this._set(0,0),_=0)}return g&&(this.__read=_),this},set:"#initialize",_set:function(a,l){return this.x=a,this.y=l,this},equals:function(a){return this===a||a&&(this.x===a.x&&this.y===a.y||Array.isArray(a)&&this.x===a[0]&&this.y===a[1])||!1},clone:function(){return new y(this.x,this.y)},toString:function(){var a=m.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+" }"},_serialize:function(a){var l=a.formatter;return[l.number(this.x),l.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(a){if(this.isZero()){var l=this._angle||0;this._set(Math.cos(l)*a,Math.sin(l)*a)}else{var c=a/this.getLength();v.isZero(c)&&this.getAngle(),this._set(this.x*c,this.y*c)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(a){this.setAngleInRadians.call(this,a*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var a=y.read(arguments),l=this.getLength()*a.getLength();if(v.isZero(l))return NaN;var c=this.dot(a)/l;return Math.acos(c<-1?-1:c>1?1:c)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(a){if(this._angle=a,!this.isZero()){var l=this.getLength();this._set(Math.cos(a)*l,Math.sin(a)*l)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var a=y.read(arguments);return Math.atan2(this.cross(a),this.dot(a))*180/Math.PI},getDistance:function(){var a=arguments,l=y.read(a),c=l.x-this.x,f=l.y-this.y,g=c*c+f*f,_=n.read(a);return _?g:Math.sqrt(g)},normalize:function(a){a===e&&(a=1);var l=this.getLength(),c=l!==0?a/l:0,f=new y(this.x*c,this.y*c);return c>=0&&(f._angle=this._angle),f},rotate:function(a,l){if(a===0)return this.clone();a=a*Math.PI/180;var c=l?this.subtract(l):this,f=Math.sin(a),g=Math.cos(a);return c=new y(c.x*g-c.y*f,c.x*f+c.y*g),l?c.add(l):c},transform:function(a){return a?a._transformPoint(this):this},add:function(){var a=y.read(arguments);return new y(this.x+a.x,this.y+a.y)},subtract:function(){var a=y.read(arguments);return new y(this.x-a.x,this.y-a.y)},multiply:function(){var a=y.read(arguments);return new y(this.x*a.x,this.y*a.y)},divide:function(){var a=y.read(arguments);return new y(this.x/a.x,this.y/a.y)},modulo:function(){var a=y.read(arguments);return new y(this.x%a.x,this.y%a.y)},negate:function(){return new y(-this.x,-this.y)},isInside:function(){return q.read(arguments).contains(this)},isClose:function(){var a=arguments,l=y.read(a),c=n.read(a);return this.getDistance(l)<=c},isCollinear:function(){var a=y.read(arguments);return y.isCollinear(this.x,this.y,a.x,a.y)},isColinear:"#isCollinear",isOrthogonal:function(){var a=y.read(arguments);return y.isOrthogonal(this.x,this.y,a.x,a.y)},isZero:function(){var a=v.isZero;return a(this.x)&&a(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(a){return this.x*(a>1&&a<4?-1:1)>=0&&this.y*(a>2?-1:1)>=0},dot:function(){var a=y.read(arguments);return this.x*a.x+this.y*a.y},cross:function(){var a=y.read(arguments);return this.x*a.y-this.y*a.x},project:function(){var a=y.read(arguments),l=a.isZero()?0:this.dot(a)/a.dot(a);return new y(a.x*l,a.y*l)},statics:{min:function(){var a=arguments,l=y.read(a),c=y.read(a);return new y(Math.min(l.x,c.x),Math.min(l.y,c.y))},max:function(){var a=arguments,l=y.read(a),c=y.read(a);return new y(Math.max(l.x,c.x),Math.max(l.y,c.y))},random:function(){return new y(Math.random(),Math.random())},isCollinear:function(a,l,c,f){return Math.abs(a*f-l*c)<=Math.sqrt((a*a+l*l)*(c*c+f*f))*1e-8},isOrthogonal:function(a,l,c,f){return Math.abs(a*c+l*f)<=Math.sqrt((a*a+l*l)*(c*c+f*f))*1e-8}}},n.each(["round","ceil","floor","abs"],function(a){var l=Math[a];this[a]=function(){return new y(l(this.x),l(this.y))}},{})),P=y.extend({initialize:function(l,c,f,g){this._x=l,this._y=c,this._owner=f,this._setter=g},_set:function(a,l,c){return this._x=a,this._y=l,c||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(a){this._x=a,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(a){this._y=a,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(a){this._owner._changeSelection(this._getSelection(),a)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),M=n.extend({_class:"Size",_readIndex:!0,initialize:function(l,c){var f=typeof l,g=this.__read,_=0;if(f==="number"){var S=typeof c=="number";this._set(l,S?c:l),g&&(_=S?2:1)}else if(f==="undefined"||l===null)this._set(0,0),g&&(_=l===null?1:0);else{var w=f==="string"?l.split(/[\s,]+/)||[]:l;_=1,Array.isArray(w)?this._set(+w[0],+(w.length>1?w[1]:w[0])):"width"in w?this._set(w.width||0,w.height||0):"x"in w?this._set(w.x||0,w.y||0):(this._set(0,0),_=0)}return g&&(this.__read=_),this},set:"#initialize",_set:function(a,l){return this.width=a,this.height=l,this},equals:function(a){return a===this||a&&(this.width===a.width&&this.height===a.height||Array.isArray(a)&&this.width===a[0]&&this.height===a[1])||!1},clone:function(){return new M(this.width,this.height)},toString:function(){var a=m.instance;return"{ width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){var l=a.formatter;return[l.number(this.width),l.number(this.height)]},add:function(){var a=M.read(arguments);return new M(this.width+a.width,this.height+a.height)},subtract:function(){var a=M.read(arguments);return new M(this.width-a.width,this.height-a.height)},multiply:function(){var a=M.read(arguments);return new M(this.width*a.width,this.height*a.height)},divide:function(){var a=M.read(arguments);return new M(this.width/a.width,this.height/a.height)},modulo:function(){var a=M.read(arguments);return new M(this.width%a.width,this.height%a.height)},negate:function(){return new M(-this.width,-this.height)},isZero:function(){var a=v.isZero;return a(this.width)&&a(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(a,l){return new M(Math.min(a.width,l.width),Math.min(a.height,l.height))},max:function(a,l){return new M(Math.max(a.width,l.width),Math.max(a.height,l.height))},random:function(){return new M(Math.random(),Math.random())}}},n.each(["round","ceil","floor","abs"],function(a){var l=Math[a];this[a]=function(){return new M(l(this.width),l(this.height))}},{})),z=M.extend({initialize:function(l,c,f,g){this._width=l,this._height=c,this._owner=f,this._setter=g},_set:function(a,l,c){return this._width=a,this._height=l,c||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(a){this._width=a,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(a){this._height=a,this._owner[this._setter](this)}}),q=n.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(l,c,f,g){var _=arguments,S=typeof l,w;if(S==="number"?(this._set(l,c,f,g),w=4):S==="undefined"||l===null?(this._set(0,0,0,0),w=l===null?1:0):_.length===1&&(Array.isArray(l)?(this._set.apply(this,l),w=1):l.x!==e||l.width!==e?(this._set(l.x||0,l.y||0,l.width||0,l.height||0),w=1):l.from===e&&l.to===e&&(this._set(0,0,0,0),n.readSupported(_,this)&&(w=1))),w===e){var C=y.readNamed(_,"from"),E=n.peek(_),B=C.x,D=C.y,R,k;if(E&&E.x!==e||n.hasNamed(_,"to")){var H=y.readNamed(_,"to");R=H.x-B,k=H.y-D,R<0&&(B=H.x,R=-R),k<0&&(D=H.y,k=-k)}else{var N=M.read(_);R=N.width,k=N.height}this._set(B,D,R,k),w=_.__index}var G=_.__filtered;return G&&(this.__filtered=G),this.__read&&(this.__read=w),this},set:"#initialize",_set:function(a,l,c,f){return this.x=a,this.y=l,this.width=c,this.height=f,this},clone:function(){return new q(this.x,this.y,this.width,this.height)},equals:function(a){var l=n.isPlainValue(a)?q.read(arguments):a;return l===this||l&&this.x===l.x&&this.y===l.y&&this.width===l.width&&this.height===l.height||!1},toString:function(){var a=m.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+", width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){var l=a.formatter;return[l.number(this.x),l.number(this.y),l.number(this.width),l.number(this.height)]},getPoint:function(a){var l=a?y:P;return new l(this.x,this.y,this,"setPoint")},setPoint:function(){var a=y.read(arguments);this.x=a.x,this.y=a.y},getSize:function(a){var l=a?M:z;return new l(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var a=M.read(arguments),l=this._sx,c=this._sy,f=a.width,g=a.height;l&&(this.x+=(this.width-f)*l),c&&(this.y+=(this.height-g)*c),this.width=f,this.height=g,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(a){if(!this._fw){var l=a-this.x;this.width-=this._sx===.5?l*2:l}this.x=a,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(a){if(!this._fh){var l=a-this.y;this.height-=this._sy===.5?l*2:l}this.y=a,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(a){if(!this._fw){var l=a-this.x;this.width=this._sx===.5?l*2:l}this.x=a-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(a){if(!this._fh){var l=a-this.y;this.height=this._sy===.5?l*2:l}this.y=a-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(a){this._fw||this._sx===.5?this.x=a-this.width/2:(this._sx&&(this.x+=(a-this.x)*2*this._sx),this.width=(a-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(a){this._fh||this._sy===.5?this.y=a-this.height/2:(this._sy&&(this.y+=(a-this.y)*2*this._sy),this.height=(a-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(a){var l=a?y:P;return new l(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var a=y.read(arguments);return this.setCenterX(a.x),this.setCenterY(a.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(a){return a&&a.width!==e||(Array.isArray(a)?a:arguments).length===4?this._containsRectangle(q.read(arguments)):this._containsPoint(y.read(arguments))},_containsPoint:function(a){var l=a.x,c=a.y;return l>=this.x&&c>=this.y&&l<=this.x+this.width&&c<=this.y+this.height},_containsRectangle:function(a){var l=a.x,c=a.y;return l>=this.x&&c>=this.y&&l+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(){var a=q.read(arguments),l=n.read(arguments)||0;return a.x+a.width>this.x-l&&a.y+a.height>this.y-l&&a.x<this.x+this.width+l&&a.y<this.y+this.height+l},intersect:function(){var a=q.read(arguments),l=Math.max(this.x,a.x),c=Math.max(this.y,a.y),f=Math.min(this.x+this.width,a.x+a.width),g=Math.min(this.y+this.height,a.y+a.height);return new q(l,c,f-l,g-c)},unite:function(){var a=q.read(arguments),l=Math.min(this.x,a.x),c=Math.min(this.y,a.y),f=Math.max(this.x+this.width,a.x+a.width),g=Math.max(this.y+this.height,a.y+a.height);return new q(l,c,f-l,g-c)},include:function(){var a=y.read(arguments),l=Math.min(this.x,a.x),c=Math.min(this.y,a.y),f=Math.max(this.x+this.width,a.x),g=Math.max(this.y+this.height,a.y);return new q(l,c,f-l,g-c)},expand:function(){var a=M.read(arguments),l=a.width,c=a.height;return new q(this.x-l/2,this.y-c/2,this.width+l,this.height+c)},scale:function(a,l){return this.expand(this.width*a-this.width,this.height*(l===e?a:l)-this.height)}},n.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(a,l){var c=a.join(""),f=/^[RL]/.test(c);l>=4&&(a[1]+=f?"Y":"X");var g=a[f?0:1],_=a[f?1:0],S="get"+g,w="get"+_,C="set"+g,E="set"+_,B="get"+c,D="set"+c;this[B]=function(R){var k=R?y:P;return new k(this[S](),this[w](),this,D)},this[D]=function(){var R=y.read(arguments);this[C](R.x),this[E](R.y)}},{beans:!0})),V=q.extend({initialize:function(l,c,f,g,_,S){this._set(l,c,f,g,!0),this._owner=_,this._setter=S},_set:function(a,l,c,f,g){return this._x=a,this._y=l,this._width=c,this._height=f,g||this._owner[this._setter](this),this}},new function(){var a=q.prototype;return n.each(["x","y","width","height"],function(l){var c=n.capitalize(l),f="_"+l;this["get"+c]=function(){return this[f]},this["set"+c]=function(g){this[f]=g,this._dontNotify||this._owner[this._setter](this)}},n.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(l){var c="set"+l;this[c]=function(){this._dontNotify=!0,a[c].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(l){var c=this._owner;c._changeSelection&&c._changeSelection(2,l)}}))}),I=n.extend({_class:"Matrix",initialize:function a(l,c){var f=arguments,g=f.length,_=!0;if(g>=6?this._set.apply(this,f):g===1||g===2?l instanceof a?this._set(l._a,l._b,l._c,l._d,l._tx,l._ty,c):Array.isArray(l)?this._set.apply(this,c?l.concat([c]):l):_=!1:g?_=!1:this.reset(),!_)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(a,l,c,f,g,_,S){return this._a=a,this._b=l,this._c=c,this._d=f,this._tx=g,this._ty=_,S||this._changed(),this},_serialize:function(a,l){return n.serialize(this.getValues(),a,!0,l)},_changed:function(){var a=this._owner;a&&(a._applyMatrix?a.transform(null,!0):a._changed(25))},clone:function(){return new I(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(a){return a===this||a&&this._a===a._a&&this._b===a._b&&this._c===a._c&&this._d===a._d&&this._tx===a._tx&&this._ty===a._ty},toString:function(){var a=m.instance;return"[["+[a.number(this._a),a.number(this._c),a.number(this._tx)].join(", ")+"], ["+[a.number(this._b),a.number(this._d),a.number(this._ty)].join(", ")+"]]"},reset:function(a){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,a||this._changed(),this},apply:function(a,l){var c=this._owner;return c?(c.transform(null,n.pick(a,!0),l),this.isIdentity()):!1},translate:function(){var a=y.read(arguments),l=a.x,c=a.y;return this._tx+=l*this._a+c*this._c,this._ty+=l*this._b+c*this._d,this._changed(),this},scale:function(){var a=arguments,l=y.read(a),c=y.read(a,0,{readNull:!0});return c&&this.translate(c),this._a*=l.x,this._b*=l.x,this._c*=l.y,this._d*=l.y,c&&this.translate(c.negate()),this._changed(),this},rotate:function(a){a*=Math.PI/180;var l=y.read(arguments,1),c=l.x,f=l.y,g=Math.cos(a),_=Math.sin(a),S=c-c*g+f*_,w=f-c*_-f*g,C=this._a,E=this._b,B=this._c,D=this._d;return this._a=g*C+_*B,this._b=g*E+_*D,this._c=-_*C+g*B,this._d=-_*E+g*D,this._tx+=S*C+w*B,this._ty+=S*E+w*D,this._changed(),this},shear:function(){var a=arguments,l=y.read(a),c=y.read(a,0,{readNull:!0});c&&this.translate(c);var f=this._a,g=this._b;return this._a+=l.y*this._c,this._b+=l.y*this._d,this._c+=l.x*f,this._d+=l.x*g,c&&this.translate(c.negate()),this._changed(),this},skew:function(){var a=arguments,l=y.read(a),c=y.read(a,0,{readNull:!0}),f=Math.PI/180,g=new y(Math.tan(l.x*f),Math.tan(l.y*f));return this.shear(g,c)},append:function(a,l){if(a){var c=this._a,f=this._b,g=this._c,_=this._d,S=a._a,w=a._c,C=a._b,E=a._d,B=a._tx,D=a._ty;this._a=S*c+C*g,this._c=w*c+E*g,this._b=S*f+C*_,this._d=w*f+E*_,this._tx+=B*c+D*g,this._ty+=B*f+D*_,l||this._changed()}return this},prepend:function(a,l){if(a){var c=this._a,f=this._b,g=this._c,_=this._d,S=this._tx,w=this._ty,C=a._a,E=a._c,B=a._b,D=a._d,R=a._tx,k=a._ty;this._a=C*c+E*f,this._c=C*g+E*_,this._b=B*c+D*f,this._d=B*g+D*_,this._tx=C*S+E*w+R,this._ty=B*S+D*w+k,l||this._changed()}return this},appended:function(a){return this.clone().append(a)},prepended:function(a){return this.clone().prepend(a)},invert:function(){var a=this._a,l=this._b,c=this._c,f=this._d,g=this._tx,_=this._ty,S=a*f-l*c,w=null;return S&&!isNaN(S)&&isFinite(g)&&isFinite(_)&&(this._a=f/S,this._b=-l/S,this._c=-c/S,this._d=a/S,this._tx=(c*_-f*g)/S,this._ty=(l*g-a*_)/S,w=this),w},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new I(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var a=this._a*this._d-this._c*this._b;return a&&!isNaN(a)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(a,l,c){return arguments.length<3?this._transformPoint(y.read(arguments)):this._transformCoordinates(a,l,c)},_transformPoint:function(a,l,c){var f=a.x,g=a.y;return l||(l=new y),l._set(f*this._a+g*this._c+this._tx,f*this._b+g*this._d+this._ty,c)},_transformCoordinates:function(a,l,c){for(var f=0,g=2*c;f<g;f+=2){var _=a[f],S=a[f+1];l[f]=_*this._a+S*this._c+this._tx,l[f+1]=_*this._b+S*this._d+this._ty}return l},_transformCorners:function(a){var l=a.x,c=a.y,f=l+a.width,g=c+a.height,_=[l,c,f,c,f,g,l,g];return this._transformCoordinates(_,_,4)},_transformBounds:function(a,l,c){for(var f=this._transformCorners(a),g=f.slice(0,2),_=g.slice(),S=2;S<8;S++){var w=f[S],C=S&1;w<g[C]?g[C]=w:w>_[C]&&(_[C]=w)}return l||(l=new q),l._set(g[0],g[1],_[0]-g[0],_[1]-g[1],c)},inverseTransform:function(){return this._inverseTransform(y.read(arguments))},_inverseTransform:function(a,l,c){var f=this._a,g=this._b,_=this._c,S=this._d,w=this._tx,C=this._ty,E=f*S-g*_,B=null;if(E&&!isNaN(E)&&isFinite(w)&&isFinite(C)){var D=a.x-this._tx,R=a.y-this._ty;l||(l=new y),B=l._set((D*S-R*_)/E,(R*f-D*g)/E,c)}return B},decompose:function(){var a=this._a,l=this._b,c=this._c,f=this._d,g=a*f-l*c,_=Math.sqrt,S=Math.atan2,w=180/Math.PI,C,E,B;if(a!==0||l!==0){var D=_(a*a+l*l);C=Math.acos(a/D)*(l>0?1:-1),E=[D,g/D],B=[S(a*c+l*f,D*D),0]}else if(c!==0||f!==0){var R=_(c*c+f*f);C=Math.asin(c/R)*(f>0?1:-1),E=[g/R,R],B=[0,S(a*c+l*f,R*R)]}else C=0,B=E=[0,0];return{translation:this.getTranslation(),rotation:C*w,scaling:new y(E),skewing:new y(B[0]*w,B[1]*w)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new y(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(a){this.isIdentity()||a.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},n.each(["a","b","c","d","tx","ty"],function(a){var l=n.capitalize(a),c="_"+a;this["get"+l]=function(){return this[c]},this["set"+l]=function(f){this[c]=f,this._changed()}},{})),Y=n.extend({_class:"Line",initialize:function(l,c,f,g,_){var S=!1;arguments.length>=4?(this._px=l,this._py=c,this._vx=f,this._vy=g,S=_):(this._px=l.x,this._py=l.y,this._vx=c.x,this._vy=c.y,S=f),S||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new y(this._px,this._py)},getVector:function(){return new y(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(a,l){return Y.intersect(this._px,this._py,this._vx,this._vy,a._px,a._py,a._vx,a._vy,!0,l)},getSide:function(a,l){return Y.getSide(this._px,this._py,this._vx,this._vy,a.x,a.y,!0,l)},getDistance:function(a){return Math.abs(this.getSignedDistance(a))},getSignedDistance:function(a){return Y.getSignedDistance(this._px,this._py,this._vx,this._vy,a.x,a.y,!0)},isCollinear:function(a){return y.isCollinear(this._vx,this._vy,a._vx,a._vy)},isOrthogonal:function(a){return y.isOrthogonal(this._vx,this._vy,a._vx,a._vy)},statics:{intersect:function(a,l,c,f,g,_,S,w,C,E){C||(c-=a,f-=l,S-=g,w-=_);var B=c*w-f*S;if(!v.isMachineZero(B)){var D=a-g,R=l-_,k=(S*R-w*D)/B,H=(c*R-f*D)/B,N=1e-12,G=-N,L=1+N;if(E||G<k&&k<L&&G<H&&H<L)return E||(k=k<=0?0:k>=1?1:k),new y(a+k*c,l+k*f)}},getSide:function(a,l,c,f,g,_,S,w){S||(c-=a,f-=l);var C=g-a,E=_-l,B=C*f-E*c;return!w&&v.isMachineZero(B)&&(B=(C*c+C*c)/(c*c+f*f),B>=0&&B<=1&&(B=0)),B<0?-1:B>0?1:0},getSignedDistance:function(a,l,c,f,g,_,S){return S||(c-=a,f-=l),c===0?f>0?g-a:a-g:f===0?c<0?_-l:l-_:((g-a)*f-(_-l)*c)/(f>c?f*Math.sqrt(1+c*c/(f*f)):c*Math.sqrt(1+f*f/(c*c)))},getDistance:function(a,l,c,f,g,_,S){return Math.abs(Y.getSignedDistance(a,l,c,f,g,_,S))}}}),K=d.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(l){d.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Fe(null,null,this),this._view=Zt.create(this,l||qe.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(a,l){return n.serialize(this._children,a,!0,l)},_changed:function(a,l){if(a&1){var c=this._view;c&&(c._needsUpdate=!0,!c._requested&&c._autoUpdate&&c.requestUpdate())}var f=this._changes;if(f&&l){var g=this._changesById,_=l._id,S=g[_];S?S.flags|=a:f.push(g[_]={item:l,flags:a})}},clear:function(){for(var a=this._children,l=a.length-1;l>=0;l--)a[l].remove()},isEmpty:function(){return!this._children.length},remove:function a(){return a.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(a){this._currentStyle.set(a)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new ct({project:this,insert:!0})},getSymbolDefinitions:function(){var a=[],l={};return this.getItems({class:It,match:function(c){var f=c._definition,g=f._id;return l[g]||(l[g]=!0,a.push(f)),!1}}),a},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var a=this._selectionItems,l=[];for(var c in a){var f=a[c],g=f._selection;g&1&&f.isInserted()?l.push(f):g||this._updateSelection(f)}return l},_updateSelection:function(a){var l=a._id,c=this._selectionItems;a._selection?c[l]!==a&&(this._selectionCount++,c[l]=a):c[l]===a&&(this._selectionCount--,delete c[l])},selectAll:function(){for(var a=this._children,l=0,c=a.length;l<c;l++)a[l].setFullySelected(!0)},deselectAll:function(){var a=this._selectionItems;for(var l in a)a[l].setFullySelected(!1)},addLayer:function(a){return this.insertLayer(e,a)},insertLayer:function(a,l){if(l instanceof ct){l._remove(!1,!0),n.splice(this._children,[l],a,0),l._setProject(this,!0);var c=l._name;c&&l.setName(c),this._changes&&l._changed(5),this._activeLayer||(this._activeLayer=l)}else l=null;return l},_insertItem:function(a,l,c){return l=this.insertLayer(a,l)||(this._activeLayer||this._insertItem(e,new ct(T.NO_INSERT),!0)).insertChild(a,l),c&&l.activate&&l.activate(),l},getItems:function(a){return T._getItems(this,a)},getItem:function(a){return T._getItems(this,a,null,null,!0)[0]||null},importJSON:function(a){this.activate();var l=this._activeLayer;return n.importJSON(a,l&&l.isEmpty()&&l)},removeOn:function(a){var l=this._removeSets;if(l){a==="mouseup"&&(l.mousedrag=null);var c=l[a];if(c){for(var f in c){var g=c[f];for(var _ in l){var S=l[_];S&&S!=c&&delete S[g._id]}g.remove()}l[a]=null}}},draw:function(a,l,c){this._updateVersion++,a.save(),l.applyToContext(a);for(var f=this._children,g=new n({offset:new y(0,0),pixelRatio:c,viewMatrix:l.isIdentity()?null:l,matrices:[new I],updateMatrix:!0}),_=0,S=f.length;_<S;_++)f[_].draw(a,g);if(a.restore(),this._selectionCount>0){a.save(),a.strokeWidth=1;var w=this._selectionItems,C=this._scope.settings.handleSize,E=this._updateVersion;for(var B in w)w[B]._drawSelection(a,l,C,w,E);a.restore()}}}),T=n.extend(o,{statics:{extend:function a(l){return l._serializeFields&&(l._serializeFields=n.set({},this.prototype._serializeFields,l._serializeFields)),a.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new I,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var a=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return n.each(a,function(l){this._events[l]={install:function(c){this.getView()._countItemEvent(c,1)},uninstall:function(c){this.getView()._countItemEvent(c,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:a}})},{initialize:function(){},_initialize:function(a,l){var c=a&&n.isPlainObject(a),f=c&&a.internal===!0,g=this._matrix=new I,_=c&&a.project||be.project,S=be.settings;return this._id=f?null:b.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&S.applyMatrix,l&&g.translate(l),g._owner=this,this._style=new Fe(_._currentStyle,this,_),f||c&&a.insert==!1||!S.insertItems&&!(c&&a.insert==!0)?this._setProject(_):(c&&a.parent||_)._insertItem(e,this,!0),c&&a!==T.NO_INSERT&&a!==T.INSERT&&this.set(a,{internal:!0,insert:!0,project:!0,parent:!0}),c},_serialize:function(a,l){var c={},f=this;function g(_){for(var S in _){var w=f[S];n.equals(w,S==="leading"?_.fontSize*1.2:_[S])||(c[S]=n.serialize(w,a,S!=="data",l))}}return g(this._serializeFields),this instanceof at||g(this._style._defaults),[this._class,c]},_changed:function(a){var l=this._symbol,c=this._parent||l,f=this._project;a&8&&(this._bounds=this._position=this._decomposed=e),a&16&&(this._globalMatrix=e),c&&a&72&&T._clearBoundsCache(c),a&2&&T._clearBoundsCache(this),f&&f._changed(a,this),l&&l._changed(a)},getId:function(){return this._id},getName:function(){return this._name},setName:function(a){if(this._name&&this._removeNamed(),a===+a+"")throw new Error("Names consisting only of numbers are not supported.");var l=this._getOwner();if(a&&l){var c=l._children,f=l._namedChildren;(f[a]=f[a]||[]).push(this),a in c||(c[a]=this)}this._name=a||e,this._changed(256)},getStyle:function(){return this._style},setStyle:function(a){this.getStyle().set(a)}},n.each(["locked","visible","blendMode","opacity","guide"],function(a){var l=n.capitalize(a),c="_"+a,f={locked:256,visible:265};this["get"+l]=function(){return this[c]},this["set"+l]=function(g){g!=this[c]&&(this[c]=g,this._changed(f[a]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(a){if(a!==this._selection){this._selection=a;var l=this._project;l&&(l._updateSelection(this),this._changed(257))}},_changeSelection:function(a,l){var c=this._selection;this.setSelection(l?c|a:c&~a)},isSelected:function(){if(this._selectChildren){for(var a=this._children,l=0,c=a.length;l<c;l++)if(a[l].isSelected())return!0}return!!(this._selection&1)},setSelected:function(a){if(this._selectChildren)for(var l=this._children,c=0,f=l.length;c<f;c++)l[c].setSelected(a);this._changeSelection(1,a)},isFullySelected:function(){var a=this._children,l=!!(this._selection&1);if(a&&l){for(var c=0,f=a.length;c<f;c++)if(!a[c].isFullySelected())return!1;return!0}return l},setFullySelected:function(a){var l=this._children;if(l)for(var c=0,f=l.length;c<f;c++)l[c].setFullySelected(a);this._changeSelection(1,a)},isClipMask:function(){return this._clipMask},setClipMask:function(a){this._clipMask!=(a=!!a)&&(this._clipMask=a,a&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(a){this._data=a},getPosition:function(a){var l=a?y:P,c=this._position||(this._position=this._getPositionFromBounds());return new l(c.x,c.y,this,"setPosition")},setPosition:function(){this.translate(y.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(a){return this._pivot?this._matrix._transformPoint(this._pivot):(a||this.getBounds()).getCenter(!0)},getPivot:function(){var a=this._pivot;return a?new P(a.x,a.y,this,"setPivot"):null},setPivot:function(){this._pivot=y.read(arguments,0,{clone:!0,readNull:!0}),this._position=e}},n.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(a,l){this[l]=function(c){return this.getBounds(c,a)}},{beans:!0,getBounds:function(a,l){var c=l||a instanceof I,f=n.set({},c?l:a,this._boundsOptions);(!f.stroke||this.getStrokeScaling())&&(f.cacheItem=this);var g=this._getCachedBounds(c&&a,f).rect;return arguments.length?g:new V(g.x,g.y,g.width,g.height,this,"setBounds")},setBounds:function(){var a=q.read(arguments),l=this.getBounds(),c=this._matrix,f=new I,g=a.getCenter();f.translate(g),(a.width!=l.width||a.height!=l.height)&&(c.isInvertible()||(c.set(c._backup||new I().translate(c.getTranslation())),l=this.getBounds()),f.scale(l.width!==0?a.width/l.width:0,l.height!==0?a.height/l.height:0)),g=l.getCenter(),f.translate(-g.x,-g.y),this.transform(f)},_getBounds:function(a,l){var c=this._children;return!c||!c.length?new q:(T._updateBoundsCache(this,l.cacheItem),T._getBounds(c,a,l))},_getBoundsCacheKey:function(a,l){return[a.stroke?1:0,a.handle?1:0,l?1:0].join("")},_getCachedBounds:function(a,l,c){a=a&&a._orNullIfIdentity();var f=l.internal&&!c,g=l.cacheItem,_=f?null:this._matrix._orNullIfIdentity(),S=g&&(!a||a.equals(_))&&this._getBoundsCacheKey(l,f),w=this._bounds;if(T._updateBoundsCache(this._parent||this._symbol,g),S&&w&&S in w){var C=w[S];return{rect:C.rect.clone(),nonscaling:C.nonscaling}}var E=this._getBounds(a||_,l),B=E.rect||E,D=this._style,R=E.nonscaling||D.hasStroke()&&!D.getStrokeScaling();if(S){w||(this._bounds=w={});var C=w[S]={rect:B.clone(),nonscaling:R,internal:f}}return{rect:B,nonscaling:R}},_getStrokeMatrix:function(a,l){var c=this.getStrokeScaling()?null:l&&l.internal?this:this._parent||this._symbol&&this._symbol._item,f=c?c.getViewMatrix().invert():a;return f&&f._shiftless()},statics:{_updateBoundsCache:function(a,l){if(a&&l){var c=l._id,f=a._boundsCache=a._boundsCache||{ids:{},list:[]};f.ids[c]||(f.list.push(l),f.ids[c]=l)}},_clearBoundsCache:function(a){var l=a._boundsCache;if(l){a._bounds=a._position=a._boundsCache=e;for(var c=0,f=l.list,g=f.length;c<g;c++){var _=f[c];_!==a&&(_._bounds=_._position=e,_._boundsCache&&T._clearBoundsCache(_))}}},_getBounds:function(a,l,c){var f=1/0,g=-f,_=f,S=g,w=!1;c=c||{};for(var C=0,E=a.length;C<E;C++){var B=a[C];if(B._visible&&!B.isEmpty(!0)){var D=B._getCachedBounds(l&&l.appended(B._matrix),c,!0),R=D.rect;f=Math.min(R.x,f),_=Math.min(R.y,_),g=Math.max(R.x+R.width,g),S=Math.max(R.y+R.height,S),D.nonscaling&&(w=!0)}}return{rect:isFinite(f)?new q(f,_,g-f,S-_):new q,nonscaling:w}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var a=this._decompose();return a?a.rotation:0},setRotation:function(a){var l=this.getRotation();if(l!=null&&a!=null){var c=this._decomposed;this.rotate(a-l),c&&(c.rotation=a,this._decomposed=c)}},getScaling:function(){var a=this._decompose(),l=a&&a.scaling;return new P(l?l.x:1,l?l.y:1,this,"setScaling")},setScaling:function(){var a=this.getScaling(),l=y.read(arguments,0,{clone:!0,readNull:!0});if(a&&l&&!a.equals(l)){var c=this.getRotation(),f=this._decomposed,g=new I,_=v.isZero;if(_(a.x)||_(a.y))g.translate(f.translation),c&&g.rotate(c),g.scale(l.x,l.y),this._matrix.set(g);else{var S=this.getPosition(!0);g.translate(S),c&&g.rotate(c),g.scale(l.x/a.x,l.y/a.y),c&&g.rotate(-c),g.translate(S.negate()),this.transform(g)}f&&(f.scaling=l,this._decomposed=f)}},getMatrix:function(){return this._matrix},setMatrix:function(){var a=this._matrix;a.set.apply(a,arguments)},getGlobalMatrix:function(a){var l=this._globalMatrix;if(l)for(var c=this._parent,f=[];c;){if(!c._globalMatrix){l=null;for(var g=0,_=f.length;g<_;g++)f[g]._globalMatrix=null;break}f.push(c),c=c._parent}if(!l){l=this._globalMatrix=this._matrix.clone();var c=this._parent;c&&l.prepend(c.getGlobalMatrix(!0))}return a?l:l.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(a){(this._applyMatrix=this._canApplyMatrix&&!!a)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(a,l){if(this._project!==a){this._project&&this._installEvents(!1),this._project=a;for(var c=this._children,f=0,g=c&&c.length;f<g;f++)c[f]._setProject(a);l=!0}l&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function a(l){a.base.call(this,l);for(var c=this._children,f=0,g=c&&c.length;f<g;f++)c[f]._installEvents(l)},getLayer:function(){for(var a=this;a=a._parent;)if(a instanceof ct)return a;return null},getParent:function(){return this._parent},setParent:function(a){return a.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(a){this.removeChildren(),this.addChildren(a)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var a=this._getOwner();return a&&a._children[this._index+1]||null},getPreviousSibling:function(){var a=this._getOwner();return a&&a._children[this._index-1]||null},getIndex:function(){return this._index},setIndex:function(a){var l=this._parent,c=l&&l._children;c&&l.insertChildren(a in c?a:e,[this])},equals:function(a){return a===this||a&&this._class===a._class&&this._style.equals(a._style)&&this._matrix.equals(a._matrix)&&this._locked===a._locked&&this._visible===a._visible&&this._blendMode===a._blendMode&&this._opacity===a._opacity&&this._clipMask===a._clipMask&&this._guide===a._guide&&this._equals(a)||!1},_equals:function(a){return n.equals(this._children,a._children)},clone:function(a){var l=new this.constructor(T.NO_INSERT),c=this._children,f=n.pick(a?a.insert:e,a===e||a===!0),g=n.pick(a?a.deep:e,!0);c&&l.copyAttributes(this),(!c||g)&&l.copyContent(this),c||l.copyAttributes(this),f&&l.insertAbove(this);var _=this._name,S=this._parent;if(_&&S){for(var c=S._children,w=_,C=1;c[_];)_=w+" "+C++;_!==w&&l.setName(_)}return l},copyContent:function(a){for(var l=a._children,c=0,f=l&&l.length;c<f;c++)this.addChild(l[c].clone(!1),!0)},copyAttributes:function(a,l){this.setStyle(a._style);for(var c=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],f=0,g=c.length;f<g;f++){var _=c[f];a.hasOwnProperty(_)&&(this[_]=a[_])}l||this._matrix.set(a._matrix,!0),this.setApplyMatrix(a._applyMatrix),this.setPivot(a._pivot),this.setSelection(a._selection);var S=a._data,w=a._name;this._data=S?n.clone(S):null,w&&this.setName(w)},rasterize:function(a,l){var c,f,g;n.isPlainObject(a)?(c=a.resolution,f=a.insert,g=a.raster):(c=a,f=l),g||(g=new wt(T.NO_INSERT));var _=this.getStrokeBounds(),S=(c||this.getView().getResolution())/72,w=_.getTopLeft().floor(),C=_.getBottomRight().ceil(),E=new M(C.subtract(w)),B=E.multiply(S);if(g.setSize(B,!0),!B.isZero()){var D=g.getContext(!0),R=new I().scale(S).translate(w.negate());D.save(),R.applyToContext(D),this.draw(D,new n({matrices:[R]})),D.restore()}return g._matrix.set(new I().translate(w.add(E.divide(2))).scale(1/S)),(f===e||f)&&g.insertAbove(this),g},contains:function(){var a=this._matrix;return a.isInvertible()&&!!this._contains(a._inverseTransform(y.read(arguments)))},_contains:function(a){var l=this._children;if(l){for(var c=l.length-1;c>=0;c--)if(l[c].contains(a))return!0;return!1}return a.isInside(this.getInternalBounds())},isInside:function(){return q.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Gt.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(a,l){return a instanceof T?this._asPathItem().getIntersections(a._asPathItem(),null,l,!0).length>0:!1}},new function(){function a(){var f=arguments;return this._hitTest(y.read(f),dt.getOptions(f))}function l(){var f=arguments,g=y.read(f),_=dt.getOptions(f),S=[];return this._hitTest(g,new n({all:S},_)),S}function c(f,g,_,S){var w=this._children;if(w)for(var C=w.length-1;C>=0;C--){var E=w[C],B=E!==S&&E._hitTest(f,g,_);if(B&&!g.all)return B}return null}return K.inject({hitTest:a,hitTestAll:l,_hitTest:c}),{hitTest:a,hitTestAll:l,_hitTestChildren:c}},{_hitTest:function(a,l,c){if(this._locked||!this._visible||this._guide&&!l.guides||this.isEmpty())return null;var f=this._matrix,g=c?c.appended(f):this.getGlobalMatrix().prepend(this.getView()._matrix),_=Math.max(l.tolerance,1e-12),S=l._tolerancePadding=new M(Gt._getStrokePadding(_,f._shiftless().invert()));if(a=f._inverseTransform(a),!a||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(S.multiply(2))._containsPoint(a))return null;var w=!(l.guides&&!this._guide||l.selected&&!this.isSelected()||l.type&&l.type!==n.hyphenate(this._class)||l.class&&!(this instanceof l.class)),C=l.match,E=this,B,D;function R(A){return A&&C&&!C(A)&&(A=null),A&&l.all&&l.all.push(A),A}function k(A,U){var X=U?B["get"+U]():E.getPosition();if(a.subtract(X).divide(S).length<=1)return new dt(A,E,{name:U?n.hyphenate(U):A,point:X})}var H=l.position,N=l.center,G=l.bounds;if(w&&this._parent&&(H||N||G)){if((N||G)&&(B=this.getInternalBounds()),D=H&&k("position")||N&&k("center","Center"),!D&&G)for(var L=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],O=0;O<8&&!D;O++)D=k("bounds",L[O]);D=R(D)}return D||(D=this._hitTestChildren(a,l,g)||w&&R(this._hitTestSelf(a,l,g,this.getStrokeScaling()?null:g._shiftless().invert()))||null),D&&D.point&&(D.point=f.transform(D.point)),D},_hitTestSelf:function(a,l){if(l.fill&&this.hasFill()&&this._contains(a))return new dt("fill",this)},matches:function(a,l){function c(S,w){for(var C in S)if(S.hasOwnProperty(C)){var E=S[C],B=w[C];if(n.isPlainObject(E)&&n.isPlainObject(B)){if(!c(E,B))return!1}else if(!n.equals(E,B))return!1}return!0}var f=typeof a;if(f==="object"){for(var g in a)if(a.hasOwnProperty(g)&&!this.matches(g,a[g]))return!1;return!0}else{if(f==="function")return a(this);if(a==="match")return l(this);var _=/^(empty|editable)$/.test(a)?this["is"+n.capitalize(a)]():a==="type"?n.hyphenate(this._class):this[a];if(a==="class"){if(typeof l=="function")return this instanceof l;_=this._class}if(typeof l=="function")return!!l(_);if(l){if(l.test)return l.test(_);if(n.isPlainObject(l))return c(l,_)}return n.equals(_,l)}},getItems:function(a){return T._getItems(this,a,this._matrix)},getItem:function(a){return T._getItems(this,a,this._matrix,null,!0)[0]||null},statics:{_getItems:function a(l,c,f,g,_){if(!g){var S=typeof c=="object"&&c,w=S&&S.overlapping,C=S&&S.inside,E=w||C,R=E&&q.read([E]);g={items:[],recursive:S&&S.recursive!==!1,inside:!!C,overlapping:!!w,rect:R,path:w&&new Gt.Rectangle({rectangle:R,insert:!1})},S&&(c=n.filter({},c,{recursive:!0,inside:!0,overlapping:!0}))}var B=l._children,D=g.items,R=g.rect;f=R&&(f||new I);for(var k=0,H=B&&B.length;k<H;k++){var N=B[k],G=f&&f.appended(N._matrix),L=!0;if(R){var E=N.getBounds(G);if(!R.intersects(E))continue;R.contains(E)||g.overlapping&&(E.contains(R)||g.path.intersects(N,G))||(L=!1)}if(L&&N.matches(c)&&(D.push(N),_)||(g.recursive!==!1&&a(N,c,G,g,_),_&&D.length>0))break}return D}}},{importJSON:function(a){var l=n.importJSON(a,this);return l!==this?this.addChild(l):l},addChild:function(a){return this.insertChild(e,a)},insertChild:function(a,l){var c=l?this.insertChildren(a,[l]):null;return c&&c[0]},addChildren:function(a){return this.insertChildren(this._children.length,a)},insertChildren:function(a,l){var c=this._children;if(c&&l&&l.length>0){l=n.slice(l);for(var f={},g=l.length-1;g>=0;g--){var _=l[g],S=_&&_._id;!_||f[S]?l.splice(g,1):(_._remove(!1,!0),f[S]=!0)}n.splice(c,l,a,0);for(var w=this._project,C=w._changes,g=0,E=l.length;g<E;g++){var _=l[g],B=_._name;_._parent=this,_._setProject(w,!0),B&&_.setName(B),C&&_._changed(5)}this._changed(11)}else l=null;return l},_insertItem:"#insertChild",_insertAt:function(a,l){var c=a&&a._getOwner(),f=a!==this&&c?this:null;return f&&(f._remove(!1,!0),c._insertItem(a._index+l,f)),f},insertAbove:function(a){return this._insertAt(a,1)},insertBelow:function(a){return this._insertAt(a,0)},sendToBack:function(){var a=this._getOwner();return a?a._insertItem(0,this):null},bringToFront:function(){var a=this._getOwner();return a?a._insertItem(e,this):null},appendTop:"#addChild",appendBottom:function(a){return this.insertChild(0,a)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(a){return a._insertItem(e,this)},copyTo:function(a){return this.clone(!1).addTo(a)},reduce:function(a){var l=this._children;if(l&&l.length===1){var c=l[0].reduce(a);return this._parent?(c.insertAbove(this),this.remove()):c.remove(),c}return this},_removeNamed:function(){var a=this._getOwner();if(a){var l=a._children,c=a._namedChildren,f=this._name,g=c[f],_=g?g.indexOf(this):-1;_!==-1&&(l[f]==this&&delete l[f],g.splice(_,1),g.length?l[f]=g[0]:delete c[f])}},_remove:function(a,l){var c=this._getOwner(),f=this._project,g=this._index;return this._style&&this._style._dispose(),c?(this._name&&this._removeNamed(),g!=null&&(f._activeLayer===this&&(f._activeLayer=this.getNextSibling()||this.getPreviousSibling()),n.splice(c._children,null,g,1)),this._installEvents(!1),a&&f._changes&&this._changed(5),l&&c._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(a){var l=a&&a.insertBelow(this);return l&&this.remove(),l},removeChildren:function(a,l){if(!this._children)return null;a=a||0,l=n.pick(l,this._children.length);for(var c=n.splice(this._children,null,a,l-a),f=c.length-1;f>=0;f--)c[f]._remove(!0,!1);return c.length>0&&this._changed(11),c},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var a=0,l=this._children.length;a<l;a++)this._children[a]._index=a;this._changed(11)}},isEmpty:function(a){var l=this._children,c=l?l.length:0;if(a){for(var f=0;f<c;f++)if(!l[f].isEmpty(a))return!1;return!0}return!c},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(a){function l(S){var w=[];do w.unshift(S);while(S=S._parent);return w}for(var c=l(this),f=l(a),g=0,_=Math.min(c.length,f.length);g<_;g++)if(c[g]!=f[g])return c[g]._index<f[g]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(a){return this._getOrder(a)===-1},isBelow:function(a){return this._getOrder(a)===1},isParent:function(a){return this._parent===a},isChild:function(a){return a&&a._parent===this},isDescendant:function(a){for(var l=this;l=l._parent;)if(l===a)return!0;return!1},isAncestor:function(a){return a?a.isDescendant(this):!1},isSibling:function(a){return this._parent===a._parent},isGroupedWith:function(a){for(var l=this._parent;l;){if(l._parent&&/^(Group|Layer|CompoundPath)$/.test(l._class)&&a.isDescendant(l))return!0;l=l._parent}return!1}},n.each(["rotate","scale","shear","skew"],function(a){var l=a==="rotate";this[a]=function(){var c=arguments,f=(l?n:y).read(c),g=y.read(c,0,{readNull:!0});return this.transform(new I()[a](f,g||this.getPosition(!0)))}},{translate:function(){var a=new I;return this.transform(a.translate.apply(a,arguments))},transform:function(a,l,c){var f=this._matrix,g=a&&!a.isIdentity(),_=c&&this._canApplyMatrix||this._applyMatrix&&(g||!f.isIdentity()||l&&this._children);if(!g&&!_)return this;if(g){!a.isInvertible()&&f.isInvertible()&&(f._backup=f.getValues()),f.prepend(a,!0);var S=this._style,w=S.getFillColor(!0),C=S.getStrokeColor(!0);w&&w.transform(a),C&&C.transform(a)}if(_&&(_=this._transformContent(f,l,c))){var E=this._pivot;E&&f._transformPoint(E,E,!0),f.reset(!0),c&&this._canApplyMatrix&&(this._applyMatrix=!0)}var B=this._bounds,D=this._position;(g||_)&&this._changed(25);var R=g&&B&&a.decompose();if(R&&R.skewing.isZero()&&R.rotation%90===0){for(var k in B){var H=B[k];if(H.nonscaling)delete B[k];else if(_||!H.internal){var N=H.rect;a._transformBounds(N,N)}}this._bounds=B;var G=B[this._getBoundsCacheKey(this._boundsOptions||{})];G&&(this._position=this._getPositionFromBounds(G.rect))}else g&&D&&this._pivot&&(this._position=a._transformPoint(D,D));return this},_transformContent:function(a,l,c){var f=this._children;if(f){for(var g=0,_=f.length;g<_;g++)f[g].transform(a,l,c);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(y.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(y.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(y.read(arguments))},localToParent:function(){return this._matrix._transformPoint(y.read(arguments))},fitBounds:function(a,l){a=q.read(arguments);var c=this.getBounds(),f=c.height/c.width,g=a.height/a.width,_=(l?f>g:f<g)?a.width/c.width:a.height/c.height,S=new q(new y,new M(c.width*_,c.height*_));S.setCenter(a.getCenter()),this.setBounds(S)}}),{_setStyles:function(a,l,c){var f=this._style,g=this._matrix;if(f.hasFill()&&(a.fillStyle=f.getFillColor().toCanvasStyle(a,g)),f.hasStroke()){a.strokeStyle=f.getStrokeColor().toCanvasStyle(a,g),a.lineWidth=f.getStrokeWidth();var _=f.getStrokeJoin(),S=f.getStrokeCap(),w=f.getMiterLimit();if(_&&(a.lineJoin=_),S&&(a.lineCap=S),w&&(a.miterLimit=w),be.support.nativeDash){var C=f.getDashArray(),E=f.getDashOffset();C&&C.length&&("setLineDash"in a?(a.setLineDash(C),a.lineDashOffset=E):(a.mozDash=C,a.mozDashOffset=E))}}if(f.hasShadow()){var B=l.pixelRatio||1,D=c._shiftless().prepend(new I().scale(B,B)),R=D.transform(new y(f.getShadowBlur(),0)),k=D.transform(this.getShadowOffset());a.shadowColor=f.getShadowColor().toCanvasStyle(a),a.shadowBlur=R.getLength(),a.shadowOffsetX=k.x,a.shadowOffsetY=k.y}},draw:function(a,l,c){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var f=l.matrices,g=l.viewMatrix,_=this._matrix,S=f[f.length-1].appended(_);if(S.isInvertible()){g=g?g.appended(S):S,f.push(S),l.updateMatrix&&(this._globalMatrix=S);var w=this._blendMode,C=v.clamp(this._opacity,0,1),E=w==="normal",B=Zi.nativeModes[w],D=E&&C===1||l.dontStart||l.clip||(B||E&&C<1)&&this._canComposite(),R=l.pixelRatio||1,k,H,N;if(!D){var G=this.getStrokeBounds(g);if(!G.width||!G.height){f.pop();return}N=l.offset,H=l.offset=G.getTopLeft().floor(),k=a,a=qe.getContext(G.getSize().ceil().add(1).multiply(R)),R!==1&&a.scale(R,R)}a.save();var L=c?c.appended(_):this._canScaleStroke&&!this.getStrokeScaling(!0)&&g,O=!D&&l.clipItem,A=!L||O;if(D?(a.globalAlpha=C,B&&(a.globalCompositeOperation=w)):A&&a.translate(-H.x,-H.y),A&&(D?_:g).applyToContext(a),O&&l.clipItem.draw(a,l.extend({clip:!0})),L){a.setTransform(R,0,0,R,0,0);var U=l.offset;U&&a.translate(-U.x,-U.y)}this._draw(a,l,g,L),a.restore(),f.pop(),l.clip&&!l.dontFinish&&a.clip(this.getFillRule()),D||(Zi.process(w,a,k,C,H.subtract(N).multiply(R)),qe.release(a),l.offset=N)}}},_isUpdated:function(a){var l=this._parent;if(l instanceof vt)return l._isUpdated(a);var c=this._updateVersion===a;return!c&&l&&l._visible&&l._isUpdated(a)&&(this._updateVersion=a,c=!0),c},_drawSelection:function(a,l,c,f,g){var _=this._selection,S=_&1,w=_&2||S&&this._selectBounds,C=_&4;if(this._drawSelected||(S=!1),(S||w||C)&&this._isUpdated(g)){var E,B=this.getSelectedColor(!0)||(E=this.getLayer())&&E.getSelectedColor(!0),D=l.appended(this.getGlobalMatrix(!0)),R=c/2;if(a.strokeStyle=a.fillStyle=B?B.toCanvasStyle(a):"#009dec",S&&this._drawSelected(a,D,f),C){var k=this.getPosition(!0),H=this._parent,N=H?H.localToGlobal(k):k,G=N.x,L=N.y;a.beginPath(),a.arc(G,L,R,0,Math.PI*2,!0),a.stroke();for(var O=[[0,-1],[1,0],[0,1],[-1,0]],A=R,U=c+1,X=0;X<4;X++){var $=O[X],W=$[0],Q=$[1];a.moveTo(G+W*A,L+Q*A),a.lineTo(G+W*U,L+Q*U),a.stroke()}}if(w){var et=D._transformCorners(this.getInternalBounds());a.beginPath();for(var X=0;X<8;X++)a[X?"lineTo":"moveTo"](et[X],et[++X]);a.closePath(),a.stroke();for(var X=0;X<8;X++)a.fillRect(et[X]-R,et[++X]-R,c,c)}}},_canComposite:function(){return!1}},n.each(["down","drag","up","move"],function(a){this["removeOn"+n.capitalize(a)]=function(){var l={};return l[a]=!0,this.removeOn(l)}},{removeOn:function(a){for(var l in a)if(a[l]){var c="mouse"+l,f=this._project,g=f._removeSets=f._removeSets||{};g[c]=g[c]||{},g[c][this._id]=this}return this}}),{tween:function(a,l,c){c||(c=l,l=a,a=null,c||(c=l,l=null));var f=c&&c.easing,g=c&&c.start,_=c!=null&&(typeof c=="number"?c:c.duration),S=new vr(this,a,l,_,f,g);function w(C){S._handleFrame(C.time*1e3),S.running||this.off("frame",w)}return _&&this.on("frame",w),S},tweenTo:function(a,l){return this.tween(null,a,l)},tweenFrom:function(a,l){return this.tween(a,null,l)}}),at=T.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(l){this._children=[],this._namedChildren={},this._initialize(l)||this.addChildren(Array.isArray(l)?l:arguments)},_changed:function a(l){a.base.call(this,l),l&2050&&(this._clipItem=e)},_getClipItem:function(){var a=this._clipItem;if(a===e){a=null;for(var l=this._children,c=0,f=l.length;c<f;c++)if(l[c]._clipMask){a=l[c];break}this._clipItem=a}return a},isClipped:function(){return!!this._getClipItem()},setClipped:function(a){var l=this.getFirstChild();l&&l.setClipMask(a)},_getBounds:function a(l,c){var f=this._getClipItem();return f?f._getCachedBounds(f._matrix.prepended(l),n.set({},c,{stroke:!1})):a.base.call(this,l,c)},_hitTestChildren:function a(l,c,f){var g=this._getClipItem();return(!g||g.contains(l))&&a.base.call(this,l,c,f,g)},_draw:function(a,l){var c=l.clip,f=!c&&this._getClipItem();l=l.extend({clipItem:f,clip:!1}),c?(a.beginPath(),l.dontStart=l.dontFinish=!0):f&&f.draw(a,l.extend({clip:!0}));for(var g=this._children,_=0,S=g.length;_<S;_++){var w=g[_];w!==f&&w.draw(a,l)}}}),ct=at.extend({_class:"Layer",initialize:function(){at.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function a(){return this._parent?a.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),pt=T.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(l,c){this._initialize(l,c)},_equals:function(a){return this._type===a._type&&this._size.equals(a._size)&&n.equals(this._radius,a._radius)},copyContent:function(a){this.setType(a._type),this.setSize(a._size),this.setRadius(a._radius)},getType:function(){return this._type},setType:function(a){this._type=a},getShape:"#getType",setShape:"#setType",getSize:function(){var a=this._size;return new z(a.width,a.height,this,"setSize")},setSize:function(){var a=M.read(arguments);if(!this._size)this._size=a.clone();else if(!this._size.equals(a)){var l=this._type,c=a.width,f=a.height;l==="rectangle"?this._radius.set(M.min(this._radius,a.divide(2).abs())):l==="circle"?(c=f=(c+f)/2,this._radius=c/2):l==="ellipse"&&this._radius._set(c/2,f/2),this._size._set(c,f),this._changed(9)}},getRadius:function(){var a=this._radius;return this._type==="circle"?a:new z(a.width,a.height,this,"setRadius")},setRadius:function(a){var l=this._type;if(l==="circle"){if(a===this._radius)return;var c=a*2;this._radius=a,this._size._set(c,c)}else if(a=M.read(arguments),!this._radius)this._radius=a.clone();else{if(this._radius.equals(a))return;if(this._radius.set(a),l==="rectangle"){var c=M.max(this._size,a.multiply(2));this._size.set(c)}else l==="ellipse"&&this._size._set(a.width*2,a.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(a){var l=new Gt[n.capitalize(this._type)]({center:new y,size:this._size,radius:this._radius,insert:!1});return l.copyAttributes(this),be.settings.applyMatrix&&l.setApplyMatrix(!0),(a===e||a)&&l.insertAbove(this),l},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(a,l,c,f){var g=this._style,_=g.hasFill(),S=g.hasStroke(),w=l.dontFinish||l.clip,C=!f;if(_||S||w){var E=this._type,B=this._radius,D=E==="circle";if(l.dontStart||a.beginPath(),C&&D)a.arc(0,0,B,0,Math.PI*2,!0);else{var R=D?B:B.width,k=D?B:B.height,H=this._size,N=H.width,G=H.height;if(C&&E==="rectangle"&&R===0&&k===0)a.rect(-N/2,-G/2,N,G);else{var L=N/2,O=G/2,A=1-.5522847498307936,U=R*A,X=k*A,$=[-L,-O+k,-L,-O+X,-L+U,-O,-L+R,-O,L-R,-O,L-U,-O,L,-O+X,L,-O+k,L,O-k,L,O-X,L-U,O,L-R,O,-L+R,O,-L+U,O,-L,O-X,-L,O-k];f&&f.transform($,$,32),a.moveTo($[0],$[1]),a.bezierCurveTo($[2],$[3],$[4],$[5],$[6],$[7]),L!==R&&a.lineTo($[8],$[9]),a.bezierCurveTo($[10],$[11],$[12],$[13],$[14],$[15]),O!==k&&a.lineTo($[16],$[17]),a.bezierCurveTo($[18],$[19],$[20],$[21],$[22],$[23]),L!==R&&a.lineTo($[24],$[25]),a.bezierCurveTo($[26],$[27],$[28],$[29],$[30],$[31])}}a.closePath()}!w&&(_||S)&&(this._setStyles(a,l,c),_&&(a.fill(g.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),S&&a.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(a,l){var c=new q(this._size).setCenter(0,0),f=this._style,g=l.stroke&&f.hasStroke()&&f.getStrokeWidth();return a&&(c=a._transformBounds(c)),g?c.expand(Gt._getStrokePadding(g,this._getStrokeMatrix(a,l))):c}},new function(){function a(c,f,g){var _=c._radius;if(!_.isZero())for(var S=c._size.divide(2),w=1;w<=4;w++){var C=new y(w>1&&w<4?-1:1,w>2?-1:1),E=C.multiply(S),B=E.subtract(C.multiply(_)),D=new q(g?E.add(C.multiply(g)):E,B);if(D.contains(f))return{point:B,quadrant:w}}}function l(c,f,g,_){var S=c.divide(f);return(!_||S.isInQuadrant(_))&&S.subtract(S.normalize()).multiply(f).divide(g).length<=1}return{_contains:function c(f){if(this._type==="rectangle"){var g=a(this,f);return g?f.subtract(g.point).divide(this._radius).getLength()<=1:c.base.call(this,f)}else return f.divide(this.size).getLength()<=.5},_hitTestSelf:function c(f,g,_,S){var w=!1,C=this._style,E=g.stroke&&C.hasStroke(),B=g.fill&&C.hasFill();if(E||B){var D=this._type,R=this._radius,k=E?C.getStrokeWidth()/2:0,H=g._tolerancePadding.add(Gt._getStrokePadding(k,!C.getStrokeScaling()&&S));if(D==="rectangle"){var N=H.multiply(2),G=a(this,f,N);if(G)w=l(f.subtract(G.point),R,H,G.quadrant);else{var L=new q(this._size).setCenter(0,0),O=L.expand(N),A=L.expand(N.negate());w=O._containsPoint(f)&&!A._containsPoint(f)}}else w=l(f,R,H)}return w?new dt(E?"stroke":"fill",this):c.base.apply(this,arguments)}}},{statics:new function(){function a(l,c,f,g,_){var S=n.create(pt.prototype);return S._type=l,S._size=f,S._radius=g,S._initialize(n.getNamed(_),c),S}return{Circle:function(){var l=arguments,c=y.readNamed(l,"center"),f=n.readNamed(l,"radius");return a("circle",c,new M(f*2),f,l)},Rectangle:function(){var l=arguments,c=q.readNamed(l,"rectangle"),f=M.min(M.readNamed(l,"radius"),c.getSize(!0).divide(2));return a("rectangle",c.getCenter(!0),c.getSize(!0),f,l)},Ellipse:function(){var l=arguments,c=pt._readEllipse(l),f=c.radius;return a("ellipse",c.center,f.multiply(2),f,l)},_readEllipse:function(l){var c,f;if(n.hasNamed(l,"radius"))c=y.readNamed(l,"center"),f=M.readNamed(l,"radius");else{var g=q.readNamed(l,"rectangle");c=g.getCenter(!0),f=g.getSize(!0).divide(2)}return{center:c,radius:f}}}}}),wt=T.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(l,c){if(!this._initialize(l,c!==e&&y.read(arguments))){var f,g=typeof l,_=g==="string"?s.getElementById(l):g==="object"?l:null;if(_&&_!==T.NO_INSERT){if(_.getContext||_.naturalHeight!=null)f=_;else if(_){var S=M.read(arguments);S.isZero()||(f=qe.getCanvas(S))}}f?this.setImage(f):this.setSource(l)}this._size||(this._size=new M,this._loaded=!1)},_equals:function(a){return this.getSource()===a.getSource()},copyContent:function(a){var l=a._image,c=a._canvas;if(l)this._setImage(l);else if(c){var f=qe.getCanvas(a._size);f.getContext("2d").drawImage(c,0,0),this._setImage(f)}this._crossOrigin=a._crossOrigin},getSize:function(){var a=this._size;return new z(a?a.width:0,a?a.height:0,this,"setSize")},setSize:function(a,l){var c=M.read(arguments);if(c.equals(this._size))l&&this.clear();else if(c.width>0&&c.height>0){var f=!l&&this.getElement();this._setImage(qe.getCanvas(c)),f&&this.getContext(!0).drawImage(f,0,0,c.width,c.height)}else this._canvas&&qe.release(this._canvas),this._size=c.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(a){this.setSize(a,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(a){this.setSize(this.getWidth(),a)},getLoaded:function(){return this._loaded},isEmpty:function(){var a=this._size;return!a||a.width===0&&a.height===0},getResolution:function(){var a=this._matrix,l=new y(0,0).transform(a),c=new y(1,0).transform(a).subtract(l),f=new y(0,1).transform(a).subtract(l);return new M(72/c.getLength(),72/f.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(a){var l=this;function c(f){var g=l.getView(),_=f&&f.type||"load";g&&l.responds(_)&&(be=g._scope,l.emit(_,new Ae(f)))}this._setImage(a),this._loaded?setTimeout(c,0):a&&ne.add(a,{load:function(f){l._setImage(a),c(f)},error:c})},_setImage:function(a){this._canvas&&qe.release(this._canvas),a&&a.getContext?(this._image=null,this._canvas=a,this._loaded=!0):(this._image=a,this._canvas=null,this._loaded=!!(a&&a.src&&a.complete)),this._size=new M(a?a.naturalWidth||a.width:0,a?a.naturalHeight||a.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var a=qe.getContext(this._size);try{this._image&&a.drawImage(this._image,0,0),this._canvas=a.canvas}catch{qe.release(a)}}return this._canvas},setCanvas:"#setImage",getContext:function(a){return this._context||(this._context=this.getCanvas().getContext("2d")),a&&(this._image=null,this._changed(1025)),this._context},setContext:function(a){this._context=a},getSource:function(){var a=this._image;return a&&a.src||this.toDataURL()},setSource:function(a){var l=new t.Image,c=this._crossOrigin;c&&(l.crossOrigin=c),a&&(l.src=a),this.setImage(l)},getCrossOrigin:function(){var a=this._image;return a&&a.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(a){this._crossOrigin=a;var l=this._image;l&&(l.crossOrigin=a)},getSmoothing:function(){return this._smoothing},setSmoothing:function(a){this._smoothing=typeof a=="string"?a:a?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var a=q.read(arguments),l=qe.getContext(a.getSize());return l.drawImage(this.getCanvas(),a.x,a.y,a.width,a.height,0,0,a.width,a.height),l.canvas},getSubRaster:function(){var a=q.read(arguments),l=new wt(T.NO_INSERT);return l._setImage(this.getSubCanvas(a)),l.translate(a.getCenter().subtract(this.getSize().divide(2))),l._matrix.prepend(this._matrix),l.insertAbove(this),l},toDataURL:function(){var a=this._image,l=a&&a.src;if(/^data:/.test(l))return l;var c=this.getCanvas();return c?c.toDataURL.apply(c,arguments):null},drawImage:function(a){var l=y.read(arguments,1);this.getContext(!0).drawImage(a,l.x,l.y)},getAverageColor:function(a){var l,c;if(a?a instanceof kt?(c=a,l=a.getBounds()):typeof a=="object"&&("width"in a?l=new q(a):"x"in a&&(l=new q(a.x-.5,a.y-.5,1,1))):l=this.getBounds(),!l)return null;var f=32,g=Math.min(l.width,f),_=Math.min(l.height,f),S=wt._sampleContext;S?S.clearRect(0,0,f+1,f+1):S=wt._sampleContext=qe.getContext(new M(f)),S.save();var w=new I().scale(g/l.width,_/l.height).translate(-l.x,-l.y);w.applyToContext(S),c&&c.draw(S,new n({clip:!0,matrices:[w]})),this._matrix.applyToContext(S);var C=this.getElement(),E=this._size;C&&S.drawImage(C,-E.width/2,-E.height/2),S.restore();for(var B=S.getImageData(.5,.5,Math.ceil(g),Math.ceil(_)).data,D=[0,0,0],R=0,k=0,H=B.length;k<H;k+=4){var N=B[k+3];R+=N,N/=255,D[0]+=B[k]*N,D[1]+=B[k+1]*N,D[2]+=B[k+2]*N}for(var k=0;k<3;k++)D[k]/=R;return R?ee.read(D):null},getPixel:function(){var a=y.read(arguments),l=this.getContext().getImageData(a.x,a.y,1,1).data;return new ee("rgb",[l[0]/255,l[1]/255,l[2]/255],l[3]/255)},setPixel:function(){var a=arguments,l=y.read(a),c=ee.read(a),f=c._convert("rgb"),g=c._alpha,_=this.getContext(!0),S=_.createImageData(1,1),w=S.data;w[0]=f[0]*255,w[1]=f[1]*255,w[2]=f[2]*255,w[3]=g!=null?g*255:255,_.putImageData(S,l.x,l.y)},clear:function(){var a=this._size;this.getContext(!0).clearRect(0,0,a.width+1,a.height+1)},createImageData:function(){var a=M.read(arguments);return this.getContext().createImageData(a.width,a.height)},getImageData:function(){var a=q.read(arguments);return a.isEmpty()&&(a=new q(this._size)),this.getContext().getImageData(a.x,a.y,a.width,a.height)},putImageData:function(a){var l=y.read(arguments,1);this.getContext(!0).putImageData(a,l.x,l.y)},setImageData:function(a){this.setSize(a),this.getContext(!0).putImageData(a,0,0)},_getBounds:function(a,l){var c=new q(this._size).setCenter(0,0);return a?a._transformBounds(c):c},_hitTestSelf:function(a){if(this._contains(a)){var l=this;return new dt("pixel",l,{offset:a.add(l._size.divide(2)).round(),color:{get:function(){return l.getPixel(this.offset)}}})}},_draw:function(a,l,c){var f=this.getElement();if(f&&f.width>0&&f.height>0){a.globalAlpha=v.clamp(this._opacity,0,1),this._setStyles(a,l,c);var g=this._smoothing,_=g==="off";se.setPrefixed(a,_?"imageSmoothingEnabled":"imageSmoothingQuality",_?!1:g),a.drawImage(f,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),It=T.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(l,c){this._initialize(l,c!==e&&y.read(arguments,1))||this.setDefinition(l instanceof bt?l:new bt(l))},_equals:function(a){return this._definition===a._definition},copyContent:function(a){this.setDefinition(a._definition)},getDefinition:function(){return this._definition},setDefinition:function(a){this._definition=a,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(a,l){var c=this._definition._item;return c._getCachedBounds(c._matrix.prepended(a),l)},_hitTestSelf:function(a,l,c){var f=l.extend({all:!1}),g=this._definition._item._hitTest(a,f,c);return g&&(g.item=this),g},_draw:function(a,l){this._definition._item.draw(a,l)}}),bt=n.extend({_class:"SymbolDefinition",initialize:function(l,c){this._id=b.get(),this.project=be.project,l&&this.setItem(l,c)},_serialize:function(a,l){return l.add(this,function(){return n.serialize([this._class,this._item],a,!1,l)})},_changed:function(a){a&8&&T._clearBoundsCache(this),a&1&&this.project._changed(a)},getItem:function(){return this._item},setItem:function(a,l){a._symbol&&(a=a.clone()),this._item&&(this._item._symbol=null),this._item=a,a.remove(),a.setSelected(!1),l||a.setPosition(new y),a._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(a){return new It(this,a)},clone:function(){return new bt(this._item.clone(!1))},equals:function(a){return a===this||a&&this._item.equals(a._item)||!1}}),dt=n.extend({_class:"HitResult",initialize:function(l,c,f){this.type=l,this.item=c,f&&this.inject(f)},statics:{getOptions:function(a){var l=a&&n.read(a);return new n({type:null,tolerance:be.settings.hitTolerance,fill:!l,stroke:!l,segments:!l,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},l)}}}),ht=n.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(l,c,f,g,_,S){var w=arguments.length,C,E,B,D;w>0&&(l==null||typeof l=="object"?w===1&&l&&"point"in l?(C=l.point,E=l.handleIn,B=l.handleOut,D=l.selection):(C=l,E=c,B=f,D=g):(C=[l,c],E=f!==e?[f,g]:null,B=_!==e?[_,S]:null)),new Mt(C,this,"_point"),new Mt(E,this,"_handleIn"),new Mt(B,this,"_handleOut"),D&&this.setSelection(D)},_serialize:function(a,l){var c=this._point,f=this._selection,g=f||this.hasHandles()?[c,this._handleIn,this._handleOut]:c;return f&&g.push(f),n.serialize(g,a,!0,l)},_changed:function(a){var l=this._path;if(l){var c=l._curves,f=this._index,g;c&&((!a||a===this._point||a===this._handleIn)&&(g=f>0?c[f-1]:l._closed?c[c.length-1]:null)&&g._changed(),(!a||a===this._point||a===this._handleOut)&&(g=c[f])&&g._changed()),l._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(y.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(y.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(y.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var a=this._handleIn,l=this._handleOut;return!a.isZero()&&!l.isZero()&&a.isCollinear(l)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(a){var l=this._selection,c=this._path;this._selection=a=a||0,c&&a!==l&&(c._updateSelection(this,l,a),c._changed(257))},_changeSelection:function(a,l){var c=this._selection;this.setSelection(l?c|a:c&~a)},isSelected:function(){return!!(this._selection&7)},setSelected:function(a){this._changeSelection(7,a)},getIndex:function(){return this._index!==e?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var a=this._path,l=this._index;return a?(l>0&&!a._closed&&l===a._segments.length-1&&l--,a.getCurves()[l]||null):null},getLocation:function(){var a=this.getCurve();return a?new Rt(a,this===a._segment1?0:1):null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&a[0])||null},smooth:function(a,l,c){var f=a||{},g=f.type,_=f.factor,S=this.getPrevious(),w=this.getNext(),C=(S||this)._point,E=this._point,B=(w||this)._point,D=C.getDistance(E),R=E.getDistance(B);if(!g||g==="catmull-rom"){var k=_===e?.5:_,H=Math.pow(D,k),N=H*H,G=Math.pow(R,k),L=G*G;if(!l&&S){var O=2*L+3*G*H+N,A=3*G*(G+H);this.setHandleIn(A!==0?new y((L*C._x+O*E._x-N*B._x)/A-E._x,(L*C._y+O*E._y-N*B._y)/A-E._y):new y)}if(!c&&w){var O=2*N+3*H*G+L,A=3*H*(H+G);this.setHandleOut(A!==0?new y((N*B._x+O*E._x-L*C._x)/A-E._x,(N*B._y+O*E._y-L*C._y)/A-E._y):new y)}}else if(g==="geometric"){if(S&&w){var U=C.subtract(B),X=_===e?.4:_,$=X*D/(D+R);l||this.setHandleIn(U.multiply($)),c||this.setHandleOut(U.multiply($-X))}}else throw new Error("Smoothing method '"+g+"' not supported.")},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&a[a.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var a=this._path;return a&&this._index===a._segments.length-1||!1},reverse:function(){var a=this._handleIn,l=this._handleOut,c=a.clone();a.set(l),l.set(c)},reversed:function(){return new ht(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new ht(this._point,this._handleIn,this._handleOut)},equals:function(a){return a===this||a&&this._class===a._class&&this._point.equals(a._point)&&this._handleIn.equals(a._handleIn)&&this._handleOut.equals(a._handleOut)||!1},toString:function(){var a=["point: "+this._point];return this._handleIn.isZero()||a.push("handleIn: "+this._handleIn),this._handleOut.isZero()||a.push("handleOut: "+this._handleOut),"{ "+a.join(", ")+" }"},transform:function(a){this._transformCoordinates(a,new Array(6),!0),this._changed()},interpolate:function(a,l,c){var f=1-c,g=c,_=a._point,S=l._point,w=a._handleIn,C=l._handleIn,E=l._handleOut,B=a._handleOut;this._point._set(f*_._x+g*S._x,f*_._y+g*S._y,!0),this._handleIn._set(f*w._x+g*C._x,f*w._y+g*C._y,!0),this._handleOut._set(f*B._x+g*E._x,f*B._y+g*E._y,!0),this._changed()},_transformCoordinates:function(a,l,c){var f=this._point,g=!c||!this._handleIn.isZero()?this._handleIn:null,_=!c||!this._handleOut.isZero()?this._handleOut:null,S=f._x,w=f._y,C=2;return l[0]=S,l[1]=w,g&&(l[C++]=g._x+S,l[C++]=g._y+w),_&&(l[C++]=_._x+S,l[C++]=_._y+w),a&&(a._transformCoordinates(l,l,C/2),S=l[0],w=l[1],c?(f._x=S,f._y=w,C=2,g&&(g._x=l[C++]-S,g._y=l[C++]-w),_&&(_._x=l[C++]-S,_._y=l[C++]-w)):(g||(l[C++]=S,l[C++]=w),_||(l[C++]=S,l[C++]=w))),l}}),Mt=y.extend({initialize:function(l,c,f){var g,_,S;if(!l)g=_=0;else if((g=l[0])!==e)_=l[1];else{var w=l;(g=w.x)===e&&(w=y.read(arguments),g=w.x),_=w.y,S=w.selected}this._x=g,this._y=_,this._owner=c,c[f]=this,S&&this.setSelected(!0)},_set:function(a,l){return this._x=a,this._y=l,this._owner._changed(this),this},getX:function(){return this._x},setX:function(a){this._x=a,this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a,this._owner._changed(this)},isZero:function(){var a=v.isZero;return a(this._x)&&a(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(a){this._owner._changeSelection(this._getSelection(),a)},_getSelection:function(){var a=this._owner;return this===a._point?1:this===a._handleIn?2:this===a._handleOut?4:0}}),_t=n.extend({_class:"Curve",beans:!0,initialize:function(l,c,f,g,_,S,w,C){var E=arguments.length,B,D,R,k,H,N;E===3?(this._path=l,B=c,D=f):E?E===1?"segment1"in l?(B=new ht(l.segment1),D=new ht(l.segment2)):"point1"in l?(R=l.point1,H=l.handle1,N=l.handle2,k=l.point2):Array.isArray(l)&&(R=[l[0],l[1]],k=[l[6],l[7]],H=[l[2]-l[0],l[3]-l[1]],N=[l[4]-l[6],l[5]-l[7]]):E===2?(B=new ht(l),D=new ht(c)):E===4?(R=l,H=c,N=f,k=g):E===8&&(R=[l,c],k=[w,C],H=[f-l,g-c],N=[_-w,S-C]):(B=new ht,D=new ht),this._segment1=B||new ht(R,null,H),this._segment2=D||new ht(k,N,null)},_serialize:function(a,l){return n.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],a,!0,l)},_changed:function(){this._length=this._bounds=e},clone:function(){return new _t(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||a.push("handle2: "+this._segment2._handleIn),a.push("point2: "+this._segment2._point),"{ "+a.join(", ")+" }"},classify:function(){return _t.classify(this.getValues())},remove:function(){var a=!1;if(this._path){var l=this._segment2,c=l._handleOut;a=l.remove(),a&&this._segment1._handleOut.set(c)}return a},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(y.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(y.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(y.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(y.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&a[a.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var a=this._path;return a&&this._segment1._index===a._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(a){this.getPoint1().setSelected(a),this.getHandle1().setSelected(a),this.getHandle2().setSelected(a),this.getPoint2().setSelected(a)},getValues:function(a){return _t.getValues(this._segment1,this._segment2,a)},getPoints:function(){for(var a=this.getValues(),l=[],c=0;c<8;c+=2)l.push(new y(a[c],a[c+1]));return l}},{getLength:function(){return this._length==null&&(this._length=_t.getLength(this.getValues(),0,1)),this._length},getArea:function(){return _t.getArea(this.getValues())},getLine:function(){return new Y(this._segment1._point,this._segment2._point)},getPart:function(a,l){return new _t(_t.getPart(this.getValues(),a,l))},getPartLength:function(a,l){return _t.getLength(this.getValues(),a,l)},divideAt:function(a){return this.divideAtTime(a&&a.curve===this?a.time:this.getTimeAt(a))},divideAtTime:function(a,l){var c=1e-8,f=1-c,g=null;if(a>=c&&a<=f){var _=_t.subdivide(this.getValues(),a),S=_[0],w=_[1],C=l||this.hasHandles(),E=this._segment1,B=this._segment2,D=this._path;C&&(E._handleOut._set(S[2]-S[0],S[3]-S[1]),B._handleIn._set(w[4]-w[6],w[5]-w[7]));var R=S[6],k=S[7],H=new ht(new y(R,k),C&&new y(S[4]-R,S[5]-k),C&&new y(w[2]-R,w[3]-k));D?(D.insert(E._index+1,H),g=this.getNext()):(this._segment2=H,this._changed(),g=new _t(H,B))}return g},splitAt:function(a){var l=this._path;return l?l.splitAt(a):null},splitAtTime:function(a){return this.splitAt(this.getLocationAtTime(a))},divide:function(a,l){return this.divideAtTime(a===e?.5:l?a:this.getTimeAt(a))},split:function(a,l){return this.splitAtTime(a===e?.5:l?a:this.getTimeAt(a))},reversed:function(){return new _t(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(a,l,c,f){var g=a._point,_=a._handleOut,S=l._handleIn,w=l._point,C=g.x,E=g.y,B=w.x,D=w.y,R=f?[C,E,C,E,B,D,B,D]:[C,E,C+_._x,E+_._y,B+S._x,D+S._y,B,D];return c&&c._transformCoordinates(R,R,4),R},subdivide:function(a,l){var c=a[0],f=a[1],g=a[2],_=a[3],S=a[4],w=a[5],C=a[6],E=a[7];l===e&&(l=.5);var B=1-l,D=B*c+l*g,R=B*f+l*_,k=B*g+l*S,H=B*_+l*w,N=B*S+l*C,G=B*w+l*E,L=B*D+l*k,O=B*R+l*H,A=B*k+l*N,U=B*H+l*G,X=B*L+l*A,$=B*O+l*U;return[[c,f,D,R,L,O,X,$],[X,$,A,U,N,G,C,E]]},getMonoCurves:function(a,l){var c=[],f=l?0:1,g=a[f+0],_=a[f+2],S=a[f+4],w=a[f+6];if(g>=_==_>=S&&_>=S==S>=w||_t.isStraight(a))c.push(a);else{var C=3*(_-S)-g+w,E=2*(g+S)-4*_,B=_-g,D=1e-8,R=1-D,k=[],H=v.solveQuadratic(C,E,B,k,D,R);if(!H)c.push(a);else{k.sort();var N=k[0],G=_t.subdivide(a,N);c.push(G[0]),H>1&&(N=(k[1]-N)/(1-N),G=_t.subdivide(G[1],N),c.push(G[0])),c.push(G[1])}}return c},solveCubic:function(a,l,c,f,g,_){var S=a[l],w=a[l+2],C=a[l+4],E=a[l+6],B=0;if(!(S<c&&E<c&&w<c&&C<c||S>c&&E>c&&w>c&&C>c)){var D=3*(w-S),R=3*(C-w)-D,k=E-S-D-R;B=v.solveCubic(k,R,D,S-c,f,g,_)}return B},getTimeOf:function(a,l){var c=new y(a[0],a[1]),f=new y(a[6],a[7]),g=1e-12,_=1e-7,S=l.isClose(c,g)?0:l.isClose(f,g)?1:null;if(S===null)for(var w=[l.x,l.y],C=[],E=0;E<2;E++)for(var B=_t.solveCubic(a,E,w[E],C,0,1),D=0;D<B;D++){var R=C[D];if(l.isClose(_t.getPoint(a,R),_))return R}return l.isClose(c,_)?0:l.isClose(f,_)?1:null},getNearestTime:function(a,l){if(_t.isStraight(a)){var c=a[0],f=a[1],g=a[6],_=a[7],S=g-c,w=_-f,C=S*S+w*w;if(C===0)return 0;var E=((l.x-c)*S+(l.y-f)*w)/C;return E<1e-12?0:E>.999999999999?1:_t.getTimeOf(a,new y(c+E*S,f+E*w))}var B=100,D=1/0,R=0;function k(G){if(G>=0&&G<=1){var L=l.getDistance(_t.getPoint(a,G),!0);if(L<D)return D=L,R=G,!0}}for(var H=0;H<=B;H++)k(H/B);for(var N=1/(B*2);N>1e-8;)!k(R-N)&&!k(R+N)&&(N/=2);return R},getPart:function(a,l,c){var f=l>c;if(f){var g=l;l=c,c=g}return l>0&&(a=_t.subdivide(a,l)[1]),c<1&&(a=_t.subdivide(a,(c-l)/(1-l))[0]),f?[a[6],a[7],a[4],a[5],a[2],a[3],a[0],a[1]]:a},isFlatEnough:function(a,l){var c=a[0],f=a[1],g=a[2],_=a[3],S=a[4],w=a[5],C=a[6],E=a[7],B=3*g-2*c-C,D=3*_-2*f-E,R=3*S-2*C-c,k=3*w-2*E-f;return Math.max(B*B,R*R)+Math.max(D*D,k*k)<=16*l*l},getArea:function(a){var l=a[0],c=a[1],f=a[2],g=a[3],_=a[4],S=a[5],w=a[6],C=a[7];return 3*((C-c)*(f+_)-(w-l)*(g+S)+g*(l-_)-f*(c-S)+C*(_+l/3)-w*(S+c/3))/20},getBounds:function(a){for(var l=a.slice(0,2),c=l.slice(),f=[0,0],g=0;g<2;g++)_t._addBounds(a[g],a[g+2],a[g+4],a[g+6],g,0,l,c,f);return new q(l[0],l[1],c[0]-l[0],c[1]-l[1])},_addBounds:function(a,l,c,f,g,_,S,w,C){function E(X,$){var W=X-$,Q=X+$;W<S[g]&&(S[g]=W),Q>w[g]&&(w[g]=Q)}_/=2;var B=S[g]+_,D=w[g]-_;if(a<B||l<B||c<B||f<B||a>D||l>D||c>D||f>D)if(l<a!=l<f&&c<a!=c<f)E(a,0),E(f,0);else{var R=3*(l-c)-a+f,k=2*(a+c)-4*l,H=l-a,N=v.solveQuadratic(R,k,H,C),G=1e-8,L=1-G;E(f,0);for(var O=0;O<N;O++){var A=C[O],U=1-A;G<=A&&A<=L&&E(U*U*U*a+3*U*U*A*l+3*U*A*A*c+A*A*A*f,_)}}}}},n.each(["getBounds","getStrokeBounds","getHandleBounds"],function(a){this[a]=function(){this._bounds||(this._bounds={});var l=this._bounds[a];return l||(l=this._bounds[a]=Gt[a]([this._segment1,this._segment2],!1,this._path)),l.clone()}},{}),n.each({isStraight:function(a,l,c,f){if(l.isZero()&&c.isZero())return!0;var g=f.subtract(a);if(g.isZero())return!1;if(g.isCollinear(l)&&g.isCollinear(c)){var _=new Y(a,f),S=1e-7;if(_.getDistance(a.add(l))<S&&_.getDistance(f.add(c))<S){var w=g.dot(g),C=g.dot(l)/w,E=g.dot(c)/w;return C>=0&&C<=1&&E<=0&&E>=-1}}return!1},isLinear:function(a,l,c,f){var g=f.subtract(a).divide(3);return l.equals(g)&&c.negate().equals(g)}},function(a,l){this[l]=function(c){var f=this._segment1,g=this._segment2;return a(f._point,f._handleOut,g._handleIn,g._point,c)},this.statics[l]=function(c,f){var g=c[0],_=c[1],S=c[6],w=c[7];return a(new y(g,_),new y(c[2]-g,c[3]-_),new y(c[4]-S,c[5]-w),new y(S,w),f)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(a){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(a||0)},isCollinear:function(a){return a&&this.isStraight()&&a.isStraight()&&this.getLine().isCollinear(a.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(a,l){return this.getLocationAtTime(l?a:this.getTimeAt(a))},getLocationAtTime:function(a){return a!=null&&a>=0&&a<=1?new Rt(this,a):null},getTimeAt:function(a,l){return _t.getTimeAt(this.getValues(),a,l)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var a=y.read(arguments);return a.isZero()?[]:_t.getTimesWithTangent(this.getValues(),a)},getOffsetAtTime:function(a){return this.getPartLength(0,a)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(y.read(arguments)))},getOffsetOf:function(){var a=this.getLocationOf.apply(this,arguments);return a?a.getOffset():null},getTimeOf:function(){return _t.getTimeOf(this.getValues(),y.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var a=y.read(arguments),l=this.getValues(),c=_t.getNearestTime(l,a),f=_t.getPoint(l,c);return new Rt(this,c,f,null,a.getDistance(f))},getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a&&a.getPoint()}},new function(){var a=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return n.each(a,function(l){this[l+"At"]=function(c,f){var g=this.getValues();return _t[l](g,f?c:_t.getTimeAt(g,c))},this[l+"AtTime"]=function(c){return _t[l](this.getValues(),c)}},{statics:{_evaluateMethods:a}})},new function(){function a(f){var g=f[0],_=f[1],S=f[2],w=f[3],C=f[4],E=f[5],B=f[6],D=f[7],R=9*(S-C)+3*(B-g),k=6*(g+C)-12*S,H=3*(S-g),N=9*(w-E)+3*(D-_),G=6*(_+E)-12*w,L=3*(w-_);return function(O){var A=(R*O+k)*O+H,U=(N*O+G)*O+L;return Math.sqrt(A*A+U*U)}}function l(f,g){return Math.max(2,Math.min(16,Math.ceil(Math.abs(g-f)*32)))}function c(f,g,_,S){if(g==null||g<0||g>1)return null;var w=f[0],C=f[1],E=f[2],B=f[3],D=f[4],R=f[5],k=f[6],H=f[7],N=v.isZero;N(E-w)&&N(B-C)&&(E=w,B=C),N(D-k)&&N(R-H)&&(D=k,R=H);var G=3*(E-w),L=3*(D-E)-G,O=k-w-G-L,A=3*(B-C),U=3*(R-B)-A,X=H-C-A-U,$,W;if(_===0)$=g===0?w:g===1?k:((O*g+L)*g+G)*g+w,W=g===0?C:g===1?H:((X*g+U)*g+A)*g+C;else{var Q=1e-8,et=1-Q;if(g<Q?($=G,W=A):g>et?($=3*(k-D),W=3*(H-R)):($=(3*O*g+2*L)*g+G,W=(3*X*g+2*U)*g+A),S){$===0&&W===0&&(g<Q||g>et)&&($=D-E,W=R-B);var rt=Math.sqrt($*$+W*W);rt&&($/=rt,W/=rt)}if(_===3){var D=6*O*g+2*L,R=6*X*g+2*U,ot=Math.pow($*$+W*W,3/2);$=ot!==0?($*R-W*D)/ot:0,W=0}}return _===2?new y(W,-$):new y($,W)}return{statics:{classify:function(f){var g=f[0],_=f[1],S=f[2],w=f[3],C=f[4],E=f[5],B=f[6],D=f[7],R=g*(D-E)+_*(C-B)+B*E-D*C,k=S*(_-D)+w*(B-g)+g*D-_*B,H=C*(w-_)+E*(g-S)+S*_-w*g,N=3*H,G=N-k,L=G-k+R,O=Math.sqrt(L*L+G*G+N*N),A=O!==0?1/O:0,U=v.isZero,X="serpentine";L*=A,G*=A,N*=A;function $(rt,ot,J){var nt=ot!==e,lt=nt&&ot>0&&ot<1,ft=nt&&J>0&&J<1;return nt&&(!(lt||ft)||rt==="loop"&&!(lt&&ft))&&(rt="arch",lt=ft=!1),{type:rt,roots:lt||ft?lt&&ft?ot<J?[ot,J]:[J,ot]:[lt?ot:J]:null}}if(U(L))return U(G)?$(U(N)?"line":"quadratic"):$(X,N/(3*G));var W=3*G*G-4*L*N;if(U(W))return $("cusp",G/(2*L));var Q=W>0?Math.sqrt(W/3):Math.sqrt(-W),et=2*L;return $(W>0?X:"loop",(G+Q)/et,(G-Q)/et)},getLength:function(f,g,_,S){if(g===e&&(g=0),_===e&&(_=1),_t.isStraight(f)){var w=f;_<1&&(w=_t.subdivide(w,_)[0],g/=_),g>0&&(w=_t.subdivide(w,g)[1]);var C=w[6]-w[0],E=w[7]-w[1];return Math.sqrt(C*C+E*E)}return v.integrate(S||a(f),g,_,l(g,_))},getTimeAt:function(f,g,_){if(_===e&&(_=g<0?1:0),g===0)return _;var S=Math.abs,w=1e-12,C=g>0,E=C?_:0,B=C?1:_,D=a(f),R=_t.getLength(f,E,B,D),k=S(g)-R;if(S(k)<w)return C?B:E;if(k>w)return null;var H=g/R,N=0;function G(L){return N+=v.integrate(D,_,L,l(_,L)),_=L,N-g}return v.findRoot(G,D,_+H,E,B,32,1e-12)},getPoint:function(f,g){return c(f,g,0,!1)},getTangent:function(f,g){return c(f,g,1,!0)},getWeightedTangent:function(f,g){return c(f,g,1,!1)},getNormal:function(f,g){return c(f,g,2,!0)},getWeightedNormal:function(f,g){return c(f,g,2,!1)},getCurvature:function(f,g){return c(f,g,3,!1).x},getPeaks:function(f){var g=f[0],_=f[1],S=f[2],w=f[3],C=f[4],E=f[5],B=f[6],D=f[7],R=-g+3*S-3*C+B,k=3*g-6*S+3*C,H=-3*g+3*S,N=-_+3*w-3*E+D,G=3*_-6*w+3*E,L=-3*_+3*w,O=1e-8,A=1-O,U=[];return v.solveCubic(9*(R*R+N*N),9*(R*k+G*N),2*(k*k+G*G)+3*(H*R+L*N),H*k+G*L,U,O,A),U.sort()}}}},new function(){function a(k,H,N,G,L,O,A){var U=!A&&N.getPrevious()===L,X=!A&&N!==L&&N.getNext()===L,$=1e-8,W=1-$;if(G!==null&&G>=(U?$:0)&&G<=(X?W:1)&&O!==null&&O>=(X?$:0)&&O<=(U?W:1)){var Q=new Rt(N,G,null,A),et=new Rt(L,O,null,A);Q._intersection=et,et._intersection=Q,(!H||H(Q))&&Rt.insert(k,Q,!0)}}function l(k,H,N,G,L,O,A,U,X,$,W,Q,et){if(++X>=4096||++U>=40)return X;var rt=1e-9,ot=H[0],J=H[1],nt=H[6],lt=H[7],ft=Y.getSignedDistance,gt=ft(ot,J,nt,lt,H[2],H[3]),yt=ft(ot,J,nt,lt,H[4],H[5]),At=gt*yt>0?3/4:4/9,Bt=At*Math.min(0,gt,yt),Ot=At*Math.max(0,gt,yt),Wt=ft(ot,J,nt,lt,k[0],k[1]),Ct=ft(ot,J,nt,lt,k[2],k[3]),Et=ft(ot,J,nt,lt,k[4],k[5]),Nt=ft(ot,J,nt,lt,k[6],k[7]),jt=c(Wt,Ct,Et,Nt),$t=jt[0],ue=jt[1],he,pe;if(gt===0&&yt===0&&Wt===0&&Ct===0&&Et===0&&Nt===0||(he=f($t,ue,Bt,Ot))==null||(pe=f($t.reverse(),ue.reverse(),Bt,Ot))==null)return X;var me=$+(W-$)*he,ce=$+(W-$)*pe;if(Math.max(et-Q,ce-me)<rt){var _i=(me+ce)/2,zt=(Q+et)/2;a(L,O,A?G:N,A?zt:_i,A?N:G,A?_i:zt)}else{k=_t.getPart(k,he,pe);var He=et-Q;if(pe-he>.8)if(ce-me>He){var ti=_t.subdivide(k,.5),_i=(me+ce)/2;X=l(H,ti[0],G,N,L,O,!A,U,X,Q,et,me,_i),X=l(H,ti[1],G,N,L,O,!A,U,X,Q,et,_i,ce)}else{var ti=_t.subdivide(H,.5),zt=(Q+et)/2;X=l(ti[0],k,G,N,L,O,!A,U,X,Q,zt,me,ce),X=l(ti[1],k,G,N,L,O,!A,U,X,zt,et,me,ce)}else He===0||He>=rt?X=l(H,k,G,N,L,O,!A,U,X,Q,et,me,ce):X=l(k,H,N,G,L,O,A,U,X,me,ce,Q,et)}return X}function c(k,H,N,G){var L=[0,k],O=[1/3,H],A=[2/3,N],U=[1,G],X=H-(2*k+G)/3,$=N-(k+2*G)/3,W;if(X*$<0)W=[[L,O,U],[L,A,U]];else{var Q=X/$;W=[Q>=2?[L,O,U]:Q<=.5?[L,A,U]:[L,O,A,U],[L,U]]}return(X||$)<0?W.reverse():W}function f(k,H,N,G){return k[0][1]<N?g(k,!0,N):H[0][1]>G?g(H,!1,G):k[0][0]}function g(k,H,N){for(var G=k[0][0],L=k[0][1],O=1,A=k.length;O<A;O++){var U=k[O][0],X=k[O][1];if(H?X>=N:X<=N)return X===N?U:G+(N-L)*(U-G)/(X-L);G=U,L=X}return null}function _(k,H,N,G,L){var O=v.isZero;if(O(G)&&O(L)){var A=_t.getTimeOf(k,new y(H,N));return A===null?[]:[A]}for(var U=Math.atan2(-L,G),X=Math.sin(U),$=Math.cos(U),W=[],Q=[],et=0;et<8;et+=2){var rt=k[et]-H,ot=k[et+1]-N;W.push(rt*$-ot*X,rt*X+ot*$)}return _t.solveCubic(W,1,0,Q,0,1),Q}function S(k,H,N,G,L,O,A){for(var U=H[0],X=H[1],$=H[6],W=H[7],Q=_(k,U,X,$-U,W-X),et=0,rt=Q.length;et<rt;et++){var ot=Q[et],J=_t.getPoint(k,ot),nt=_t.getTimeOf(H,J);nt!==null&&a(L,O,A?G:N,A?nt:ot,A?N:G,A?ot:nt)}}function w(k,H,N,G,L,O){var A=Y.intersect(k[0],k[1],k[6],k[7],H[0],H[1],H[6],H[7]);A&&a(L,O,N,_t.getTimeOf(k,A),G,_t.getTimeOf(H,A))}function C(k,H,N,G,L,O){var A=1e-12,U=Math.min,X=Math.max;if(X(k[0],k[2],k[4],k[6])+A>U(H[0],H[2],H[4],H[6])&&U(k[0],k[2],k[4],k[6])-A<X(H[0],H[2],H[4],H[6])&&X(k[1],k[3],k[5],k[7])+A>U(H[1],H[3],H[5],H[7])&&U(k[1],k[3],k[5],k[7])-A<X(H[1],H[3],H[5],H[7])){var $=D(k,H);if($)for(var W=0;W<2;W++){var Q=$[W];a(L,O,N,Q[0],G,Q[1],!0)}else{var et=_t.isStraight(k),rt=_t.isStraight(H),ot=et&&rt,J=et&&!rt,nt=L.length;if((ot?w:et||rt?S:l)(J?H:k,J?k:H,J?G:N,J?N:G,L,O,J,0,0,0,1,0,1),!ot||L.length===nt)for(var W=0;W<4;W++){var lt=W>>1,ft=W&1,gt=lt*6,yt=ft*6,At=new y(k[gt],k[gt+1]),Bt=new y(H[yt],H[yt+1]);At.isClose(Bt,A)&&a(L,O,N,lt,G,ft)}}}return L}function E(k,H,N,G){var L=_t.classify(k);if(L.type==="loop"){var O=L.roots;a(N,G,H,O[0],H,O[1])}return N}function B(k,H,N,G,L,O){var A=1e-7,U=!H;U&&(H=k);for(var X=k.length,$=H.length,W=new Array(X),Q=U?W:new Array($),et=[],rt=0;rt<X;rt++)W[rt]=k[rt].getValues(G);if(!U)for(var rt=0;rt<$;rt++)Q[rt]=H[rt].getValues(L);for(var ot=p.findCurveBoundsCollisions(W,Q,A),J=0;J<X;J++){var nt=k[J],lt=W[J];U&&E(lt,nt,et,N);var ft=ot[J];if(ft)for(var gt=0;gt<ft.length;gt++){if(O&&et.length)return et;var yt=ft[gt];if(!U||yt>J){var At=H[yt],Bt=Q[yt];C(lt,Bt,nt,At,et,N)}}}return et}function D(k,H){function N(Nt){var jt=Nt[6]-Nt[0],$t=Nt[7]-Nt[1];return jt*jt+$t*$t}var G=Math.abs,L=Y.getDistance,O=1e-8,A=1e-7,U=_t.isStraight(k),X=_t.isStraight(H),$=U&&X,W=N(k)<N(H),Q=W?H:k,et=W?k:H,rt=Q[0],ot=Q[1],J=Q[6]-rt,nt=Q[7]-ot;if(L(rt,ot,J,nt,et[0],et[1],!0)<A&&L(rt,ot,J,nt,et[6],et[7],!0)<A)!$&&L(rt,ot,J,nt,Q[2],Q[3],!0)<A&&L(rt,ot,J,nt,Q[4],Q[5],!0)<A&&L(rt,ot,J,nt,et[2],et[3],!0)<A&&L(rt,ot,J,nt,et[4],et[5],!0)<A&&(U=X=$=!0);else if($)return null;if(U^X)return null;for(var lt=[k,H],ft=[],gt=0;gt<4&&ft.length<2;gt++){var yt=gt&1,At=yt^1,Bt=gt>>1,Ot=_t.getTimeOf(lt[yt],new y(lt[At][Bt?6:0],lt[At][Bt?7:1]));if(Ot!=null){var Wt=yt?[Bt,Ot]:[Ot,Bt];(!ft.length||G(Wt[0]-ft[0][0])>O&&G(Wt[1]-ft[0][1])>O)&&ft.push(Wt)}if(gt>2&&!ft.length)break}if(ft.length!==2)ft=null;else if(!$){var Ct=_t.getPart(k,ft[0][0],ft[1][0]),Et=_t.getPart(H,ft[0][1],ft[1][1]);(G(Et[2]-Ct[2])>A||G(Et[3]-Ct[3])>A||G(Et[4]-Ct[4])>A||G(Et[5]-Ct[5])>A)&&(ft=null)}return ft}function R(k,H){var N=k[0],G=k[1],L=k[2],O=k[3],A=k[4],U=k[5],X=k[6],$=k[7],W=H.normalize(),Q=W.x,et=W.y,rt=3*X-9*A+9*L-3*N,ot=3*$-9*U+9*O-3*G,J=6*A-12*L+6*N,nt=6*U-12*O+6*G,lt=3*L-3*N,ft=3*O-3*G,gt=2*rt*et-2*ot*Q,yt=[];if(Math.abs(gt)<v.CURVETIME_EPSILON){var At=rt*ft-ot*lt,gt=rt*nt-ot*J;if(gt!=0){var Bt=-At/gt;Bt>=0&&Bt<=1&&yt.push(Bt)}}else{var Ot=(J*J-4*rt*lt)*et*et+(-2*J*nt+4*ot*lt+4*rt*ft)*Q*et+(nt*nt-4*ot*ft)*Q*Q,Wt=J*et-nt*Q;if(Ot>=0&&gt!=0){var Ct=Math.sqrt(Ot),Et=-(Wt+Ct)/gt,Nt=(-Wt+Ct)/gt;Et>=0&&Et<=1&&yt.push(Et),Nt>=0&&Nt<=1&&yt.push(Nt)}}return yt}return{getIntersections:function(k){var H=this.getValues(),N=k&&k!==this&&k.getValues();return N?C(H,N,this,k,[]):E(H,this,[])},statics:{getOverlaps:D,getIntersections:B,getCurveLineIntersections:_,getTimesWithTangent:R}}}),Rt=n.extend({_class:"CurveLocation",initialize:function(l,c,f,g,_){if(c>=.99999999){var S=l.getNext();S&&(c=0,l=S)}this._setCurve(l),this._time=c,this._point=f||l.getPointAtTime(c),this._overlap=g,this._distance=_,this._intersection=this._next=this._previous=null},_setPath:function(a){this._path=a,this._version=a?a._version:0},_setCurve:function(a){this._setPath(a._path),this._curve=a,this._segment=null,this._segment1=a._segment1,this._segment2=a._segment2},_setSegment:function(a){var l=a.getCurve();l?this._setCurve(l):(this._setPath(a._path),this._segment1=a,this._segment2=null),this._segment=a,this._time=a===this._segment1?0:1,this._point=a._point.clone()},getSegment:function(){var a=this._segment;if(!a){var l=this.getCurve(),c=this.getTime();c===0?a=l._segment1:c===1?a=l._segment2:c!=null&&(a=l.getPartLength(0,c)<l.getPartLength(c,1)?l._segment1:l._segment2),this._segment=a}return a},getCurve:function(){var a=this._path,l=this;a&&a._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function c(f){var g=f&&f.getCurve();if(g&&(l._time=g.getTimeOf(l._point))!=null)return l._setCurve(g),g}return this._curve||c(this._segment)||c(this._segment1)||c(this._segment2.getPrevious())},getPath:function(){var a=this.getCurve();return a&&a._path},getIndex:function(){var a=this.getCurve();return a&&a.getIndex()},getTime:function(){var a=this.getCurve(),l=this._time;return a&&l==null?this._time=a.getTimeOf(this._point):l},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var a=this._offset;if(a==null){a=0;var l=this.getPath(),c=this.getIndex();if(l&&c!=null)for(var f=l.getCurves(),g=0;g<c;g++)a+=f[g].getLength();this._offset=a+=this.getCurveOffset()}return a},getCurveOffset:function(){var a=this._curveOffset;if(a==null){var l=this.getCurve(),c=this.getTime();this._curveOffset=a=c!=null&&l&&l.getPartLength(0,c)}return a},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var a=this.getCurve(),l=a&&a.divideAtTime(this.getTime());return l&&this._setSegment(l._segment1),l},split:function(){var a=this.getCurve(),l=a._path,c=a&&a.splitAtTime(this.getTime());return c&&this._setSegment(l.getLastSegment()),c},equals:function(a,l){var c=this===a;if(!c&&a instanceof Rt){var f=this.getCurve(),g=a.getCurve(),_=f._path,S=g._path;if(_===S){var w=Math.abs,C=1e-7,E=w(this.getOffset()-a.getOffset()),B=!l&&this._intersection,D=!l&&a._intersection;c=(E<C||_&&w(_.getLength()-E)<C)&&(!B&&!D||B&&D&&B.equals(D,!0))}}return c},toString:function(){var a=[],l=this.getPoint(),c=m.instance;l&&a.push("point: "+l);var f=this.getIndex();f!=null&&a.push("index: "+f);var g=this.getTime();return g!=null&&a.push("time: "+c.number(g)),this._distance!=null&&a.push("distance: "+c.number(this._distance)),"{ "+a.join(", ")+" }"},isTouching:function(){var a=this._intersection;if(a&&this.getTangent().isCollinear(a.getTangent())){var l=this.getCurve(),c=a.getCurve();return!(l.isStraight()&&c.isStraight()&&l.getLine().intersect(c.getLine()))}return!1},isCrossing:function(){var a=this._intersection;if(!a)return!1;var l=this.getTime(),c=a.getTime(),f=1e-8,g=1-f,_=l>=f&&l<=g,S=c>=f&&c<=g;if(_&&S)return!this.isTouching();var w=this.getCurve(),C=w&&l<f?w.getPrevious():w,E=a.getCurve(),B=E&&c<f?E.getPrevious():E;if(l>g&&(w=w.getNext()),c>g&&(E=E.getNext()),!C||!w||!B||!E)return!1;var D=[];function R(Q,et){var rt=Q.getValues(),ot=_t.classify(rt).roots||_t.getPeaks(rt),J=ot.length,nt=_t.getLength(rt,et&&J?ot[J-1]:0,!et&&J?ot[0]:1);D.push(J?nt:nt/32)}function k(Q,et,rt){return et<rt?Q>et&&Q<rt:Q>et||Q<rt}_||(R(C,!0),R(w,!1)),S||(R(B,!0),R(E,!1));var H=this.getPoint(),N=Math.min.apply(Math,D),G=_?w.getTangentAtTime(l):w.getPointAt(N).subtract(H),L=_?G.negate():C.getPointAt(-N).subtract(H),O=S?E.getTangentAtTime(c):E.getPointAt(N).subtract(H),A=S?O.negate():B.getPointAt(-N).subtract(H),U=L.getAngle(),X=G.getAngle(),$=A.getAngle(),W=O.getAngle();return!!(_?k(U,$,W)^k(X,$,W)&&k(U,W,$)^k(X,W,$):k($,U,X)^k(W,U,X)&&k($,X,U)^k(W,X,U))},hasOverlap:function(){return!!this._overlap}},n.each(_t._evaluateMethods,function(a){var l=a+"At";this[a]=function(){var c=this.getCurve(),f=this.getTime();return f!=null&&c&&c[l](f,!0)}},{preserve:!0}),new function(){function a(l,c,f){var g=l.length,_=0,S=g-1;function w(H,N){for(var G=H+N;G>=-1&&G<=g;G+=N){var L=l[(G%g+g)%g];if(!c.getPoint().isClose(L.getPoint(),1e-7))break;if(c.equals(L))return L}return null}for(;_<=S;){var C=_+S>>>1,E=l[C],B;if(f&&(B=c.equals(E)?E:w(C,-1)||w(C,1)))return c._overlap&&(B._overlap=B._intersection._overlap=!0),B;var D=c.getPath(),R=E.getPath(),k=D!==R?D._id-R._id:c.getIndex()+c.getTime()-(E.getIndex()+E.getTime());k<0?S=C-1:_=C+1}return l.splice(_,0,c),c}return{statics:{insert:a,expand:function(l){for(var c=l.slice(),f=l.length-1;f>=0;f--)a(c,l[f]._intersection,!1);return c}}}}),kt=T.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(a){var l,c,f;if(n.isPlainObject(a)?(c=a.segments,l=a.pathData):Array.isArray(a)?c=a:typeof a=="string"&&(l=a),c){var g=c[0];f=g&&Array.isArray(g[0])}else l&&(f=(l.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(l));var _=f?vt:Gt;return new _(a)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(a){this.isClockwise()!=(a=!!a)&&this.reverse()},setPathData:function(a){var l=a&&a.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),c,f=!1,g,_,S=new y,w=new y;function C(A,U){var X=+c[A];return f&&(X+=S[U]),X}function E(A){return new y(C(A,"x"),C(A+1,"y"))}this.clear();for(var B=0,D=l&&l.length;B<D;B++){var R=l[B],k=R[0],H=k.toLowerCase();c=R.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var N=c&&c.length;switch(f=k===H,g==="z"&&!/[mz]/.test(H)&&this.moveTo(S),H){case"m":case"l":for(var G=H==="m",L=0;L<N;L+=2)this[G?"moveTo":"lineTo"](S=E(L)),G&&(w=S,G=!1);_=S;break;case"h":case"v":var O=H==="h"?"x":"y";S=S.clone();for(var L=0;L<N;L++)S[O]=C(L,O),this.lineTo(S);_=S;break;case"c":for(var L=0;L<N;L+=6)this.cubicCurveTo(E(L),_=E(L+2),S=E(L+4));break;case"s":for(var L=0;L<N;L+=4)this.cubicCurveTo(/[cs]/.test(g)?S.multiply(2).subtract(_):S,_=E(L),S=E(L+2)),g=H;break;case"q":for(var L=0;L<N;L+=4)this.quadraticCurveTo(_=E(L),S=E(L+2));break;case"t":for(var L=0;L<N;L+=2)this.quadraticCurveTo(_=/[qt]/.test(g)?S.multiply(2).subtract(_):S,S=E(L)),g=H;break;case"a":for(var L=0;L<N;L+=7)this.arcTo(S=E(L+5),new M(+c[L],+c[L+1]),+c[L+2],+c[L+4],+c[L+3]);break;case"z":this.closePath(1e-12),S=w;break}g=H}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(a){var l=a.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(a):{};return l.onPath||!!(this.getFillRule()==="evenodd"?l.windingL&1||l.windingR&1:l.winding)},getIntersections:function(a,l,c,f){var g=this===a||!a,_=this._matrix._orNullIfIdentity(),S=g?_:(c||a._matrix)._orNullIfIdentity();return g||this.getBounds(_).intersects(a.getBounds(S),1e-12)?_t.getIntersections(this.getCurves(),!g&&a.getCurves(),l,_,S,f):[]},getCrossings:function(a){return this.getIntersections(a,function(l){return l.isCrossing()})},getNearestLocation:function(){for(var a=y.read(arguments),l=this.getCurves(),c=1/0,f=null,g=0,_=l.length;g<_;g++){var S=l[g].getNearestLocation(a);S._distance<c&&(c=S._distance,f=S)}return f},getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a&&a.getPoint()},interpolate:function(a,l,c){var f=!this._children,g=f?"_segments":"_children",_=a[g],S=l[g],w=this[g];if(!_||!S||_.length!==S.length)throw new Error("Invalid operands in interpolate() call: "+a+", "+l);var C=w.length,E=S.length;if(C<E)for(var B=f?ht:Gt,D=C;D<E;D++)this.add(new B);else C>E&&this[f?"removeSegments":"removeChildren"](E,C);for(var D=0;D<E;D++)w[D].interpolate(_[D],S[D],c);f&&(this.setClosed(a._closed),this._changed(9))},compare:function(a){var l=!1;if(a){var c=this._children||[this],f=a._children?a._children.slice():[a],g=c.length,_=f.length,S=[],w=0;l=!0;for(var C=p.findItemBoundsCollisions(c,f,v.GEOMETRIC_EPSILON),E=g-1;E>=0&&l;E--){var B=c[E];l=!1;var D=C[E];if(D)for(var R=D.length-1;R>=0&&!l;R--)B.compare(f[D[R]])&&(S[D[R]]||(S[D[R]]=!0,w++),l=!0)}l=l&&w===_}return l}}),Gt=kt.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(l){this._closed=!1,this._segments=[],this._version=0;var c=arguments,f=Array.isArray(l)?typeof l[0]=="object"?l:c:l&&l.size===e&&(l.x!==e||l.point!==e)?c:null;f&&f.length>0?this.setSegments(f):(this._curves=e,this._segmentSelection=0,!f&&typeof l=="string"&&(this.setPathData(l),l=null)),this._initialize(!f&&l)},_equals:function(a){return this._closed===a._closed&&n.equals(this._segments,a._segments)},copyContent:function(a){this.setSegments(a._segments),this._closed=a._closed},_changed:function a(l){if(a.base.call(this,l),l&8){if(this._length=this._area=e,l&32)this._version++;else if(this._curves)for(var c=0,f=this._curves.length;c<f;c++)this._curves[c]._changed()}else l&64&&(this._bounds=e)},getStyle:function(){var a=this._parent;return(a instanceof vt?a:this)._style},getSegments:function(){return this._segments},setSegments:function(a){var l=this.isFullySelected(),c=a&&a.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=e,c){var f=a[c-1];typeof f=="boolean"&&(this.setClosed(f),c--),this._add(ht.readList(a,0,{},c))}l&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var a=this._curves,l=this._segments;if(!a){var c=this._countCurves();a=this._curves=new Array(c);for(var f=0;f<c;f++)a[f]=new _t(this,l[f],l[f+1]||l[0])}return a},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},isClosed:function(){return this._closed},setClosed:function(a){if(this._closed!=(a=!!a)){if(this._closed=a,this._curves){var l=this._curves.length=this._countCurves();a&&(this._curves[l-1]=new _t(this,this._segments[l-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(a,l){var c=this._segments,f=c.length,g=new m(l),_=new Array(6),S=!0,w,C,E,B,D,R,k,H,N=[];function G(O,A){if(O._transformCoordinates(a,_),w=_[0],C=_[1],S)N.push("M"+g.pair(w,C)),S=!1;else if(D=_[2],R=_[3],D===w&&R===C&&k===E&&H===B){if(!A){var U=w-E,X=C-B;N.push(U===0?"v"+g.number(X):X===0?"h"+g.number(U):"l"+g.pair(U,X))}}else N.push("c"+g.pair(k-E,H-B)+" "+g.pair(D-E,R-B)+" "+g.pair(w-E,C-B));E=w,B=C,k=_[4],H=_[5]}if(!f)return"";for(var L=0;L<f;L++)G(c[L]);return this._closed&&f>0&&(G(c[0],!0),N.push("z")),N.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(a){for(var l=this._segments,c=new Array(6),f=0,g=l.length;f<g;f++)l[f]._transformCoordinates(a,c,!0);return!0},_add:function(a,S){for(var c=this._segments,f=this._curves,g=a.length,_=S==null,S=_?c.length:S,w=0;w<g;w++){var C=a[w];C._path&&(C=a[w]=C.clone()),C._path=this,C._index=S+w,C._selection&&this._updateSelection(C,0,C._selection)}if(_)n.push(c,a);else{c.splice.apply(c,[S,0].concat(a));for(var w=S+g,E=c.length;w<E;w++)c[w]._index=w}if(f){var B=this._countCurves(),D=S>0&&S+g-1===B?S-1:S,R=D,k=Math.min(D+g,B);a._curves&&(f.splice.apply(f,[D,0].concat(a._curves)),R+=a._curves.length);for(var w=R;w<k;w++)f.splice(w,0,new _t(this,null,null));this._adjustCurves(D,k)}return this._changed(41),a},_adjustCurves:function(a,l){for(var c=this._segments,f=this._curves,g,_=a;_<l;_++)g=f[_],g._path=this,g._segment1=c[_],g._segment2=c[_+1]||c[0],g._changed();(g=f[this._closed&&!a?c.length-1:a-1])&&(g._segment2=c[a]||c[0],g._changed()),(g=f[l])&&(g._segment1=c[l],g._changed())},_countCurves:function(){var a=this._segments.length;return!this._closed&&a>0?a-1:a},add:function(a){var l=arguments;return l.length>1&&typeof a!="number"?this._add(ht.readList(l)):this._add([ht.read(l)])[0]},insert:function(a,l){var c=arguments;return c.length>2&&typeof l!="number"?this._add(ht.readList(c,1),a):this._add([ht.read(c,1)],a)[0]},addSegment:function(){return this._add([ht.read(arguments)])[0]},insertSegment:function(a){return this._add([ht.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(ht.readList(a))},insertSegments:function(a,l){return this._add(ht.readList(l),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,l,c){a=a||0,l=n.pick(l,this._segments.length);var f=this._segments,g=this._curves,_=f.length,S=f.splice(a,l-a),w=S.length;if(!w)return S;for(var C=0;C<w;C++){var E=S[C];E._selection&&this._updateSelection(E,E._selection,0),E._index=E._path=null}for(var C=a,B=f.length;C<B;C++)f[C]._index=C;if(g){for(var D=a>0&&l===_+(this._closed?1:0)?a-1:a,g=g.splice(D,w),C=g.length-1;C>=0;C--)g[C]._path=null;c&&(S._curves=g.slice(1)),this._adjustCurves(D,D)}return this._changed(41),S},clear:"#removeSegments",hasHandles:function(){for(var a=this._segments,l=0,c=a.length;l<c;l++)if(a[l].hasHandles())return!0;return!1},clearHandles:function(){for(var a=this._segments,l=0,c=a.length;l<c;l++)a[l].clearHandles()},getLength:function(){if(this._length==null){for(var a=this.getCurves(),l=0,c=0,f=a.length;c<f;c++)l+=a[c].getLength();this._length=l}return this._length},getArea:function(){var a=this._area;if(a==null){var l=this._segments,c=this._closed;a=0;for(var f=0,g=l.length;f<g;f++){var _=f+1===g;a+=_t.getArea(_t.getValues(l[f],l[_?0:f+1],null,_&&!c))}this._area=a}return a},isFullySelected:function(){var a=this._segments.length;return this.isSelected()&&a>0&&this._segmentSelection===a*7},setFullySelected:function(a){a&&this._selectSegments(!0),this.setSelected(a)},setSelection:function a(l){l&1||this._selectSegments(!1),a.base.call(this,l)},_selectSegments:function(a){var l=this._segments,c=l.length,f=a?7:0;this._segmentSelection=f*c;for(var g=0;g<c;g++)l[g]._selection=f},_updateSelection:function(a,l,c){a._selection=c;var f=this._segmentSelection+=c-l;f>0&&this.setSelected(!0)},divideAt:function(a){var l=this.getLocationAt(a),c;return l&&(c=l.getCurve().divideAt(l.getCurveOffset()))?c._segment1:null},splitAt:function(a){var l=this.getLocationAt(a),c=l&&l.index,f=l&&l.time,g=1e-8,_=1-g;f>_&&(c++,f=0);var S=this.getCurves();if(c>=0&&c<S.length){f>=g&&S[c++].divideAtTime(f);var w=this.removeSegments(c,this._segments.length,!0),C;return this._closed?(this.setClosed(!1),C=this):(C=new Gt(T.NO_INSERT),C.insertAbove(this),C.copyAttributes(this)),C._add(w,0),this.addSegment(w[0]),C}return null},split:function(a,l){var c,f=l===e?a:(c=this.getCurves()[a])&&c.getLocationAtTime(l);return f!=null?this.splitAt(f):null},join:function(a,l){var c=l||0;if(a&&a!==this){var f=a._segments,g=this.getLastSegment(),_=a.getLastSegment();if(!_)return this;g&&g._point.isClose(_._point,c)&&a.reverse();var S=a.getFirstSegment();if(g&&g._point.isClose(S._point,c))g.setHandleOut(S._handleOut),this._add(f.slice(1));else{var w=this.getFirstSegment();w&&w._point.isClose(S._point,c)&&a.reverse(),_=a.getLastSegment(),w&&w._point.isClose(_._point,c)?(w.setHandleIn(_._handleIn),this._add(f.slice(0,f.length-1),0)):this._add(f.slice())}a._closed&&this._add([f[0]]),a.remove()}var C=this.getFirstSegment(),E=this.getLastSegment();return C!==E&&C._point.isClose(E._point,c)&&(C.setHandleIn(E._handleIn),E.remove(),this.setClosed(!0)),this},reduce:function(a){for(var l=this.getCurves(),c=a&&a.simplify,f=c?1e-7:0,g=l.length-1;g>=0;g--){var _=l[g];!_.hasHandles()&&(!_.hasLength(f)||c&&_.isCollinear(_.getNext()))&&_.remove()}return this},reverse:function(){this._segments.reverse();for(var a=0,l=this._segments.length;a<l;a++){var c=this._segments[a],f=c._handleIn;c._handleIn=c._handleOut,c._handleOut=f,c._index=a}this._curves=null,this._changed(9)},flatten:function(a){for(var l=new Pt(this,a||.25,256,!0),c=l.parts,f=c.length,g=[],_=0;_<f;_++)g.push(new ht(c[_].curve.slice(0,2)));!this._closed&&f>0&&g.push(new ht(c[f-1].curve.slice(6))),this.setSegments(g)},simplify:function(a){var l=new Vt(this).fit(a||2.5);return l&&this.setSegments(l),!!l},smooth:function(a){var l=this,c=a||{},f=c.type||"asymmetric",g=this._segments,_=g.length,S=this._closed;function w($t,ue){var he=$t&&$t.index;if(he!=null){var pe=$t.path;if(pe&&pe!==l)throw new Error($t._class+" "+he+" of "+pe+" is not part of "+l);ue&&$t instanceof _t&&he++}else he=typeof $t=="number"?$t:ue;return Math.min(he<0&&S?he%_:he<0?he+_:he,_-1)}var C=S&&c.from===e&&c.to===e,E=w(c.from,0),B=w(c.to,_-1);if(E>B)if(S)E-=_;else{var D=E;E=B,B=D}if(/^(?:asymmetric|continuous)$/.test(f)){var R=f==="asymmetric",k=Math.min,H=B-E+1,N=H-1,G=C?k(H,4):1,L=G,O=G,A=[];if(S||(L=k(1,E),O=k(1,_-B-1)),N+=L+O,N<=1)return;for(var U=0,X=E-L;U<=N;U++,X++)A[U]=g[(X<0?X+_:X)%_]._point;for(var $=A[0]._x+2*A[1]._x,W=A[0]._y+2*A[1]._y,Q=2,et=N-1,rt=[$],ot=[W],J=[Q],nt=[],lt=[],U=1;U<N;U++){var ft=U<et,gt=ft||R?1:2,yt=ft?4:R?2:7,At=ft?4:R?3:8,Bt=ft?2:R?0:1,Ot=gt/Q;Q=J[U]=yt-Ot,$=rt[U]=At*A[U]._x+Bt*A[U+1]._x-Ot*$,W=ot[U]=At*A[U]._y+Bt*A[U+1]._y-Ot*W}nt[et]=rt[et]/J[et],lt[et]=ot[et]/J[et];for(var U=N-2;U>=0;U--)nt[U]=(rt[U]-nt[U+1])/J[U],lt[U]=(ot[U]-lt[U+1])/J[U];nt[N]=(3*A[N]._x-nt[et])/2,lt[N]=(3*A[N]._y-lt[et])/2;for(var U=L,Wt=N-O,X=E;U<=Wt;U++,X++){var Ct=g[X<0?X+_:X],Et=Ct._point,Nt=nt[U]-Et._x,jt=lt[U]-Et._y;(C||U<Wt)&&Ct.setHandleOut(Nt,jt),(C||U>L)&&Ct.setHandleIn(-Nt,-jt)}}else for(var U=E;U<=B;U++)g[U<0?U+_:U].smooth(c,!C&&U===E,!C&&U===B)},toShape:function(a){if(!this._closed)return null;var l=this._segments,c,f,g,_;function S(R,k){var H=l[R],N=H.getNext(),G=l[k],L=G.getNext();return H._handleOut.isZero()&&N._handleIn.isZero()&&G._handleOut.isZero()&&L._handleIn.isZero()&&N._point.subtract(H._point).isCollinear(L._point.subtract(G._point))}function w(R){var k=l[R],H=k.getPrevious(),N=k.getNext();return H._handleOut.isZero()&&k._handleIn.isZero()&&k._handleOut.isZero()&&N._handleIn.isZero()&&k._point.subtract(H._point).isOrthogonal(N._point.subtract(k._point))}function C(R){var k=l[R],H=k.getNext(),N=k._handleOut,G=H._handleIn,L=.5522847498307936;if(N.isOrthogonal(G)){var O=k._point,A=H._point,U=new Y(O,N,!0).intersect(new Y(A,G,!0),!0);return U&&v.isZero(N.getLength()/U.subtract(O).getLength()-L)&&v.isZero(G.getLength()/U.subtract(A).getLength()-L)}return!1}function E(R,k){return l[R]._point.getDistance(l[k]._point)}if(!this.hasHandles()&&l.length===4&&S(0,2)&&S(1,3)&&w(1)?(c=pt.Rectangle,f=new M(E(0,3),E(0,1)),_=l[1]._point.add(l[2]._point).divide(2)):l.length===8&&C(0)&&C(2)&&C(4)&&C(6)&&S(1,5)&&S(3,7)?(c=pt.Rectangle,f=new M(E(1,6),E(0,3)),g=f.subtract(new M(E(0,7),E(1,2))).divide(2),_=l[3]._point.add(l[4]._point).divide(2)):l.length===4&&C(0)&&C(1)&&C(2)&&C(3)&&(v.isZero(E(0,2)-E(1,3))?(c=pt.Circle,g=E(0,2)/2):(c=pt.Ellipse,g=new M(E(2,0)/2,E(3,1)/2)),_=l[1]._point),c){var B=this.getPosition(!0),D=new c({center:B,size:f,radius:g,insert:!1});return D.copyAttributes(this,!0),D._matrix.prepend(this._matrix),D.rotate(_.subtract(B).getAngle()+90),(a===e||a)&&D.insertAbove(this),D}return null},toPath:"#clone",compare:function a(l){if(!l||l instanceof vt)return a.base.call(this,l);var c=this.getCurves(),f=l.getCurves(),g=c.length,_=f.length;if(!g||!_)return g==_;for(var S=c[0].getValues(),w=[],C=0,E,B=0,D,R=0;R<_;R++){var G=f[R].getValues();w.push(G);var k=_t.getOverlaps(S,G);if(k){E=!R&&k[0][0]>0?_-1:R,D=k[0][1];break}}for(var H=Math.abs,N=1e-8,G=w[E],L;S&&G;){var k=_t.getOverlaps(S,G);if(k){var O=k[0][0];if(H(O-B)<N){B=k[1][0],B===1&&(S=++C<g?c[C].getValues():null,B=0);var A=k[0][1];if(H(A-D)<N){if(L||(L=[E,A]),D=k[1][1],D===1&&(++E>=_&&(E=0),G=w[E]||f[E].getValues(),D=0),!S)return L[0]===E&&L[1]===D;continue}}}break}return!1},_hitTestSelf:function(a,l,c,f){var g=this,_=this.getStyle(),S=this._segments,w=S.length,C=this._closed,E=l._tolerancePadding,B=E,D,R,k,H,N,G,L=l.stroke&&_.hasStroke(),O=l.fill&&_.hasFill(),A=l.curves,U=L?_.getStrokeWidth()/2:O&&l.tolerance>0||A?0:null;U!==null&&(U>0?(D=_.getStrokeJoin(),R=_.getStrokeCap(),k=_.getMiterLimit(),B=B.add(Gt._getStrokePadding(U,f))):D=R="round");function X(nt,lt){return a.subtract(nt).divide(lt).length<=1}function $(nt,lt,ft){if(!l.selected||lt.isSelected()){var gt=nt._point;if(lt!==gt&&(lt=lt.add(gt)),X(lt,B))return new dt(ft,g,{segment:nt,point:lt})}}function W(nt,lt){return(lt||l.segments)&&$(nt,nt._point,"segment")||!lt&&l.handles&&($(nt,nt._handleIn,"handle-in")||$(nt,nt._handleOut,"handle-out"))}function Q(nt){H.add(nt)}function et(nt){var lt=C||nt._index>0&&nt._index<w-1;if((lt?D:R)==="round")return X(nt._point,B);if(H=new Gt({internal:!0,closed:!0}),lt?nt.isSmooth()||Gt._addBevelJoin(nt,D,U,k,null,f,Q,!0):R==="square"&&Gt._addSquareCap(nt,R,U,null,f,Q,!0),!H.isEmpty()){var ft;return H.contains(a)||(ft=H.getNearestLocation(a))&&X(ft.getPoint(),E)}}if(l.ends&&!l.segments&&!C){if(G=W(S[0],!0)||W(S[w-1],!0))return G}else if(l.segments||l.handles){for(var rt=0;rt<w;rt++)if(G=W(S[rt]))return G}if(U!==null){if(N=this.getNearestLocation(a),N){var ot=N.getTime();ot===0||ot===1&&w>1?et(N.getSegment())||(N=null):X(N.getPoint(),B)||(N=null)}if(!N&&D==="miter"&&w>1)for(var rt=0;rt<w;rt++){var J=S[rt];if(a.getDistance(J._point)<=k*U&&et(J)){N=J.getLocation();break}}}return!N&&O&&this._contains(a)||N&&!L&&!A?new dt("fill",this):N?new dt(L?"stroke":"curve",this,{location:N,point:N.getPoint()}):null}},n.each(_t._evaluateMethods,function(a){this[a+"At"]=function(l){var c=this.getLocationAt(l);return c&&c[a]()}},{beans:!1,getLocationOf:function(){for(var a=y.read(arguments),l=this.getCurves(),c=0,f=l.length;c<f;c++){var g=l[c].getLocationOf(a);if(g)return g}return null},getOffsetOf:function(){var a=this.getLocationOf.apply(this,arguments);return a?a.getOffset():null},getLocationAt:function(a){if(typeof a=="number"){for(var l=this.getCurves(),c=0,f=0,g=l.length;f<g;f++){var _=c,S=l[f];if(c+=S.getLength(),c>a)return S.getLocationAt(a-_)}if(l.length>0&&a<=this.getLength())return new Rt(l[l.length-1],1)}else if(a&&a.getPath&&a.getPath()===this)return a;return null},getOffsetsWithTangent:function(){var a=y.read(arguments);if(a.isZero())return[];for(var l=[],c=0,f=this.getCurves(),g=0,_=f.length;g<_;g++){for(var S=f[g],w=S.getTimesWithTangent(a),C=0,E=w.length;C<E;C++){var B=c+S.getOffsetAtTime(w[C]);l.indexOf(B)<0&&l.push(B)}c+=S.length}return l}}),new function(){function a(c,f,g,_){if(_<=0)return;var S=_/2,w=_-2,C=S-1,E=new Array(6),B,D;function R(O){var A=E[O],U=E[O+1];(B!=A||D!=U)&&(c.beginPath(),c.moveTo(B,D),c.lineTo(A,U),c.stroke(),c.beginPath(),c.arc(A,U,S,0,Math.PI*2,!0),c.fill())}for(var k=0,H=f.length;k<H;k++){var N=f[k],G=N._selection;if(N._transformCoordinates(g,E),B=E[0],D=E[1],G&2&&R(2),G&4&&R(4),c.fillRect(B-S,D-S,_,_),w>0&&!(G&1)){var L=c.fillStyle;c.fillStyle="#ffffff",c.fillRect(B-C,D-C,w,w),c.fillStyle=L}}}function l(c,f,g){var _=f._segments,S=_.length,w=new Array(6),C=!0,E,B,D,R,k,H,N,G;function L(A){if(g)A._transformCoordinates(g,w),E=w[0],B=w[1];else{var U=A._point;E=U._x,B=U._y}if(C)c.moveTo(E,B),C=!1;else{if(g)k=w[2],H=w[3];else{var X=A._handleIn;k=E+X._x,H=B+X._y}k===E&&H===B&&N===D&&G===R?c.lineTo(E,B):c.bezierCurveTo(N,G,k,H,E,B)}if(D=E,R=B,g)N=w[4],G=w[5];else{var X=A._handleOut;N=D+X._x,G=R+X._y}}for(var O=0;O<S;O++)L(_[O]);f._closed&&S>0&&L(_[0])}return{_draw:function(c,f,g,_){var S=f.dontStart,w=f.dontFinish||f.clip,C=this.getStyle(),E=C.hasFill(),B=C.hasStroke(),D=C.getDashArray(),R=!be.support.nativeDash&&B&&D&&D.length;S||c.beginPath(),(E||B&&!R||w)&&(l(c,this,_),this._closed&&c.closePath());function k(A){return D[(A%R+R)%R]}if(!w&&(E||B)&&(this._setStyles(c,f,g),E&&(c.fill(C.getFillRule()),c.shadowColor="rgba(0,0,0,0)"),B)){if(R){S||c.beginPath();for(var H=new Pt(this,.25,32,!1,_),N=H.length,G=-C.getDashOffset(),L,O=0;G>0;)G-=k(O--)+k(O--);for(;G<N;)L=G+k(O++),(G>0||L>0)&&H.drawPart(c,Math.max(G,0),Math.max(L,0)),G=L+k(O++)}c.stroke()}},_drawSelected:function(c,f){c.beginPath(),l(c,this,f),c.stroke(),a(c,this._segments,f,be.settings.handleSize)}}},new function(){function a(l){var c=l._segments;if(!c.length)throw new Error("Use a moveTo() command first");return c[c.length-1]}return{moveTo:function(){var l=this._segments;l.length===1&&this.removeSegment(0),l.length||this._add([new ht(y.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new ht(y.read(arguments))])},cubicCurveTo:function(){var l=arguments,c=y.read(l),f=y.read(l),g=y.read(l),_=a(this);_.setHandleOut(c.subtract(_._point)),this._add([new ht(g,f.subtract(g))])},quadraticCurveTo:function(){var l=arguments,c=y.read(l),f=y.read(l),g=a(this)._point;this.cubicCurveTo(c.add(g.subtract(c).multiply(1/3)),c.add(f.subtract(c).multiply(1/3)),f)},curveTo:function(){var l=arguments,c=y.read(l),f=y.read(l),g=n.pick(n.read(l),.5),_=1-g,S=a(this)._point,w=c.subtract(S.multiply(_*_)).subtract(f.multiply(g*g)).divide(2*g*_);if(w.isNaN())throw new Error("Cannot put a curve through points with parameter = "+g);this.quadraticCurveTo(w,f)},arcTo:function(){var l=arguments,c=Math.abs,f=Math.sqrt,g=a(this),_=g._point,S=y.read(l),w,C=n.peek(l),E=n.pick(C,!0),B,D,R,k;if(typeof E=="boolean")var H=_.add(S).divide(2),w=H.add(H.subtract(_).rotate(E?-90:90));else if(n.remain(l)<=2)w=S,S=y.read(l);else if(!_.equals(S)){var N=M.read(l),G=v.isZero;if(G(N.width)||G(N.height))return this.lineTo(S);var L=n.read(l),E=!!n.read(l),O=!!n.read(l),H=_.add(S).divide(2),A=_.subtract(H).rotate(-L),U=A.x,X=A.y,$=c(N.width),W=c(N.height),Q=$*$,et=W*W,rt=U*U,ot=X*X,J=f(rt/Q+ot/et);if(J>1&&($*=J,W*=J,Q=$*$,et=W*W),J=(Q*et-Q*ot-et*rt)/(Q*ot+et*rt),c(J)<1e-12&&(J=0),J<0)throw new Error("Cannot create an arc with the given arguments");B=new y($*X/W,-W*U/$).multiply((O===E?-1:1)*f(J)).rotate(L).add(H),k=new I().translate(B).rotate(L).scale($,W),R=k._inverseTransform(_),D=R.getDirectedAngle(k._inverseTransform(S)),!E&&D>0?D-=360:E&&D<0&&(D+=360)}if(w){var nt=new Y(_.add(w).divide(2),w.subtract(_).rotate(90),!0),lt=new Y(w.add(S).divide(2),S.subtract(w).rotate(90),!0),ft=new Y(_,S),gt=ft.getSide(w);if(B=nt.intersect(lt,!0),!B){if(!gt)return this.lineTo(S);throw new Error("Cannot create an arc with the given arguments")}R=_.subtract(B),D=R.getDirectedAngle(S.subtract(B));var yt=ft.getSide(B,!0);yt===0?D=gt*c(D):gt===yt&&(D+=D<0?360:-360)}if(D){for(var At=1e-5,Bt=c(D),Ot=Bt>=360?4:Math.ceil((Bt-At)/90),Wt=D/Ot,Ct=Wt*Math.PI/360,Et=4/3*Math.sin(Ct)/(1+Math.cos(Ct)),Nt=[],jt=0;jt<=Ot;jt++){var A=S,$t=null;if(jt<Ot&&($t=R.rotate(90).multiply(Et),k?(A=k._transformPoint(R),$t=k._transformPoint(R.add($t)).subtract(A)):A=B.add(R)),!jt)g.setHandleOut($t);else{var ue=R.rotate(-90).multiply(Et);k&&(ue=k._transformPoint(R.add(ue)).subtract(A)),Nt.push(new ht(A,ue,$t))}R=R.rotate(Wt)}this._add(Nt)}},lineBy:function(){var l=y.read(arguments),c=a(this)._point;this.lineTo(c.add(l))},curveBy:function(){var l=arguments,c=y.read(l),f=y.read(l),g=n.read(l),_=a(this)._point;this.curveTo(_.add(c),_.add(f),g)},cubicCurveBy:function(){var l=arguments,c=y.read(l),f=y.read(l),g=y.read(l),_=a(this)._point;this.cubicCurveTo(_.add(c),_.add(f),_.add(g))},quadraticCurveBy:function(){var l=arguments,c=y.read(l),f=y.read(l),g=a(this)._point;this.quadraticCurveTo(g.add(c),g.add(f))},arcBy:function(){var l=arguments,c=a(this)._point,f=c.add(y.read(l)),g=n.pick(n.peek(l),!0);typeof g=="boolean"?this.arcTo(f,g):this.arcTo(f,c.add(y.read(l)))},closePath:function(l){this.setClosed(!0),this.join(this,l)}}},{_getBounds:function(a,l){var c=l.handle?"getHandleBounds":l.stroke?"getStrokeBounds":"getBounds";return Gt[c](this._segments,this._closed,this,a,l)},statics:{getBounds:function(a,l,c,f,g,_){var S=a[0];if(!S)return new q;var w=new Array(6),C=S._transformCoordinates(f,new Array(6)),E=C.slice(0,2),B=E.slice(),D=new Array(2);function R(N){N._transformCoordinates(f,w);for(var G=0;G<2;G++)_t._addBounds(C[G],C[G+4],w[G+2],w[G],G,_?_[G]:0,E,B,D);var L=C;C=w,w=L}for(var k=1,H=a.length;k<H;k++)R(a[k]);return l&&R(S),new q(E[0],E[1],B[0]-E[0],B[1]-E[1])},getStrokeBounds:function(a,l,c,f,g){var _=c.getStyle(),S=_.hasStroke(),w=_.getStrokeWidth(),C=S&&c._getStrokeMatrix(f,g),E=S&&Gt._getStrokePadding(w,C),B=Gt.getBounds(a,l,c,f,g,E);if(!S)return B;var D=w/2,R=_.getStrokeJoin(),k=_.getStrokeCap(),H=_.getMiterLimit(),N=new q(new M(E));function G($){B=B.include($)}function L($){B=B.unite(N.setCenter($._point.transform(f)))}function O($,W){W==="round"||$.isSmooth()?L($):Gt._addBevelJoin($,W,D,H,f,C,G)}function A($,W){W==="round"?L($):Gt._addSquareCap($,W,D,f,C,G)}var U=a.length-(l?0:1);if(U>0){for(var X=1;X<U;X++)O(a[X],R);l?O(a[0],R):(A(a[0],k),A(a[a.length-1],k))}return B},_getStrokePadding:function(a,l){if(!l)return[a,a];var c=new y(a,0).transform(l),f=new y(0,a).transform(l),g=c.getAngleInRadians(),_=c.getLength(),S=f.getLength(),w=Math.sin(g),C=Math.cos(g),E=Math.tan(g),B=Math.atan2(S*E,_),D=Math.atan2(S,E*_);return[Math.abs(_*Math.cos(B)*C+S*Math.sin(B)*w),Math.abs(S*Math.sin(D)*C+_*Math.cos(D)*w)]},_addBevelJoin:function(a,l,c,f,g,_,S,w){var C=a.getCurve(),E=C.getPrevious(),B=C.getPoint1().transform(g),D=E.getNormalAtTime(1).multiply(c).transform(_),R=C.getNormalAtTime(0).multiply(c).transform(_),k=D.getDirectedAngle(R);if((k<0||k>=180)&&(D=D.negate(),R=R.negate()),w&&S(B),S(B.add(D)),l==="miter"){var H=new Y(B.add(D),new y(-D.y,D.x),!0).intersect(new Y(B.add(R),new y(-R.y,R.x),!0),!0);H&&B.getDistance(H)<=f*c&&S(H)}S(B.add(R))},_addSquareCap:function(a,l,c,f,g,_,S){var w=a._point.transform(f),C=a.getLocation(),E=C.getNormal().multiply(C.getTime()===0?c:-c).transform(g);l==="square"&&(S&&(_(w.subtract(E)),_(w.add(E))),w=w.add(E.rotate(-90))),_(w.add(E)),_(w.subtract(E))},getHandleBounds:function(a,l,c,f,g){var _=c.getStyle(),S=g.stroke&&_.hasStroke(),w,C;if(S){var E=c._getStrokeMatrix(f,g),B=_.getStrokeWidth()/2,D=B;_.getStrokeJoin()==="miter"&&(D=B*_.getMiterLimit()),_.getStrokeCap()==="square"&&(D=Math.max(D,B*Math.SQRT2)),w=Gt._getStrokePadding(B,E),C=Gt._getStrokePadding(D,E)}for(var R=new Array(6),k=1/0,H=-k,N=k,G=H,L=0,O=a.length;L<O;L++){var A=a[L];A._transformCoordinates(f,R);for(var U=0;U<6;U+=2){var X=U?w:C,$=X?X[0]:0,W=X?X[1]:0,Q=R[U],et=R[U+1],rt=Q-$,ot=Q+$,J=et-W,nt=et+W;rt<k&&(k=rt),ot>H&&(H=ot),J<N&&(N=J),nt>G&&(G=nt)}}return new q(k,N,H-k,G-N)}}});Gt.inject({statics:new function(){var a=.5522847498307936,l=[new ht([-1,0],[0,a],[0,-a]),new ht([0,-1],[-a,0],[a,0]),new ht([1,0],[0,-a],[0,a]),new ht([0,1],[a,0],[-a,0])];function c(g,_,S){var w=n.getNamed(S),C=new Gt(w&&(w.insert==!0?T.INSERT:w.insert==!1?T.NO_INSERT:null));return C._add(g),C._closed=_,C.set(w,T.INSERT)}function f(g,_,S){for(var w=new Array(4),C=0;C<4;C++){var E=l[C];w[C]=new ht(E._point.multiply(_).add(g),E._handleIn.multiply(_),E._handleOut.multiply(_))}return c(w,!0,S)}return{Line:function(){var g=arguments;return c([new ht(y.readNamed(g,"from")),new ht(y.readNamed(g,"to"))],!1,g)},Circle:function(){var g=arguments,_=y.readNamed(g,"center"),S=n.readNamed(g,"radius");return f(_,new M(S),g)},Rectangle:function(){var g=arguments,_=q.readNamed(g,"rectangle"),S=M.readNamed(g,"radius",0,{readNull:!0}),w=_.getBottomLeft(!0),C=_.getTopLeft(!0),E=_.getTopRight(!0),B=_.getBottomRight(!0),D;if(!S||S.isZero())D=[new ht(w),new ht(C),new ht(E),new ht(B)];else{S=M.min(S,_.getSize(!0).divide(2));var R=S.width,k=S.height,H=R*a,N=k*a;D=[new ht(w.add(R,0),null,[-H,0]),new ht(w.subtract(0,k),[0,N]),new ht(C.add(0,k),null,[0,-N]),new ht(C.add(R,0),[-H,0],null),new ht(E.subtract(R,0),null,[H,0]),new ht(E.add(0,k),[0,-N],null),new ht(B.subtract(0,k),null,[0,N]),new ht(B.subtract(R,0),[H,0])]}return c(D,!0,g)},RoundRectangle:"#Rectangle",Ellipse:function(){var g=arguments,_=pt._readEllipse(g);return f(_.center,_.radius,g)},Oval:"#Ellipse",Arc:function(){var g=arguments,_=y.readNamed(g,"from"),S=y.readNamed(g,"through"),w=y.readNamed(g,"to"),C=n.getNamed(g),E=new Gt(C&&C.insert==!1&&T.NO_INSERT);return E.moveTo(_),E.arcTo(S,w),E.set(C)},RegularPolygon:function(){for(var g=arguments,_=y.readNamed(g,"center"),S=n.readNamed(g,"sides"),w=n.readNamed(g,"radius"),C=360/S,E=S%3===0,B=new y(0,E?-w:w),D=E?-1:.5,R=new Array(S),k=0;k<S;k++)R[k]=new ht(_.add(B.rotate((k+D)*C)));return c(R,!0,g)},Star:function(){for(var g=arguments,_=y.readNamed(g,"center"),S=n.readNamed(g,"points")*2,w=n.readNamed(g,"radius1"),C=n.readNamed(g,"radius2"),E=360/S,B=new y(0,-1),D=new Array(S),R=0;R<S;R++)D[R]=new ht(_.add(B.rotate(E*R).multiply(R%2?C:w)));return c(D,!0,g)}}}});var vt=kt.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(l){this._children=[],this._namedChildren={},this._initialize(l)||(typeof l=="string"?this.setPathData(l):this.addChildren(Array.isArray(l)?l:arguments))},insertChildren:function a(l,c){var f=c,g=f[0];g&&typeof g[0]=="number"&&(f=[f]);for(var _=c.length-1;_>=0;_--){var S=f[_];f===c&&!(S instanceof Gt)&&(f=n.slice(f)),Array.isArray(S)?f[_]=new Gt({segments:S,insert:!1}):S instanceof vt&&(f.splice.apply(f,[_,1].concat(S.removeChildren())),S.remove())}return a.base.call(this,l,f)},reduce:function a(l){for(var c=this._children,f=c.length-1;f>=0;f--){var g=c[f].reduce(l);g.isEmpty()&&g.remove()}if(!c.length){var g=new Gt(T.NO_INSERT);return g.copyAttributes(this),g.insertAbove(this),this.remove(),g}return a.base.call(this)},isClosed:function(){for(var a=this._children,l=0,c=a.length;l<c;l++)if(!a[l]._closed)return!1;return!0},setClosed:function(a){for(var l=this._children,c=0,f=l.length;c<f;c++)l[c].setClosed(a)},getFirstSegment:function(){var a=this.getFirstChild();return a&&a.getFirstSegment()},getLastSegment:function(){var a=this.getLastChild();return a&&a.getLastSegment()},getCurves:function(){for(var a=this._children,l=[],c=0,f=a.length;c<f;c++)n.push(l,a[c].getCurves());return l},getFirstCurve:function(){var a=this.getFirstChild();return a&&a.getFirstCurve()},getLastCurve:function(){var a=this.getLastChild();return a&&a.getLastCurve()},getArea:function(){for(var a=this._children,l=0,c=0,f=a.length;c<f;c++)l+=a[c].getArea();return l},getLength:function(){for(var a=this._children,l=0,c=0,f=a.length;c<f;c++)l+=a[c].getLength();return l},getPathData:function(a,l){for(var c=this._children,f=[],g=0,_=c.length;g<_;g++){var S=c[g],w=S._matrix;f.push(S.getPathData(a&&!w.isIdentity()?a.appended(w):a,l))}return f.join("")},_hitTestChildren:function a(l,c,f){return a.base.call(this,l,c.class===Gt||c.type==="path"?c:n.set({},c,{fill:!1}),f)},_draw:function(a,l,c,f){var g=this._children;if(g.length){l=l.extend({dontStart:!0,dontFinish:!0}),a.beginPath();for(var _=0,S=g.length;_<S;_++)g[_].draw(a,l,f);if(!l.clip){this._setStyles(a,l,c);var w=this._style;w.hasFill()&&(a.fill(w.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),w.hasStroke()&&a.stroke()}}},_drawSelected:function(a,l,c){for(var f=this._children,g=0,_=f.length;g<_;g++){var S=f[g],w=S._matrix;c[S._id]||S._drawSelected(a,w.isIdentity()?l:l.appended(w))}}},new function(){function a(l,c){var f=l._children;if(c&&!f.length)throw new Error("Use a moveTo() command first");return f[f.length-1]}return n.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(l){this[l]=function(){var c=a(this,!0);c[l].apply(c,arguments)}},{moveTo:function(){var l=a(this),c=l&&l.isEmpty()?l:new Gt(T.NO_INSERT);c!==l&&this.addChild(c),c.moveTo.apply(c,arguments)},moveBy:function(){var l=a(this,!0),c=l&&l.getLastSegment(),f=y.read(arguments);this.moveTo(c?f.add(c._point):f)},closePath:function(l){a(this,!0).closePath(l)}})},n.each(["reverse","flatten","simplify","smooth"],function(a){this[a]=function(l){for(var c=this._children,f,g=0,_=c.length;g<_;g++)f=c[g][a](l)||f;return f}},{}));kt.inject(new function(){var a=Math.min,l=Math.max,c=Math.abs,f={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function g(L){return L._children||[L]}function _(L,O){var A=L.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(O){for(var U=g(A),X=0,$=U.length;X<$;X++){var L=U[X];!L._closed&&!L.isEmpty()&&(L.closePath(1e-12),L.getFirstSegment().setHandleIn(0,0),L.getLastSegment().setHandleOut(0,0))}A=A.resolveCrossings().reorient(A.getFillRule()==="nonzero",!0)}return A}function S(L,O,A,U,X){var $=new vt(T.NO_INSERT);return $.addChildren(L,!0),$=$.reduce({simplify:O}),X&&X.insert==!1||$.insertAbove(U&&A.isSibling(U)&&A.getIndex()<U.getIndex()?U:A),$.copyAttributes(A,!0),$}function w(L){return L.hasOverlap()||L.isCrossing()}function C(L,O,A,U){if(U&&(U.trace==!1||U.stroke)&&/^(subtract|intersect)$/.test(A))return E(L,O,A);var X=_(L,!0),$=O&&L!==O&&_(O,!0),W=f[A];W[A]=!0,$&&(W.subtract||W.exclude)^($.isClockwise()^X.isClockwise())&&$.reverse();var Q=k(Rt.expand(X.getIntersections($,w))),et=g(X),rt=$&&g($),ot=[],J=[],nt;function lt($t){for(var ue=0,he=$t.length;ue<he;ue++){var pe=$t[ue];n.push(ot,pe._segments),n.push(J,pe.getCurves()),pe._overlapsOnly=!0}}function ft($t){for(var ue=[],he=0,pe=$t&&$t.length;he<pe;he++)ue.push(J[$t[he]]);return ue}if(Q.length){lt(et),rt&&lt(rt);for(var gt=new Array(J.length),yt=0,At=J.length;yt<At;yt++)gt[yt]=J[yt].getValues();for(var Bt=p.findCurveBoundsCollisions(gt,gt,0,!0),Ot={},yt=0;yt<J.length;yt++){var Wt=J[yt],Ct=Wt._path._id,Et=Ot[Ct]=Ot[Ct]||{};Et[Wt.getIndex()]={hor:ft(Bt[yt].hor),ver:ft(Bt[yt].ver)}}for(var yt=0,At=Q.length;yt<At;yt++)N(Q[yt]._segment,X,$,Ot,W);for(var yt=0,At=ot.length;yt<At;yt++){var Nt=ot[yt],jt=Nt._intersection;Nt._winding||N(Nt,X,$,Ot,W),jt&&jt._overlap||(Nt._path._overlapsOnly=!1)}nt=G(ot,W)}else nt=R(rt?et.concat(rt):et.slice(),function($t){return!!W[$t]});return S(nt,!0,L,O,U)}function E(L,O,A){var U=_(L),X=_(O),$=U.getIntersections(X,w),W=A==="subtract",Q=A==="divide",et={},rt=[];function ot(lt){if(!et[lt._id]&&(Q||X.contains(lt.getPointAt(lt.getLength()/2))^W))return rt.unshift(lt),et[lt._id]=!0}for(var J=$.length-1;J>=0;J--){var nt=$[J].split();nt&&(ot(nt)&&nt.getFirstSegment().setHandleIn(0,0),U.getLastSegment().setHandleOut(0,0))}return ot(U),S(rt,!1,L,O)}function B(L,O){for(var A=L;A;){if(A===O)return;A=A._previous}for(;L._next&&L._next!==O;)L=L._next;if(!L._next){for(;O._previous;)O=O._previous;L._next=O,O._previous=L}}function D(L){for(var O=L.length-1;O>=0;O--)L[O].clearHandles()}function R(L,O,A){var U=L&&L.length;if(U){var X=n.each(L,function(Bt,Ot){this[Bt._id]={container:null,winding:Bt.isClockwise()?1:-1,index:Ot}},{}),$=L.slice().sort(function(Bt,Ot){return c(Ot.getArea())-c(Bt.getArea())}),W=$[0],Q=p.findItemBoundsCollisions($,null,v.GEOMETRIC_EPSILON);A==null&&(A=W.isClockwise());for(var et=0;et<U;et++){var rt=$[et],ot=X[rt._id],J=0,nt=Q[et];if(nt){for(var lt=null,ft=nt.length-1;ft>=0;ft--)if(nt[ft]<et){lt=lt||rt.getInteriorPoint();var gt=$[nt[ft]];if(gt.contains(lt)){var yt=X[gt._id];J=yt.winding,ot.winding+=J,ot.container=yt.exclude?yt.container:gt;break}}}if(O(ot.winding)===O(J))ot.exclude=!0,L[ot.index]=null;else{var At=ot.container;rt.setClockwise(At?!At.isClockwise():A)}}}return L}function k(L,O,A){var U=O&&[],X=1e-8,$=1-X,W=!1,Q=A||[],et=A&&{},rt,ot,J;function nt(ue){return ue._path._id+"."+ue._segment1._index}for(var lt=(A&&A.length)-1;lt>=0;lt--){var ft=A[lt];ft._path&&(et[nt(ft)]=!0)}for(var lt=L.length-1;lt>=0;lt--){var gt=L[lt],yt=gt._time,At=yt,Bt=O&&!O(gt),ft=gt._curve,Ot;if(ft&&(ft!==ot?(W=!ft.hasHandles()||et&&et[nt(ft)],rt=[],J=null,ot=ft):J>=X&&(yt/=J)),Bt){rt&&rt.push(gt);continue}else O&&U.unshift(gt);if(J=At,yt<X)Ot=ft._segment1;else if(yt>$)Ot=ft._segment2;else{var Wt=ft.divideAtTime(yt,!0);W&&Q.push(ft,Wt),Ot=Wt._segment1;for(var Ct=rt.length-1;Ct>=0;Ct--){var Et=rt[Ct];Et._time=(Et._time-yt)/(1-yt)}}gt._setSegment(Ot);var Nt=Ot._intersection,jt=gt._intersection;if(Nt){B(Nt,jt);for(var $t=Nt;$t;)B($t._intersection,Nt),$t=$t._next}else Ot._intersection=jt}return A||D(Q),U||L}function H(L,O,A,U,X){var $=Array.isArray(O)?O:O[A?"hor":"ver"],W=A?1:0,Q=W^1,et=[L.x,L.y],rt=et[W],ot=et[Q],J=1e-9,nt=1e-6,lt=rt-J,ft=rt+J,gt=0,yt=0,At=0,Bt=0,Ot=!1,Wt=!1,Ct=1,Et=[],Nt,jt;function $t(ze){var si=ze[Q+0],zi=ze[Q+6];if(!(ot<a(si,zi)||ot>l(si,zi))){var vi=ze[W+0],Ki=ze[W+2],Bi=ze[W+4],ei=ze[W+6];if(si===zi){(vi<ft&&ei>lt||ei<ft&&vi>lt)&&(Ot=!0);return}var or=ot===si?0:ot===zi||lt>l(vi,Ki,Bi,ei)||ft<a(vi,Ki,Bi,ei)?1:_t.solveCubic(ze,Q,ot,Et,0,1)>0?Et[0]:1,Gi=or===0?vi:or===1?ei:_t.getPoint(ze,or)[A?"y":"x"],Qi=si>zi?1:-1,Fr=Nt[Q]>Nt[Q+6]?1:-1,lr=Nt[W+6];return ot!==si?(Gi<lt?At+=Qi:Gi>ft?Bt+=Qi:Ot=!0,Gi>rt-nt&&Gi<rt+nt&&(Ct/=2)):(Qi!==Fr?vi<lt?At+=Qi:vi>ft&&(Bt+=Qi):vi!=lr&&(lr<ft&&Gi>ft?(Bt+=Qi,Ot=!0):lr>lt&&Gi<lt&&(At+=Qi,Ot=!0)),Ct/=4),Nt=ze,!X&&Gi>lt&&Gi<ft&&_t.getTangent(ze,or)[A?"x":"y"]===0&&H(L,O,!A,U,!0)}}function ue(ze){var si=ze[Q+0],zi=ze[Q+2],vi=ze[Q+4],Ki=ze[Q+6];if(ot<=l(si,zi,vi,Ki)&&ot>=a(si,zi,vi,Ki)){for(var Bi=ze[W+0],ei=ze[W+2],or=ze[W+4],Gi=ze[W+6],Qi=lt>l(Bi,ei,or,Gi)||ft<a(Bi,ei,or,Gi)?[ze]:_t.getMonoCurves(ze,A),Fr,lr=0,zn=Qi.length;lr<zn;lr++)if(Fr=$t(Qi[lr]))return Fr}}for(var he=0,pe=$.length;he<pe;he++){var me=$[he],ce=me._path,_i=me.getValues(),zt;if((!he||$[he-1]._path!==ce)&&(Nt=null,ce._closed||(jt=_t.getValues(ce.getLastCurve().getSegment2(),me.getSegment1(),null,!U),jt[Q]!==jt[Q+6]&&(Nt=jt)),!Nt)){Nt=_i;for(var He=ce.getLastCurve();He&&He!==me;){var ti=He.getValues();if(ti[Q]!==ti[Q+6]){Nt=ti;break}He=He.getPrevious()}}if(zt=ue(_i))return zt;if(he+1===pe||$[he+1]._path!==ce){if(jt&&(zt=ue(jt)))return zt;Ot&&!At&&!Bt&&(At=Bt=ce.isClockwise(U)^A?1:-1),gt+=At,yt+=Bt,At=Bt=0,Ot&&(Wt=!0,Ot=!1),jt=null}}return gt=c(gt),yt=c(yt),{winding:l(gt,yt),windingL:gt,windingR:yt,quality:Ct,onPath:Wt}}function N(L,O,A,U,X){var $=[],W=L,Q=0,J;do{var et=L.getCurve();if(et){var rt=et.getLength();$.push({segment:L,curve:et,length:rt}),Q+=rt}L=L.getNext()}while(L&&!L._intersection&&L!==W);for(var ot=[.5,.25,.75],J={winding:0,quality:-1},nt=.001,lt=1-nt,ft=0;ft<ot.length&&J.quality<.5;ft++)for(var rt=Q*ot[ft],gt=0,yt=$.length;gt<yt;gt++){var At=$[gt],Bt=At.length;if(rt<=Bt){var et=At.curve,Ot=et._path,Wt=Ot._parent,Ct=Wt instanceof vt?Wt:Ot,Et=v.clamp(et.getTimeAt(rt),nt,lt),Nt=et.getPointAtTime(Et),jt=c(et.getTangentAtTime(Et).y)<Math.SQRT1_2,$t=null;if(X.subtract&&A){var ue=Ct===O?A:O,he=ue._getWinding(Nt,jt,!0);if(Ct===O&&he.winding||Ct===A&&!he.winding){if(he.quality<1)continue;$t={winding:0,quality:1}}}$t=$t||H(Nt,U[Ot._id][et.getIndex()],jt,!0),$t.quality>J.quality&&(J=$t);break}rt-=Bt}for(var gt=$.length-1;gt>=0;gt--)$[gt].segment._winding=J}function G(L,O){var A=[],U;function X(pe){var me;return!!(pe&&!pe._visited&&(!O||O[(me=pe._winding||{}).winding]&&!(O.unite&&me.winding===2&&me.windingL&&me.windingR)))}function $(pe){if(pe){for(var me=0,ce=U.length;me<ce;me++)if(pe===U[me])return!0}return!1}function W(pe){for(var me=pe._segments,ce=0,_i=me.length;ce<_i;ce++)me[ce]._visited=!0}function Q(pe,me){var ce=pe._intersection,_i=ce,zt=[];me&&(U=[pe]);function He(ti,ze){for(;ti&&ti!==ze;){var si=ti._segment,zi=si&&si._path;if(zi){var vi=si.getNext()||zi.getFirstSegment(),Ki=vi._intersection;si!==pe&&($(si)||$(vi)||vi&&X(si)&&(X(vi)||Ki&&X(Ki._segment)))&&zt.push(si),me&&U.push(si)}ti=ti._next}}if(ce){for(He(ce);ce&&ce._previous;)ce=ce._previous;He(ce,_i)}return zt}L.sort(function(pe,me){var ce=pe._intersection,_i=me._intersection,zt=!!(ce&&ce._overlap),He=!!(_i&&_i._overlap),ti=pe._path,ze=me._path;return zt^He?zt?1:-1:!ce^!_i?ce?1:-1:ti!==ze?ti._id-ze._id:pe._index-me._index});for(var et=0,rt=L.length;et<rt;et++){var ot=L[et],J=X(ot),nt=null,lt=!1,ft=!0,gt=[],yt,At,Bt;if(J&&ot._path._overlapsOnly){var Ot=ot._path,Wt=ot._intersection._segment._path;Ot.compare(Wt)&&(Ot.getArea()&&A.push(Ot.clone(!1)),W(Ot),W(Wt),J=!1)}for(;J;){var Ct=!nt,Et=Q(ot,Ct),Nt=Et.shift(),lt=!Ct&&($(ot)||$(Nt)),jt=!lt&&Nt;if(Ct&&(nt=new Gt(T.NO_INSERT),yt=null),lt){(ot.isFirst()||ot.isLast())&&(ft=ot._path._closed),ot._visited=!0;break}if(jt&&yt&&(gt.push(yt),yt=null),yt||(jt&&Et.push(ot),yt={start:nt._segments.length,crossings:Et,visited:At=[],handleIn:Bt}),jt&&(ot=Nt),!X(ot)){nt.removeSegments(yt.start);for(var $t=0,ue=At.length;$t<ue;$t++)At[$t]._visited=!1;At.length=0;do ot=yt&&yt.crossings.shift(),(!ot||!ot._path)&&(ot=null,yt=gt.pop(),yt&&(At=yt.visited,Bt=yt.handleIn));while(yt&&!X(ot));if(!ot)break}var he=ot.getNext();nt.add(new ht(ot._point,Bt,he&&ot._handleOut)),ot._visited=!0,At.push(ot),ot=he||ot._path.getFirstSegment(),Bt=he&&he._handleIn}lt&&(ft&&(nt.getFirstSegment().setHandleIn(Bt),nt.setClosed(ft)),nt.getArea()!==0&&A.push(nt))}return A}return{_getWinding:function(L,O,A){return H(L,this.getCurves(),O,A)},unite:function(L,O){return C(this,L,"unite",O)},intersect:function(L,O){return C(this,L,"intersect",O)},subtract:function(L,O){return C(this,L,"subtract",O)},exclude:function(L,O){return C(this,L,"exclude",O)},divide:function(L,O){return O&&(O.trace==!1||O.stroke)?E(this,L,"divide"):S([this.subtract(L,O),this.intersect(L,O)],!0,this,L,O)},resolveCrossings:function(){var L=this._children,O=L||[this];function A(yt,At){var Bt=yt&&yt._intersection;return Bt&&Bt._overlap&&Bt._path===At}var U=!1,X=!1,$=this.getIntersections(null,function(yt){return yt.hasOverlap()&&(U=!0)||yt.isCrossing()&&(X=!0)}),W=U&&X&&[];if($=Rt.expand($),U)for(var Q=k($,function(yt){return yt.hasOverlap()},W),et=Q.length-1;et>=0;et--){var rt=Q[et],ot=rt._path,J=rt._segment,nt=J.getPrevious(),lt=J.getNext();A(nt,ot)&&A(lt,ot)&&(J.remove(),nt._handleOut._set(0,0),lt._handleIn._set(0,0),nt!==J&&!nt.getCurve().hasLength()&&(lt._handleIn.set(nt._handleIn),nt.remove()))}X&&(k($,U&&function(yt){var At=yt.getCurve(),Bt=yt.getSegment(),Ot=yt._intersection,Wt=Ot._curve,Ct=Ot._segment;if(At&&Wt&&At._path&&Wt._path)return!0;Bt&&(Bt._intersection=null),Ct&&(Ct._intersection=null)},W),W&&D(W),O=G(n.each(O,function(yt){n.push(this,yt._segments)},[])));var ft=O.length,gt;return ft>1&&L?(O!==L&&this.setChildren(O),gt=this):ft===1&&!L&&(O[0]!==this&&this.setSegments(O[0].removeSegments()),gt=this),gt||(gt=new vt(T.NO_INSERT),gt.addChildren(O),gt=gt.reduce(),gt.copyAttributes(this),this.replaceWith(gt)),gt},reorient:function(L,O){var A=this._children;return A&&A.length?this.setChildren(R(this.removeChildren(),function(U){return!!(L?U:U&1)},O)):O!==e&&this.setClockwise(O),this},getInteriorPoint:function(){var L=this.getBounds(),O=L.getCenter(!0);if(!this.contains(O)){for(var A=this.getCurves(),U=O.y,X=[],$=[],W=0,Q=A.length;W<Q;W++){var et=A[W].getValues(),rt=et[1],ot=et[3],J=et[5],nt=et[7];if(U>=a(rt,ot,J,nt)&&U<=l(rt,ot,J,nt))for(var lt=_t.getMonoCurves(et),ft=0,gt=lt.length;ft<gt;ft++){var yt=lt[ft],At=yt[1],Bt=yt[7];if(At!==Bt&&(U>=At&&U<=Bt||U>=Bt&&U<=At)){var Ot=U===At?yt[0]:U===Bt?yt[6]:_t.solveCubic(yt,1,U,$,0,1)===1?_t.getPoint(yt,$[0]).x:(yt[0]+yt[6])/2;X.push(Ot)}}}X.length>1&&(X.sort(function(Wt,Ct){return Wt-Ct}),O.x=(X[0]+X[1])/2)}return O}}});var Pt=n.extend({_class:"PathFlattener",initialize:function(a,l,c,f,g){var _=[],S=[],w=0,C=1/(c||32),E=a._segments,B=E[0],D;function R(G,L){var O=_t.getValues(G,L,g);_.push(O),k(O,G._index,0,1)}function k(G,L,O,A){if(A-O>C&&!(f&&_t.isStraight(G))&&!_t.isFlatEnough(G,l||.25)){var U=_t.subdivide(G,.5),X=(O+A)/2;k(U[0],L,O,X),k(U[1],L,X,A)}else{var $=G[6]-G[0],W=G[7]-G[1],Q=Math.sqrt($*$+W*W);Q>0&&(w+=Q,S.push({offset:w,curve:G,index:L,time:A}))}}for(var H=1,N=E.length;H<N;H++)D=E[H],R(B,D),B=D;a._closed&&R(D||B,E[0]),this.curves=_,this.parts=S,this.length=w,this.index=0},_get:function(a){for(var l=this.parts,c=l.length,f,g=this.index;f=g,!(!g||l[--g].offset<a););for(;f<c;f++){var _=l[f];if(_.offset>=a){this.index=f;var S=l[f-1],w=S&&S.index===_.index?S.time:0,C=S?S.offset:0;return{index:_.index,time:w+(_.time-w)*(a-C)/(_.offset-C)}}}return{index:l[c-1].index,time:1}},drawPart:function(a,l,c){for(var f=this._get(l),g=this._get(c),_=f.index,S=g.index;_<=S;_++){var w=_t.getPart(this.curves[_],_===f.index?f.time:0,_===g.index?g.time:1);_===f.index&&a.moveTo(w[0],w[1]),a.bezierCurveTo.apply(a,w.slice(2))}}},n.each(_t._evaluateMethods,function(a){this[a+"At"]=function(l){var c=this._get(l);return _t[a](this.curves[c.index],c.time)}},{})),Vt=n.extend({initialize:function(a){for(var l=this.points=[],c=a._segments,f=a._closed,g=0,_,S=c.length;g<S;g++){var w=c[g].point;(!_||!_.equals(w))&&l.push(_=w.clone())}f&&(l.unshift(l[l.length-1]),l.push(l[1])),this.closed=f},fit:function(a){var l=this.points,c=l.length,f=null;return c>0&&(f=[new ht(l[0])],c>1&&(this.fitCubic(f,a,0,c-1,l[1].subtract(l[0]),l[c-2].subtract(l[c-1])),this.closed&&(f.shift(),f.pop()))),f},fitCubic:function(a,l,c,f,g,_){var S=this.points;if(f-c===1){var w=S[c],C=S[f],E=w.getDistance(C)/3;this.addCurve(a,[w,w.add(g.normalize(E)),C.add(_.normalize(E)),C]);return}for(var B=this.chordLengthParameterize(c,f),D=Math.max(l,l*l),R,k=!0,H=0;H<=4;H++){var N=this.generateBezier(c,f,B,g,_),G=this.findMaxError(c,f,N,B);if(G.error<l&&k){this.addCurve(a,N);return}if(R=G.index,G.error>=D)break;k=this.reparameterize(c,f,B,N),D=G.error}var L=S[R-1].subtract(S[R+1]);this.fitCubic(a,l,c,R,g,L),this.fitCubic(a,l,R,f,L.negate(),_)},addCurve:function(a,l){var c=a[a.length-1];c.setHandleOut(l[1].subtract(l[0])),a.push(new ht(l[3],l[2].subtract(l[3])))},generateBezier:function(a,l,c,f,g){for(var _=1e-12,S=Math.abs,w=this.points,C=w[a],E=w[l],B=[[0,0],[0,0]],D=[0,0],R=0,k=l-a+1;R<k;R++){var H=c[R],N=1-H,G=3*H*N,L=N*N*N,O=G*N,A=G*H,U=H*H*H,X=f.normalize(O),$=g.normalize(A),W=w[a+R].subtract(C.multiply(L+O)).subtract(E.multiply(A+U));B[0][0]+=X.dot(X),B[0][1]+=X.dot($),B[1][0]=B[0][1],B[1][1]+=$.dot($),D[0]+=X.dot(W),D[1]+=$.dot(W)}var Q=B[0][0]*B[1][1]-B[1][0]*B[0][1],et,rt;if(S(Q)>_){var ot=B[0][0]*D[1]-B[1][0]*D[0],J=D[0]*B[1][1]-D[1]*B[0][1];et=J/Q,rt=ot/Q}else{var nt=B[0][0]+B[0][1],lt=B[1][0]+B[1][1];et=rt=S(nt)>_?D[0]/nt:S(lt)>_?D[1]/lt:0}var ft=E.getDistance(C),gt=_*ft,yt,At;if(et<gt||rt<gt)et=rt=ft/3;else{var Bt=E.subtract(C);yt=f.normalize(et),At=g.normalize(rt),yt.dot(Bt)-At.dot(Bt)>ft*ft&&(et=rt=ft/3,yt=At=null)}return[C,C.add(yt||f.normalize(et)),E.add(At||g.normalize(rt)),E]},reparameterize:function(a,l,c,f){for(var g=a;g<=l;g++)c[g-a]=this.findRoot(f,this.points[g],c[g-a]);for(var g=1,_=c.length;g<_;g++)if(c[g]<=c[g-1])return!1;return!0},findRoot:function(a,l,c){for(var f=[],g=[],_=0;_<=2;_++)f[_]=a[_+1].subtract(a[_]).multiply(3);for(var _=0;_<=1;_++)g[_]=f[_+1].subtract(f[_]).multiply(2);var S=this.evaluate(3,a,c),w=this.evaluate(2,f,c),C=this.evaluate(1,g,c),E=S.subtract(l),B=w.dot(w)+E.dot(C);return v.isMachineZero(B)?c:c-E.dot(w)/B},evaluate:function(a,l,c){for(var f=l.slice(),g=1;g<=a;g++)for(var _=0;_<=a-g;_++)f[_]=f[_].multiply(1-c).add(f[_+1].multiply(c));return f[0]},chordLengthParameterize:function(a,l){for(var c=[0],f=a+1;f<=l;f++)c[f-a]=c[f-a-1]+this.points[f].getDistance(this.points[f-1]);for(var f=1,g=l-a;f<=g;f++)c[f]/=c[g];return c},findMaxError:function(a,l,c,f){for(var g=Math.floor((l-a+1)/2),_=0,S=a+1;S<l;S++){var w=this.evaluate(3,c,f[S-a]),C=w.subtract(this.points[S]),E=C.x*C.x+C.y*C.y;E>=_&&(_=E,g=S)}return{error:_,index:g}}}),le=T.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(l){this._content="",this._lines=[];var c=l&&n.isPlainObject(l)&&l.x===e&&l.y===e;this._initialize(c&&l,!c&&y.read(arguments))},_equals:function(a){return this._content===a._content},copyContent:function(a){this.setContent(a._content)},getContent:function(){return this._content},setContent:function(a){this._content=""+a,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),re=le.extend({_class:"PointText",initialize:function(){le.apply(this,arguments)},getPoint:function(){var a=this._matrix.getTranslation();return new P(a.x,a.y,this,"setPoint")},setPoint:function(){var a=y.read(arguments);this.translate(a.subtract(this._matrix.getTranslation()))},_draw:function(a,l,c){if(this._content){this._setStyles(a,l,c);var f=this._lines,g=this._style,_=g.hasFill(),S=g.hasStroke(),w=g.getLeading(),C=a.shadowColor;a.font=g.getFontStyle(),a.textAlign=g.getJustification();for(var E=0,B=f.length;E<B;E++){a.shadowColor=C;var D=f[E];_&&(a.fillText(D,0,0),a.shadowColor="rgba(0,0,0,0)"),S&&a.strokeText(D,0,0),a.translate(0,w)}}},_getBounds:function(a,l){var c=this._style,f=this._lines,g=f.length,_=c.getJustification(),S=c.getLeading(),w=this.getView().getTextWidth(c.getFontStyle(),f),C=0;_!=="left"&&(C-=w/(_==="center"?2:1));var E=new q(C,g?-.75*S:0,w,g*S);return a?a._transformBounds(E,E):E}}),ee=n.extend(new function(){var a={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},l={},c={transparent:[0,0,0,0]},f;function g(w){var C=w.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||w.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),E="rgb",B;if(C){var D=C[4]?4:3;B=new Array(D);for(var R=0;R<D;R++){var k=C[R+1];B[R]=parseInt(k.length==1?k+k:k,16)/255}}else if(C=w.match(/^(rgb|hsl)a?\((.*)\)$/)){E=C[1],B=C[2].trim().split(/[,\s]+/g);for(var H=E==="hsl",R=0,N=Math.min(B.length,4);R<N;R++){var G=B[R],k=parseFloat(G);if(H)if(R===0){var L=G.match(/([a-z]*)$/)[1];k*={turn:360,rad:180/Math.PI,grad:.9}[L]||1}else R<3&&(k/=100);else R<3&&(k/=/%$/.test(G)?100:255);B[R]=k}}else{var O=c[w];if(!O)if(i){f||(f=qe.getContext(1,1,{willReadFrequently:!0}),f.globalCompositeOperation="copy"),f.fillStyle="rgba(0,0,0,0)",f.fillStyle=w,f.fillRect(0,0,1,1);var A=f.getImageData(0,0,1,1).data;O=c[w]=[A[0]/255,A[1]/255,A[2]/255]}else O=[0,0,0];B=O.slice()}return[E,B]}var _=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],S={"rgb-hsb":function(w,C,E){var B=Math.max(w,C,E),D=Math.min(w,C,E),R=B-D,k=R===0?0:(B==w?(C-E)/R+(C<E?6:0):B==C?(E-w)/R+2:(w-C)/R+4)*60;return[k,B===0?0:R/B,B]},"hsb-rgb":function(w,C,E){w=(w/60%6+6)%6;var D=Math.floor(w),B=w-D,D=_[D],R=[E,E*(1-C),E*(1-C*B),E*(1-C*(1-B))];return[R[D[0]],R[D[1]],R[D[2]]]},"rgb-hsl":function(w,C,E){var B=Math.max(w,C,E),D=Math.min(w,C,E),R=B-D,k=R===0,H=k?0:(B==w?(C-E)/R+(C<E?6:0):B==C?(E-w)/R+2:(w-C)/R+4)*60,N=(B+D)/2,G=k?0:N<.5?R/(B+D):R/(2-B-D);return[H,G,N]},"hsl-rgb":function(w,C,E){if(w=(w/360%1+1)%1,C===0)return[E,E,E];for(var B=[w+1/3,w,w-1/3],D=E<.5?E*(1+C):E+C-E*C,R=2*E-D,k=[],H=0;H<3;H++){var N=B[H];N<0&&(N+=1),N>1&&(N-=1),k[H]=6*N<1?R+(D-R)*6*N:2*N<1?D:3*N<2?R+(D-R)*(2/3-N)*6:R}return k},"rgb-gray":function(w,C,E){return[w*.2989+C*.587+E*.114]},"gray-rgb":function(w){return[w,w,w]},"gray-hsb":function(w){return[0,0,w]},"gray-hsl":function(w){return[0,0,w]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return n.each(a,function(w,C){l[C]=[],n.each(w,function(E,B){var D=n.capitalize(E),R=/^(hue|saturation)$/.test(E),k=l[C][B]=C==="gradient"?E==="gradient"?function(H){var N=this._components[0];return H=Qt.read(Array.isArray(H)?H:arguments,0,{readNull:!0}),N!==H&&(N&&N._removeOwner(this),H&&H._addOwner(this)),H}:function(){return y.read(arguments,0,{readNull:E==="highlight",clone:!0})}:function(H){return H==null||isNaN(H)?0:+H};this["get"+D]=function(){return this._type===C||R&&/^hs[bl]$/.test(this._type)?this._components[B]:this._convert(C)[B]},this["set"+D]=function(H){this._type!==C&&!(R&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(C),this._properties=a[C],this._type=C),this._components[B]=k.call(this,H),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function w(C){var E=arguments,B=this.__read,D=0,R,k,H,N;Array.isArray(C)&&(E=C,C=E[0]);var G=C!=null&&typeof C;if(G==="string"&&C in a&&(R=C,C=E[1],Array.isArray(C)?(k=C,H=E[2]):(B&&(D=1),E=n.slice(E,1),G=typeof C)),!k){if(N=G==="number"?E:G==="object"&&C.length!=null?C:null,N){R||(R=N.length>=3?"rgb":"gray");var L=a[R].length;H=N[L],B&&(D+=N===arguments?L+(H!=null?1:0):1),N.length>L&&(N=n.slice(N,0,L))}else if(G==="string"){var O=g(C);R=O[0],k=O[1],k.length===4&&(H=k[3],k.length--)}else if(G==="object")if(C.constructor===w){if(R=C._type,k=C._components.slice(),H=C._alpha,R==="gradient")for(var A=1,U=k.length;A<U;A++){var X=k[A];X&&(k[A]=X.clone())}}else if(C.constructor===Qt)R="gradient",N=E;else{R="hue"in C?"lightness"in C?"hsl":"hsb":"gradient"in C||"stops"in C||"radial"in C?"gradient":"gray"in C?"gray":"rgb";var $=a[R],W=l[R];this._components=k=[];for(var A=0,U=$.length;A<U;A++){var Q=C[$[A]];Q==null&&!A&&R==="gradient"&&"stops"in C&&(Q={stops:C.stops,radial:C.radial}),Q=W[A].call(this,Q),Q!=null&&(k[A]=Q)}H=C.alpha}B&&R&&(D=1)}if(this._type=R||"rgb",!k){this._components=k=[];for(var W=l[this._type],A=0,U=W.length;A<U;A++){var Q=W[A].call(this,N&&N[A]);Q!=null&&(k[A]=Q)}}return this._components=k,this._properties=a[this._type],this._alpha=H,B&&(this.__read=D),this},set:"#initialize",_serialize:function(w,C){var E=this.getComponents();return n.serialize(/^(gray|rgb)$/.test(this._type)?E:[this._type].concat(E),w,!0,C)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(w){var C;return this._type===w?this._components.slice():(C=S[this._type+"-"+w])?C.apply(this,this._components):S["rgb-"+w].apply(this,S[this._type+"-rgb"].apply(this,this._components))},convert:function(w){return new ee(w,this._convert(w),this._alpha)},getType:function(){return this._type},setType:function(w){this._components=this._convert(w),this._properties=a[w],this._type=w},getComponents:function(){var w=this._components.slice();return this._alpha!=null&&w.push(this._alpha),w},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(w){this._alpha=w==null?null:Math.min(Math.max(w,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(w){var C=n.isPlainValue(w,!0)?ee.read(arguments):w;return C===this||C&&this._class===C._class&&this._type===C._type&&this.getAlpha()===C.getAlpha()&&n.equals(this._components,C._components)||!1},toString:function(){for(var w=this._properties,C=[],E=this._type==="gradient",B=m.instance,D=0,R=w.length;D<R;D++){var k=this._components[D];k!=null&&C.push(w[D]+": "+(E?k:B.number(k)))}return this._alpha!=null&&C.push("alpha: "+B.number(this._alpha)),"{ "+C.join(", ")+" }"},toCSS:function(w){var C=this._convert("rgb"),E=w||this._alpha==null?1:this._alpha;function B(D){return Math.round((D<0?0:D>1?1:D)*255)}return C=[B(C[0]),B(C[1]),B(C[2])],E<1&&C.push(E<0?0:E),w?"#"+((1<<24)+(C[0]<<16)+(C[1]<<8)+C[2]).toString(16).slice(1):(C.length==4?"rgba(":"rgb(")+C.join(",")+")"},toCanvasStyle:function(w,C){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var E=this._components,B=E[0],D=B._stops,R=E[1],k=E[2],H=E[3],N=C&&C.inverted(),G;if(N&&(R=N._transformPoint(R),k=N._transformPoint(k),H&&(H=N._transformPoint(H))),B._radial){var L=k.getDistance(R);if(H){var O=H.subtract(R);O.getLength()>L&&(H=R.add(O.normalize(L-.1)))}var A=H||R;G=w.createRadialGradient(A.x,A.y,0,R.x,R.y,L)}else G=w.createLinearGradient(R.x,R.y,k.x,k.y);for(var U=0,X=D.length;U<X;U++){var $=D[U],W=$._offset;G.addColorStop(W??U/(X-1),$._color.toCanvasStyle())}return this._canvasStyle=G},transform:function(w){if(this._type==="gradient"){for(var C=this._components,E=1,B=C.length;E<B;E++){var D=C[E];w._transformPoint(D,D,!0)}this._changed()}},statics:{_types:a,random:function(){var w=Math.random;return new ee(w(),w(),w())},_setOwner:function(w,C,E){return w&&(w._owner&&C&&w._owner!==C&&(w=w.clone()),!w._owner^!C&&(w._owner=C||null,w._setter=E||null)),w}}})},new function(){var a={add:function(l,c){return l+c},subtract:function(l,c){return l-c},multiply:function(l,c){return l*c},divide:function(l,c){return l/c}};return n.each(a,function(l,c){this[c]=function(f){f=ee.read(arguments);for(var g=this._type,_=this._components,S=f._convert(g),w=0,C=_.length;w<C;w++)S[w]=l(_[w],S[w]);return new ee(g,S,this._alpha!=null?l(this._alpha,f.getAlpha()):null)}},{})}),Qt=n.extend({_class:"Gradient",initialize:function(l,c){this._id=b.get(),l&&n.isPlainObject(l)&&(this.set(l),l=c=null),this._stops==null&&this.setStops(l||["white","black"]),this._radial==null&&this.setRadial(typeof c=="string"&&c==="radial"||c||!1)},_serialize:function(a,l){return l.add(this,function(){return n.serialize([this._stops,this._radial],a,!0,l)})},_changed:function(){for(var a=0,l=this._owners&&this._owners.length;a<l;a++)this._owners[a]._changed()},_addOwner:function(a){this._owners||(this._owners=[]),this._owners.push(a)},_removeOwner:function(a){var l=this._owners?this._owners.indexOf(a):-1;l!=-1&&(this._owners.splice(l,1),this._owners.length||(this._owners=e))},clone:function(){for(var a=[],l=0,c=this._stops.length;l<c;l++)a[l]=this._stops[l].clone();return new Qt(a,this._radial)},getStops:function(){return this._stops},setStops:function(a){if(a.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var l=this._stops;if(l)for(var c=0,f=l.length;c<f;c++)l[c]._owner=e;l=this._stops=xe.readList(a,0,{clone:!0});for(var c=0,f=l.length;c<f;c++)l[c]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(a){this._radial=a,this._changed()},equals:function(a){if(a===this)return!0;if(a&&this._class===a._class){var l=this._stops,c=a._stops,f=l.length;if(f===c.length){for(var g=0;g<f;g++)if(!l[g].equals(c[g]))return!1;return!0}}return!1}}),xe=n.extend({_class:"GradientStop",initialize:function(l,c){var f=l,g=c;typeof l=="object"&&c===e&&(Array.isArray(l)&&typeof l[0]!="number"?(f=l[0],g=l[1]):("color"in l||"offset"in l||"rampPoint"in l)&&(f=l.color,g=l.offset||l.rampPoint||0)),this.setColor(f),this.setOffset(g)},clone:function(){return new xe(this._color.clone(),this._offset)},_serialize:function(a,l){var c=this._color,f=this._offset;return n.serialize(f==null?[c]:[c,f],a,!0,l)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(a){this._offset=a,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){ee._setOwner(this._color,null),this._color=ee._setOwner(ee.read(arguments,0),this,"setColor"),this._changed()},equals:function(a){return a===this||a&&this._class===a._class&&this._color.equals(a._color)&&this._offset==a._offset||!1}}),Fe=n.extend(new function(){var a={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new y,selectedColor:null},l=n.set({},a,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),c=n.set({},l,{fillColor:new ee}),f={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},g={beans:!0},_={_class:"Style",beans:!0,initialize:function(w,C,E){this._values={},this._owner=C,this._project=C&&C._project||E||be.project,this._defaults=!C||C instanceof at?l:C instanceof le?c:a,w&&this.set(w)}};return n.each(l,function(S,w){var C=/Color$/.test(w),E=w==="shadowOffset",B=n.capitalize(w),D=f[w],R="set"+B,k="get"+B;_[R]=function(H){var N=this._owner,G=N&&N._children,L=G&&G.length>0&&!(N instanceof vt);if(L)for(var O=0,A=G.length;O<A;O++)G[O]._style[R](H);if((w==="selectedColor"||!L)&&w in this._defaults){var U=this._values[w];U!==H&&(C&&(U&&(ee._setOwner(U,null),U._canvasStyle=null),H&&H.constructor===ee&&(H=ee._setOwner(H,N,L&&R))),this._values[w]=H,N&&N._changed(D||129))}},_[k]=function(H){var N=this._owner,G=N&&N._children,L=G&&G.length>0&&!(N instanceof vt),O;if(L&&!H)for(var A=0,U=G.length;A<U;A++){var X=G[A]._style[k]();if(!A)O=X;else if(!n.equals(O,X))return e}else if(w in this._defaults){var O=this._values[w];if(O===e)O=this._defaults[w],O&&O.clone&&(O=O.clone());else{var $=C?ee:E?y:null;$&&!(O&&O.constructor===$)&&(this._values[w]=O=$.read([O],0,{readNull:!0,clone:!0}))}}return O&&C&&(O=ee._setOwner(O,N,L&&R)),O},g[k]=function(H){return this._style[k](H)},g[R]=function(H){this._style[R](H)}}),n.each({Font:"FontFamily",WindingRule:"FillRule"},function(S,w){var C="get"+w,E="set"+w;_[C]=g[C]="#get"+S,_[E]=g[E]="#set"+S}),T.inject(g),_},{set:function(a){var l=a instanceof Fe,c=l?a._values:a;if(c){for(var f in c)if(f in this._defaults){var g=c[f];this[f]=g&&l&&g.clone?g.clone():g}}},equals:function(a){function l(c,f,g){var _=c._values,S=f._values,w=f._defaults;for(var C in _){var E=_[C],B=S[C];if(!(g&&C in S)&&!n.equals(E,B===e?w[C]:B))return!1}return!0}return a===this||a&&this._class===a._class&&l(this,a)&&l(a,this,!0)||!1},_dispose:function(){var a;a=this.getFillColor(),a&&(a._canvasStyle=null),a=this.getStrokeColor(),a&&(a._canvasStyle=null),a=this.getShadowColor(),a&&(a._canvasStyle=null)},hasFill:function(){var a=this.getFillColor();return!!a&&a.alpha>0},hasStroke:function(){var a=this.getStrokeColor();return!!a&&a.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var a=this.getShadowColor();return!!a&&a.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var a=this.getFontSize();return this.getFontWeight()+" "+a+(/[a-z]/i.test(a+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function a(){var l=a.base.call(this),c=this.getFontSize();return/pt|em|%|px/.test(c)&&(c=this.getView().getPixelSize(c)),l??c*1.2}}),se=new function(){function a(l,c,f,g){for(var _=["","webkit","moz","Moz","ms","o"],S=c[0].toUpperCase()+c.substring(1),w=0;w<6;w++){var C=_[w],E=C?C+S:c;if(E in l){if(f)l[E]=g;else return l[E];break}}}return{getStyles:function(l){var c=l&&l.nodeType!==9?l.ownerDocument:l,f=c&&c.defaultView;return f&&f.getComputedStyle(l,"")},getBounds:function(l,c){var f=l.ownerDocument,g=f.body,_=f.documentElement,S;try{S=l.getBoundingClientRect()}catch{S={left:0,top:0,width:0,height:0}}var w=S.left-(_.clientLeft||g.clientLeft||0),C=S.top-(_.clientTop||g.clientTop||0);if(!c){var E=f.defaultView;w+=E.pageXOffset||_.scrollLeft||g.scrollLeft,C+=E.pageYOffset||_.scrollTop||g.scrollTop}return new q(w,C,S.width,S.height)},getViewportBounds:function(l){var c=l.ownerDocument,f=c.defaultView,g=c.documentElement;return new q(0,0,f.innerWidth||g.clientWidth,f.innerHeight||g.clientHeight)},getOffset:function(l,c){return se.getBounds(l,c).getPoint()},getSize:function(l){return se.getBounds(l,!0).getSize()},isInvisible:function(l){return se.getSize(l).equals(new M(0,0))},isInView:function(l){return!se.isInvisible(l)&&se.getViewportBounds(l).intersects(se.getBounds(l,!0))},isInserted:function(l){return s.body.contains(l)},getPrefixed:function(l,c){return l&&a(l,c)},setPrefixed:function(l,c,f){if(typeof c=="object")for(var g in c)a(l,g,!0,c[g]);else a(l,c,!0,f)}}},ne={add:function(a,l){if(a)for(var c in l)for(var f=l[c],g=c.split(/[\s,]+/g),_=0,S=g.length;_<S;_++){var w=g[_],C=a===s&&(w==="touchstart"||w==="touchmove")?{passive:!1}:!1;a.addEventListener(w,f,C)}},remove:function(a,l){if(a)for(var c in l)for(var f=l[c],g=c.split(/[\s,]+/g),_=0,S=g.length;_<S;_++)a.removeEventListener(g[_],f,!1)},getPoint:function(a){var l=a.targetTouches?a.targetTouches.length?a.targetTouches[0]:a.changedTouches[0]:a;return new y(l.pageX||l.clientX+s.documentElement.scrollLeft,l.pageY||l.clientY+s.documentElement.scrollTop)},getTarget:function(a){return a.target||a.srcElement},getRelatedTarget:function(a){return a.relatedTarget||a.toElement},getOffset:function(a,l){return ne.getPoint(a).subtract(se.getOffset(l||ne.getTarget(a)))}};ne.requestAnimationFrame=new function(){var a=se.getPrefixed(i,"requestAnimationFrame"),l=!1,c=[],f;function g(){var _=c;c=[];for(var S=0,w=_.length;S<w;S++)_[S]();l=a&&c.length,l&&a(g)}return function(_){c.push(_),a?l||(a(g),l=!0):f||(f=setInterval(g,1e3/60))}};var Zt=n.extend(o,{_class:"View",initialize:function a(l,c){function f(D){return c[D]||parseInt(c.getAttribute(D),10)}function g(){var D=se.getSize(c);return D.isNaN()||D.isZero()?new M(f("width"),f("height")):D}var _;if(i&&c){this._id=c.getAttribute("id"),this._id==null&&c.setAttribute("id",this._id="paper-view-"+a._id++),ne.add(c,this._viewEvents);var S="none";if(se.setPrefixed(c.style,{userDrag:S,userSelect:S,touchCallout:S,contentZooming:S,tapHighlightColor:"rgba(0,0,0,0)"}),h.hasAttribute(c,"resize")){var w=this;ne.add(i,this._windowEvents={resize:function(){w.setViewSize(g())}})}if(_=g(),h.hasAttribute(c,"stats")&&typeof Stats<"u"){this._stats=new Stats;var C=this._stats.domElement,E=C.style,B=se.getOffset(c);E.position="absolute",E.left=B.x+"px",E.top=B.y+"px",s.body.appendChild(C)}}else _=new M(c),c=null;this._project=l,this._scope=l._scope,this._element=c,this._pixelRatio||(this._pixelRatio=i&&i.devicePixelRatio||1),this._setElementSize(_.width,_.height),this._viewSize=_,a._views.push(this),a._viewsById[this._id]=this,(this._matrix=new I)._owner=this,a._focused||(a._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!be.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;Zt._focused===this&&(Zt._focused=null),Zt._views.splice(Zt._views.indexOf(this),1),delete Zt._viewsById[this._id];var a=this._project;return a._view===this&&(a._view=null),ne.remove(this._element,this._viewEvents),ne.remove(i,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:n.each(T._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(a){this[a]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(a){this._autoUpdate=a,a&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var a=this;ne.requestAnimationFrame(function(){if(a._requested=!1,a._animate){a.requestUpdate();var l=a._element;(!se.getPrefixed(s,"hidden")||h.getAttribute(l,"keepalive")==="true")&&se.isInView(l)&&a._handleFrame()}a._autoUpdate&&a.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){be=this._scope;var a=Date.now()/1e3,l=this._last?a-this._last:0;this._last=a,this.emit("frame",new n({delta:l,time:this._time+=l,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(a,l){var c=this._frameItems;l?(c[a._id]={item:a,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete c[a._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(a){for(var l in this._frameItems){var c=this._frameItems[l];c.item.emit("frame",new n(a,{time:c.time+=a.delta,count:c.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=e},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var a=this._viewSize;return new z(a.width,a.height,this,"setViewSize")},setViewSize:function(){var a=M.read(arguments),l=a.subtract(this._viewSize);l.isZero()||(this._setElementSize(a.width,a.height),this._viewSize.set(a),this._changed(),this.emit("resize",{size:a,delta:l}),this._autoUpdate&&this.update())},_setElementSize:function(a,l){var c=this._element;c&&(c.width!==a&&(c.width=a),c.height!==l&&(c.height=l))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new q(new y,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return se.isInView(this._element)},isInserted:function(){return se.isInserted(this._element)},getPixelSize:function(a){var l=this._element,c;if(l){var f=l.parentNode,g=s.createElement("div");g.style.fontSize=a,f.appendChild(g),c=parseFloat(se.getStyles(g).fontSize),f.removeChild(g)}else c=parseFloat(c);return c},getTextWidth:function(a,l){return 0}},n.each(["rotate","scale","shear","skew"],function(a){var l=a==="rotate";this[a]=function(){var c=arguments,f=(l?n:y).read(c),g=y.read(c,0,{readNull:!0});return this.transform(new I()[a](f,g||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var a=new I;return this.transform(a.translate.apply(a,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var a=y.read(arguments);this.translate(this.getCenter().subtract(a))},getZoom:function(){var a=this._decompose().scaling;return(a.x+a.y)/2},setZoom:function(a){this.transform(new I().scale(a/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(a){var l=this.getRotation();l!=null&&a!=null&&this.rotate(a-l)},getScaling:function(){var a=this._decompose().scaling;return new P(a.x,a.y,this,"setScaling")},setScaling:function(){var a=this.getScaling(),l=y.read(arguments,0,{clone:!0,readNull:!0});a&&l&&this.scale(l.x/a.x,l.y/a.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var a=this._matrix;a.set.apply(a,arguments)},transform:function(a){this._matrix.append(a)},scrollBy:function(){this.translate(y.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(y.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(y.read(arguments))},getEventPoint:function(a){return this.viewToProject(ne.getOffset(a,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(a,l){s&&typeof l=="string"&&(l=s.getElementById(l));var c=i?Oe:Zt;return new c(a,l)}}},new function(){if(!i)return;var a,l,c=!1,f=!1;function g(J){var nt=ne.getTarget(J);return nt.getAttribute&&Zt._viewsById[nt.getAttribute("id")]}function _(){var J=Zt._focused;if(!J||!J.isVisible()){for(var nt=0,lt=Zt._views.length;nt<lt;nt++)if((J=Zt._views[nt]).isVisible()){Zt._focused=l=J;break}}}function S(J,nt,lt){J._handleMouseEvent("mousemove",nt,lt)}var w=i.navigator,C,E,B;w.pointerEnabled||w.msPointerEnabled?(C="pointerdown MSPointerDown",E="pointermove MSPointerMove",B="pointerup pointercancel MSPointerUp MSPointerCancel"):(C="touchstart",E="touchmove",B="touchend touchcancel","ontouchstart"in i&&w.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(C+=" mousedown",E+=" mousemove",B+=" mouseup"));var D={},R={mouseout:function(J){var nt=Zt._focused,lt=ne.getRelatedTarget(J);if(nt&&(!lt||lt.nodeName==="HTML")){var ft=ne.getOffset(J,nt._element),gt=ft.x,yt=Math.abs,At=yt(gt),Bt=1<<25,Ot=At-Bt;ft.x=yt(Ot)<At?Ot*(gt<0?-1:1):gt,S(nt,J,nt.viewToProject(ft))}},scroll:_};D[C]=function(J){var nt=Zt._focused=g(J);c||(c=!0,nt._handleMouseEvent("mousedown",J))},R[E]=function(J){var nt=Zt._focused;if(!f){var lt=g(J);lt?nt!==lt&&(nt&&S(nt,J),a||(a=nt),nt=Zt._focused=l=lt):l&&l===nt&&(a&&!a.isInserted()&&(a=null),nt=Zt._focused=a,a=null,_())}nt&&S(nt,J)},R[C]=function(){f=!0},R[B]=function(J){var nt=Zt._focused;nt&&c&&nt._handleMouseEvent("mouseup",J),f=c=!1},ne.add(s,R),ne.add(i,{load:_});var k=!1,H=!1,N={doubleclick:"click",mousedrag:"mousemove"},G=!1,L,O,A,U,X,$,W,Q;function et(J,nt,lt,ft,gt,yt,At){var Bt=!1,Ot;function Wt(Ct,Et){if(Ct.responds(Et)){if(Ot||(Ot=new ci(Et,ft,gt,nt||Ct,yt?gt.subtract(yt):null)),Ct.emit(Et,Ot)&&(k=!0,Ot.prevented&&(H=!0),Ot.stopped))return Bt=!0}else{var Nt=N[Et];if(Nt)return Wt(Ct,Nt)}}for(;J&&J!==At&&!Wt(J,lt);)J=J._parent;return Bt}function rt(J,nt,lt,ft,gt,yt){return J._project.removeOn(lt),H=k=!1,X&&et(X,null,lt,ft,gt,yt)||nt&&nt!==X&&!nt.isDescendant(X)&&et(nt,null,lt==="mousedrag"?"mousemove":lt,ft,gt,yt,X)||et(J,X||nt||J,lt,ft,gt,yt)}var ot={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:D,_handleMouseEvent:function(J,nt,lt){var ft=this._itemEvents,gt=ft.native[J],yt=J==="mousemove",At=this._scope.tool,Bt=this;function Ot(ue){return ft.virtual[ue]||Bt.responds(ue)||At&&At.responds(ue)}yt&&c&&Ot("mousedrag")&&(J="mousedrag"),lt||(lt=this.getEventPoint(nt));var Wt=this.getBounds().contains(lt),Ct=gt&&Wt&&Bt._project.hitTest(lt,{tolerance:0,fill:!0,stroke:!0}),Et=Ct&&Ct.item||null,Nt=!1,jt={};if(jt[J.substr(5)]=!0,gt&&Et!==U&&(U&&et(U,null,"mouseleave",nt,lt),Et&&et(Et,null,"mouseenter",nt,lt),U=Et),G^Wt&&(et(this,null,Wt?"mouseenter":"mouseleave",nt,lt),Nt=!0),(Wt||jt.drag)&&!lt.equals(O)&&(rt(this,Et,yt?J:"mousemove",nt,lt,O),Nt=!0),G=Wt,jt.down&&Wt||jt.up&&L){if(rt(this,Et,J,nt,lt,L),jt.down){if(Q=Et===$&&Date.now()-W<300,A=$=Et,!H&&Et){for(var $t=Et;$t&&!$t.responds("mousedrag");)$t=$t._parent;$t&&(X=Et)}L=lt}else jt.up&&(!H&&Et===A&&(W=Date.now(),rt(this,Et,Q?"doubleclick":"click",nt,lt,L),Q=!1),A=X=null);G=!1,Nt=!0}O=lt,Nt&&At&&(k=At._handleMouseEvent(J,nt,lt,jt)||k),nt.cancelable!==!1&&(k&&!jt.move||jt.down&&Ot("mouseup"))&&nt.preventDefault()},_handleKeyEvent:function(J,nt,lt,ft){var gt=this._scope,yt=gt.tool,At;function Bt(Ot){Ot.responds(J)&&(be=gt,Ot.emit(J,At=At||new Xe(J,nt,lt,ft)))}this.isVisible()&&(Bt(this),yt&&yt.responds(J)&&Bt(yt))},_countItemEvent:function(J,nt){var lt=this._itemEvents,ft=lt.native,gt=lt.virtual;for(var yt in ot)ft[yt]=(ft[yt]||0)+(ot[yt][J]||0)*nt;gt[J]=(gt[J]||0)+nt},statics:{updateFocus:_,_resetState:function(){c=f=k=G=!1,a=l=L=O=A=U=X=$=W=Q=null}}}}),Oe=Zt.extend({_class:"CanvasView",initialize:function(l,c){if(!(c instanceof i.HTMLCanvasElement)){var f=M.read(arguments,1);if(f.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+n.slice(arguments,1));c=qe.getCanvas(f)}var g=this._context=c.getContext("2d");if(g.save(),this._pixelRatio=1,!/^off|false$/.test(h.getAttribute(c,"hidpi"))){var _=i.devicePixelRatio||1,S=se.getPrefixed(g,"backingStorePixelRatio")||1;this._pixelRatio=_/S}Zt.call(this,l,c),this._needsUpdate=!0},remove:function a(){return this._context.restore(),a.base.call(this)},_setElementSize:function a(l,c){var f=this._pixelRatio;if(a.base.call(this,l*f,c*f),f!==1){var g=this._element,_=this._context;if(!h.hasAttribute(g,"resize")){var S=g.style;S.width=l+"px",S.height=c+"px"}_.restore(),_.save(),_.scale(f,f)}},getContext:function(){return this._context},getPixelSize:function a(l){var c=be.agent,f;if(c&&c.firefox)f=a.base.call(this,l);else{var g=this._context,_=g.font;g.font=l+" serif",f=parseFloat(g.font),g.font=_}return f},getTextWidth:function(a,l){var c=this._context,f=c.font,g=0;c.font=a;for(var _=0,S=l.length;_<S;_++)g=Math.max(g,c.measureText(l[_]).width);return c.font=f,g},update:function(){if(!this._needsUpdate)return!1;var a=this._project,l=this._context,c=this._viewSize;return l.clearRect(0,0,c.width+1,c.height+1),a&&a.draw(l,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),Ae=n.extend({_class:"Event",initialize:function(l){this.event=l,this.type=l&&l.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return Ve.modifiers}}),Xe=Ae.extend({_class:"KeyEvent",initialize:function(l,c,f,g){this.type=l,this.event=c,this.key=f,this.character=g},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Ve=new function(){var a={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},l={tab:"	",space:" ",enter:"\r"},c={},f={},g,_,S=new n({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var E=be&&be.agent;return E&&E.mac?this.meta:this.control}}});function w(E){var B=E.key||E.keyIdentifier;return B=/^U\+/.test(B)?String.fromCharCode(parseInt(B.substr(2),16)):/^Arrow[A-Z]/.test(B)?B.substr(5):B==="Unidentified"||B===e?String.fromCharCode(E.keyCode):B,a[B]||(B.length>1?n.hyphenate(B):B.toLowerCase())}function C(E,B,D,R){var k=Zt._focused,H;if(c[B]=E,E?f[B]=D:delete f[B],B.length>1&&(H=n.camelize(B))in S){S[H]=E;var N=be&&be.agent;if(H==="meta"&&N&&N.mac)if(E)g={};else{for(var G in g)G in f&&C(!1,G,g[G],R);g=null}}else E&&g&&(g[B]=D);k&&k._handleKeyEvent(E?"keydown":"keyup",R,B,D)}return ne.add(s,{keydown:function(E){var B=w(E),D=be&&be.agent;B.length>1||D&&D.chrome&&(E.altKey||D.mac&&E.metaKey||!D.mac&&E.ctrlKey)?C(!0,B,l[B]||(B.length>1?"":B),E):_=B},keypress:function(E){if(_){var B=w(E),D=E.charCode,R=D>=32?String.fromCharCode(D):B.length>1?"":B;B!==_&&(B=R.toLowerCase()),C(!0,B,R,E),_=null}},keyup:function(E){var B=w(E);B in f&&C(!1,B,f[B],E)}}),ne.add(i,{blur:function(E){for(var B in f)C(!1,B,f[B],E)}}),{modifiers:S,isDown:function(E){return!!c[E]}}},ci=Ae.extend({_class:"MouseEvent",initialize:function(l,c,f,g,_){this.type=l,this.event=c,this.point=f,this.target=g,this.delta=_},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),mi=Ae.extend({_class:"ToolEvent",_item:null,initialize:function(l,c,f){this.tool=l,this.type=c,this.event=f},_choosePoint:function(a,l){return a||(l?l.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(a){this._point=a},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(a){this._lastPoint=a},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(a){this._downPoint=a},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(a){this._middlePoint=a},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(a){this._delta=a},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(a){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=a},getItem:function(){if(!this._item){var a=this.tool._scope.project.hitTest(this.getPoint());if(a){for(var l=a.item,c=l._parent;/^(Group|CompoundPath)$/.test(c._class);)l=c,c=c._parent;this._item=l}}return this._item},setItem:function(a){this._item=a},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Ii=d.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(l){d.call(this),this._moveCount=-1,this._downCount=-1,this.set(l)},getMinDistance:function(){return this._minDistance},setMinDistance:function(a){this._minDistance=a,a!=null&&this._maxDistance!=null&&a>this._maxDistance&&(this._maxDistance=a)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(a){this._maxDistance=a,this._minDistance!=null&&a!=null&&a<this._minDistance&&(this._minDistance=a)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(a){this._minDistance=this._maxDistance=a},_handleMouseEvent:function(a,l,c,f){be=this._scope,f.drag&&!this.responds(a)&&(a="mousemove");var g=f.move||f.drag,_=this.responds(a),S=!1,w=this;function C(B,D){var R=c,k=g?w._point:w._downPoint||R;if(g){if(w._moveCount>=0&&R.equals(k))return!1;if(k&&(B!=null||D!=null)){var H=R.subtract(k),N=H.getLength();if(N<(B||0))return!1;D&&(R=k.add(H.normalize(Math.min(N,D))))}w._moveCount++}return w._point=R,w._lastPoint=k||R,f.down&&(w._moveCount=-1,w._downPoint=R,w._downCount++),!0}function E(){_&&(S=w.emit(a,new mi(w,a,l))||S)}if(f.down)C(),E();else if(f.up)C(null,this._maxDistance),E();else if(_)for(;C(this._minDistance,this._maxDistance);)E();return S}}),vr=n.extend(o,{_class:"Tween",statics:{easings:new n({linear:function(a){return a},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return a*(2-a)},easeInOutQuad:function(a){return a<.5?2*a*a:-1+2*(2-a)*a},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return--a*a*a+1},easeInOutCubic:function(a){return a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return 1- --a*a*a*a},easeInOutQuart:function(a){return a<.5?8*a*a*a*a:1-8*--a*a*a*a},easeInQuint:function(a){return a*a*a*a*a},easeOutQuint:function(a){return 1+--a*a*a*a*a},easeInOutQuint:function(a){return a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a}})},initialize:function a(l,c,f,g,_,S){this.object=l;var w=typeof _,C=w==="function";this.type=C?w:w==="string"?_:"linear",this.easing=C?_:a.easings[this.type],this.duration=g,this.running=!1,this._then=null,this._startTime=null;var E=c||f;this._keys=E?Object.keys(E):[],this._parsedKeys=this._parseKeys(this._keys),this._from=E&&this._getState(c),this._to=E&&this._getState(f),S!==!1&&this.start()},then:function(a){return this._then=a,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(a){if(this.running){a>=1&&(a=1,this.running=!1);for(var l=this.easing(a),c=this._keys,f=function(B){return typeof B=="function"?B(l,a):B},g=0,_=c&&c.length;g<_;g++){var S=c[g],w=f(this._from[S]),C=f(this._to[S]),E=w&&C&&w.__add&&C.__add?C.__subtract(w).__multiply(l).__add(w):(C-w)*l+w;this._setProperty(this._parsedKeys[S],E)}this.responds("update")&&this.emit("update",new n({progress:a,factor:l})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(a){var l=this._startTime,c=l?(a-l)/this.duration:0;l||(this._startTime=a),this.update(c)},_getState:function(a){for(var l=this._keys,c={},f=0,g=l.length;f<g;f++){var _=l[f],S=this._parsedKeys[_],w=this._getProperty(S),C;if(a){var E=this._resolveValue(w,a[_]);this._setProperty(S,E),C=this._getProperty(S),C=C&&C.clone?C.clone():C,this._setProperty(S,w)}else C=w&&w.clone?w.clone():w;c[_]=C}return c},_resolveValue:function(a,l){if(l){if(Array.isArray(l)&&l.length===2){var c=l[0];return c&&c.match&&c.match(/^[+\-\*\/]=/)?this._calculate(a,c[0],l[1]):l}else if(typeof l=="string"){var f=l.match(/^[+\-*/]=(.*)/);if(f){var g=JSON.parse(f[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(a,l[0],g)}}}return l},_calculate:function(a,l,c){return be.PaperScript.calculateBinary(a,l,c)},_parseKeys:function(a){for(var l={},c=0,f=a.length;c<f;c++){var g=a[c],_=g.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");l[g]=_.split("/")}return l},_getProperty:function(a,l){for(var c=this.object,f=0,g=a.length-(l||0);f<g&&c;f++)c=c[a[f]];return c},_setProperty:function(a,l){var c=this._getProperty(a,1);c&&(c[a[a.length-1]]=l)}}),es={request:function(a){var l=new t.XMLHttpRequest;return l.open((a.method||"get").toUpperCase(),a.url,n.pick(a.async,!0)),a.mimeType&&l.overrideMimeType(a.mimeType),l.onload=function(){var c=l.status;c===0||c===200?a.onLoad&&a.onLoad.call(l,l.responseText):l.onerror()},l.onerror=function(){var c=l.status,f='Could not load "'+a.url+'" (Status: '+c+")";if(a.onError)a.onError(f,c);else throw new Error(f)},l.send(null)}},qe=n.exports.CanvasProvider={canvases:[],getCanvas:function(a,l,c){if(!i)return null;var f,g=!0;typeof a=="object"&&(l=a.height,a=a.width),this.canvases.length?f=this.canvases.pop():(f=s.createElement("canvas"),g=!1);var _=f.getContext("2d",c||{});if(!_)throw new Error("Canvas "+f+" is unable to provide a 2D context.");return f.width===a&&f.height===l?g&&_.clearRect(0,0,a+1,l+1):(f.width=a,f.height=l),_.save(),f},getContext:function(a,l,c){var f=this.getCanvas(a,l,c);return f?f.getContext("2d",c||{}):null},release:function(a){var l=a&&a.canvas?a.canvas:a;l&&l.getContext&&(l.getContext("2d").restore(),this.canvases.push(l))}},Zi=new function(){var a=Math.min,l=Math.max,c=Math.abs,f,g,_,S,w,C,E,B,D,R,k;function H(X,$,W){return .2989*X+.587*$+.114*W}function N(X,$,W,rt){var et=rt-H(X,$,W);D=X+et,R=$+et,k=W+et;var rt=H(D,R,k),ot=a(D,R,k),J=l(D,R,k);if(ot<0){var nt=rt-ot;D=rt+(D-rt)*rt/nt,R=rt+(R-rt)*rt/nt,k=rt+(k-rt)*rt/nt}if(J>255){var lt=255-rt,ft=J-rt;D=rt+(D-rt)*lt/ft,R=rt+(R-rt)*lt/ft,k=rt+(k-rt)*lt/ft}}function G(X,$,W){return l(X,$,W)-a(X,$,W)}function L(X,$,W,Q){var et=[X,$,W],rt=l(X,$,W),ot=a(X,$,W),J;ot=ot===X?0:ot===$?1:2,rt=rt===X?0:rt===$?1:2,J=a(ot,rt)===0?l(ot,rt)===1?2:1:0,et[rt]>et[ot]?(et[J]=(et[J]-et[ot])*Q/(et[rt]-et[ot]),et[rt]=Q):et[J]=et[rt]=0,et[ot]=0,D=et[0],R=et[1],k=et[2]}var O={multiply:function(){D=w*f/255,R=C*g/255,k=E*_/255},screen:function(){D=w+f-w*f/255,R=C+g-C*g/255,k=E+_-E*_/255},overlay:function(){D=w<128?2*w*f/255:255-2*(255-w)*(255-f)/255,R=C<128?2*C*g/255:255-2*(255-C)*(255-g)/255,k=E<128?2*E*_/255:255-2*(255-E)*(255-_)/255},"soft-light":function(){var X=f*w/255;D=X+w*(255-(255-w)*(255-f)/255-X)/255,X=g*C/255,R=X+C*(255-(255-C)*(255-g)/255-X)/255,X=_*E/255,k=X+E*(255-(255-E)*(255-_)/255-X)/255},"hard-light":function(){D=f<128?2*f*w/255:255-2*(255-f)*(255-w)/255,R=g<128?2*g*C/255:255-2*(255-g)*(255-C)/255,k=_<128?2*_*E/255:255-2*(255-_)*(255-E)/255},"color-dodge":function(){D=w===0?0:f===255?255:a(255,255*w/(255-f)),R=C===0?0:g===255?255:a(255,255*C/(255-g)),k=E===0?0:_===255?255:a(255,255*E/(255-_))},"color-burn":function(){D=w===255?255:f===0?0:l(0,255-(255-w)*255/f),R=C===255?255:g===0?0:l(0,255-(255-C)*255/g),k=E===255?255:_===0?0:l(0,255-(255-E)*255/_)},darken:function(){D=w<f?w:f,R=C<g?C:g,k=E<_?E:_},lighten:function(){D=w>f?w:f,R=C>g?C:g,k=E>_?E:_},difference:function(){D=w-f,D<0&&(D=-D),R=C-g,R<0&&(R=-R),k=E-_,k<0&&(k=-k)},exclusion:function(){D=w+f*(255-w-w)/255,R=C+g*(255-C-C)/255,k=E+_*(255-E-E)/255},hue:function(){L(f,g,_,G(w,C,E)),N(D,R,k,H(w,C,E))},saturation:function(){L(w,C,E,G(f,g,_)),N(D,R,k,H(w,C,E))},luminosity:function(){N(w,C,E,H(f,g,_))},color:function(){N(f,g,_,H(w,C,E))},add:function(){D=a(w+f,255),R=a(C+g,255),k=a(E+_,255)},subtract:function(){D=l(w-f,0),R=l(C-g,0),k=l(E-_,0)},average:function(){D=(w+f)/2,R=(C+g)/2,k=(E+_)/2},negation:function(){D=255-c(255-f-w),R=255-c(255-g-C),k=255-c(255-_-E)}},A=this.nativeModes=n.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(X){this[X]=!0},{}),U=qe.getContext(1,1,{willReadFrequently:!0});U&&(n.each(O,function(X,$){var W=$==="darken",Q=!1;U.save();try{U.fillStyle=W?"#300":"#a00",U.fillRect(0,0,1,1),U.globalCompositeOperation=$,U.globalCompositeOperation===$&&(U.fillStyle=W?"#a00":"#300",U.fillRect(0,0,1,1),Q=U.getImageData(0,0,1,1).data[0]!==W?170:51)}catch{}U.restore(),A[$]=Q}),qe.release(U)),this.process=function(X,$,W,Q,et){var rt=$.canvas,ot=X==="normal";if(ot||A[X])W.save(),W.setTransform(1,0,0,1,0,0),W.globalAlpha=Q,ot||(W.globalCompositeOperation=X),W.drawImage(rt,et.x,et.y),W.restore();else{var J=O[X];if(!J)return;for(var nt=W.getImageData(et.x,et.y,rt.width,rt.height),lt=nt.data,ft=$.getImageData(0,0,rt.width,rt.height).data,gt=0,yt=lt.length;gt<yt;gt+=4){f=ft[gt],w=lt[gt],g=ft[gt+1],C=lt[gt+1],_=ft[gt+2],E=lt[gt+2],S=ft[gt+3],B=lt[gt+3],J();var At=S*Q/255,Bt=1-At;lt[gt]=At*D+Bt*w,lt[gt+1]=At*R+Bt*C,lt[gt+2]=At*k+Bt*E,lt[gt+3]=S*Q+Bt*B}W.putImageData(nt,et.x,et.y)}}},$e=new function(){var a="http://www.w3.org/2000/svg",l="http://www.w3.org/2000/xmlns",c="http://www.w3.org/1999/xlink",f={href:c,xlink:l,xmlns:l+"/","xmlns:xlink":l+"/"};function g(w,C,E){return S(s.createElementNS(a,w),C,E)}function _(w,C){var E=f[C],B=E?w.getAttributeNS(E,C):w.getAttribute(C);return B==="null"?null:B}function S(w,C,E){for(var B in C){var D=C[B],R=f[B];typeof D=="number"&&E&&(D=E.number(D)),R?w.setAttributeNS(R,B,D):w.setAttribute(B,D)}return w}return{svg:a,xmlns:l,xlink:c,create:g,get:_,set:S}},ws=n.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(a,l){return!l&&(a instanceof kt||a instanceof pt||a instanceof le)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(a,l){var c=n.capitalize(l),f=a[2];this[l]={type:a[1],property:l,attribute:a[0],toSVG:f,fromSVG:f&&n.each(f,function(g,_){this[g]=_},{}),exportFilter:a[3],get:"get"+c,set:"set"+c}},{});new function(){var a;function l(O,A,U){var X=new n,$=O.getTranslation();if(A){var W;O.isInvertible()?(O=O._shiftless(),W=O._inverseTransform($),$=null):W=new y,X[U?"cx":"x"]=W.x,X[U?"cy":"y"]=W.y}if(!O.isIdentity()){var Q=O.decompose();if(Q){var et=[],rt=Q.rotation,ot=Q.scaling,J=Q.skewing;$&&!$.isZero()&&et.push("translate("+a.point($)+")"),rt&&et.push("rotate("+a.number(rt)+")"),(!v.isZero(ot.x-1)||!v.isZero(ot.y-1))&&et.push("scale("+a.point(ot)+")"),J.x&&et.push("skewX("+a.number(J.x)+")"),J.y&&et.push("skewY("+a.number(J.y)+")"),X.transform=et.join(" ")}else X.transform="matrix("+O.getValues().join(",")+")"}return X}function c(O,A){for(var U=l(O._matrix),X=O._children,$=$e.create("g",U,a),W=0,Q=X.length;W<Q;W++){var et=X[W],rt=G(et,A);if(rt)if(et.isClipMask()){var ot=$e.create("clipPath");ot.appendChild(rt),H(et,ot,"clip"),$e.set($,{"clip-path":"url(#"+ot.id+")"})}else $.appendChild(rt)}return $}function f(O,A){var U=l(O._matrix,!0),X=O.getSize(),$=O.getImage();return U.x-=X.width/2,U.y-=X.height/2,U.width=X.width,U.height=X.height,U.href=A.embedImages==!1&&$&&$.src||O.toDataURL(),$e.create("image",U,a)}function g(O,A){var U=A.matchShapes;if(U){var X=O.toShape(!1);if(X)return _(X)}var $=O._segments,W=$.length,Q,et=l(O._matrix);if(U&&W>=2&&!O.hasHandles())if(W>2){Q=O._closed?"polygon":"polyline";for(var rt=[],ot=0;ot<W;ot++)rt.push(a.point($[ot]._point));et.points=rt.join(" ")}else{Q="line";var J=$[0]._point,nt=$[1]._point;et.set({x1:J.x,y1:J.y,x2:nt.x,y2:nt.y})}else Q="path",et.d=O.getPathData(null,A.precision);return $e.create(Q,et,a)}function _(O){var A=O._type,U=O._radius,X=l(O._matrix,!0,A!=="rectangle");if(A==="rectangle"){A="rect";var $=O._size,W=$.width,Q=$.height;X.x-=W/2,X.y-=Q/2,X.width=W,X.height=Q,U.isZero()&&(U=null)}return U&&(A==="circle"?X.r=U:(X.rx=U.width,X.ry=U.height)),$e.create(A,X,a)}function S(O,A){var U=l(O._matrix),X=O.getPathData(null,A.precision);return X&&(U.d=X),$e.create("path",U,a)}function w(O,A){var U=l(O._matrix,!0),X=O._definition,$=k(X,"symbol"),W=X._item,Q=W.getStrokeBounds();return $||($=$e.create("symbol",{viewBox:a.rectangle(Q)}),$.appendChild(G(W,A)),H(X,$,"symbol")),U.href="#"+$.id,U.x+=Q.x,U.y+=Q.y,U.width=Q.width,U.height=Q.height,U.overflow="visible",$e.create("use",U,a)}function C(O){var A=k(O,"color");if(!A){var U=O.getGradient(),X=U._radial,$=O.getOrigin(),W=O.getDestination(),Q;if(X){Q={cx:$.x,cy:$.y,r:$.getDistance(W)};var et=O.getHighlight();et&&(Q.fx=et.x,Q.fy=et.y)}else Q={x1:$.x,y1:$.y,x2:W.x,y2:W.y};Q.gradientUnits="userSpaceOnUse",A=$e.create((X?"radial":"linear")+"Gradient",Q,a);for(var rt=U._stops,ot=0,J=rt.length;ot<J;ot++){var nt=rt[ot],lt=nt._color,ft=lt.getAlpha(),gt=nt._offset;Q={offset:gt??ot/(J-1)},lt&&(Q["stop-color"]=lt.toCSS(!0)),ft<1&&(Q["stop-opacity"]=ft),A.appendChild($e.create("stop",Q,a))}H(O,A,"color")}return"url(#"+A.id+")"}function E(O){var A=$e.create("text",l(O._matrix,!0),a);return A.textContent=O._content,A}var B={Group:c,Layer:c,Raster:f,Path:g,Shape:_,CompoundPath:S,SymbolItem:w,PointText:E};function D(O,A,U,X){var $={},W=!X&&O.getParent(),Q=[];return O._name!=null&&($.id=O._name),n.each(ws,function(et){var rt=et.get,ot=et.type,J=O[rt]();if(et.exportFilter?et.exportFilter(O,J):U.reduceAttributes==!1||!W||!n.equals(W[rt](),J)){if(ot==="color"&&J!=null){var nt=J.getAlpha();nt<1&&($[et.attribute+"-opacity"]=nt)}ot==="style"?Q.push(et.attribute+": "+J):$[et.attribute]=J==null?"none":ot==="color"?J.gradient?C(J):J.toCSS(!0):ot==="array"?J.join(","):ot==="lookup"?et.toSVG[J]:J}}),Q.length&&($.style=Q.join(";")),$.opacity===1&&delete $.opacity,O._visible||($.visibility="hidden"),$e.set(A,$,a)}var R;function k(O,A){return R||(R={ids:{},svgs:{}}),O&&R.svgs[A+"-"+(O._id||O.__id||(O.__id=b.get("svg")))]}function H(O,A,U){R||k();var X=R.ids[U]=(R.ids[U]||0)+1;A.id=U+"-"+X,R.svgs[U+"-"+(O._id||O.__id)]=A}function N(O,A){var U=O,X=null;if(R){U=O.nodeName.toLowerCase()==="svg"&&O;for(var $ in R.svgs)X||(U||(U=$e.create("svg"),U.appendChild(O)),X=U.insertBefore($e.create("defs"),U.firstChild)),X.appendChild(R.svgs[$]);R=null}return A.asString?new t.XMLSerializer().serializeToString(U):U}function G(O,A,U){var X=B[O._class],$=X&&X(O,A);if($){var W=A.onExport;W&&($=W(O,$,A)||$);var Q=JSON.stringify(O._data);Q&&Q!=="{}"&&Q!=="null"&&$.setAttribute("data-paper-data",Q)}return $&&D(O,$,A,U)}function L(O){return O||(O={}),a=new m(O.precision),O}T.inject({exportSVG:function(O){return O=L(O),N(G(this,O,!0),O)}}),K.inject({exportSVG:function(O){O=L(O);var A=this._children,U=this.getView(),X=n.pick(O.bounds,"view"),$=O.matrix||X==="view"&&U._matrix,W=$&&I.read([$]),Q=X==="view"?new q([0,0],U.getViewSize()):X==="content"?T._getBounds(A,W,{stroke:!0}).rect:q.read([X],0,{readNull:!0}),et={version:"1.1",xmlns:$e.svg,"xmlns:xlink":$e.xlink};Q&&(et.width=Q.width,et.height=Q.height,(Q.x||Q.x===0||Q.y||Q.y===0)&&(et.viewBox=a.rectangle(Q)));var rt=$e.create("svg",et,a),ot=rt;W&&!W.isIdentity()&&(ot=rt.appendChild($e.create("g",l(W),a)));for(var J=0,nt=A.length;J<nt;J++)ot.appendChild(G(A[J],O,!0));return N(rt,O)}})},new function(){var a={},l;function c(A,U,X,$,W,Q){var et=$e.get(A,U)||Q,rt=et==null?$?null:X?"":0:X?et:parseFloat(et);return/%\s*$/.test(et)?rt/100*(W?1:l[/x|^width/.test(U)?"width":"height"]):rt}function f(A,U,X,$,W,Q,et){return U=c(A,U||"x",!1,$,W,Q),X=c(A,X||"y",!1,$,W,et),$&&(U==null||X==null)?null:new y(U,X)}function g(A,U,X,$,W){return U=c(A,U||"width",!1,$,W),X=c(A,X||"height",!1,$,W),$&&(U==null||X==null)?null:new M(U,X)}function _(A,U,X){return A==="none"?null:U==="number"?parseFloat(A):U==="array"?A?A.split(/[\s,]+/g).map(parseFloat):[]:U==="color"?G(A)||A:U==="lookup"?X[A]:A}function S(A,U,X,$){var W=A.childNodes,Q=U==="clippath",et=U==="defs",rt=new at,ot=rt._project,J=ot._currentStyle,nt=[];if(!Q&&!et&&(rt=N(rt,A,$),ot._currentStyle=rt._style.clone()),$)for(var lt=A.querySelectorAll("defs"),ft=0,gt=lt.length;ft<gt;ft++)L(lt[ft],X,!1);for(var ft=0,gt=W.length;ft<gt;ft++){var yt=W[ft],At;yt.nodeType===1&&!/^defs$/i.test(yt.nodeName)&&(At=L(yt,X,!1))&&!(At instanceof bt)&&nt.push(At)}return rt.addChildren(nt),Q&&(rt=N(rt.reduce(),A,$)),ot._currentStyle=J,(Q||et)&&(rt.remove(),rt=null),rt}function w(A,U){for(var X=A.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),$=[],W=0,Q=X.length;W<Q;W+=2)$.push(new y(parseFloat(X[W]),parseFloat(X[W+1])));var et=new Gt($);return U==="polygon"&&et.closePath(),et}function C(A){return kt.create(A.getAttribute("d"))}function E(A,U){var X=(c(A,"href",!0)||"").substring(1),$=U==="radialgradient",W;if(X)W=a[X].getGradient(),W._radial^$&&(W=W.clone(),W._radial=$);else{for(var Q=A.childNodes,et=[],rt=0,ot=Q.length;rt<ot;rt++){var J=Q[rt];J.nodeType===1&&et.push(N(new xe,J))}W=new Qt(et,$)}var nt,lt,ft,gt=c(A,"gradientUnits",!0)!=="userSpaceOnUse";$?(nt=f(A,"cx","cy",!1,gt,"50%","50%"),lt=nt.add(c(A,"r",!1,!1,gt,"50%"),0),ft=f(A,"fx","fy",!0,gt)):(nt=f(A,"x1","y1",!1,gt,"0%","0%"),lt=f(A,"x2","y2",!1,gt,"100%","0%"));var yt=N(new ee(W,nt,lt,ft),A);return yt._scaleToBounds=gt,null}var B={"#document":function(A,U,X,$){for(var W=A.childNodes,Q=0,et=W.length;Q<et;Q++){var rt=W[Q];if(rt.nodeType===1)return L(rt,X,$)}},g:S,svg:S,clippath:S,polygon:w,polyline:w,path:C,lineargradient:E,radialgradient:E,image:function(A){var U=new wt(c(A,"href",!0));return U.on("load",function(){var X=g(A);this.setSize(X);var $=f(A).add(X.divide(2));this._matrix.append(new I().translate($))}),U},symbol:function(A,U,X,$){return new bt(S(A,U,X,$),!0)},defs:S,use:function(A){var U=(c(A,"href",!0)||"").substring(1),X=a[U],$=f(A);return X?X instanceof bt?X.place($):X.clone().translate($):null},circle:function(A){return new pt.Circle(f(A,"cx","cy"),c(A,"r"))},ellipse:function(A){return new pt.Ellipse({center:f(A,"cx","cy"),radius:g(A,"rx","ry")})},rect:function(A){return new pt.Rectangle(new q(f(A),g(A)),g(A,"rx","ry"))},line:function(A){return new Gt.Line(f(A,"x1","y1"),f(A,"x2","y2"))},text:function(A){var U=new re(f(A).add(f(A,"dx","dy")));return U.setContent(A.textContent.trim()||""),U},switch:S};function D(A,U,X,$){if(A.transform){for(var W=($.getAttribute(X)||"").split(/\)\s*/g),Q=new I,et=0,rt=W.length;et<rt;et++){var ot=W[et];if(!ot)break;for(var J=ot.split(/\(\s*/),nt=J[0].trim(),lt=J[1].split(/[\s,]+/g),ft=0,gt=lt.length;ft<gt;ft++)lt[ft]=parseFloat(lt[ft]);switch(nt){case"matrix":Q.append(new I(lt[0],lt[1],lt[2],lt[3],lt[4],lt[5]));break;case"rotate":Q.rotate(lt[0],lt[1]||0,lt[2]||0);break;case"translate":Q.translate(lt[0],lt[1]||0);break;case"scale":Q.scale(lt);break;case"skewX":Q.skew(lt[0],0);break;case"skewY":Q.skew(0,lt[0]);break}}A.transform(Q)}}function R(A,U,X){var $=X==="fill-opacity"?"getFillColor":"getStrokeColor",W=A[$]&&A[$]();W&&W.setAlpha(parseFloat(U))}var k=n.set(n.each(ws,function(A){this[A.attribute]=function(U,X){if(U[A.set]&&(U[A.set](_(X,A.type,A.fromSVG)),A.type==="color")){var $=U[A.get]();if($&&$._scaleToBounds){var W=U.getBounds();$.transform(new I().translate(W.getPoint()).scale(W.getSize()))}}}},{}),{id:function(A,U){a[U]=A,A.setName&&A.setName(U)},"clip-path":function(A,U){var X=G(U);if(X)if(X=X.clone(),X.setClipMask(!0),A instanceof at)A.insertChild(0,X);else return new at(X,A)},gradientTransform:D,transform:D,"fill-opacity":R,"stroke-opacity":R,visibility:function(A,U){A.setVisible&&A.setVisible(U==="visible")},display:function(A,U){A.setVisible&&A.setVisible(U!==null)},"stop-color":function(A,U){A.setColor&&A.setColor(U)},"stop-opacity":function(A,U){A._color&&A._color.setAlpha(parseFloat(U))},offset:function(A,U){if(A.setOffset){var X=U.match(/(.*)%$/);A.setOffset(X?X[1]/100:parseFloat(U))}},viewBox:function(A,U,X,$,W){var Q=new q(_(U,"array")),et=g($,null,null,!0),rt,ot;if(A instanceof at){var J=et?et.divide(Q.getSize()):1,ot=new I().scale(J).translate(Q.getPoint().negate());rt=A}else A instanceof bt&&(et&&Q.setSize(et),rt=A._item);if(rt){if(H($,"overflow",W)!=="visible"){var nt=new pt.Rectangle(Q);nt.setClipMask(!0),rt.addChild(nt)}ot&&rt.transform(ot)}}});function H(A,U,X){var $=A.attributes[U],W=$&&$.value;if(!W&&A.style){var Q=n.camelize(U);W=A.style[Q],!W&&X.node[Q]!==X.parent[Q]&&(W=X.node[Q])}return W?W==="none"?null:W:e}function N(A,U,X){var $=U.parentNode,W={node:se.getStyles(U)||{},parent:!X&&!/^defs$/i.test($.tagName)&&se.getStyles($)||{}};return n.each(k,function(Q,et){var rt=H(U,et,W);A=rt!==e&&Q(A,rt,et,U,W)||A}),A}function G(A){var U=A&&A.match(/\((?:["'#]*)([^"')]+)/),X=U&&U[1],$=X&&a[i?X.replace(i.location.href.split("#")[0]+"#",""):X];return $&&$._scaleToBounds&&($=$.clone(),$._scaleToBounds=!0),$}function L(A,U,X){var $=A.nodeName.toLowerCase(),W=$!=="#document",Q=s.body,et,rt,ot;X&&W&&(l=be.getView().getSize(),l=g(A,null,null,!0)||l,et=$e.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),rt=A.parentNode,ot=A.nextSibling,et.appendChild(A),Q.appendChild(et));var J=be.settings,nt=J.applyMatrix,lt=J.insertItems;J.applyMatrix=!1,J.insertItems=!1;var ft=B[$],gt=ft&&ft(A,$,U,X)||null;if(J.insertItems=lt,J.applyMatrix=nt,gt){W&&!(gt instanceof at)&&(gt=N(gt,A,X));var yt=U.onImport,At=W&&A.getAttribute("data-paper-data");yt&&(gt=yt(A,gt,U)||gt),U.expandShapes&&gt instanceof pt&&(gt.remove(),gt=gt.toPath()),At&&(gt._data=JSON.parse(At))}return et&&(Q.removeChild(et),rt&&(ot?rt.insertBefore(A,ot):rt.appendChild(A))),X&&(a={},gt&&n.pick(U.applyMatrix,nt)&&gt.matrix.apply(!0,!0)),gt}function O(A,U,X){if(!A)return null;U=typeof U=="function"?{onLoad:U}:U||{};var $=be,W=null;function Q(J){try{var nt=typeof J=="object"?J:new t.DOMParser().parseFromString(J.trim(),"image/svg+xml");if(!nt.nodeName)throw nt=null,new Error("Unsupported SVG source: "+A);be=$,W=L(nt,U,!0),(!U||U.insert!==!1)&&X._insertItem(e,W);var lt=U.onLoad;lt&&lt(W,J)}catch(ft){et(ft)}}function et(J,nt){var lt=U.onError;if(lt)lt(J,nt);else throw new Error(J)}if(typeof A=="string"&&!/^[\s\S]*</.test(A)){var rt=s.getElementById(A);rt?Q(rt):es.request({url:A,async:!0,onLoad:Q,onError:et})}else if(typeof File<"u"&&A instanceof File){var ot=new FileReader;return ot.onload=function(){Q(ot.result)},ot.onerror=function(){et(ot.error)},ot.readAsText(A)}else Q(A);return W}T.inject({importSVG:function(A,U){return O(A,U,this)}}),K.inject({importSVG:function(A,U){return this.activate(),O(A,U,this)}})},n.exports.PaperScript=(function(){var a=this,l=a.acorn;if(!l&&typeof CE<"u")try{l=EE()}catch{}if(!l){var c,f;l=c=f={},function(N,G){if(typeof c=="object"&&typeof f=="object")return G(c);if(typeof e=="function"&&e.amd)return e(["exports"],G);G(N.acorn||(N.acorn={}))}(this,function(N){N.version="0.5.0";var G,L,O,A;N.parse=function(st,ut){return L=String(st),O=L.length,X(ut),Ud(),S_(G.program)};var U=N.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function X(st){G=st||{};for(var ut in U)Object.prototype.hasOwnProperty.call(G,ut)||(G[ut]=U[ut]);A=G.sourceFile||null}var $=N.getLineInfo=function(st,ut){for(var St=1,Tt=0;;){Vn.lastIndex=Tt;var de=Vn.exec(st);if(de&&de.index<ut)++St,Tt=de.index+de[0].length;else break}return{line:St,column:ut-Tt}};N.tokenize=function(st,ut){L=String(st),O=L.length,X(ut),Ud();var St={};function Tt(de){return At=et,ln(de),St.start=Q,St.end=et,St.startLoc=rt,St.endLoc=ot,St.type=J,St.value=nt,St}return Tt.jumpTo=function(de,ge){if(W=de,G.locations){ft=1,gt=Vn.lastIndex=0;for(var ye;(ye=Vn.exec(L))&&ye.index<de;)++ft,gt=ye.index+ye[0].length}lt=ge,Hn()},Tt};var W,Q,et,rt,ot,J,nt,lt,ft,gt,yt,At,Bt,Ot,Wt,Ct;function Et(st,ut){var St=$(L,st);ut+=" ("+St.line+":"+St.column+")";var Tt=new SyntaxError(ut);throw Tt.pos=st,Tt.loc=St,Tt.raisedAt=W,Tt}var Nt=[],jt={type:"num"},$t={type:"regexp"},ue={type:"string"},he={type:"name"},pe={type:"eof"},me={keyword:"break"},ce={keyword:"case",beforeExpr:!0},_i={keyword:"catch"},zt={keyword:"continue"},He={keyword:"debugger"},ti={keyword:"default"},ze={keyword:"do",isLoop:!0},si={keyword:"else",beforeExpr:!0},zi={keyword:"finally"},vi={keyword:"for",isLoop:!0},Ki={keyword:"function"},Bi={keyword:"if"},ei={keyword:"return",beforeExpr:!0},or={keyword:"switch"},Gi={keyword:"throw",beforeExpr:!0},Qi={keyword:"try"},Fr={keyword:"var"},lr={keyword:"while",isLoop:!0},zn={keyword:"with"},en={keyword:"new",beforeExpr:!0},ka={keyword:"this"},Ra={keyword:"null",atomValue:null},Ba={keyword:"true",atomValue:!0},rn={keyword:"false",atomValue:!1},Te={keyword:"in",binop:7,beforeExpr:!0},La={break:me,case:ce,catch:_i,continue:zt,debugger:He,default:ti,do:ze,else:si,finally:zi,for:vi,function:Ki,if:Bi,return:ei,switch:or,throw:Gi,try:Qi,var:Fr,while:lr,with:zn,null:Ra,true:Ba,false:rn,new:en,in:Te,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:ka,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},sn={type:"[",beforeExpr:!0},nn={type:"]"},is={type:"{",beforeExpr:!0},rs={type:"}"},pr={type:"(",beforeExpr:!0},hr={type:")"},u={type:",",beforeExpr:!0},x={type:";",beforeExpr:!0},F={type:":",beforeExpr:!0},j={type:"."},it={type:"?",beforeExpr:!0},mt={binop:10,beforeExpr:!0},xt={isAssign:!0,beforeExpr:!0},Dt={isAssign:!0,beforeExpr:!0},Ht={postfix:!0,prefix:!0,isUpdate:!0},Ee={prefix:!0,beforeExpr:!0},Me={binop:1,beforeExpr:!0},di={binop:2,beforeExpr:!0},ss={binop:3,beforeExpr:!0},an={binop:4,beforeExpr:!0},Ss={binop:5,beforeExpr:!0},Gn={binop:6,beforeExpr:!0},Cs={binop:7,beforeExpr:!0},Es={binop:8,beforeExpr:!0},r_={binop:9,prefix:!0,beforeExpr:!0},s_={binop:10,beforeExpr:!0};N.tokTypes={bracketL:sn,bracketR:nn,braceL:is,braceR:rs,parenL:pr,parenR:hr,comma:u,semi:x,colon:F,dot:j,question:it,slash:mt,eq:xt,name:he,eof:pe,num:jt,regexp:$t,string:ue};for(var Ld in La)N.tokTypes["_"+Ld]=La[Ld];function Da(st){st=st.split(" ");var ut="",St=[];t:for(var Tt=0;Tt<st.length;++Tt){for(var de=0;de<St.length;++de)if(St[de][0].length==st[Tt].length){St[de].push(st[Tt]);continue t}St.push([st[Tt]])}function ge(Ge){if(Ge.length==1)return ut+="return str === "+JSON.stringify(Ge[0])+";";ut+="switch(str){";for(var xr=0;xr<Ge.length;++xr)ut+="case "+JSON.stringify(Ge[xr])+":";ut+="return true}return false;"}if(St.length>3){St.sort(function(Ge,xr){return xr.length-Ge.length}),ut+="switch(str.length){";for(var Tt=0;Tt<St.length;++Tt){var ye=St[Tt];ut+="case "+ye[0].length+":",ge(ye)}ut+="}"}else ge(st);return new Function("str",ut)}var n_=Da("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),a_=Da("class enum extends super const export import"),Dd=Da("implements interface let package private protected public static yield"),Ao=Da("eval arguments"),o_=Da("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),l_=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Fd="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",h_="------------------------------------------------------------------------------------------------------------------------------------------",Od=new RegExp("["+Fd+"]"),u_=new RegExp("["+Fd+h_+"]"),Mo=/[\n\r\u2028\u2029]/,Vn=/\r\n|[\n\r\u2028\u2029]/g,ko=N.isIdentifierStart=function(st){return st<65?st===36:st<91?!0:st<97?st===95:st<123?!0:st>=170&&Od.test(String.fromCharCode(st))},Nd=N.isIdentifierChar=function(st){return st<48?st===36:st<58?!0:st<65?!1:st<91?!0:st<97?st===95:st<123?!0:st>=170&&u_.test(String.fromCharCode(st))};function on(){this.line=ft,this.column=W-gt}function Ud(){ft=1,W=gt=0,lt=!0,Hn()}function Li(st,ut){et=W,G.locations&&(ot=new on),J=st,Hn(),nt=ut,lt=st.beforeExpr}function c_(){var st=G.onComment&&G.locations&&new on,ut=W,St=L.indexOf("*/",W+=2);if(St===-1&&Et(W-2,"Unterminated comment"),W=St+2,G.locations){Vn.lastIndex=ut;for(var Tt;(Tt=Vn.exec(L))&&Tt.index<W;)++ft,gt=Tt.index+Tt[0].length}G.onComment&&G.onComment(!0,L.slice(ut+2,St),ut,W,st,G.locations&&new on)}function kh(){for(var st=W,ut=G.onComment&&G.locations&&new on,St=L.charCodeAt(W+=2);W<O&&St!==10&&St!==13&&St!==8232&&St!==8233;)++W,St=L.charCodeAt(W);G.onComment&&G.onComment(!1,L.slice(st+2,W),st,W,ut,G.locations&&new on)}function Hn(){for(;W<O;){var st=L.charCodeAt(W);if(st===32)++W;else if(st===13){++W;var ut=L.charCodeAt(W);ut===10&&++W,G.locations&&(++ft,gt=W)}else if(st===10||st===8232||st===8233)++W,G.locations&&(++ft,gt=W);else if(st>8&&st<14)++W;else if(st===47){var ut=L.charCodeAt(W+1);if(ut===42)c_();else if(ut===47)kh();else break}else if(st===160)++W;else if(st>=5760&&l_.test(String.fromCharCode(st)))++W;else break}}function d_(){var st=L.charCodeAt(W+1);return st>=48&&st<=57?Gd(!0):(++W,Li(j))}function f_(){var st=L.charCodeAt(W+1);return lt?(++W,zd()):st===61?Di(Dt,2):Di(mt,1)}function p_(){var st=L.charCodeAt(W+1);return st===61?Di(Dt,2):Di(s_,1)}function g_(st){var ut=L.charCodeAt(W+1);return ut===st?Di(st===124?Me:di,2):ut===61?Di(Dt,2):Di(st===124?ss:Ss,1)}function m_(){var st=L.charCodeAt(W+1);return st===61?Di(Dt,2):Di(an,1)}function __(st){var ut=L.charCodeAt(W+1);return ut===st?ut==45&&L.charCodeAt(W+2)==62&&Mo.test(L.slice(At,W))?(W+=3,kh(),Hn(),ln()):Di(Ht,2):ut===61?Di(Dt,2):Di(r_,1)}function v_(st){var ut=L.charCodeAt(W+1),St=1;return ut===st?(St=st===62&&L.charCodeAt(W+2)===62?3:2,L.charCodeAt(W+St)===61?Di(Dt,St+1):Di(Es,St)):ut==33&&st==60&&L.charCodeAt(W+2)==45&&L.charCodeAt(W+3)==45?(W+=4,kh(),Hn(),ln()):(ut===61&&(St=L.charCodeAt(W+2)===61?3:2),Di(Cs,St))}function y_(st){var ut=L.charCodeAt(W+1);return ut===61?Di(Gn,L.charCodeAt(W+2)===61?3:2):Di(st===61?xt:Ee,1)}function x_(st){switch(st){case 46:return d_();case 40:return++W,Li(pr);case 41:return++W,Li(hr);case 59:return++W,Li(x);case 44:return++W,Li(u);case 91:return++W,Li(sn);case 93:return++W,Li(nn);case 123:return++W,Li(is);case 125:return++W,Li(rs);case 58:return++W,Li(F);case 63:return++W,Li(it);case 48:var ut=L.charCodeAt(W+1);if(ut===120||ut===88)return b_();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return Gd(!1);case 34:case 39:return w_(st);case 47:return f_();case 37:case 42:return p_();case 124:case 38:return g_(st);case 94:return m_();case 43:case 45:return __(st);case 60:case 62:return v_(st);case 61:case 33:return y_(st);case 126:return Di(Ee,1)}return!1}function ln(st){if(st?W=Q+1:Q=W,G.locations&&(rt=new on),st)return zd();if(W>=O)return Li(pe);var ut=L.charCodeAt(W);if(ko(ut)||ut===92)return Hd();var St=x_(ut);if(St===!1){var Tt=String.fromCharCode(ut);if(Tt==="\\"||Od.test(Tt))return Hd();Et(W,"Unexpected character '"+Tt+"'")}return St}function Di(st,ut){var St=L.slice(W,W+ut);W+=ut,Li(st,St)}function zd(){for(var de="",st,ut,St=W;;){W>=O&&Et(St,"Unterminated regular expression");var Tt=L.charAt(W);if(Mo.test(Tt)&&Et(St,"Unterminated regular expression"),st)st=!1;else{if(Tt==="[")ut=!0;else if(Tt==="]"&&ut)ut=!1;else if(Tt==="/"&&!ut)break;st=Tt==="\\"}++W}var de=L.slice(St,W);++W;var ge=Vd();ge&&!/^[gmsiy]*$/.test(ge)&&Et(St,"Invalid regexp flag");try{var ye=new RegExp(de,ge)}catch(Ge){Ge instanceof SyntaxError&&Et(St,Ge.message),Et(Ge)}return Li($t,ye)}function Fa(st,ut){for(var St=W,Tt=0,de=0,ge=ut??1/0;de<ge;++de){var ye=L.charCodeAt(W),Ge;if(ye>=97?Ge=ye-97+10:ye>=65?Ge=ye-65+10:ye>=48&&ye<=57?Ge=ye-48:Ge=1/0,Ge>=st)break;++W,Tt=Tt*st+Ge}return W===St||ut!=null&&W-St!==ut?null:Tt}function b_(){W+=2;var st=Fa(16);return st==null&&Et(Q+2,"Expected hexadecimal number"),ko(L.charCodeAt(W))&&Et(W,"Identifier directly after number"),Li(jt,st)}function Gd(st){var ut=W,St=!1,Tt=L.charCodeAt(W)===48;!st&&Fa(10)===null&&Et(ut,"Invalid number"),L.charCodeAt(W)===46&&(++W,Fa(10),St=!0);var de=L.charCodeAt(W);(de===69||de===101)&&(de=L.charCodeAt(++W),(de===43||de===45)&&++W,Fa(10)===null&&Et(ut,"Invalid number"),St=!0),ko(L.charCodeAt(W))&&Et(W,"Identifier directly after number");var ge=L.slice(ut,W),ye;return St?ye=parseFloat(ge):!Tt||ge.length===1?ye=parseInt(ge,10):/[89]/.test(ge)||Ct?Et(ut,"Invalid number"):ye=parseInt(ge,8),Li(jt,ye)}function w_(st){W++;for(var ut="";;){W>=O&&Et(Q,"Unterminated string constant");var St=L.charCodeAt(W);if(St===st)return++W,Li(ue,ut);if(St===92){St=L.charCodeAt(++W);var Tt=/^[0-7]+/.exec(L.slice(W,W+3));for(Tt&&(Tt=Tt[0]);Tt&&parseInt(Tt,8)>255;)Tt=Tt.slice(0,-1);if(Tt==="0"&&(Tt=null),++W,Tt)Ct&&Et(W-2,"Octal literal in strict mode"),ut+=String.fromCharCode(parseInt(Tt,8)),W+=Tt.length-1;else switch(St){case 110:ut+=`
`;break;case 114:ut+="\r";break;case 120:ut+=String.fromCharCode(Ro(2));break;case 117:ut+=String.fromCharCode(Ro(4));break;case 85:ut+=String.fromCharCode(Ro(8));break;case 116:ut+="	";break;case 98:ut+="\b";break;case 118:ut+="\v";break;case 102:ut+="\f";break;case 48:ut+="\0";break;case 13:L.charCodeAt(W)===10&&++W;case 10:G.locations&&(gt=W,++ft);break;default:ut+=String.fromCharCode(St);break}}else(St===13||St===10||St===8232||St===8233)&&Et(Q,"Unterminated string constant"),ut+=String.fromCharCode(St),++W}}function Ro(st){var ut=Fa(16,st);return ut===null&&Et(Q,"Bad character escape sequence"),ut}var Wn;function Vd(){Wn=!1;for(var st,ut=!0,St=W;;){var Tt=L.charCodeAt(W);if(Nd(Tt))Wn&&(st+=L.charAt(W)),++W;else if(Tt===92){Wn||(st=L.slice(St,W)),Wn=!0,L.charCodeAt(++W)!=117&&Et(W,"Expecting Unicode escape sequence \\uXXXX"),++W;var de=Ro(4),ge=String.fromCharCode(de);ge||Et(W-1,"Invalid Unicode escape"),(ut?ko(de):Nd(de))||Et(W-4,"Invalid Unicode escape"),st+=ge}else break;ut=!1}return Wn?st:L.slice(St,W)}function Hd(){var st=Vd(),ut=he;return!Wn&&o_(st)&&(ut=La[st]),Li(ut,st)}function Ne(){yt=Q,At=et,Bt=ot,ln()}function Rh(st){if(Ct=st,W=Q,G.locations)for(;W<gt;)gt=L.lastIndexOf(`
`,gt-2)+1,--ft;Hn(),ln()}function Wd(){this.type=null,this.start=Q,this.end=null}function Xd(){this.start=rt,this.end=null,A!==null&&(this.source=A)}function Vi(){var st=new Wd;return G.locations&&(st.loc=new Xd),G.directSourceFile&&(st.sourceFile=G.directSourceFile),G.ranges&&(st.range=[Q,0]),st}function Ps(st){var ut=new Wd;return ut.start=st.start,G.locations&&(ut.loc=new Xd,ut.loc.start=st.loc.start),G.ranges&&(ut.range=[st.range[0],0]),ut}function ke(st,ut){return st.type=ut,st.end=At,G.locations&&(st.loc.end=Bt),G.ranges&&(st.range[1]=At),st}function Bh(st){return G.ecmaVersion>=5&&st.type==="ExpressionStatement"&&st.expression.type==="Literal"&&st.expression.value==="use strict"}function ni(st){if(J===st)return Ne(),!0}function Bo(){return!G.strictSemicolons&&(J===pe||J===rs||Mo.test(L.slice(At,Q)))}function hn(){!ni(x)&&!Bo()&&ns()}function Si(st){J===st?Ne():ns()}function ns(){Et(Q,"Unexpected token")}function Lo(st){st.type!=="Identifier"&&st.type!=="MemberExpression"&&Et(st.start,"Assigning to rvalue"),Ct&&st.type==="Identifier"&&Ao(st.name)&&Et(st.start,"Assigning to "+st.name+" in strict mode")}function S_(st){yt=At=W,G.locations&&(Bt=new on),Ot=Ct=null,Wt=[],ln();var ut=st||Vi(),St=!0;for(st||(ut.body=[]);J!==pe;){var Tt=yr();ut.body.push(Tt),St&&Bh(Tt)&&Rh(!0),St=!1}return ke(ut,"Program")}var Lh={kind:"loop"},C_={kind:"switch"};function yr(){(J===mt||J===Dt&&nt=="/=")&&ln(!0);var st=J,ut=Vi();switch(st){case me:case zt:Ne();var St=st===me;ni(x)||Bo()?ut.label=null:J!==he?ns():(ut.label=Ts(),hn());for(var Tt=0;Tt<Wt.length;++Tt){var de=Wt[Tt];if((ut.label==null||de.name===ut.label.name)&&(de.kind!=null&&(St||de.kind==="loop")||ut.label&&St))break}return Tt===Wt.length&&Et(ut.start,"Unsyntactic "+st.keyword),ke(ut,St?"BreakStatement":"ContinueStatement");case He:return Ne(),hn(),ke(ut,"DebuggerStatement");case ze:return Ne(),Wt.push(Lh),ut.body=yr(),Wt.pop(),Si(lr),ut.test=Oa(),hn(),ke(ut,"DoWhileStatement");case vi:if(Ne(),Wt.push(Lh),Si(pr),J===x)return Dh(ut,null);if(J===Fr){var ge=Vi();return Ne(),$d(ge,!0),ke(ge,"VariableDeclaration"),ge.declarations.length===1&&ni(Te)?jd(ut,ge):Dh(ut,ge)}var ge=ji(!1,!0);return ni(Te)?(Lo(ge),jd(ut,ge)):Dh(ut,ge);case Ki:return Ne(),zh(ut,!0);case Bi:return Ne(),ut.test=Oa(),ut.consequent=yr(),ut.alternate=ni(si)?yr():null,ke(ut,"IfStatement");case ei:return!Ot&&!G.allowReturnOutsideFunction&&Et(Q,"'return' outside of function"),Ne(),ni(x)||Bo()?ut.argument=null:(ut.argument=ji(),hn()),ke(ut,"ReturnStatement");case or:Ne(),ut.discriminant=Oa(),ut.cases=[],Si(is),Wt.push(C_);for(var ye,Ge;J!=rs;)if(J===ce||J===ti){var xr=J===ce;ye&&ke(ye,"SwitchCase"),ut.cases.push(ye=Vi()),ye.consequent=[],Ne(),xr?ye.test=ji():(Ge&&Et(yt,"Multiple default clauses"),Ge=!0,ye.test=null),Si(F)}else ye||ns(),ye.consequent.push(yr());return ye&&ke(ye,"SwitchCase"),Ne(),Wt.pop(),ke(ut,"SwitchStatement");case Gi:return Ne(),Mo.test(L.slice(At,Q))&&Et(At,"Illegal newline after throw"),ut.argument=ji(),hn(),ke(ut,"ThrowStatement");case Qi:if(Ne(),ut.block=Na(),ut.handler=null,J===_i){var un=Vi();Ne(),Si(pr),un.param=Ts(),Ct&&Ao(un.param.name)&&Et(un.param.start,"Binding "+un.param.name+" in strict mode"),Si(hr),un.guard=null,un.body=Na(),ut.handler=ke(un,"CatchClause")}return ut.guardedHandlers=Nt,ut.finalizer=ni(zi)?Na():null,!ut.handler&&!ut.finalizer&&Et(ut.start,"Missing catch or finally clause"),ke(ut,"TryStatement");case Fr:return Ne(),$d(ut),hn(),ke(ut,"VariableDeclaration");case lr:return Ne(),ut.test=Oa(),Wt.push(Lh),ut.body=yr(),Wt.pop(),ke(ut,"WhileStatement");case zn:return Ct&&Et(Q,"'with' in strict mode"),Ne(),ut.object=Oa(),ut.body=yr(),ke(ut,"WithStatement");case is:return Na();case x:return Ne(),ke(ut,"EmptyStatement");default:var Vh=nt,Do=ji();if(st===he&&Do.type==="Identifier"&&ni(F)){for(var Tt=0;Tt<Wt.length;++Tt)Wt[Tt].name===Vh&&Et(Do.start,"Label '"+Vh+"' is already declared");var M_=J.isLoop?"loop":J===or?"switch":null;return Wt.push({name:Vh,kind:M_}),ut.body=yr(),Wt.pop(),ut.label=Do,ke(ut,"LabeledStatement")}else return ut.expression=Do,hn(),ke(ut,"ExpressionStatement")}}function Oa(){Si(pr);var st=ji();return Si(hr),st}function Na(st){var ut=Vi(),St=!0,Tt=!1,de;for(ut.body=[],Si(is);!ni(rs);){var ge=yr();ut.body.push(ge),St&&st&&Bh(ge)&&(de=Tt,Rh(Tt=!0)),St=!1}return Tt&&!de&&Rh(!1),ke(ut,"BlockStatement")}function Dh(st,ut){return st.init=ut,Si(x),st.test=J===x?null:ji(),Si(x),st.update=J===hr?null:ji(),Si(hr),st.body=yr(),Wt.pop(),ke(st,"ForStatement")}function jd(st,ut){return st.left=ut,st.right=ji(),Si(hr),st.body=yr(),Wt.pop(),ke(st,"ForInStatement")}function $d(st,ut){for(st.declarations=[],st.kind="var";;){var St=Vi();if(St.id=Ts(),Ct&&Ao(St.id.name)&&Et(St.id.start,"Binding "+St.id.name+" in strict mode"),St.init=ni(xt)?ji(!0,ut):null,st.declarations.push(ke(St,"VariableDeclarator")),!ni(u))break}return st}function ji(st,ut){var St=Fh(ut);if(!st&&J===u){var Tt=Ps(St);for(Tt.expressions=[St];ni(u);)Tt.expressions.push(Fh(ut));return ke(Tt,"SequenceExpression")}return St}function Fh(st){var ut=E_(st);if(J.isAssign){var St=Ps(ut);return St.operator=nt,St.left=ut,Ne(),St.right=Fh(st),Lo(ut),ke(St,"AssignmentExpression")}return ut}function E_(st){var ut=P_(st);if(ni(it)){var St=Ps(ut);return St.test=ut,St.consequent=ji(!0),Si(F),St.alternate=ji(!0,st),ke(St,"ConditionalExpression")}return ut}function P_(st){return Oh(Nh(),-1,st)}function Oh(st,ut,St){var Tt=J.binop;if(Tt!=null&&(!St||J!==Te)&&Tt>ut){var de=Ps(st);de.left=st,de.operator=nt;var ge=J;Ne(),de.right=Oh(Nh(),Tt,St);var ye=ke(de,ge===Me||ge===di?"LogicalExpression":"BinaryExpression");return Oh(ye,ut,St)}return st}function Nh(){if(J.prefix){var st=Vi(),ut=J.isUpdate;return st.operator=nt,st.prefix=!0,lt=!0,Ne(),st.argument=Nh(),ut?Lo(st.argument):Ct&&st.operator==="delete"&&st.argument.type==="Identifier"&&Et(st.start,"Deleting local variable in strict mode"),ke(st,ut?"UpdateExpression":"UnaryExpression")}for(var St=T_();J.postfix&&!Bo();){var st=Ps(St);st.operator=nt,st.prefix=!1,st.argument=St,Lo(St),Ne(),St=ke(st,"UpdateExpression")}return St}function T_(){return Ua(Uh())}function Ua(st,ut){if(ni(j)){var St=Ps(st);return St.object=st,St.property=Ts(!0),St.computed=!1,Ua(ke(St,"MemberExpression"),ut)}else if(ni(sn)){var St=Ps(st);return St.object=st,St.property=ji(),St.computed=!0,Si(nn),Ua(ke(St,"MemberExpression"),ut)}else if(!ut&&ni(pr)){var St=Ps(st);return St.callee=st,St.arguments=Gh(hr,!1),Ua(ke(St,"CallExpression"),ut)}else return st}function Uh(){switch(J){case ka:var Tt=Vi();return Ne(),ke(Tt,"ThisExpression");case he:return Ts();case jt:case ue:case $t:var Tt=Vi();return Tt.value=nt,Tt.raw=L.slice(Q,et),Ne(),ke(Tt,"Literal");case Ra:case Ba:case rn:var Tt=Vi();return Tt.value=J.atomValue,Tt.raw=J.keyword,Ne(),ke(Tt,"Literal");case pr:var st=rt,ut=Q;Ne();var St=ji();return St.start=ut,St.end=et,G.locations&&(St.loc.start=st,St.loc.end=ot),G.ranges&&(St.range=[ut,et]),Si(hr),St;case sn:var Tt=Vi();return Ne(),Tt.elements=Gh(nn,!0,!0),ke(Tt,"ArrayExpression");case is:return A_();case Ki:var Tt=Vi();return Ne(),zh(Tt,!1);case en:return I_();default:ns()}}function I_(){var st=Vi();return Ne(),st.callee=Ua(Uh(),!0),ni(pr)?st.arguments=Gh(hr,!1):st.arguments=Nt,ke(st,"NewExpression")}function A_(){var st=Vi(),ut=!0,St=!1;for(st.properties=[],Ne();!ni(rs);){if(ut)ut=!1;else if(Si(u),G.allowTrailingCommas&&ni(rs))break;var Tt={key:Yd()},de=!1,ge;if(ni(F)?(Tt.value=ji(!0),ge=Tt.kind="init"):G.ecmaVersion>=5&&Tt.key.type==="Identifier"&&(Tt.key.name==="get"||Tt.key.name==="set")?(de=St=!0,ge=Tt.kind=Tt.key.name,Tt.key=Yd(),J!==pr&&ns(),Tt.value=zh(Vi(),!1)):ns(),Tt.key.type==="Identifier"&&(Ct||St))for(var ye=0;ye<st.properties.length;++ye){var Ge=st.properties[ye];if(Ge.key.name===Tt.key.name){var xr=ge==Ge.kind||de&&Ge.kind==="init"||ge==="init"&&(Ge.kind==="get"||Ge.kind==="set");xr&&!Ct&&ge==="init"&&Ge.kind==="init"&&(xr=!1),xr&&Et(Tt.key.start,"Redefinition of property")}}st.properties.push(Tt)}return ke(st,"ObjectExpression")}function Yd(){return J===jt||J===ue?Uh():Ts(!0)}function zh(st,ut){J===he?st.id=Ts():ut?ns():st.id=null,st.params=[];var St=!0;for(Si(pr);!ni(hr);)St?St=!1:Si(u),st.params.push(Ts());var Tt=Ot,de=Wt;if(Ot=!0,Wt=[],st.body=Na(!0),Ot=Tt,Wt=de,Ct||st.body.body.length&&Bh(st.body.body[0]))for(var ge=st.id?-1:0;ge<st.params.length;++ge){var ye=ge<0?st.id:st.params[ge];if((Dd(ye.name)||Ao(ye.name))&&Et(ye.start,"Defining '"+ye.name+"' in strict mode"),ge>=0)for(var Ge=0;Ge<ge;++Ge)ye.name===st.params[Ge].name&&Et(ye.start,"Argument name clash in strict mode")}return ke(st,ut?"FunctionDeclaration":"FunctionExpression")}function Gh(st,ut,St){for(var Tt=[],de=!0;!ni(st);){if(de)de=!1;else if(Si(u),ut&&G.allowTrailingCommas&&ni(st))break;St&&J===u?Tt.push(null):Tt.push(ji(!0))}return Tt}function Ts(st){var ut=Vi();return st&&G.forbidReserved=="everywhere"&&(st=!1),J===he?(!st&&(G.forbidReserved&&(G.ecmaVersion===3?n_:a_)(nt)||Ct&&Dd(nt))&&L.slice(Q,et).indexOf("\\")==-1&&Et(Q,"The keyword '"+nt+"' is reserved"),ut.name=nt):st&&J.keyword?ut.name=J.keyword:ns(),lt=!1,Ne(),ke(ut,"Identifier")}}),l.version||(l=null)}function g(N,G){return(a.acorn||l).parse(N,G)}var _={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},S={"-":"__negate","+":"__self"},w=n.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(N){this["__"+N]="#"+N},{__self:function(){return this}});y.inject(w),M.inject(w),ee.inject(w);function C(N,G,L){var O=_[G];if(N&&N[O]){var A=N[O](L);return G==="!="?!A:A}switch(G){case"+":return N+L;case"-":return N-L;case"*":return N*L;case"/":return N/L;case"%":return N%L;case"==":return N==L;case"!=":return N!=L}}function E(N,G){var L=S[N];if(G&&G[L])return G[L]();switch(N){case"+":return+G;case"-":return-G}}function B(N,G){if(!N)return"";G=G||{};var L=[];function O(Ct){for(var Et=0,Nt=L.length;Et<Nt;Et++){var jt=L[Et];if(jt[0]>=Ct)break;Ct+=jt[1]}return Ct}function A(Ct){return N.substring(O(Ct.range[0]),O(Ct.range[1]))}function U(Ct,Et){return N.substring(O(Ct.range[1]),O(Et.range[0]))}function X(Ct,Et){for(var Nt=O(Ct.range[0]),jt=O(Ct.range[1]),$t=0,ue=L.length-1;ue>=0;ue--)if(Nt>L[ue][0]){$t=ue+1;break}L.splice($t,0,[Nt,Et.length-jt+Nt]),N=N.substring(0,Nt)+Et+N.substring(jt)}function $(Ct,Et){switch(Ct.type){case"UnaryExpression":if(Ct.operator in S&&Ct.argument.type!=="Literal"){var Nt=A(Ct.argument);X(Ct,'$__("'+Ct.operator+'", '+Nt+")")}break;case"BinaryExpression":if(Ct.operator in _&&Ct.left.type!=="Literal"){var jt=A(Ct.left),$t=A(Ct.right),ue=U(Ct.left,Ct.right),he=Ct.operator;X(Ct,"__$__("+jt+","+ue.replace(new RegExp("\\"+he),'"'+he+'"')+", "+$t+")")}break;case"UpdateExpression":case"AssignmentExpression":var pe=Et&&Et.type;if(!(pe==="ForStatement"||pe==="BinaryExpression"&&/^[=!<>]/.test(Et.operator)||pe==="MemberExpression"&&Et.computed)){if(Ct.type==="UpdateExpression"){var Nt=A(Ct.argument),me="__$__("+Nt+', "'+Ct.operator[0]+'", 1)',ce=Nt+" = "+me;Ct.prefix?ce="("+ce+")":(pe==="AssignmentExpression"||pe==="VariableDeclarator"||pe==="BinaryExpression")&&(A(Et.left||Et.id)===Nt&&(ce=me),ce=Nt+"; "+ce),X(Ct,ce)}else if(/^.=$/.test(Ct.operator)&&Ct.left.type!=="Literal"){var jt=A(Ct.left),$t=A(Ct.right),me=jt+" = __$__("+jt+', "'+Ct.operator[0]+'", '+$t+")";X(Ct,/^\(.*\)$/.test(A(Ct))?"("+me+")":me)}}break}}function W(Ct){switch(Ct.type){case"ExportDefaultDeclaration":X({range:[Ct.start,Ct.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var Et=Ct.declaration,Nt=Ct.specifiers;if(Et){var jt=Et.declarations;jt&&(jt.forEach(function(ue){X(ue,"module.exports."+A(ue))}),X({range:[Ct.start,Et.start+Et.kind.length]},""))}else if(Nt){var $t=Nt.map(function(ue){var he=A(ue);return"module.exports."+he+" = "+he+"; "}).join("");$t&&X(Ct,$t)}break}}function Q(Ct,Et,Nt){if(Ct){for(var jt in Ct)if(jt!=="range"&&jt!=="loc"){var $t=Ct[jt];if(Array.isArray($t))for(var ue=0,he=$t.length;ue<he;ue++)Q($t[ue],Ct,Nt);else $t&&typeof $t=="object"&&Q($t,Ct,Nt)}Nt.operatorOverloading!==!1&&$(Ct,Et),Nt.moduleExports!==!1&&W(Ct)}}function et(Ct){var Et="",Nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Ct=(Math.abs(Ct)<<1)+(Ct<0?1:0);Ct||!Et;){var jt=Ct&31;Ct>>=5,Ct&&(jt|=32),Et+=Nt[jt]}return Et}var rt=G.url||"",ot=G.sourceMaps,J=G.paperFeatures||{},nt=G.source||N,lt=G.offset||0,ft=be.agent,gt=ft.versionNumber,yt=!1,At=/\r\n|\n|\r/mg,Bt;if(ot&&(ft.chrome&&gt>=30||ft.webkit&&gt>=537.76||ft.firefox&&gt>=23||ft.node)){if(ft.node)lt-=2;else if(i&&rt&&!i.location.href.indexOf(rt)){var Ot=s.getElementsByTagName("html")[0].innerHTML;lt=Ot.substr(0,Ot.indexOf(N)+1).match(At).length+1}yt=lt>0&&!(ft.chrome&&gt>=36||ft.safari&&gt>=600||ft.firefox&&gt>=40||ft.node);var Wt=["AA"+et(yt?0:lt)+"A"];Wt.length=(N.match(At)||[]).length+1+(yt?lt:0),Bt={version:3,file:rt,names:[],mappings:Wt.join(";AACA"),sourceRoot:"",sources:[rt],sourcesContent:[nt]}}return(J.operatorOverloading!==!1||J.moduleExports!==!1)&&Q(g(N,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,J),Bt&&(yt&&(N=new Array(lt+1).join(`
`)+N),/^(inline|both)$/.test(ot)&&(N+=`
//# sourceMappingURL=data:application/json;base64,`+t.btoa(unescape(encodeURIComponent(JSON.stringify(Bt))))),N+=`
//# sourceURL=`+(rt||"paperscript")),{url:rt,source:nt,code:N,map:Bt}}function D(N,G,L){be=G;var O=G.getView(),A=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(N)&&!/\bnew\s+Tool\b/.test(N)?new Ii:null,U=A?A._events:[],X=["onFrame","onResize"].concat(U),$=[],W=[],Q,et=typeof N=="object"?N:B(N,L);N=et.code;function rt(gt,yt){for(var At in gt)(yt||!/^_/.test(At))&&new RegExp("([\\b\\s\\W]|^)"+At.replace(/\$/g,"\\$")+"\\b").test(N)&&($.push(At),W.push(gt[At]))}rt({__$__:C,$__:E,paper:G,tool:A},!0),rt(G),N="var module = { exports: {} }; "+N;var lt=n.each(X,function(gt){new RegExp("\\s+"+gt+"\\b").test(N)&&($.push(gt),this.push("module.exports."+gt+" = "+gt+";"))},[]).join(`
`);lt&&(N+=`
`+lt),N+=`
return module.exports;`;var ot=be.agent;if(s&&(ot.chrome||ot.firefox&&ot.versionNumber<40)){var J=s.createElement("script"),nt=s.head||s.getElementsByTagName("head")[0];ot.firefox&&(N=`
`+N),J.appendChild(s.createTextNode("document.__paperscript__ = function("+$+") {"+N+`
}`)),nt.appendChild(J),Q=s.__paperscript__,delete s.__paperscript__,nt.removeChild(J)}else Q=Function($,N);var lt=Q&&Q.apply(G,W),ft=lt||{};return n.each(U,function(gt){var yt=ft[gt];yt&&(A[gt]=yt)}),O&&(ft.onResize&&O.setOnResize(ft.onResize),O.emit("resize",{size:O.size,delta:new y}),ft.onFrame&&O.setOnFrame(ft.onFrame),O.requestUpdate()),lt}function R(N){if(/^text\/(?:x-|)paperscript$/.test(N.type)&&h.getAttribute(N,"ignore")!=="true"){var G=h.getAttribute(N,"canvas"),L=s.getElementById(G),O=N.src||N.getAttribute("data-src"),A=h.hasAttribute(N,"async"),U="data-paper-scope";if(!L)throw new Error('Unable to find canvas with id "'+G+'"');var X=h.get(L.getAttribute(U))||new h().setup(L);return L.setAttribute(U,X._id),O?es.request({url:O,async:A,mimeType:"text/plain",onLoad:function($){D($,X,O)}}):D(N.innerHTML,X,N.baseURI),N.setAttribute("data-paper-ignore","true"),X}}function k(){n.each(s&&s.getElementsByTagName("script"),R)}function H(N){return N?R(N):k()}return i&&(s.readyState==="complete"?setTimeout(k):ne.add(i,{load:k})),{compile:B,execute:D,load:H,parse:g,calculateBinary:C,calculateUnary:E}}).call(this);var be=new(h.inject(n.exports,{Base:n,Numerical:v,Key:Ve,DomEvent:ne,DomElement:se,document:s,window:i,Symbol:bt,PlacedSymbol:It}));return be.agent.node&&Ju(be),typeof e=="function"&&e.amd?e("paper",be):r&&(r.exports=be),be}).call(js,typeof self=="object"?self:null)})(Fm);var Om=Fm.exports;const Ed=vo(Om);var Pd={exports:{}},Nm={exports:{}};(function(r,t){(function(e,i){r.exports=i()})(js,function(){function e(V,I,Y,K,T){(function at(ct,pt,wt,It,bt){for(;It>wt;){if(It-wt>600){var dt=It-wt+1,ht=pt-wt+1,Mt=Math.log(dt),_t=.5*Math.exp(2*Mt/3),Rt=.5*Math.sqrt(Mt*_t*(dt-_t)/dt)*(ht-dt/2<0?-1:1),kt=Math.max(wt,Math.floor(pt-ht*_t/dt+Rt)),Gt=Math.min(It,Math.floor(pt+(dt-ht)*_t/dt+Rt));at(ct,pt,kt,Gt,bt)}var vt=ct[pt],Pt=wt,Vt=It;for(i(ct,wt,pt),bt(ct[It],vt)>0&&i(ct,wt,It);Pt<Vt;){for(i(ct,Pt,Vt),Pt++,Vt--;bt(ct[Pt],vt)<0;)Pt++;for(;bt(ct[Vt],vt)>0;)Vt--}bt(ct[wt],vt)===0?i(ct,wt,Vt):i(ct,++Vt,It),Vt<=pt&&(wt=Vt+1),pt<=Vt&&(It=Vt-1)}})(V,I,Y||0,K||V.length-1,T||s)}function i(V,I,Y){var K=V[I];V[I]=V[Y],V[Y]=K}function s(V,I){return V<I?-1:V>I?1:0}var n=function(V){V===void 0&&(V=9),this._maxEntries=Math.max(4,V),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(V,I,Y){if(!Y)return I.indexOf(V);for(var K=0;K<I.length;K++)if(Y(V,I[K]))return K;return-1}function h(V,I){d(V,0,V.children.length,I,V)}function d(V,I,Y,K,T){T||(T=z(null)),T.minX=1/0,T.minY=1/0,T.maxX=-1/0,T.maxY=-1/0;for(var at=I;at<Y;at++){var ct=V.children[at];p(T,V.leaf?K(ct):ct)}return T}function p(V,I){return V.minX=Math.min(V.minX,I.minX),V.minY=Math.min(V.minY,I.minY),V.maxX=Math.max(V.maxX,I.maxX),V.maxY=Math.max(V.maxY,I.maxY),V}function m(V,I){return V.minX-I.minX}function v(V,I){return V.minY-I.minY}function b(V){return(V.maxX-V.minX)*(V.maxY-V.minY)}function y(V){return V.maxX-V.minX+(V.maxY-V.minY)}function P(V,I){return V.minX<=I.minX&&V.minY<=I.minY&&I.maxX<=V.maxX&&I.maxY<=V.maxY}function M(V,I){return I.minX<=V.maxX&&I.minY<=V.maxY&&I.maxX>=V.minX&&I.maxY>=V.minY}function z(V){return{children:V,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function q(V,I,Y,K,T){for(var at=[I,Y];at.length;)if(!((Y=at.pop())-(I=at.pop())<=K)){var ct=I+Math.ceil((Y-I)/K/2)*K;e(V,ct,I,Y,T),at.push(I,ct,ct,Y)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(V){var I=this.data,Y=[];if(!M(V,I))return Y;for(var K=this.toBBox,T=[];I;){for(var at=0;at<I.children.length;at++){var ct=I.children[at],pt=I.leaf?K(ct):ct;M(V,pt)&&(I.leaf?Y.push(ct):P(V,pt)?this._all(ct,Y):T.push(ct))}I=T.pop()}return Y},n.prototype.collides=function(V){var I=this.data;if(!M(V,I))return!1;for(var Y=[];I;){for(var K=0;K<I.children.length;K++){var T=I.children[K],at=I.leaf?this.toBBox(T):T;if(M(V,at)){if(I.leaf||P(V,at))return!0;Y.push(T)}}I=Y.pop()}return!1},n.prototype.load=function(V){if(!V||!V.length)return this;if(V.length<this._minEntries){for(var I=0;I<V.length;I++)this.insert(V[I]);return this}var Y=this._build(V.slice(),0,V.length-1,0);if(this.data.children.length)if(this.data.height===Y.height)this._splitRoot(this.data,Y);else{if(this.data.height<Y.height){var K=this.data;this.data=Y,Y=K}this._insert(Y,this.data.height-Y.height-1,!0)}else this.data=Y;return this},n.prototype.insert=function(V){return V&&this._insert(V,this.data.height-1),this},n.prototype.clear=function(){return this.data=z([]),this},n.prototype.remove=function(V,I){if(!V)return this;for(var Y,K,T,at=this.data,ct=this.toBBox(V),pt=[],wt=[];at||pt.length;){if(at||(at=pt.pop(),K=pt[pt.length-1],Y=wt.pop(),T=!0),at.leaf){var It=o(V,at.children,I);if(It!==-1)return at.children.splice(It,1),pt.push(at),this._condense(pt),this}T||at.leaf||!P(at,ct)?K?(Y++,at=K.children[Y],T=!1):at=null:(pt.push(at),wt.push(Y),Y=0,K=at,at=at.children[0])}return this},n.prototype.toBBox=function(V){return V},n.prototype.compareMinX=function(V,I){return V.minX-I.minX},n.prototype.compareMinY=function(V,I){return V.minY-I.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(V){return this.data=V,this},n.prototype._all=function(V,I){for(var Y=[];V;)V.leaf?I.push.apply(I,V.children):Y.push.apply(Y,V.children),V=Y.pop();return I},n.prototype._build=function(V,I,Y,K){var T,at=Y-I+1,ct=this._maxEntries;if(at<=ct)return h(T=z(V.slice(I,Y+1)),this.toBBox),T;K||(K=Math.ceil(Math.log(at)/Math.log(ct)),ct=Math.ceil(at/Math.pow(ct,K-1))),(T=z([])).leaf=!1,T.height=K;var pt=Math.ceil(at/ct),wt=pt*Math.ceil(Math.sqrt(ct));q(V,I,Y,wt,this.compareMinX);for(var It=I;It<=Y;It+=wt){var bt=Math.min(It+wt-1,Y);q(V,It,bt,pt,this.compareMinY);for(var dt=It;dt<=bt;dt+=pt){var ht=Math.min(dt+pt-1,bt);T.children.push(this._build(V,dt,ht,K-1))}}return h(T,this.toBBox),T},n.prototype._chooseSubtree=function(V,I,Y,K){for(;K.push(I),!I.leaf&&K.length-1!==Y;){for(var T=1/0,at=1/0,ct=void 0,pt=0;pt<I.children.length;pt++){var wt=I.children[pt],It=b(wt),bt=(dt=V,ht=wt,(Math.max(ht.maxX,dt.maxX)-Math.min(ht.minX,dt.minX))*(Math.max(ht.maxY,dt.maxY)-Math.min(ht.minY,dt.minY))-It);bt<at?(at=bt,T=It<T?It:T,ct=wt):bt===at&&It<T&&(T=It,ct=wt)}I=ct||I.children[0]}var dt,ht;return I},n.prototype._insert=function(V,I,Y){var K=Y?V:this.toBBox(V),T=[],at=this._chooseSubtree(K,this.data,I,T);for(at.children.push(V),p(at,K);I>=0&&T[I].children.length>this._maxEntries;)this._split(T,I),I--;this._adjustParentBBoxes(K,T,I)},n.prototype._split=function(V,I){var Y=V[I],K=Y.children.length,T=this._minEntries;this._chooseSplitAxis(Y,T,K);var at=this._chooseSplitIndex(Y,T,K),ct=z(Y.children.splice(at,Y.children.length-at));ct.height=Y.height,ct.leaf=Y.leaf,h(Y,this.toBBox),h(ct,this.toBBox),I?V[I-1].children.push(ct):this._splitRoot(Y,ct)},n.prototype._splitRoot=function(V,I){this.data=z([V,I]),this.data.height=V.height+1,this.data.leaf=!1,h(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(V,I,Y){for(var K,T,at,ct,pt,wt,It,bt=1/0,dt=1/0,ht=I;ht<=Y-I;ht++){var Mt=d(V,0,ht,this.toBBox),_t=d(V,ht,Y,this.toBBox),Rt=(T=Mt,at=_t,ct=void 0,pt=void 0,wt=void 0,It=void 0,ct=Math.max(T.minX,at.minX),pt=Math.max(T.minY,at.minY),wt=Math.min(T.maxX,at.maxX),It=Math.min(T.maxY,at.maxY),Math.max(0,wt-ct)*Math.max(0,It-pt)),kt=b(Mt)+b(_t);Rt<bt?(bt=Rt,K=ht,dt=kt<dt?kt:dt):Rt===bt&&kt<dt&&(dt=kt,K=ht)}return K||Y-I},n.prototype._chooseSplitAxis=function(V,I,Y){var K=V.leaf?this.compareMinX:m,T=V.leaf?this.compareMinY:v;this._allDistMargin(V,I,Y,K)<this._allDistMargin(V,I,Y,T)&&V.children.sort(K)},n.prototype._allDistMargin=function(V,I,Y,K){V.children.sort(K);for(var T=this.toBBox,at=d(V,0,I,T),ct=d(V,Y-I,Y,T),pt=y(at)+y(ct),wt=I;wt<Y-I;wt++){var It=V.children[wt];p(at,V.leaf?T(It):It),pt+=y(at)}for(var bt=Y-I-1;bt>=I;bt--){var dt=V.children[bt];p(ct,V.leaf?T(dt):dt),pt+=y(ct)}return pt},n.prototype._adjustParentBBoxes=function(V,I,Y){for(var K=Y;K>=0;K--)p(I[K],V)},n.prototype._condense=function(V){for(var I=V.length-1,Y=void 0;I>=0;I--)V[I].children.length===0?I>0?(Y=V[I-1].children).splice(Y.indexOf(V[I]),1):this.clear():h(V[I],this.toBBox)},n})})(Nm);var PE=Nm.exports;class TE{constructor(t=[],e=IE){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,s=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(i(s,o)>=0)break;e[t]=o,t=n}e[t]=s}_down(t){const{data:e,compare:i}=this,s=this.length>>1,n=e[t];for(;t<s;){let o=(t<<1)+1,h=e[o];const d=o+1;if(d<this.length&&i(e[d],h)<0&&(o=d,h=e[d]),i(h,n)>=0)break;e[t]=h,t=o}e[t]=n}}function IE(r,t){return r<t?-1:r>t?1:0}const AE=Object.freeze(Object.defineProperty({__proto__:null,default:TE},Symbol.toStringTag,{value:"Module"})),ME=Gg(AE);var Eh={exports:{}},kE=function(t,e,i,s){var n=t[0],o=t[1],h=!1;i===void 0&&(i=0),s===void 0&&(s=e.length);for(var d=(s-i)/2,p=0,m=d-1;p<d;m=p++){var v=e[i+p*2+0],b=e[i+p*2+1],y=e[i+m*2+0],P=e[i+m*2+1],M=b>o!=P>o&&n<(y-v)*(o-b)/(P-b)+v;M&&(h=!h)}return h},RE=function(t,e,i,s){var n=t[0],o=t[1],h=!1;i===void 0&&(i=0),s===void 0&&(s=e.length);for(var d=s-i,p=0,m=d-1;p<d;m=p++){var v=e[p+i][0],b=e[p+i][1],y=e[m+i][0],P=e[m+i][1],M=b>o!=P>o&&n<(y-v)*(o-b)/(P-b)+v;M&&(h=!h)}return h},Um=kE,zm=RE;Eh.exports=function(t,e,i,s){return e.length>0&&Array.isArray(e[0])?zm(t,e,i,s):Um(t,e,i,s)};Eh.exports.nested=zm;Eh.exports.flat=Um;var BE=Eh.exports,Zc={exports:{}};(function(r,t){(function(e,i){i(t)})(js,function(e){const s=33306690738754706e-32;function n(M,z,q,V,I){let Y,K,T,at,ct=z[0],pt=V[0],wt=0,It=0;pt>ct==pt>-ct?(Y=ct,ct=z[++wt]):(Y=pt,pt=V[++It]);let bt=0;if(wt<M&&It<q)for(pt>ct==pt>-ct?(T=Y-((K=ct+Y)-ct),ct=z[++wt]):(T=Y-((K=pt+Y)-pt),pt=V[++It]),Y=K,T!==0&&(I[bt++]=T);wt<M&&It<q;)pt>ct==pt>-ct?(T=Y-((K=Y+ct)-(at=K-Y))+(ct-at),ct=z[++wt]):(T=Y-((K=Y+pt)-(at=K-Y))+(pt-at),pt=V[++It]),Y=K,T!==0&&(I[bt++]=T);for(;wt<M;)T=Y-((K=Y+ct)-(at=K-Y))+(ct-at),ct=z[++wt],Y=K,T!==0&&(I[bt++]=T);for(;It<q;)T=Y-((K=Y+pt)-(at=K-Y))+(pt-at),pt=V[++It],Y=K,T!==0&&(I[bt++]=T);return Y===0&&bt!==0||(I[bt++]=Y),bt}function o(M){return new Float64Array(M)}const h=33306690738754716e-32,d=22204460492503146e-32,p=11093356479670487e-47,m=o(4),v=o(8),b=o(12),y=o(16),P=o(4);e.orient2d=function(M,z,q,V,I,Y){const K=(z-Y)*(q-I),T=(M-I)*(V-Y),at=K-T;if(K===0||T===0||K>0!=T>0)return at;const ct=Math.abs(K+T);return Math.abs(at)>=h*ct?at:-function(pt,wt,It,bt,dt,ht,Mt){let _t,Rt,kt,Gt,vt,Pt,Vt,le,re,ee,Qt,xe,Fe,se,ne,Zt,Oe,Ae;const Xe=pt-dt,Ve=It-dt,ci=wt-ht,mi=bt-ht;vt=(ne=(le=Xe-(Vt=(Pt=134217729*Xe)-(Pt-Xe)))*(ee=mi-(re=(Pt=134217729*mi)-(Pt-mi)))-((se=Xe*mi)-Vt*re-le*re-Vt*ee))-(Qt=ne-(Oe=(le=ci-(Vt=(Pt=134217729*ci)-(Pt-ci)))*(ee=Ve-(re=(Pt=134217729*Ve)-(Pt-Ve)))-((Zt=ci*Ve)-Vt*re-le*re-Vt*ee))),m[0]=ne-(Qt+vt)+(vt-Oe),vt=(Fe=se-((xe=se+Qt)-(vt=xe-se))+(Qt-vt))-(Qt=Fe-Zt),m[1]=Fe-(Qt+vt)+(vt-Zt),vt=(Ae=xe+Qt)-xe,m[2]=xe-(Ae-vt)+(Qt-vt),m[3]=Ae;let Ii=function($e,ws){let be=ws[0];for(let a=1;a<$e;a++)be+=ws[a];return be}(4,m),vr=d*Mt;if(Ii>=vr||-Ii>=vr||(_t=pt-(Xe+(vt=pt-Xe))+(vt-dt),kt=It-(Ve+(vt=It-Ve))+(vt-dt),Rt=wt-(ci+(vt=wt-ci))+(vt-ht),Gt=bt-(mi+(vt=bt-mi))+(vt-ht),_t===0&&Rt===0&&kt===0&&Gt===0)||(vr=p*Mt+s*Math.abs(Ii),(Ii+=Xe*Gt+mi*_t-(ci*kt+Ve*Rt))>=vr||-Ii>=vr))return Ii;vt=(ne=(le=_t-(Vt=(Pt=134217729*_t)-(Pt-_t)))*(ee=mi-(re=(Pt=134217729*mi)-(Pt-mi)))-((se=_t*mi)-Vt*re-le*re-Vt*ee))-(Qt=ne-(Oe=(le=Rt-(Vt=(Pt=134217729*Rt)-(Pt-Rt)))*(ee=Ve-(re=(Pt=134217729*Ve)-(Pt-Ve)))-((Zt=Rt*Ve)-Vt*re-le*re-Vt*ee))),P[0]=ne-(Qt+vt)+(vt-Oe),vt=(Fe=se-((xe=se+Qt)-(vt=xe-se))+(Qt-vt))-(Qt=Fe-Zt),P[1]=Fe-(Qt+vt)+(vt-Zt),vt=(Ae=xe+Qt)-xe,P[2]=xe-(Ae-vt)+(Qt-vt),P[3]=Ae;const es=n(4,m,4,P,v);vt=(ne=(le=Xe-(Vt=(Pt=134217729*Xe)-(Pt-Xe)))*(ee=Gt-(re=(Pt=134217729*Gt)-(Pt-Gt)))-((se=Xe*Gt)-Vt*re-le*re-Vt*ee))-(Qt=ne-(Oe=(le=ci-(Vt=(Pt=134217729*ci)-(Pt-ci)))*(ee=kt-(re=(Pt=134217729*kt)-(Pt-kt)))-((Zt=ci*kt)-Vt*re-le*re-Vt*ee))),P[0]=ne-(Qt+vt)+(vt-Oe),vt=(Fe=se-((xe=se+Qt)-(vt=xe-se))+(Qt-vt))-(Qt=Fe-Zt),P[1]=Fe-(Qt+vt)+(vt-Zt),vt=(Ae=xe+Qt)-xe,P[2]=xe-(Ae-vt)+(Qt-vt),P[3]=Ae;const qe=n(es,v,4,P,b);vt=(ne=(le=_t-(Vt=(Pt=134217729*_t)-(Pt-_t)))*(ee=Gt-(re=(Pt=134217729*Gt)-(Pt-Gt)))-((se=_t*Gt)-Vt*re-le*re-Vt*ee))-(Qt=ne-(Oe=(le=Rt-(Vt=(Pt=134217729*Rt)-(Pt-Rt)))*(ee=kt-(re=(Pt=134217729*kt)-(Pt-kt)))-((Zt=Rt*kt)-Vt*re-le*re-Vt*ee))),P[0]=ne-(Qt+vt)+(vt-Oe),vt=(Fe=se-((xe=se+Qt)-(vt=xe-se))+(Qt-vt))-(Qt=Fe-Zt),P[1]=Fe-(Qt+vt)+(vt-Zt),vt=(Ae=xe+Qt)-xe,P[2]=xe-(Ae-vt)+(Qt-vt),P[3]=Ae;const Zi=n(qe,b,4,P,y);return y[Zi-1]}(M,z,q,V,I,Y,ct)},e.orient2dfast=function(M,z,q,V,I,Y){return(z-Y)*(q-I)-(M-I)*(V-Y)},Object.defineProperty(e,"__esModule",{value:!0})})})(Zc,Zc.exports);var LE=Zc.exports,gg=PE,Ol=ME,DE=BE,FE=LE.orient2d;Ol.default&&(Ol=Ol.default);Pd.exports=Gm;Pd.exports.default=Gm;function Gm(r,t,e){t=Math.max(0,t===void 0?2:t),e=e||0;var i=GE(r),s=new gg(16);s.toBBox=function(V){return{minX:V[0],minY:V[1],maxX:V[0],maxY:V[1]}},s.compareMinX=function(V,I){return V[0]-I[0]},s.compareMinY=function(V,I){return V[1]-I[1]},s.load(r);for(var n=[],o=0,h;o<i.length;o++){var d=i[o];s.remove(d),h=vg(d,h),n.push(h)}var p=new gg(16);for(o=0;o<n.length;o++)p.insert(Ru(n[o]));for(var m=t*t,v=e*e;n.length;){var b=n.shift(),y=b.p,P=b.next.p,M=Bu(y,P);if(!(M<v)){var z=M/m;d=OE(s,b.prev.p,y,P,b.next.next.p,z,p),d&&Math.min(Bu(d,y),Bu(d,P))<=z&&(n.push(b),n.push(vg(d,b)),s.remove(d),p.remove(b),p.insert(Ru(b)),p.insert(Ru(b.next)))}}b=h;var q=[];do q.push(b.p),b=b.next;while(b!==h);return q.push(b.p),q}function OE(r,t,e,i,s,n,o){for(var h=new Ol([],NE),d=r.data;d;){for(var p=0;p<d.children.length;p++){var m=d.children[p],v=d.leaf?Lu(m,e,i):UE(e,i,m);v>n||h.push({node:m,dist:v})}for(;h.length&&!h.peek().node.children;){var b=h.pop(),y=b.node,P=Lu(y,t,e),M=Lu(y,i,s);if(b.dist<P&&b.dist<M&&_g(e,y,o)&&_g(i,y,o))return y}d=h.pop(),d&&(d=d.node)}return null}function NE(r,t){return r.dist-t.dist}function UE(r,t,e){if(mg(r,e)||mg(t,e))return 0;var i=cl(r[0],r[1],t[0],t[1],e.minX,e.minY,e.maxX,e.minY);if(i===0)return 0;var s=cl(r[0],r[1],t[0],t[1],e.minX,e.minY,e.minX,e.maxY);if(s===0)return 0;var n=cl(r[0],r[1],t[0],t[1],e.maxX,e.minY,e.maxX,e.maxY);if(n===0)return 0;var o=cl(r[0],r[1],t[0],t[1],e.minX,e.maxY,e.maxX,e.maxY);return o===0?0:Math.min(i,s,n,o)}function mg(r,t){return r[0]>=t.minX&&r[0]<=t.maxX&&r[1]>=t.minY&&r[1]<=t.maxY}function _g(r,t,e){for(var i=Math.min(r[0],t[0]),s=Math.min(r[1],t[1]),n=Math.max(r[0],t[0]),o=Math.max(r[1],t[1]),h=e.search({minX:i,minY:s,maxX:n,maxY:o}),d=0;d<h.length;d++)if(zE(h[d].p,h[d].next.p,r,t))return!1;return!0}function ca(r,t,e){return FE(r[0],r[1],t[0],t[1],e[0],e[1])}function zE(r,t,e,i){return r!==i&&t!==e&&ca(r,t,e)>0!=ca(r,t,i)>0&&ca(e,i,r)>0!=ca(e,i,t)>0}function Ru(r){var t=r.p,e=r.next.p;return r.minX=Math.min(t[0],e[0]),r.minY=Math.min(t[1],e[1]),r.maxX=Math.max(t[0],e[0]),r.maxY=Math.max(t[1],e[1]),r}function GE(r){for(var t=r[0],e=r[0],i=r[0],s=r[0],n=0;n<r.length;n++){var o=r[n];o[0]<t[0]&&(t=o),o[0]>i[0]&&(i=o),o[1]<e[1]&&(e=o),o[1]>s[1]&&(s=o)}var h=[t,e,i,s],d=h.slice();for(n=0;n<r.length;n++)DE(r[n],h)||d.push(r[n]);return HE(d)}function vg(r,t){var e={p:r,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(e.next=t.next,e.prev=t,t.next.prev=e,t.next=e):(e.prev=e,e.next=e),e}function Bu(r,t){var e=r[0]-t[0],i=r[1]-t[1];return e*e+i*i}function Lu(r,t,e){var i=t[0],s=t[1],n=e[0]-i,o=e[1]-s;if(n!==0||o!==0){var h=((r[0]-i)*n+(r[1]-s)*o)/(n*n+o*o);h>1?(i=e[0],s=e[1]):h>0&&(i+=n*h,s+=o*h)}return n=r[0]-i,o=r[1]-s,n*n+o*o}function cl(r,t,e,i,s,n,o,h){var d=e-r,p=i-t,m=o-s,v=h-n,b=r-s,y=t-n,P=d*d+p*p,M=d*m+p*v,z=m*m+v*v,q=d*b+p*y,V=m*b+v*y,I=P*z-M*M,Y,K,T,at,ct=I,pt=I;I===0?(K=0,ct=1,at=V,pt=z):(K=M*V-z*q,at=P*V-M*q,K<0?(K=0,at=V,pt=z):K>ct&&(K=ct,at=V+M,pt=z)),at<0?(at=0,-q<0?K=0:-q>P?K=ct:(K=-q,ct=P)):at>pt&&(at=pt,-q+M<0?K=0:-q+M>P?K=ct:(K=-q+M,ct=P)),Y=K===0?0:K/ct,T=at===0?0:at/pt;var wt=(1-Y)*r+Y*e,It=(1-Y)*t+Y*i,bt=(1-T)*s+T*o,dt=(1-T)*n+T*h,ht=bt-wt,Mt=dt-It;return ht*ht+Mt*Mt}function VE(r,t){return r[0]===t[0]?r[1]-t[1]:r[0]-t[0]}function HE(r){r.sort(VE);for(var t=[],e=0;e<r.length;e++){for(;t.length>=2&&ca(t[t.length-2],t[t.length-1],r[e])<=0;)t.pop();t.push(r[e])}for(var i=[],s=r.length-1;s>=0;s--){for(;i.length>=2&&ca(i[i.length-2],i[i.length-1],r[s])<=0;)i.pop();i.push(r[s])}return i.pop(),t.pop(),t.concat(i)}var WE=Pd.exports;const yg=vo(WE);let ii=Ed;ii.setup(new ii.Size(100,100));class gs{constructor({paths:t,withReduction:e=!0,withSimplify:i=!0,widthInMm:s=1,heightInMm:n=1,widthInVu:o=1,heightInVu:h=1}){tt(this,"_type","ITEM");tt(this,"selectedShape");tt(this,"overLapShape");tt(this,"isZoomLocked",!1);tt(this,"_startDragPosition",{x:0,y:0});tt(this,"_mainCtn");tt(this,"_mainGraphics");tt(this,"_editPoints",[]);tt(this,"_boardSurface");tt(this,"_editPathItem",null);tt(this,"_psStart",null);tt(this,"_psEnd",null);tt(this,"_psLine",null);tt(this,"_hasZoomChanged",!1);tt(this,"disposed",!0);tt(this,"_wrapPt1",{x:0,y:0});tt(this,"_wrapPt2",{x:0,y:0});tt(this,"_hasBeenWrapped",!1);tt(this,"_zoomLevel",1);tt(this,"_isWrapMode",!1);tt(this,"_isSplitMode",!1);tt(this,"_isSubPatternMode",!1);tt(this,"guid","");tt(this,"widthInMm",0);tt(this,"heightInMm",0);tt(this,"widthInVu",0);tt(this,"heightInVu",0);tt(this,"withReduction",!0);tt(this,"withSimlify",!0);tt(this,"backupAngle",0);tt(this,"hasBeenOutwarded",!1);tt(this,"originalPaths",[]);tt(this,"normalizedPaths",[]);tt(this,"workingPaths",[]);tt(this,"originalPosition",new ii.Point(0,0));tt(this,"originalShift",new ii.Point(0,0));tt(this,"center",new ii.Point(0,0));tt(this,"wasDragEnded",!1);tt(this,"outwardedPath");tt(this,"outwardedPaper");tt(this,"outwardDoubleCut",!1);tt(this,"_x",0);tt(this,"_y",0);tt(this,"_angle",0);tt(this,"polygon",[]);tt(this,"allowSelection",!0);tt(this,"allowDragNDrop",!0);tt(this,"_isDragged",!1);tt(this,"_isSelected",!1);tt(this,"isDragStarted",!1);tt(this,"isDragEnded",!1);tt(this,"isHovered",!1);tt(this,"_mainPathPaper");tt(this,"_mainNormalizedPaper");tt(this,"dragStartPosition",{x:0,y:0});tt(this,"_isEditMode",!1);tt(this,"_editPointIndex",-1);tt(this,"_editPointIndexPosition",-1);tt(this,"_isCollided",!1);tt(this,"_colliderGfx",null);tt(this,"_collideList",new Set);tt(this,"_shapeHasChanged",!1);tt(this,"_carColor",-1);tt(this,"workingPapers",[]);tt(this,"originalPaper");tt(this,"originalPaperRot0");tt(this,"originalRotation",0);if(this.guid=ho(),this.originalPaths=t,this.withReduction=e,this.withSimlify=i,this.widthInMm=s,this.heightInMm=n,this.widthInVu=o,this.heightInVu=h,i)for(let d=0;d<this.originalPaths.length;d++)this.originalPaths[d]=Fl.from(this.originalPaths[d]).abs().round(3).toString();this.normalize()}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this.isZoomLocked||t!==this._zoomLevel&&(this._hasZoomChanged=!0,this._zoomLevel=t)}set isWrapMode(t){this.checkMvItems(),this._isWrapMode=t,t||(this._psEnd._mainCtn.visible=!1,this._psStart._mainCtn.visible=!1,this._psLine&&(this._psLine.visible=!1))}drawPsLine(t,e,i,s,n,o){this._psLine||(this._psLine=new Ri,this._mainCtn.parent.addChild(this._psLine)),this._psLine.visible=!0,this._psLine.clear();let h=n;if(t=t||this._psStart._mainCtn.x,e=e||this._psStart._mainCtn.y,i=i||this._psEnd._mainCtn.x,s=s||this._psEnd._mainCtn.y,this._psLine.lineStyle(2,16711935,1),this._psLine.moveTo(t,e),h){this._psLine.drawCircle(t,e,5);const d=Math.sqrt(Math.pow(i-t,2)+Math.pow(s-e,2));let p=this._psLine.getChildByName("text");p||(p=new $i(`${(d/o).toFixed(0)}mm`,{fill:0,fontSize:12}),p.name="text",this._psLine.addChild(p)),p.x=(t+i)/2,p.y=(e+s)/2,p.text=`${(d/o).toFixed(0)}mm`}this._psLine.lineTo(i,s)}hidePsLine(){this._psLine&&(this._psLine.visible=!1)}get isWrapMode(){return this._isWrapMode}set isSplitMode(t){this.checkMvItems(),this._isSplitMode=t,t||(this._psEnd._mainCtn.visible=!1,this._psStart._mainCtn.visible=!1)}get isSplitMode(){return this._isSplitMode}set isSubPatternMode(t){this.checkMvItems(),this._isSubPatternMode=t}get isSubPatternMode(){return this._isSplitMode}saveState(){var t,e,i,s,n,o,h,d,p;return{_x:this._x,_y:this._y,_angle:this._angle,_zoomLevel:this._zoomLevel,_isWrapMode:this._isWrapMode,_isSplitMode:this._isSplitMode,_isSubPatternMode:this._isSubPatternMode,_isEditMode:this._isEditMode,_isSelected:this._isSelected,_isDragged:this._isDragged,_shapeHasChanged:this._shapeHasChanged,_carColor:this._carColor,_hasBeenWrapped:this._hasBeenWrapped,_hasZoomChanged:this._hasZoomChanged,_collideList:Array.from(this._collideList??[]),_isCollided:this._isCollided,originalPaths:((t=this.originalPaths)==null?void 0:t.map(m=>m))??[],normalizedPaths:((e=this.normalizedPaths)==null?void 0:e.map(m=>m))??[],workingPaths:((i=this.workingPaths)==null?void 0:i.map(m=>m))??[],originalPosition:(s=this.originalPosition)==null?void 0:s.clone(),originalShift:(n=this.originalShift)==null?void 0:n.clone(),center:(o=this.center)==null?void 0:o.clone(),outwardedPath:this.outwardedPath,outwardedPaper:(h=this.outwardedPaper)==null?void 0:h.clone(),_mainPathPaper:(d=this._mainPathPaper)==null?void 0:d.clone(),_mainNormalizedPaper:(p=this._mainNormalizedPaper)==null?void 0:p.clone(),dragStartPosition:JSON.parse(JSON.stringify(this.dragStartPosition??{x:0,y:0})),_editPointIndex:this._editPointIndex,_editPointIndexPosition:this._editPointIndexPosition}}restoreState(t){this.rawX=t._x,this.rawY=t._y,this.angle=t._angle}get isCollided(){return this._isCollided}sealOriginalPath(){!this.originalPaper&&(this.originalPaper=this.workingPapers[0].clone(),this.originalPaperRot0=this.workingPapers[0].clone(),this.originalPaperRot0.rotate(-this.angle,this.originalPaperRot0.bounds.center))}addCollideItem(t){this._collideList.add(t.guid),this.isCollided=!0}removeCollideItem(t){this._collideList.delete(t.guid),this._collideList.size>0?this.isCollided=!0:this.isCollided=!1}set isCollided(t){this._isCollided=t,this.overLapShape.visible=t}getMainPaths(){return this.workingPaths}getMainPapers(){return this.workingPapers}get isSelected(){return this._isSelected}set isSelected(t){this._isSelected=t,this.selectedShape.visible=t}get mainPathPaper(){return this.workingPapers[0]}set mainPathPaper(t){this._mainPathPaper=t}get isDragged(){return this._isDragged}set isDragged(t){this._isDragged=t,this._startDragPosition={x:this.x,y:this.y},document.body.style.cursor=t?"grabbing":"default",this._mainCtn.alpha=t?.5:1}get x(){return this._x*this.zoomLevel}set x(t){this._x=t/this.zoomLevel,this._mainCtn&&(this._mainCtn.x=t)}get y(){return this._y*this.zoomLevel}set y(t){this._y=t/this.zoomLevel,this._mainCtn&&(this._mainCtn.y=t)}get mainPath(){return this.workingPaths[0]}set mainPath(t){this.workingPaths[0]=t}get angle(){return this._angle}get rawX(){return this._x}set rawX(t){this._x=t,this._mainCtn&&(this._mainCtn.x=t*this.zoomLevel)}get rawY(){return this._y}set rawY(t){this._y=t,this._mainCtn&&(this._mainCtn.y=t*this.zoomLevel)}set angle(t){var e;if(this.hasBeenOutwarded){Qe("Cannot Rotate","Outwarded shape cannot be rotated");return}this._angle=t,this.applyChanges(),(e=this._boardSurface)!=null&&e._spMainCtn&&this.reloadUI(this._boardSurface._spMainCtn)}dragEnd(){this.wasDragEnded=!0,console.log("Drag End",this._editPointIndex,this._editPointIndexPosition);const t=this._editPointIndex>-1?this._editPathItem.mainPathPaper.bounds.center:this.mainPathPaper.bounds.center;if(this._editPointIndex>-1){const e=this._editPointIndex,i=this._editPointIndexPosition;let s=this._editPathItem.mainPathPaper;i===1?(s.curves[e].point1.x=this._editPathItem.rawVal(this.x)-this._editPathItem.rawX,s.curves[e].point1.y=this._editPathItem.rawVal(this.y)-this._editPathItem.rawY):i===2?(s.curves[e].handle1.x=this._editPathItem.rawVal(this.x)-this._editPathItem.rawX-s.curves[e].values[0],s.curves[e].handle1.y=this._editPathItem.rawVal(this.y)-this._editPathItem.rawY-s.curves[e].values[1]):(s.curves[e].handle2.x=this._editPathItem.rawVal(this.x)-this._editPathItem.rawX-s.curves[e].values[6],s.curves[e].handle2.y=this._editPathItem.rawVal(this.y)-this._editPathItem.rawY-s.curves[e].values[7]),s.rotate(-this._editPathItem.angle,t),this._editPathItem.normalizedPaths[0]=s.pathData,this._editPathItem.updateChanges(),this._editPathItem.reloadUI(this._boardSurface._spMainCtn),this.reloadUI(this._boardSurface._spMainCtn)}else this._shapeHasChanged=!0}updateEditMode(){}_addPositionPoint(t,e,i){const s=this.mainPathPaper.curves[e].point1,n=new gs({paths:[i]});n._type="CIRCLE",n.normalize(),n.zoomLevel=3,n.isZoomLocked=!0,n._editPointIndex=e,n._editPointIndexPosition=1,this._boardSurface.addItem(n),n._editPathItem=this,n.reloadUI(this._boardSurface._spMainCtn),this._editPoints.push(n),n.x=this.zVal(s.x+this.rawX),n.y=this.zVal(s.y+this.rawY)}_addControlPoint(t,e,i,s){const n=t[e][s===2?"control1":"control2"],o=new gs({paths:[i]});o._type="CIRCLE",o.normalize(),o.zoomLevel=3,o.isZoomLocked=!0,o._editPointIndex=e,o._editPointIndexPosition=s,this._boardSurface.addItem(o),o._editPathItem=this,o.reloadUI(this._boardSurface._spMainCtn),this._editPoints.push(o),o.x=this.zVal(n.x+this.rawX),o.y=this.zVal(n.y+this.rawY)}checkMvItems(){const t=new ii.Path.Circle(new ii.Point(0,0),3).pathData;if(!this._psStart){const e=new gs({paths:[t]});e._type="CIRCLE",e.zoomLevel=5,e.isZoomLocked=!0,e._editPointIndex=-1,e._editPointIndexPosition=-1,e._editPathItem=this,e.allowDragNDrop=!1,e.allowSelection=!1,this._psStart=e,this._boardSurface.addItem(e),this._psStart.reloadUI(this._boardSurface._spMainCtn)}if(!this._psEnd){const e=new gs({paths:[t]});e._type="CIRCLE",e.zoomLevel=this.zoomLevel,e._editPointIndex=-1,e._editPointIndexPosition=-1,e._editPathItem=this,e.allowDragNDrop=!1,e.allowSelection=!1,this._psEnd=e,this._boardSurface.addItem(e),this._psEnd.reloadUI(this._boardSurface._spMainCtn)}}setEditMode(t){if(t!==this._isEditMode&&t===!0&&(this.backupAngle=this.angle),this._isEditMode=t,t){this.sealOriginalPath(),this._shapeHasChanged=!0,this.angle=0,this._editPoints.forEach(n=>n.disposeUI()),this._editPoints=[];const e=this.getCurveDefinition(this.workingPaths[0]);console.log("Working Points",e);const i=new ii.Path.Circle(new ii.Point(0,0),1.5).pathData,s=new ii.Path.Circle(new ii.Point(0,0),1.5).pathData;e.forEach((n,o)=>{this._addPositionPoint(e,o,s)}),e.forEach((n,o)=>{this._addControlPoint(e,o,i,2),this._addControlPoint(e,o,i,3)}),this.checkMvItems(),this.reloadUI(this._boardSurface._spMainCtn);return}else this.backupAngle!==this._angle&&(this.angle=this.backupAngle),this._editPoints.forEach(e=>e.disposeUI()),this._editPoints=[],this._psStart._mainCtn.visible=!1,this._psEnd._mainCtn.visible=!1,this.reNormalize(),this.updateChanges()}applyChanges(t=!1){this.updateChanges(t)}getCurvedPath(t){const e=new ii.Path(Fl.from(t).round(3).toString());return e.clockwise=!0,`M${e.curves[0].values[0]} ${e.curves[0].values[1]}`+e.curves.map(i=>i.values).map(i=>`C${i[2]} ${i[3]} ${i[4]} ${i[5]} ${i[6]} ${i[7]}`).join("")}getPolygonDefinition(t,e=!0){const i=new ii.Path(t),s=[];return i.curves.forEach(n=>{s.push(n.getPointAtTime(0)),e&&s.push(n.getPointAtTime(.5)),s.push(n.getPointAtTime(1))}),s.push(i.lastSegment.point),s}getConvexHull(){return yg(this.getPolygonDefinition(this.normalizedPaths[0]).map(t=>[t.x,t.y]),1/0).map(t=>({x:t[0],y:t[1]}))}getWorkingConvexHull(){return yg(this.getPolygonDefinition(this.workingPaths[0]).map(t=>[t.x,t.y]),1/0).map(t=>({x:t[0],y:t[1]}))}getCurveDefinition(t){const e=new ii.Path(Fl.from(t).round(3).toString());return e.clockwise=!0,e.curves.map(i=>i.values).map(i=>({start:{x:i[0],y:i[1]},end:{x:i[6],y:i[7]},control1:{x:i[2],y:i[3]},control2:{x:i[4],y:i[5]}}))}getCurveFromPaper(t){const e=t;return e.clockwise=!0,e.curves.map(i=>i.values).map(i=>({start:{x:i[0],y:i[1]},end:{x:i[6],y:i[7]},control1:{x:i[2],y:i[3]},control2:{x:i[4],y:i[5]}}))}reNormalize(){this._isEditMode&&(this.normalizedPaths=this.normalizedPaths.map((t,e)=>{const i=new ii.Path(t);if(i.clockwise=!0,e===0){const n=i.bounds.center;this.originalShift=new ii.Point(-n.x,-n.y),this.originalPosition=new ii.Point(n.x,n.y),i.translate(this.originalShift)}return i.pathData}))}normalize(){const t=this.widthInMm/this.widthInVu,e=this.heightInMm/this.heightInVu,i=t!==1||e!==1;i&&(this.widthInVu=this.widthInMm,this.heightInVu=this.heightInMm),this.normalizedPaths=this.originalPaths.map((s,n)=>{const o=new ii.Path(s);if(o.clockwise=!0,i&&o.scale(t,e),n===0){const d=o.bounds.center;this.originalShift=new ii.Point(-d.x,-d.y),this.originalPosition=new ii.Point(d.x,d.y)}return o.translate(this.originalShift),o.pathData}),this.updateChanges()}updateChanges(t=!1){let e=null;this.workingPapers=this.normalizedPaths.map((i,s)=>{var o;s===0&&(e=new ii.Path(i));const n=new ii.Path(i);return n.clockwise=!0,this.angle!==0&&(!t&&n.rotate(this.angle,e.bounds.center),s===0&&this.originalPaper&&(this.originalPaper=this.originalPaperRot0.clone(),(o=this.originalPaper)==null||o.rotate(this.angle,e.bounds.center))),n}),this.workingPaths=this.workingPapers.map(i=>i.pathData),this.mainPathPaper=this.workingPapers[0]}disposeUI(){var t,e,i,s,n,o,h;(e=(t=this._boardSurface)==null?void 0:t._spMainCtn)==null||e.removeChild(this._mainCtn),(i=this._boardSurface)==null||i.removeItem(this),(n=(s=this._boardSurface)==null?void 0:s._spMainCtn)==null||n.removeChild(this._psLine),this.overLapShape&&((h=(o=this._boardSurface)==null?void 0:o._spMainCtn)==null||h.removeChild(this.overLapShape)),this.overLapShape.destroy(),this.overLapShape=null}reloadUI(t){this.disposed?(this._mainCtn=new Ui,t.addChild(this._mainCtn),this._mainGraphics=new Ri,this._mainCtn.addChild(this._mainGraphics),this.disposed=!1,this.selectedShape=new Ri,this._mainCtn.addChild(this.selectedShape)):this._mainGraphics.clear(),this._drawItem(),this._drawSelected(),this._drawOverLap(),this._hasZoomChanged&&(this._hasZoomChanged=!1,this._isEditMode&&this.setEditMode(this._isEditMode))}_drawItem(){this._mainGraphics.clear();let t=this._carColor>-1?this._carColor:0,e=0,i=.2,s=.5;if(this._editPointIndexPosition===1?(t=0,e=0,i=.8,s=1):(this._editPointIndexPosition===2||this._editPointIndexPosition===3)&&(t=609898,e=609898),this.getMainPapers().forEach((n,o)=>{const h=this.getCurveFromPaper(o===0&&this.outwardedPath&&!this.outwardDoubleCut?this.outwardedPaper:n);this._mainGraphics.moveTo(this.zVal(h[0].start.x),this.zVal(h[0].start.y)),this._mainGraphics.beginFill(t,i),this._mainGraphics.lineStyle(1,e,s),h.forEach((d,p)=>{this.cubicBezierCurveTo(this._mainGraphics,d)}),this._mainGraphics.closePath(),this._mainGraphics.endFill()}),this.outwardedPath&&this.outwardDoubleCut){const n=this.getCurveFromPaper(this.outwardedPaper);this._mainGraphics.moveTo(this.zVal(n[0].start.x),this.zVal(n[0].start.y)),this._mainGraphics.beginFill(t,i),this._mainGraphics.lineStyle(1,e,s),n.forEach((o,h)=>{this.cubicBezierCurveTo(this._mainGraphics,o)}),this._mainGraphics.closePath(),this._mainGraphics.endFill()}if(this._editPointIndexPosition===1&&this.wasDragEnded){const n=this._editPathItem._editPoints.filter(h=>h._editPointIndex===this._editPointIndex&&h._editPointIndexPosition===2)[0];if(!n)return;n.dragEnd();let o=this._editPathItem._editPoints.filter(h=>h._editPointIndex===this._editPointIndex-1&&h._editPointIndexPosition===3)[0];o||(o=this._editPathItem._editPoints.filter(h=>h._editPointIndex===this._editPathItem._editPoints.length-1&&h._editPointIndexPosition===3)[0]),o.dragEnd()}if(this._editPointIndexPosition===2){const n=this._editPathItem._editPoints.filter(o=>o._editPointIndex===this._editPointIndex&&o._editPointIndexPosition===1)[0];if(!n)return;this._mainGraphics.beginFill(609898,s),this._mainGraphics.lineStyle(1,609898,s),this._mainGraphics.moveTo(0,0),this._mainGraphics.lineTo(n.x-this.x,n.y-this.y),this.wasDragEnded||(this.wasDragEnded=!0,setTimeout(()=>{this.reloadUI(this._boardSurface._spMainCtn)},100))}if(this._editPointIndexPosition===3){let n=this._editPathItem._editPoints.filter(o=>o._editPointIndex===this._editPointIndex+1&&o._editPointIndexPosition===1)[0];n||(n=this._editPathItem._editPoints.filter(o=>o._editPointIndex===0&&o._editPointIndexPosition===1)[0]),this._mainGraphics.beginFill(609898,s),this._mainGraphics.lineStyle(1,609898,s),this._mainGraphics.moveTo(0,0),this._mainGraphics.lineTo(n.x-this.x,n.y-this.y),this.wasDragEnded||(this.wasDragEnded=!0,setTimeout(()=>{this.reloadUI(this._boardSurface._spMainCtn)},100))}}_drawSelected(){console.log("Draw Selected",this._isSelected),this.selectedShape||(this.selectedShape=new Ri,this._mainCtn.addChild(this.selectedShape));let t=ug,e=ug,i=VC,s=HC;this.selectedShape.clear();const n=this.getCurveFromPaper(this.workingPapers[0]);this.selectedShape.moveTo(this.zVal(n[0].start.x),this.zVal(n[0].start.y)),this.selectedShape.beginFill(t,i),this.selectedShape.lineStyle(1,e,s),n.forEach(o=>{this.cubicBezierCurveTo(this.selectedShape,o)}),this.selectedShape.closePath(),this.selectedShape.endFill(),this.selectedShape.visible=this._isSelected}_drawOverLap(){console.log("Draw Overlap",this.isCollided,this.guid),this.overLapShape||(this.overLapShape=new Ri,this._mainCtn.addChild(this.overLapShape));let t=cg,e=cg,i=WC,s=XC;this.overLapShape.clear();const n=this.getCurveFromPaper(this.workingPapers[0]);this.overLapShape.moveTo(this.zVal(n[0].start.x),this.zVal(n[0].start.y)),this.overLapShape.beginFill(t,i),this.overLapShape.lineStyle(1,e,s),n.forEach(o=>{this.cubicBezierCurveTo(this.overLapShape,o)}),this.overLapShape.closePath(),this.overLapShape.endFill(),this.overLapShape.visible=this.isCollided}_reloadUI(t){console.log("Reload UI",this),this.disposed?(this._mainCtn=new Ui,t.addChild(this._mainCtn),this._mainGraphics=new Ri,this._mainCtn.addChild(this._mainGraphics),this.disposed=!1):this._mainGraphics.clear();let e=this._isSelected?609898:0,i=this._isSelected?609898:0,s=.2,n=.5;this._editPointIndexPosition===1&&(e=0,i=0,s=.8,n=1),this._editPointIndexPosition===2&&(e=609898,i=609898),this._editPointIndexPosition===3&&(e=609898,i=609898),this._mainGraphics.beginFill(e,s),this._mainGraphics.lineStyle(1,i,n);const o=this.getCurveDefinition(this.mainPath);this.mainPathPaper=new ii.Path(this.mainPath),this._editPointIndex>-1?this._mainGraphics.moveTo(o[0].start.x,o[0].start.y):this._mainGraphics.moveTo(this.zVal(o[0].start.x),this.zVal(o[0].start.y)),o.forEach(P=>{this.cubicBezierCurveTo(this._mainGraphics,P)});for(let P=1;P<this.workingPaths.length;P++){const M=new ii.Path(this.workingPaths[P]);M.rotate(this.angle,M.bounds.center),M.clockwise=!0;const z=this.getCurveDefinition(M.pathData);this._editPointIndex>-1?this._mainGraphics.moveTo(z[0].start.x,z[0].start.y):this._mainGraphics.moveTo(this.zVal(z[0].start.x),this.zVal(z[0].start.y)),z.forEach(q=>{this.cubicBezierCurveTo(this._mainGraphics,q)})}if(this._editPointIndexPosition===2){const P=this._editPathItem.getCurveDefinition(this._editPathItem.mainPath);console.log("Rdraw CP1"),this._mainGraphics.beginFill(609898,n),this._mainGraphics.lineStyle(1,609898,n),this._mainGraphics.moveTo(0,0),this._mainGraphics.lineTo(this.zVal(P[this._editPointIndex].start.x)-this.x+this._editPathItem.x,this.zVal(P[this._editPointIndex].start.y)-this.y+this._editPathItem.y),this._mainGraphics.endFill()}else if(this._editPointIndexPosition===3)try{const P=this._editPathItem.getCurveDefinition(this._editPathItem.mainPath);this._mainGraphics.beginFill(609898,n),this._mainGraphics.lineStyle(1,[609898,609898][Math.random()],1),this._mainGraphics.moveTo(0,0),this._mainGraphics.lineTo(this.zVal(P[this._editPointIndex].end.x)-this.x+this._editPathItem.x,this.zVal(P[this._editPointIndex].end.y)-this.y+this._editPathItem.y),this._mainGraphics.endFill(),this._mainGraphics.beginFill(609898,n),console.log("Rdraw CP2")}catch(P){console.log("Error",P)}else this._mainGraphics.endFill();const h=new Ri;h.name="polygon";const d=Math.min(...this.polygon.map(P=>P.x)),p=Math.max(...this.polygon.map(P=>P.x)),m=Math.min(...this.polygon.map(P=>P.y)),v=Math.max(...this.polygon.map(P=>P.y)),b=new Ri;b.beginFill(16711680,.2),b.lineStyle(1,16711680,.5),b.drawRect(this.zVal(d),this.zVal(m),this.zVal(p-d),this.zVal(v-m)),b.endFill();const y=new Ri;y.beginFill(255,.2),y.lineStyle(1,255,.5),y.drawCircle(this.zVal((d+p)/2),this.zVal((m+v)/2),5),y.endFill(),this._mainCtn.x=this.x,this._mainCtn.y=this.y,this.applyChanges()}removeSubPatterns(){this.workingPapers=this.workingPapers.slice(0,1),this.workingPaths=this.workingPaths.slice(0,1),this.normalizedPaths=this.normalizedPaths.slice(0,1),this.originalPaths=this.originalPaths.slice(0,1),this.reloadUI(this._boardSurface._spMainCtn)}zVal(t){return t*this.zoomLevel}rawVal(t){return t/this.zoomLevel}cubicBezierCurveTo(t,e){t.bezierCurveTo(this.zVal(e.control1.x),this.zVal(e.control1.y),this.zVal(e.control2.x),this.zVal(e.control2.y),this.zVal(e.end.x),this.zVal(e.end.y))}}class XE{constructor(){tt(this,"boards",[]);tt(this,"currentBoardIndex",0);tt(this,"app",null);tt(this,"evtZoomIn",null);tt(this,"evtZoomOut",null)}createBoard(){if(console.log("Creating board",this.boards.length),this.boards.length>=5)return;const t=new jE;return t.boardId="",t.boardName="Untitled Board "+this.boards.length+1,t.items=[],t.displayItems=[],this.boards.push(t),this.currentBoardIndex=this.boards.length-1,t.newBoard={boardIndex:0,boardName:t.boardName,carLegend:new Map,mvs:[],zoomLevel:.2,undoStack:[],undoIdx:0,hasbeenCentered:!1},t}setSelectedBoardName(t){this.boards[this.currentBoardIndex].boardName=t}get selectedBoard(){return this.boards[this.currentBoardIndex]}setSelectedBoard(t){t<0||t>=this.boards.length||(this.currentBoardIndex=t)}async updateSelectedBoard(){}async displaySelectedBoard(){if(this.boards.length===0)return;Ie("cutBoard").reloadBoard()}async _displaySelectedBoard(){var z,q,V;if(console.log("FORBIDDEN",this.selectedBoard),this.boards.length===0)return;_e.zoomFactor=this.selectedBoard.zoomfactor;const t=await Ea("#cut-board-workspace");t.querySelectorAll("canvas").forEach(I=>I.remove());const e=document.createElement("canvas");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.id="cut-board-canvas";const i=e;t.appendChild(e),this.app&&this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),this.app=new bh({background:"#ffffff",antialias:!0,autoDensity:!0,view:e}),this.app.resizeTo=e.parentElement,this.selectedBoard.mainCtn=new Ui,this.app.stage.addChild(this.selectedBoard.mainCtn),_e.zoomFactor=.2;const s=new Ri;s.beginFill(0),s.drawCircle(0,0,3.5),s.endFill(),s.x=0,s.y=0,this.selectedBoard.items.forEach(I=>{const Y=I.rawVectors.map(at=>at.asString()),K=new gs({paths:Y});console.log("mvItm.mainPath",K.mainPath);const T=new Yc(new Ws(K.mainPath));this.selectedBoard.mainCtn.addChild(T.getContainer()),T.rebuild(),T.render()}),(z=this.selectedBoard.mainCtn)==null||z.addChild(s),this.selectedBoard.boardSprite=new Ri,this.selectedBoard.boardSprite.lineStyle(3,0),this.selectedBoard.boardSprite.beginFill(16777215),this.selectedBoard.boardSprite.drawRect(0,0,5e3*_e.zoomFactor,1600*_e.zoomFactor),this.selectedBoard.boardSprite.endFill(),this.selectedBoard.boardSprite.pivot.x=this.selectedBoard.boardSprite.width/2,this.selectedBoard.boardSprite.pivot.y=this.selectedBoard.boardSprite.height/2,this.selectedBoard.boardSprite.x=this.app.screen.width/2*_e.zoomFactor,this.selectedBoard.boardSprite.y=this.app.screen.height/2*_e.zoomFactor,this.selectedBoard.displayItems=this.selectedBoard.items.map(I=>{const Y=new Yc(I.merged);return Y.rebuild(),Y.render(),Y.getContainer().interactive=!0,Y._x=I.merged.x,Y._y=I.merged.y,Y.getContainer().x=Y._x*_e.zoomFactor,Y.getContainer().y=Y._y*_e.zoomFactor,Y.getContainer().angle=I.merged.rotation,Y}),this.selectedBoard.displayItems.forEach(I=>{I.getContainer().interactive=!0,I.rebuild(),I.render(),I.getContainer().onclick=Y=>{I.isSelected=!I.isSelected},I.getContainer().x=I._x*_e.zoomFactor,I.getContainer().y=I._y*_e.zoomFactor});let n=0,o=0;this.app.stage.interactive=!0,this.app.stage.eventMode="static";const h=()=>this.selectedBoard.displayItems.find(I=>I._isHovered);let d=!1,p=!1;i.addEventListener("mouseup",I=>{console.log("mouse up",I.button),I.button===0?p=!1:I.button===2&&(d=!1),P&&(P=null)});let m=0,v=0,b=0,y=0,P=null;i.addEventListener("mousedown",I=>{const Y=i.getBoundingClientRect(),K=I.clientX-Y.left,T=I.clientY-Y.top;console.log("mouse down",I.button),I.button===0?(p=!0,b=K,y=T,P=h(),this.selectedBoard.displayItems.forEach(at=>{at!==P&&(at.isSelected=!1)})):I.button===2&&(d=!0,m=K,v=T),i.addEventListener("mousemove",at=>{var It,bt,dt,ht,Mt;const ct=i.getBoundingClientRect(),pt=at.clientX-ct.left,wt=at.clientY-ct.top;if(d){const _t=pt-m,Rt=wt-v;m=pt,v=wt,(dt=this.selectedBoard.mainCtn)==null||dt.position.set(((It=this.selectedBoard.mainCtn)==null?void 0:It.position.x)+_t,((bt=this.selectedBoard.mainCtn)==null?void 0:bt.position.y)+Rt),this.selectedBoard.mainCtnPos.x=(ht=this.selectedBoard.mainCtn)==null?void 0:ht.position.x,this.selectedBoard.mainCtnPos.y=(Mt=this.selectedBoard.mainCtn)==null?void 0:Mt.position.y}if(p){const _t=pt-b,Rt=wt-y;b=pt,y=wt;const kt=P;kt&&(kt.getContainer().x+=_t,kt.getContainer().y+=Rt,kt._x=kt.getContainer().x/_e.zoomFactor,kt._y=kt.getContainer().y/_e.zoomFactor,kt.rawVector.x=kt._x,kt.rawVector.y=kt._y,console.log("item gl",kt.getContainer().x,kt.getContainer().y),console.log("item vec",kt._x,kt._y))}})}),i.addEventListener("wheel",I=>{const Y=I.deltaY>0;console.log("zoom",Y),Lt.emit(Y?je.cutBoard.zoomIn:je.cutBoard.zoomOut)}),(q=this.evtZoomIn)==null||q.off(),(V=this.evtZoomOut)==null||V.off(),this.evtZoomIn=Lt.on(je.cutBoard.zoomIn,()=>{console.log("zoom in");const I=_e.zoomFactor;_e.zoomFactor+=.02,this.selectedBoard.zoomfactor=_e.zoomFactor,this.selectedBoard.displayItems.forEach(K=>{K.getContainer().x=K._x*_e.zoomFactor,K.getContainer().y=K._y*_e.zoomFactor,console.log("item",K.getContainer().x,K.getContainer().y),console.log("item",K._x,K._y)}),M();const Y={x:(n-this.selectedBoard.mainCtn.x)/I,y:(o-this.selectedBoard.mainCtn.y)/I};this.selectedBoard.mainCtn.x=n-Y.x*_e.zoomFactor,this.selectedBoard.mainCtn.y=o-Y.y*_e.zoomFactor}),this.evtZoomOut=Lt.on(je.cutBoard.zoomOut,()=>{console.log("zoom out");const I=_e.zoomFactor;_e.zoomFactor-=.02,this.selectedBoard.zoomfactor=_e.zoomFactor,this.selectedBoard.boardSprite.x/=1.02,this.selectedBoard.displayItems.forEach(K=>{K.getContainer().x=K._x*_e.zoomFactor,K.getContainer().y=K._y*_e.zoomFactor,console.log("item",K.getContainer().x,K.getContainer().y),console.log("item",K._x,K._y)}),M();const Y={x:(n-this.selectedBoard.mainCtn.x)/I,y:(o-this.selectedBoard.mainCtn.y)/I};this.selectedBoard.mainCtn.x=n-Y.x*_e.zoomFactor,this.selectedBoard.mainCtn.y=o-Y.y*_e.zoomFactor});const M=()=>{this.selectedBoard.boardSprite.clear(),this.selectedBoard.boardSprite.lineStyle(3,0),this.selectedBoard.boardSprite.beginFill(16777215),this.selectedBoard.boardSprite.drawRect(0,0,5e3*_e.zoomFactor,1600*_e.zoomFactor),this.selectedBoard.boardSprite.endFill(),this.selectedBoard.boardSprite.pivot.set(this.selectedBoard.boardSprite.width/2,this.selectedBoard.boardSprite.height/2),this.selectedBoard.boardSprite.x=0,this.selectedBoard.boardSprite.y=0,this.selectedBoard.displayItems.forEach(I=>{console.log("adding item",I),I.rebuild(),I.render(),I.getContainer().x=I._x*_e.zoomFactor,I.getContainer().y=I._y*_e.zoomFactor})};M(),this.selectedBoard.mainCtn.position.set(this.selectedBoard.mainCtnPos.x,this.selectedBoard.mainCtnPos.y)}async saveSelectedBoard(){if(this.boards[this.currentBoardIndex].boardId===""){const t=await Cd("Name your board",`My Board ${new Date().toLocaleDateString()}-${new Date().toLocaleTimeString()}`,"OK","Cancel");if(!t)return;this.boards[this.currentBoardIndex].boardName=t;const e={projectId:this.selectedBoard.projectId,boardId:this.selectedBoard.boardId,boardName:this.selectedBoard.boardName,items:this.selectedBoard.items.map(s=>s.serializeState())},i={vector_image:btoa(JSON.stringify(e)),name:t};fr.id!==""&&(i.projectId=fr.id,this.boards[this.currentBoardIndex].projectId=fr.id),this.boards[this.currentBoardIndex].boardId?(await Ce("userboard","patch",i,!0),await Qe("Updated","The board has been updated.")):(await Ce("userboard","post",i,!0),await Qe("Added","The board has been created, you can reload it from the 'Saved Boards' section"))}}}class jE{constructor(){tt(this,"projectId","");tt(this,"boardId","");tt(this,"boardName","");tt(this,"items",[]);tt(this,"displayItems",[]);tt(this,"boardSprite",null);tt(this,"mainCtn",null);tt(this,"mainCtnPos",{x:0,y:0});tt(this,"zoomfactor",.2);tt(this,"newBoard",{boardIndex:0,boardName:"",carLegend:new Map,mvs:[],zoomLevel:.2,undoStack:[],undoIdx:0,hasbeenCentered:!1})}}const we=new XE;async function $E(r,t){for(let e=0;e<r.length;e++)await t(r[e],e,r),await new Promise(i=>setTimeout(i,500))}async function YE(r,t=15){if(t<0||t>100)throw new Error("Precision should be between 0 and 100.");const e=[],i=r,s=i.length;return await $E(i,async(n,o)=>{try{qE(e,n,t,s,o,!0)}catch{}}),e}function qE(r,t,e,i,s,n=!1){let o=[];o=[];const p=new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg"><path d='${t}' /></svg>`,"image/svg+xml").querySelector("path"),m=p.getTotalLength(),v=Math.max(2,Math.ceil(e/100*m));let b=p.getPointAtLength(0);for(let y=1;y<v-1;y++)b=p.getPointAtLength(m/(v-1)*y),o.push([b.x,b.y]);b=p.getPointAtLength(m),o.push([b.x,b.y]),o.push(o[0]),r.push(o)}function ZE(r,t,e=15){console.log("Origonal path",r);const i=KE(r,e),s=i.map(d=>"M"+d.map(p=>p.join(" ")).join("L")).join("Z")+"Z";console.log("POLY",s);const n=QE(i[0].map(d=>new pi(d[0],d[1])),t,!1),o=Vm(n);o[0]=o[o.length-1];let h="Z M"+o[0].x+" "+o[0].y+" ";for(let d=1;d<o.length;d++)h+="L"+o[d].x+" "+o[d].y+" ";return h+="Z",console.log("Path finalized",h),h}function KE(r,t=15){if(t<0||t>100)throw new Error("Precision should be between 0 and 100.");const e=[],i=[r];for(const s of i)try{JE(e,s,t,0,0,!0)}catch{}return e}function QE(r,t,e=!0){const i=[],s=r.length;for(let n=0;n<s;n++){const o=r[(n-1+s)%s],h=r[n],d=r[(n+1)%s];i.push(t2(o,h,d,t,e))}return i}function Vm(r){const t=r.length;for(let e=0;e<t;e++){const i=r[e],s=r[(e+1)%t];for(let n=0;n<t;n++){const o=r[n],h=r[(n+1)%t];if(!(e===n||e===(n+1)%t||(e+1)%t===n)&&xg(i,s,o,h)!==null){const d=xg(i,s,o,h);return r.splice(e+1,n-e,d),Vm(r)}}}return r}function xg(r,t,e,i){const s=t.y-r.y,n=r.x-t.x,o=s*r.x+n*r.y,h=i.y-e.y,d=e.x-i.x,p=h*e.x+d*e.y,m=s*d-h*n;if(m===0)return null;{const v=(d*o-n*p)/m,b=(s*p-h*o)/m;if(Math.min(r.x,t.x)<=v&&v<=Math.max(r.x,t.x)&&Math.min(r.y,t.y)<=b&&b<=Math.max(r.y,t.y)&&Math.min(e.x,i.x)<=v&&v<=Math.max(e.x,i.x)&&Math.min(e.y,i.y)<=b&&b<=Math.max(e.y,i.y))return{x:v,y:b}}return null}function JE(r,t,e,i,s,n=!1){let o=[];o=[];const p=new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg"><path d='${t}' /></svg>`,"image/svg+xml").querySelector("path"),m=p.getTotalLength(),v=Math.max(2,Math.ceil(e/100*m));let b=p.getPointAtLength(0);for(let y=1;y<v-1;y++)b=p.getPointAtLength(m/(v-1)*y),o.push([b.x,b.y]);b=p.getPointAtLength(m),o.push([b.x,b.y]),o.push(o[0]),r.push(o)}function t2(r,t,e,i,s=!0){const n=e2(r,t,e,s);return{x:t.x+n.x*i,y:t.y+n.y*i}}function e2(r,t,e,i=!0){const s=i2(r,e);let n={x:-s.y,y:s.x};const o=s.x*(t.x-r.x)+s.y*(t.y-r.y);(o<0&&i||o>0&&!i)&&(n.x=-n.x,n.y=-n.y);const h=Math.sqrt(n.x**2+n.y**2);return{x:n.x/h,y:n.y/h}}function i2(r,t){return{x:t.x-r.x,y:t.y-r.y}}let ir=Ed;const We={boardWidth:0,boardHeight:0,boardMousePos:{x:0,y:0},screenMousePos:{x:0,y:0}};class r2{constructor(){tt(this,"displayMaterialUsage",!1);tt(this,"hasBeenCentered",!1);tt(this,"hasPendingCut",!1);tt(this,"globalCollisionMap",new Map);tt(this,"isGlobalCollisionRunning",!1);tt(this,"legends",new Map);tt(this,"divide1");tt(this,"divide2");tt(this,"guid","");tt(this,"canvas");tt(this,"zoomLevel",.2);tt(this,"items",[]);tt(this,"boardLimit",{width:5e3,height:1600});tt(this,"_lastNearestPoint",{x:0,y:0});tt(this,"_app");tt(this,"_appDebug");tt(this,"_spMainCtn");tt(this,"_spBoard");tt(this,"_isDragStarted",!1);tt(this,"_isDragged",!1);tt(this,"_dragStartPosition",{x:0,y:0});tt(this,"_dragBoardStartPosition",{x:0,y:0});tt(this,"_isCtrlPressed",!1);tt(this,"_unloaded",!1);tt(this,"debugEvents",[]);tt(this,"moveRotateTimerIdx",0);this.guid=ho(),this.zoomLevel=qc}get hasItemSelected(){return this.items.filter(t=>t.isSelected).length>0}setDisplayMaterialUsage(t){this.displayMaterialUsage=t,this.drawBoard()}debugUI(t=!0){var v;if((v=this._appDebug)==null||v.destroy({children:!0,texture:!0,baseTexture:!0}),!t)return;this.debugEvents.forEach(b=>b.off()),this.debugEvents.length=0,this._appDebug=new Ui,this._app.stage.addChild(this._appDebug);let e=10,i=10,s=[];this.canvas.parentElement.getBoundingClientRect();const n=As(ve.boardLenght,"inches"),o=As(ve.boardWidth,"inches"),h=new $i(`Board Size: ${n[0]} ${n[1]==="Metric"?"mm":"in"} x ${o[0]} ${n[1]==="Metric"?"mm":"in"}`,{fontSize:15,fill:0});h.position.set(e,i),this._appDebug.addChild(h),i+=20;const d=new $i("Mouse Position: 0, 0",{fontSize:12,fill:0});d.position.set(e,i),i+=20;const p=new $i("Mouse Position (Main): 0, 0",{fontSize:12,fill:0});p.position.set(e,i),i+=20;let m={};this.debugEvents.push(Lt.on(Kt.BoardSurface.onUndo,()=>{if(this._unloaded)return;we.selectedBoard.newBoard.undoIdx=Math.max(0,we.selectedBoard.newBoard.undoIdx-1);const b=we.selectedBoard.newBoard.undoStack[we.selectedBoard.newBoard.undoIdx];b[0].restoreState(b[1])})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onRedo,()=>{if(this._unloaded)return;we.selectedBoard.newBoard.undoIdx=Math.min(we.selectedBoard.newBoard.undoStack.length-1,we.selectedBoard.newBoard.undoIdx+1);const b=we.selectedBoard.newBoard.undoStack[we.selectedBoard.newBoard.undoIdx];b[0].restoreState(b[1])})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onReloadConfig,()=>{this.drawBoard(),console.log("Reload Config",this.guid)})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onToggleMaterialusage,()=>{this._unloaded||(console.log("Display Material Usage",this.displayMaterialUsage,this.guid),this.setDisplayMaterialUsage(!this.displayMaterialUsage),console.log("Display Material Usage",this.displayMaterialUsage))})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onResize,()=>{this._unloaded||(h.text=`Screen Size: ${We.boardWidth} x ${We.boardHeight}`)})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onRotate,(b=!1)=>{clearTimeout(this.moveRotateTimerIdx),this.moveRotateTimerIdx=setTimeout(()=>{this.debugUI(!0),console.log("Rotate",b)},16)})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onMove,(b=!1)=>{clearTimeout(this.moveRotateTimerIdx),this.moveRotateTimerIdx=setTimeout(()=>{this.displayMaterialUsage&&(Lt.emit(Kt.BoardSurface.onToggleMaterialusage,null),Lt.emit(Kt.BoardSurface.onToggleMaterialusage,null))},16)})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onNesting,b=>{if(this._unloaded)return;const y=[];Yi.sessionCreation.do(),Yi.setBin.do({width:ve.boardLenght,height:ve.boardWidth}),m={},this.items.filter(P=>P._type==="ITEM").forEach((P,M)=>{Yi.addPart.do({idx:M,item:P}),m[M]=P}),Yi.start.do(),y.push(Yi.progress.waitFor(P=>{Lt.emit(Kt.BoardSurface.onNestingProgress,[P.progress*100>>0,P.generation])})),y.push(Yi.packingResult.waitFor(P=>{if(s.push(P),P.placements.forEach(M=>{m[M.part].rawX=M.position.x,m[M.part].rawY=M.position.y,m[M.part].angle=M.rotation*180/Math.PI}),P.unplaced.forEach(M=>{m[M.id].rawX=0,m[M.id].rawY=0,m[M.id].angle=0}),P.isLast){s.sort((q,V)=>V.placed.length-q.placed.length);const M=s[0].placed.length;s=s.filter(q=>q.placed.length===M),s.sort((q,V)=>{const I=Math.max(...q.placed.map(K=>Math.max(...K.points.map(T=>T.x)))),Y=Math.max(...V.placed.map(K=>Math.max(...K.points.map(T=>T.x))));return I-Y});const z=s[0];z.placements.forEach(q=>{m[q.part].rawX=q.position.x,m[q.part].rawY=q.position.y,m[q.part].angle=q.rotation*180/Math.PI}),z.unplaced.forEach(q=>{m[q.id].rawX=0,m[q.id].rawY=0,m[q.id].angle=0}),y.forEach(q=>q.off()),Lt.emit(Kt.BoardSurface.onNestingResult,z),Lt.emit(Kt.BoardSurface.onNestingComplete)}}))})),this.debugEvents.push(Lt.on(Kt.Item.onCheckCollisions,b=>{if(this._unloaded)return;if(!b){if(this.items.filter(M=>M._type==="ITEM").length<2){Lt.emit(Kt.BoardSurface.onGlobalCollisionComplete,!1);return}this.globalCollisionMap=new Map,this.isGlobalCollisionRunning=!0,this.items.forEach(M=>{M._type==="ITEM"&&this.globalCollisionMap.set(M.guid,{done:!1,collide:!1})}),this.items.forEach(M=>{M._type==="ITEM"&&Lt.emit(Kt.Item.onCheckCollisions,M)});return}let y=!1;if(this.items.filter(P=>P._type==="ITEM").filter(P=>P._editPointIndexPosition===-1).forEach(P=>{if(b.guid===P.guid)return;const M=b.mainPathPaper.clone();M.translate({x:b.rawX,y:b.rawY});const z=P.mainPathPaper.clone();z.translate({x:P.rawX,y:P.rawY}),M.intersects(z)?(b.addCollideItem(P),P.addCollideItem(b),y=!0):(b.removeCollideItem(P),P.removeCollideItem(b))}),this.isGlobalCollisionRunning){if(y?(console.log("Collision detected",b.guid),this.globalCollisionMap.set(b.guid,{done:!0,collide:!0})):this.globalCollisionMap.set(b.guid,{done:!0,collide:!1}),Array.from(this.globalCollisionMap.values()).filter(P=>P.done).length===this.globalCollisionMap.size){this.isGlobalCollisionRunning=!1;let P=Array.from(this.globalCollisionMap.values()).filter(z=>z.collide).length>0;console.log("Global Collision Complete",this.globalCollisionMap.entries());const M=this.globalCollisionMap.entries();this.items.forEach(z=>{const q=Array.from(M).filter(V=>V[0]===z.guid)[0];q&&q[1].collide===!0&&(console.log("Collided display",z.guid),z._isCollided=!0,z.reloadUI(this._spMainCtn))}),Lt.emit(Kt.BoardSurface.onGlobalCollisionComplete,P)}this.globalCollisionMap.forEach((P,M)=>{P.collide&&this.items.filter(z=>z.guid===M)[0].reloadUI(this._spMainCtn)})}})),this.debugEvents.push(Lt.on(Kt.BoardSurface.onMove,b=>{this._unloaded||(d.text=`Mouse screen Position: ${We.screenMousePos.x}, ${We.screenMousePos.y}`,p.text=`Mouse board position: ${We.boardMousePos.x}, ${We.boardMousePos.y}`)}))}drawLegends(){let t=0,e=-20;const i=[];this._spBoard.children.forEach(s=>{var n;(n=s.name)!=null&&n.includes("legend")&&i.push(s)}),i.forEach(s=>{this._spBoard.removeChild(s)}),this.legends.forEach((s,n)=>{let o=this._spBoard.getChildByName(`legend-${n}`);o||(o=new $i(`${s}`,{fontSize:12,fill:n})),o=new $i(`${s}`,{fontSize:12,fill:n}),o.alpha=.5,o.position.set(t,e),this._spBoard.addChild(o),o.name=`legend-${n}`,e-=20})}getMaterialUsage(){const t=ve.boardLenght*this.zoomLevel,e=ve.boardWidth*this.zoomLevel,i=t>e,s=[];if(this.items.forEach(n=>{const o=n.getWorkingConvexHull().map(b=>new ir.Point(b.x,b.y)),h=Math.min(...o.map(b=>b.x)),d=Math.min(...o.map(b=>b.y)),p=Math.max(...o.map(b=>b.x)),m=Math.max(...o.map(b=>b.y)),v={x:h+n.rawX,y:d+n.rawY,width:p-h,height:m-d};v.x+v.width>t,v.y+v.height>e,s.push(v)}),i){const o=Math.max(...s.map(m=>m.x+m.width))*ve.boardWidth/1e6,h=o.toFixed(2),d=ve.boardLenght*ve.boardWidth/1e6;Number(d.toFixed(2));const p=o/d*100;return[Number(h),p]}else{const n=Math.max(...s.map(m=>m.y+m.height)),o=ve.boardLenght*n/1e6,h=o.toFixed(2),d=ve.boardLenght*ve.boardWidth/1e6;Number(d.toFixed(2));const p=o/d*100;return[Number(h),p]}}centerBoard(){let t=ve.boardLenght*this.zoomLevel,e=ve.boardWidth*this.zoomLevel;const i=this.canvas.parentElement.getBoundingClientRect();let s=t>e,n=i.width>i.height;s?n?t>i.width&&(this.zoomLevel=i.width/t*this.zoomLevel):e>i.height&&(this.zoomLevel=i.height/e*this.zoomLevel):n?e>i.height&&(this.zoomLevel=i.height/e*this.zoomLevel):t>i.width&&(this.zoomLevel=i.width/t*this.zoomLevel);let o=(i.width-t)/2,h=(i.height-e)/2;return this._spMainCtn.position.set(o,h),{x:o,y:h}}drawBoard(){this._spBoard||(this._spBoard=new Ri,this._spMainCtn.addChild(this._spBoard));const t=ve.boardLenght*this.zoomLevel,e=ve.boardWidth*this.zoomLevel,i=t>e;if(this._spBoard.clear(),this._spBoard.lineStyle(3,0,1),this._spBoard.beginFill(0,0),this._spBoard.drawRect(0,0,t,e),this._spBoard.endFill(),this.displayMaterialUsage){const m=[];this.items.forEach(b=>{const y=b.getWorkingConvexHull().map(I=>new ir.Point(I.x,I.y)),P=Math.min(...y.map(I=>I.x)),M=Math.min(...y.map(I=>I.y)),z=Math.max(...y.map(I=>I.x)),q=Math.max(...y.map(I=>I.y)),V={x:P+b.rawX,y:M+b.rawY,width:z-P,height:q-M};V.x+V.width>t,V.y+V.height>e,m.push(V)});const v=[];if(this._spBoard.children.forEach(b=>{var y;(y=b.name)!=null&&y.includes("txt-board-size")&&v.push(b)}),v.forEach(b=>{this._spBoard.removeChild(b)}),i){const b=Math.max(...m.map(K=>K.x+K.width));this._spBoard.lineStyle(2,0,1),this._spBoard.moveTo(0,e+100*this.zoomLevel),this._spBoard.lineTo(b*this.zoomLevel,e+100*this.zoomLevel),this._spBoard.moveTo(-100*this.zoomLevel,0),this._spBoard.lineTo(-100*this.zoomLevel,e);const y=b/1e3*1e3,P=As(y,"inches"),M=new $i(`${P[1]==="Metric"?(y/1e3).toFixed(2):P[0]} ${P[1]==="Metric"?"m":"in"}`,{fontSize:12,fill:0});M.name="txt-board-size",M.position.set(b*this.zoomLevel/2>>0,e+100*this.zoomLevel>>0),M.anchor.set(.5,0),this._spBoard.addChild(M);const z=ve.boardWidth/1e3*1e3,q=As(z,"inches"),V=new $i(`${q[1]==="Metric"?(z/1e3).toFixed(2):q[0]} ${q[1]==="Metric"?"m":"in"}`,{fontSize:12,fill:0});V.name="txt-board-size2",V.position.set(-130*this.zoomLevel>>0,e/2>>0),V.anchor.set(.5,.5),this._spBoard.addChild(V),V.rotation=Math.PI/2;let I=b*ve.boardWidth/1e6;q[1]==="Imperial"&&(I=I*10.7639);const Y=new $i(`Usage : ${I.toFixed(2)} ${q[1]==="Metric"?"m":"sqft"}`,{fontSize:12,fill:0});Y.name="txt-board-size3",Y.position.set(0,e+100*this.zoomLevel>>0),this._spBoard.addChild(Y)}else{const b=Math.max(...m.map(K=>K.y+K.height));this._spBoard.lineStyle(2,0,1),this._spBoard.moveTo(t+100*this.zoomLevel,0),this._spBoard.lineTo(t+100*this.zoomLevel,b*this.zoomLevel),this._spBoard.moveTo(0,-100*this.zoomLevel),this._spBoard.lineTo(t,-100*this.zoomLevel);const y=ve.boardLenght/1e3*1e3,P=As(y,"inches"),M=new $i(`${P[1]==="Metric"?(y/1e3).toFixed(2):P[0]} ${P[1]==="Metric"?"m":"in"}`,{fontSize:12,fill:0});M.name="txt-board-size",M.anchor.set(.5,.5),M.position.set(t/2>>0,(-150-M.getBounds().height)*this.zoomLevel>>0),this._spBoard.addChild(M);const z=b/1e3*1e3,q=As(z,"inches"),V=new $i(`${q[1]==="Metric"?(z/1e3).toFixed(2):q[0]} ${q[1]==="Metric"?"m":"in"}`,{fontSize:12,fill:0});V.name="txt-board-size2",V.position.set(t+150*this.zoomLevel>>0,b*this.zoomLevel/2>>0),this._spBoard.addChild(V);let I=ve.boardLenght*b/1e6;q[1]==="Imperial"&&(I=I*10.7639);const Y=new $i(`Usage : ${I.toFixed(2)} ${q[1]==="Metric"?"m":"sqft"}`,{fontSize:12,fill:0});Y.name="txt-board-size3",Y.position.set(t+150*this.zoomLevel>>0,0),this._spBoard.addChild(Y)}}else{const m=[];this._spBoard.children.forEach(v=>{var b;(b=v.name)!=null&&b.includes("txt-board-size")&&m.push(v)}),m.forEach(v=>{this._spBoard.removeChild(v)})}this.drawLegends();const s=100*this.zoomLevel,n=0,o=.2,h=1;let d=0;const p=[];this._spBoard.children.forEach(m=>{var v;(v=m.name)!=null&&v.includes("grid-")&&p.push(m)}),p.forEach(m=>{this._spBoard.removeChild(m)});for(let m=0;m<=t;m+=s){if(this._spBoard.lineStyle(h,n,o),this._spBoard.moveTo(m,0),this._spBoard.lineTo(m,e),d%20===0&&d>0){this._spBoard.lineStyle(2,n,1),this._spBoard.moveTo(m,0),this._spBoard.lineTo(m,-100*this.zoomLevel);const v=As(d/10*1e3,"inches"),b=new $i(`${v[1]==="Metric"?(d/10).toFixed(2):v[0]} ${v[1]==="Metric"?"m":"in"}`,{fontSize:12,fill:0});b.name="grid-"+m,b.position.set(m+10,-100*this.zoomLevel),this._spBoard.addChild(b)}d++}d=0;for(let m=0;m<=e;m+=s){if(this._spBoard.lineStyle(h,n,o),this._spBoard.moveTo(0,m),this._spBoard.lineTo(t,m),d%20===0&&d>0){this._spBoard.lineStyle(2,n,1),this._spBoard.moveTo(0,m),this._spBoard.lineTo(-100*this.zoomLevel,m);const v=As(d/10*1e3,"inches"),b=new $i(`${v[1]==="Metric"?(d/10).toFixed(2):v[0]} ${v[1]==="Metric"?"m":"in"}`,{fontSize:12,fill:0});b.name="grid-"+m,b.position.set(-300*this.zoomLevel,m+10),this._spBoard.addChild(b)}d++}}addItem(t){t.zoomLevel=this.zoomLevel,this.items.push(t),t._boardSurface=this,we.selectedBoard.newBoard.undoStack.push([t,t.saveState()]),we.selectedBoard.newBoard.undoIdx=we.selectedBoard.newBoard.undoStack.length-1}removeItem(t){this.items=this.items.filter(e=>e.guid!==t.guid),this._spMainCtn.removeChild(t._mainCtn)}cleanItems(){this.items=this.items.filter(t=>!t._mainCtn.destroyed)}unload(t){var e,i;this._unloaded=!0,t==null||t.removeChild(t.children[0]),this.items.forEach(s=>{s.disposeUI()}),(e=this._spMainCtn)==null||e.removeChildren(),(i=this._spMainCtn)==null||i.destroy({children:!0,texture:!0,baseTexture:!0}),console.log("Board Unloaded"),this._app&&(this._app.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),console.log("Board Destroyed"),this._app=void 0)}async createBoard(t=!1){console.log("Creating Board surface",this._unloaded);const e=t?null:await Ea(".cut-board-workspace");this._app&&(this._app.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),console.log("Board Destroyed"));const i=document.createElement("canvas");i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.id="cut-board-canvas",e.appendChild(i),this.canvas=i,this._app=new bh({background:"#ffffff",antialias:!0,autoDensity:!0,view:i,resizeTo:e}),this._spMainCtn=new Ui,this._app.stage.addChild(this._spMainCtn),this.drawBoard();const s=new Ri;s.beginFill(0,1),s.drawCircle(0,0,5),s.endFill(),this._spMainCtn.addChild(s),this.connectEventSystem(),await Ea("#cut-board-canvas")}connectEventSystem(){console.log("Adding events to the board surface",this.guid),Lt.on(Kt.BoardSurface.onConfigChange,()=>{this._unloaded||this.drawBoard()}),Lt.on(Kt.Item.onEnterEdit,t=>{if(this._unloaded)return;let e=!1;this.items.forEach(i=>{if(i.isSelected){if(e=!0,i.hasBeenOutwarded){Qe("Outwarded","This item has been outwarded and cannot be edited");return}i.setEditMode(!i._isEditMode)}}),e||this.items.forEach(i=>{i._isEditMode&&(e=!0,i.setEditMode(!i._isEditMode))})}),Lt.on(Kt.Item.onEnterSubPatternRemove,()=>{this._unloaded||this.items.forEach(t=>{const e=t.workingPapers.length>1;if(t.isSelected&&e){if(t.hasBeenOutwarded){Qe("Outwarded","This item has been outwarded and cannot be edited");return}t.isSubPatternMode=!0,t.removeSubPatterns(),t.isSubPatternMode=!1}})}),Lt.on(Kt.Item.onEnterSplitEdit,t=>{if(this._unloaded)return;let e=!1;this.items.forEach(i=>{if(i.isSelected){if(e=!0,i.hasBeenOutwarded){Qe("Outwarded","This item has been outwarded and cannot be splited");return}i.isSplitMode=!i._isSplitMode}}),e||this.items.forEach(i=>{i.isSplitMode=!1})}),Lt.on(Kt.Item.onEnterWrapEdit,t=>{if(this._unloaded)return;let e=!1;this.items.forEach(i=>{if(i.isSelected){if(e=!0,i.hasBeenOutwarded){Qe("Outwarded","This item has been outwarded and cannot be wrapped");return}i.isWrapMode=!i._isWrapMode}}),e||this.items.forEach(i=>{i.isWrapMode=!1})}),this.canvas.addEventListener("mouseup",t=>{if(!this._unloaded)if(t.button===2&&(this.items.forEach(e=>{e.isDragStarted=!1,e.isDragged=!1}),this._isDragStarted=!1,this._isDragged=!1,document.body.style.cursor="default"),t.button===0&&this.items.forEach(e=>{var i,s;if(e.isDragged){e.isDragged=!1,e.isDragStarted=!1,e.dragEnd();const n=e.saveState();we.selectedBoard.newBoard.undoStack.push([e,n]),we.selectedBoard.newBoard.undoIdx=we.selectedBoard.newBoard.undoStack.length-1;return}if(e._type==="ITEM"&&e.isDragStarted&&(!e.isDragged||!e.allowDragNDrop)){if(e._isEditMode||e._isSplitMode||e._isWrapMode||(console.log("Selecting",e.guid),e.isSelected=!e.isSelected),(i=e._editPathItem)!=null&&i._isEditMode)return}else e._isEditMode||e._isSplitMode||e._isWrapMode||(e.isSelected=!1);e.isDragStarted=!1,e.isDragged=!1,(s=e._psLine)!=null&&s.visible&&(e._psLine.visible=!1)}),Lt.emit(Kt.BoardSurface.onMouseUp,t),this.hasItemSelected){const e=this.items.filter(n=>n.isSelected)[0];if(e._isEditMode||e.isWrapMode||e.isSplitMode)return;const i=document.createElement("input");document.getElementById("rotation-elt")&&(document.getElementById("rotation-elt").remove(),document.getElementById("rotation-eltl").remove()),i.type="range",i.min="0",i.max="360",i.step="25",i.style.position="fixed",i.style.top="115px",i.style.right="20px",i.value=e.angle.toString();const s=document.createElement("label");s.id="rotation-eltl",s.innerText="Rotation",s.style.position="fixed",s.style.fontWeight="bold",s.style.top="112px",s.style.right="161px",i.id="rotation-elt",i.addEventListener("input",n=>{this.items.filter(o=>o.isSelected).forEach(o=>{o.angle=parseInt(n.target.value),o.reloadUI(this._spMainCtn)})})}else{const e=document.getElementById("rotation-elt"),i=document.getElementById("rotation-eltl");e&&(e.remove(),i.remove())}}),this.canvas.addEventListener("wheel",t=>{if(!this._unloaded){if(t.ctrlKey){t.deltaY<0?Lt.emit(Kt.BoardSurface.onRotate):Lt.emit(Kt.BoardSurface.onRotate,!0);return}t.deltaY<0?Lt.emit(Kt.BoardSurface.zoomIn):Lt.emit(Kt.BoardSurface.zoomOut)}}),this.canvas.addEventListener("mousedown",t=>{if(!this._unloaded){if(t.button===2){this.items.forEach(e=>{e.isZoomLocked||(e.isDragged=!1,e.isDragStarted=!1)}),this._isDragStarted=!0,this._dragStartPosition={x:We.screenMousePos.x,y:We.screenMousePos.y},this._dragBoardStartPosition={x:this._spMainCtn.x,y:this._spMainCtn.y},document.body.style.cursor="grabbing";return}if(t.button===0){this._isDragStarted=!1;let e=!1;this.items.forEach(i=>{i.allowDragNDrop&&(i._isEditMode||e||(new ir.Path(i.mainPath).contains({x:i.rawVal(We.boardMousePos.x)-i.rawX,y:i.rawVal(We.boardMousePos.y)-i.rawY})?(e=!0,i.isDragStarted=!0,i.dragStartPosition={x:We.boardMousePos.x-i.x,y:We.boardMousePos.y-i.y}):i.isDragStarted=!1))})}Lt.emit(Kt.BoardSurface.onMouseDown,t)}}),this.canvas.addEventListener("wheel",t=>{this._unloaded||Lt.emit(Kt.BoardSurface.onMouseScroll,t)}),this.canvas.addEventListener("mousemove",t=>{if(this._unloaded)return;const e=this.canvas.getBoundingClientRect();We.screenMousePos.x=t.clientX-e.x,We.screenMousePos.y=t.clientY-e.y,We.boardMousePos.x=t.clientX-e.x-this._spMainCtn.x,We.boardMousePos.y=t.clientY-e.y-this._spMainCtn.y,this.items.forEach(i=>{if(i.isSplitMode||i.isWrapMode){const s=(We.boardMousePos.x-i.x)/i.zoomLevel,n=(We.boardMousePos.y-i.y)/i.zoomLevel,o=i.mainPathPaper.getNearestPoint(new ir.Point(s,n));this._lastNearestPoint=o,this.divide1===void 0?(i._psStart._mainCtn.visible=!0,i._psStart.isZoomLocked||(i._psStart.zoomLevel=5,i._psStart.isZoomLocked=!0,i._psStart.reloadUI(i._psStart._boardSurface._spMainCtn)),i._psStart.x=(o.x+i.rawX)*i.zoomLevel,i._psStart.y=(o.y+i.rawY)*i.zoomLevel):this.divide2===void 0&&(i._psEnd._mainCtn.visible=!0,i._psEnd.isZoomLocked||(i._psEnd.zoomLevel=5,i._psEnd.isZoomLocked=!0,i._psEnd.reloadUI(i._psEnd._boardSurface._spMainCtn)),i._psEnd.x=(o.x+i.rawX)*i.zoomLevel,i._psEnd.y=(o.y+i.rawY)*i.zoomLevel,i.isSplitMode?i.drawPsLine():i.hidePsLine())}if(i._isEditMode){if(!i.allowDragNDrop)return;const s=(We.boardMousePos.x-i.x)/i.zoomLevel,n=(We.boardMousePos.y-i.y)/i.zoomLevel,o=i.mainPathPaper.getNearestPoint(new ir.Point(s,n));this._lastNearestPoint=o,i._psStart._mainCtn.visible=!0,i._psStart.isZoomLocked||(i._psStart.zoomLevel=5,i._psStart.isZoomLocked=!0,i._psStart.reloadUI(i._psStart._boardSurface._spMainCtn)),i._psStart.x=(o.x+i.rawX)*i.zoomLevel,i._psStart.y=(o.y+i.rawY)*i.zoomLevel}if(i.isDragged){i.x=We.boardMousePos.x-i.dragStartPosition.x,i.y=We.boardMousePos.y-i.dragStartPosition.y,i._editPointIndex>-1&&t.button===0&&(i.dragEnd(),i._editPointIndexPosition===1&&i.drawPsLine(i._startDragPosition.x,i._startDragPosition.y,i._mainCtn.x,i._mainCtn.y,!0,this.zoomLevel));return}i.mainPathPaper.contains({x:i.rawVal(We.boardMousePos.x)-i.rawX,y:i.rawVal(We.boardMousePos.y)-i.rawY})?i.isDragStarted?i.isDragged=!0:i.isHovered=!0:i.isHovered=!1}),this._isDragStarted&&(this._isDragged=!0),this._isDragged&&(this._spMainCtn.x=We.screenMousePos.x-this._dragStartPosition.x+this._dragBoardStartPosition.x,this._spMainCtn.y=We.screenMousePos.y-this._dragStartPosition.y+this._dragBoardStartPosition.y,we.selectedBoard.mainCtnPos={x:this._spMainCtn.x,y:this._spMainCtn.y}),Lt.emit(Kt.BoardSurface.onMove,t)}),this.canvas.addEventListener("mouseleave",t=>{this._unloaded||Lt.emit(Kt.BoardSurface.onMouseLeave,t)}),window.addEventListener("mouseout",t=>{this._unloaded||Lt.emit(Kt.BoardSurface.onMouseOut)}),window.addEventListener("resize",t=>{this._unloaded||(this._app.resize(),setTimeout(()=>{const e=this.canvas.parentElement.getBoundingClientRect();We.boardWidth=e.width,We.boardHeight=e.height,Lt.emit(Kt.BoardSurface.onResize)},100))}),window.addEventListener("keydown",t=>{this._unloaded||t.ctrlKey&&(this._isCtrlPressed=!0)}),window.addEventListener("keyup",t=>{if(!this._unloaded){if(t.key==="Delete"){this.items.forEach(e=>{e.isSelected&&(e.disposeUI(),this.removeItem(e),we.selectedBoard.newBoard.mvs=this.items)});return}if(t.key==="w"){const e=this.items.find(i=>i._isWrapMode);if(!e)return;if(this.divide1===void 0)this.divide1=this._lastNearestPoint;else if(this.divide2=this._lastNearestPoint,e){let i=function(o,h,d,p=s){const m=new ir.Point(h),v=new ir.Point(d);if(o.closed||(o=o.clone(),o.closePath()),!o.closed)throw new Error("The path must be closed.");const b=o.getNearestLocation(m),y=o.getNearestLocation(v);if(!b||!y)throw new Error("Points must lie on the path.");let P=o.splitAt(b),M=P?P.splitAt(y):null;if(!M)throw new Error("Failed to split the path at the specified points.");console.log("size",P.segments.length,M.segments.length);const z=v.subtract(m).normalize(),q=new ir.Point(-z.y,z.x),V=v.subtract(q.multiply(p)),I=m.subtract(q.multiply(p)),Y=P.length>M.length;let K=!1;if(Y){K=!0;const T=P;P=M,M=T}return P.translate({x:q.multiply(p).x*(K?1:-1),y:q.multiply(p).y*(K?1:-1)}),P.lineTo(K?I:v),M.lineTo(K?v:I),P.join(M),console.log("sPlit1",P.pathData),P.segments.forEach(T=>{var pt,wt,It,bt;T.point.x>>0===m.x>>0&&T.point.y>>0===m.y>>0&&console.log("P1",T.index),T.point.x>>0===v.x>>0&&T.point.y>>0===v.y>>0&&(T.clearHandles(),(pt=T.previous)==null||pt.clearHandles(),(wt=T.next)==null||wt.clearHandles()),T.point.x>>0===V.x>>0&&T.point.y>>0===V.y>>0&&console.log("P3",T.index),T.point.x>>0===I.x>>0&&T.point.y>>0===I.y>>0&&(T.clearHandles(),(It=T.previous)==null||It.clearHandles(),(bt=T.next)==null||bt.clearHandles());const at=P.getNearestPoint(m),ct=P.getNearestPoint(V);console.log("PP1",m,at),console.log("PP3",V,ct)}),P.closePath(),P};const s=Ye.unitOfMeasure===3?Ye.wrapDistance*25.4:Ye.wrapDistance;e.sealOriginalPath(),e._shapeHasChanged=!0;const n=i(e.mainPathPaper,this.divide1,this.divide2,s);e.normalizedPaths[0]=n.pathData,e.applyChanges(!0),e.isWrapMode=!1,e.isSelected=!1,e.reloadUI(this._spMainCtn),this.divide1=void 0,this.divide2=void 0}}if(t.key==="s"){const e=this.items.find(i=>i._isSplitMode);if(!e)return;if(this.divide1===void 0)this.divide1=this._lastNearestPoint;else if(this.divide2=this._lastNearestPoint,e){let i=function(o,h,d){const p=new ir.Point(h),m=new ir.Point(d),v=1e4,b=m.subtract(p).normalize(),y=new ir.Point(-b.y,b.x),P=p.subtract(b.multiply(v)),M=p.add(b.multiply(v)),z=P.add(y.multiply(v)),q=M.add(y.multiply(v)),V=new ir.Path({segments:[P,M,q,z],closed:!0,insert:!1}),I=P.subtract(y.multiply(v)),Y=M.subtract(y.multiply(v)),K=new ir.Path({segments:[P,M,Y,I],closed:!0,insert:!1});o.closed||(o=o.clone(),o.closePath());const T=o.intersect(V),at=o.intersect(K);return V.remove(),K.remove(),[T,at]};e.hidePsLine(),e._shapeHasChanged=!1,e.originalPaper=void 0;const s=i(e.mainPathPaper,this.divide1,this.divide2);e.normalizedPaths[0]=s[0].pathData,e.applyChanges(),e.isSplitMode=!1,e.isSelected=!1,e.reloadUI(this._spMainCtn),this.divide1=void 0,this.divide2=void 0;const n=new gs({paths:[s[1].pathData]});this.addItem(n),n.reloadUI(this._spMainCtn),n.x=e.x,n.y=e.y}}if(t.key==="p"){const e=this.items.find(i=>i._isEditMode);if(e){e._psStart.rawX,e._psStart.rawY;const i=e.mainPathPaper.getLocationOf(this._lastNearestPoint);e.mainPathPaper.divideAt(i),e.mainPathPaper.rotate(-e._angle,e.mainPathPaper.bounds.center),e.normalizedPaths[0]=e.mainPathPaper.pathData,e.mainPathPaper.rotate(e._angle,e.mainPathPaper.bounds.center),e.mainPath=e.mainPathPaper.pathData,e.applyChanges(),e.setEditMode(!0)}}if(t.key==="d"){const e=this.items.find(i=>i._isEditMode);if(e){e._psStart.rawX,e._psStart.rawY;const i=e.mainPathPaper.getOffsetOf(this._lastNearestPoint);e.mainPathPaper.getPointAt(i),e.mainPathPaper.segments.forEach((s,n)=>{s.curve.getOffsetOf(this._lastNearestPoint)===i&&e.mainPathPaper.segments.length>3&&e.mainPathPaper.removeSegment(n)}),e.mainPathPaper.rotate(-e._angle,e.mainPathPaper.bounds.center),e.normalizedPaths[0]=e.mainPathPaper.pathData,e.mainPathPaper.rotate(e._angle,e.mainPathPaper.bounds.center),e.mainPath=e.mainPathPaper.pathData,e.applyChanges(),e.setEditMode(!0)}}}}),Lt.on(Kt.BoardSurface.onRotate,t=>{if(this._unloaded)return;const e=this.items.find(i=>i._isSelected);e&&(t?e.angle+=hg:e.angle-=hg)}),Lt.on(Kt.BoardSurface.zoomIn,()=>{this._unloaded||(this.zoomLevel+=ag,this.zoomLevel>lg&&(this.zoomLevel=lg),we.selectedBoard.newBoard.zoomLevel=this.zoomLevel,this.items.forEach(t=>{t.zoomLevel=this.zoomLevel,t.reloadUI(this._spMainCtn),t.rawX=t.rawX,t.rawY=t.rawY}),this.drawBoard())}),Lt.on(Kt.BoardSurface.zoomOut,()=>{this._unloaded||(this.zoomLevel-=ag,this.zoomLevel<og&&(this.zoomLevel=og),we.selectedBoard.newBoard.zoomLevel=this.zoomLevel,this.items.forEach(t=>{t.zoomLevel=this.zoomLevel,t.reloadUI(this._spMainCtn),t.rawX=t.rawX,t.rawY=t.rawY}),this.drawBoard())}),Lt.on(Kt.BoardSurface.onGlobalCollisionComplete,async t=>{if(this._unloaded)return;if(this.items.filter(s=>s._type==="ITEM").length===0){Qe("Cut","No Items to Cut");return}const i=await getConfig();if(console.log("Global Collision Complete",t),this.hasPendingCut)if(console.log("Asked for Cutting"),this.hasPendingCut=!1,t)console.log("Collision Detected, Aborting Cut");else{console.log("No Collision, Proceeding to Cut");const s=this.getMaterialUsage();await Ce("usercuttes","POST",{usagePercent:s[1],usageSize:s[0],patternCuttedList:["2366b1bb-058e-4670-8558-c25c75fcd704"]});const n=[];this.items.forEach(p=>{p.mainPathPaper.bounds.center,p.hasBeenOutwarded?p.outwardDoubleCut?(p.outwardedPaper.translate({x:p.rawX,y:p.rawY}),n.push(p.outwardedPaper.pathData),p.getMainPapers().forEach(m=>{m.translate({x:p.rawX,y:p.rawY}),n.push(m.pathData)})):p.getMainPapers().forEach((m,v)=>{v===0?(p.outwardedPaper.translate({x:p.rawX,y:p.rawY}),n.push(p.outwardedPaper.pathData)):(m.translate({x:p.rawX,y:p.rawY}),n.push(m.pathData))}):p.getMainPapers().forEach(m=>{m.translate({x:p.rawX,y:p.rawY}),n.push(m.pathData)})});const o=40,h=await YE(n,80);if(i.cut.target==="SUMMA"){const m=i.cut.summa.model.split("|");let v=i.cut.summa.blade;m[0].includes("F")&&(v="1");let b=`IN;SP${v};`;m[0].includes("S3")&&(b=";"),m[0].includes("D")&&(b=",;:HOA,ECN,");let y=b+h.map(P=>`PU;PA${P[0][1]*o>>0},${P[0][0]*o>>0};PD${P.map(M=>`${M[1]*o>>0},${M[0]*o>>0}`).join(",")};`);y=y.replace(/;;,PU/g,";PU"),m[0].includes("D")&&(y=y.replace(/PU/g,"U"),y=y.replace(/PA/g,"U"),y=y.replace(/PD/g,"D"),y+=`

,e

"@"`),m[0].includes("S3")&&(y=y.replace(/PU/g,"PI"),y=y.replace(/PA/g,"PU"),y=y.replace(/PI/g,"PA")),console.log(m),m.join("|").includes("Network")?sendCutToIp(i.cut.network.ip,i.cut.network.port.toString(),y):sendCutToSuma(y);return}if(i.cut.target==="PRINTER"){const p="PRINTER|"+i.cut.printer.name+"|IN;SP1;"+h.map(m=>`PU;PA${m[0][1]*o>>0},${m[0][0]*o>>0};PD${m.map(v=>`${v[1]*o>>0},${v[0]*o>>0}`).join(",")};`);console.log("Sending to Printer",p),sendCutToSuma(p);return}const d="IN;SP1;"+h.map(p=>`PU;PA${p[0][1]*o>>0},${p[0][0]*o>>0};PD${p.map(m=>`${m[1]*o>>0},${m[0]*o>>0}`).join(",")};`);sendCutToIp(i.cut.network.ip,i.cut.network.port.toString(),d.replace(/;,PU/g,";PU")),console.log("Cut Sent")}}),Lt.on(Kt.BoardSurface.onCutCommand,async()=>{this._unloaded||(this.hasPendingCut=!0,Lt.emit(Kt.Item.onCheckCollisions))}),Lt.on(Kt.BoardSurface.onOutward,async()=>{if(this._unloaded)return;const t=this.items.find(n=>n.isSelected);if(!t)return;if(t.hasBeenOutwarded){Qe("Outward","Item has already been outwarded");return}const e=t.workingPapers[0].pathData,i=Ye.unitOfMeasure===3?Ye.wrapDistance*25.4:Ye.wrapDistance,s=ZE(e,i);t.outwardedPath=s,t.outwardedPaper=new ir.Path(s),t.hasBeenOutwarded=!0,t.outwardDoubleCut=Ye.doubleCut,t.reloadUI(this._spMainCtn),console.log("Outwarded",t.workingPaths[0])})}async reload(){this._unloaded||(this.drawLegends(),this.items.forEach(t=>{t.reloadUI(this._spMainCtn)}))}}class Bs extends ri{constructor(){super("Dropdown");tt(this,"title","");tt(this,"text","");tt(this,"isOpened",!1);tt(this,"items",[]);tt(this,"itemLabel","");tt(this,"selectedItem");tt(this,"isDisabled",!1);tt(this,"forceWidth","160px");tt(this,"onSelect");this.registerTemplate("default",s2),this.registerDependencyProperties(["title","text","isOpened","isDisabled"]);const e=this,i=function(s){document.body.querySelector(`#dd${e.guid}`).contains(s.target)||(e.isOpened=!1,e.update())};this.addEventListener("mount",()=>{document.addEventListener("click",i)}),this.addEventListener("unmount",()=>{document.removeEventListener("click",i)})}openList(){this.isOpened||(this.isOpened=!0,console.log("openList"))}reset(){this.text="",this.isOpened=!1,this.items.length=0,this.selectedItem=-1}}const s2=r=>{let t=null;return r.isOpened?t=Z("div",{class:"filter-drop-down-list"},r.items.map(e=>Z("div",{class:"filter-drop-down-item",onClick:()=>{var i;r.text=e[r.itemLabel],r.isOpened=!1,r.selectedItem=e,(i=r.onSelect)==null||i.call(r,e)}},e[r.itemLabel]))):t=null,Z(Re,null,Z("div",{class:"filter-drop-down",id:"dd"+r.guid,style:{opacity:r.isDisabled?"0.3":"1",minWidth:`${r.forceWidth}!important`}},Z("div",{class:"filter-drop-down",style:{minWidth:`${r.forceWidth}`},onClick:()=>{!r.isDisabled&&r.openList()}},Z("span",{style:{fontWeight:"500"}},r.text!==""?r.text:r.title),Z("div",{style:{backgroundImage:"url(assets/svg/black-triangle.svg)",minWidth:"8px",minHeight:"8px",maxWidth:"8px",maxHeight:"8px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:"50%",right:"15px"}})),t))};function Hi(r){const t={gap:r.gap||0,display:"flex",flexDirection:r.col?"column":"row",padding:r.padding||0};r.root&&(t.width="100%",t.height="100%"),r.absolute&&(t.position="absolute",t.top=0,t.left=0,t.right=0,t.bottom=0),r.fixed&&(t.position="fixed",t.top=0,t.left=0,t.right=0,t.bottom=0),r.debug&&(t.border="1px solid red",t.backgroundColor="rgba(255, 0, 0, 0.1)",t.boxSizing="border-box"),r.size&&(typeof r.size=="number"?t.flex=r.size:t.flexDirection==="row"?t.width=r.size:t.height=r.size),!r.col&&!r.row&&(t.justifyContent="stretch",t.alignItems="stretch"),t.flexDirection==="row"&&(t.alignItems="stretch"),t.flexDirection==="column"&&(t.justifyContent="stretch"),r.fixWidth&&(t.minWidth=r.fixWidth,t.maxWidth=r.fixWidth),r.fixHeight&&(t.minHeight=r.fixHeight,t.maxHeight=r.fixHeight),r.overflowX&&(t.overflowX=r.overflowX),r.overflowY&&(t.overflowY=r.overflowY),r.style&&Object.assign(t,r.style);const e=[];return r.colXs&&e.push(["-","+"].includes(r.colXs)?`x${r.colXs}col-xs`:`col-xs-${r.colXs}`),r.colSm&&e.push(["-","+"].includes(r.colSm)?`x${r.colSm}col-sm`:`col-sm-${r.colSm}`),r.colMd&&e.push(["-","+"].includes(r.colMd)?`x${r.colMd}col-md`:`col-md-${r.colMd}`),r.colLg&&e.push(["-","+"].includes(r.colLg)?`x${r.colLg}col-lg`:`col-lg-${r.colLg}`),r.colXl&&e.push(["-","+"].includes(r.colXl)?`x${r.colXl}col-xl`:`col-xl-${r.colXl}`),r.colXxl&&e.push(["-","+"].includes(r.colXxl)?`x${r.colXxl}col-xxl`:`col-xxl-${r.colXxl}`),r.class&&e.push(r.class),r.fullSize&&e.push("i-stack"),Z("div",{className:e.join(" "),style:t},r.children)}class n2 extends ri{constructor(){super("CutBoard");tt(this,"mainCtn",null);tt(this,"boardSprite",null);tt(this,"x",0);tt(this,"y",0);tt(this,"wrapDistance",new Bs);tt(this,"boardSurface",null);this.registerTemplate("default",a2),this.addEventListener("mount",async()=>{this.wrapDistance.items=[{label:"Wrap distance = 10mm",value:10},{label:"Wrap distance = 20mm",value:20},{label:"Wrap distance = 30mm",value:30},{label:"Wrap distance = 40mm",value:40},{label:"Wrap distance = 50mm",value:50},{label:"Wrap distance = 60mm",value:60},{label:"Wrap distance = 70mm",value:70},{label:"Wrap distance = 80mm",value:80},{label:"Wrap distance = 90mm",value:90},{label:"Wrap distance = 100mm",value:100}],Ye.unitOfMeasure===3&&this.wrapDistance.items.forEach(e=>{e.label=e.label.replace("mm","in"),e.value=e.value*.0393701}),Ye.wrapDistance,this.wrapDistance.itemLabel="label",this.wrapDistance.selectedItem=this.wrapDistance.items[0],this.wrapDistance.text=`Wrap Distance (${Ye.unitOfMeasure===3?"in":"mm"})`,this.wrapDistance.forceWidth="230px",Ye.wrapDistance=Ye.wrapDistance,this.update(),this.reloadBoard(),console.log("CutBoard mounted !")}),this.addEventListener("unmount",async()=>{var i;console.log("CutBoard unmounted !");const e=(await Ea("#cut-board-canvas")).parentElement;(i=this.boardSurface)==null||i.unload(e)})}async reloadBoard(){var s,n,o;try{const h=(await Ea("#cut-board-canvas")).parentElement;(s=this.boardSurface)==null||s.unload(h)}catch{console.log("Unload failed")}const e=((n=we.selectedBoard)==null?void 0:n.newBoard)??{boardIndex:0,boardName:"",carLegend:new Map,zoomLevel:qc,mvs:[]};if(we.boards.length===0&&e.mvs.length===0&&bi.selections.length===0)return;let i=new r2;console.log("Board surface should unload",(o=this.boardSurface)==null?void 0:o._unloaded),this.boardSurface=i,window.board=window.board||[],window.board.push(i),await i.createBoard(),i._spMainCtn.visible=!1,i.reload(),i.debugUI(!0),e.mvs.length===0?(bi.selections.forEach((h,d)=>{const p=h.rawVectors.map(v=>v.asString()),m=new gs({paths:p});e.mvs.push(m),m._carColor=h.carColor,i.addItem(m),m.zoomLevel=qc,m.reloadUI(m._boardSurface._spMainCtn),m.x=0,m.y=0}),bi.selections.forEach((h,d)=>{h.carColor=h.carColor??4251856,e.carLegend.has(h.carColor)||e.carLegend.set(h.carColor,h.carLegend)}),bi.images.length=0,bi.selections.length=0,bi.selectionsDisp.length=0,bi.shouldBeProcessed=!1):(i.zoomLevel=e.zoomLevel,e.mvs.forEach((h,d)=>{h.disposed=!0,h.zoomLevel=e.zoomLevel,i.addItem(h),h.reloadUI(h._boardSurface._spMainCtn),h.x=h.x,h.y=h.y}),i.reload(),i.drawBoard(),i.debugUI(!0)),i.legends=e.carLegend,i.drawLegends(),setTimeout(()=>{var h,d;if(this.boardSurface._spMainCtn.visible=!0,(h=we.selectedBoard)!=null&&h.newBoard.hasbeenCentered){this.boardSurface._spMainCtn.x=we.selectedBoard.mainCtnPos.x,this.boardSurface._spMainCtn.y=we.selectedBoard.mainCtnPos.y;return}we.selectedBoard.mainCtnPos=(d=this.boardSurface)==null?void 0:d.centerBoard(),we.selectedBoard.newBoard.hasbeenCentered=!0},16)}}const a2=r=>Z(Re,null,Z("div",{class:"cut-board",style:{flex:"1",display:"flex",flexDirection:"column"}},Z("div",{class:"cut-board-header",style:{marginTop:"20px",flex:"0",display:"flex",flexDirection:"column",minHeight:"110px",maxHeight:"110px",backgroundColor:"#CDE7F2"}},Z("div",{class:"filter-pane-empty"},"Settings"),Z("div",{class:"filter-pane-empty"},Z("div",{style:{display:"flex",alignItems:"center",marginRight:"20px"}},Z("div",{style:{fontSize:"16px"}},Z(Hi,{style:{width:"600px"}},Z(Hi,{debug:!1,gap:10,size:1,style:{alignItems:"center"}},Z("span",null,"Wrap distance (",Ye.unitOfMeasure===3?"in":"mm",")"),Z("input",{className:"settings",type:"text",style:{width:"100px",height:"30px",backgroundColor:"#2babd5",color:"#FFFFFF",textAlign:"center"},value:Ye.wrapDistance,onChange:async t=>{Ye.wrapDistance=parseInt(t.currentTarget.value),r.update()}})),Z(Hi,{debug:!1,gap:10,size:1,style:{alignItems:"center"}},Z("span",null,"Outward double cut"),Z("input",{type:"checkbox",id:"ipPlotter",name:"plotter",checked:Ye.doubleCut,value:"IP",onClick:async()=>{Ye.doubleCut=!Ye.doubleCut,r.update()}}))))),Z("div",{style:{display:"flex",alignItems:"center",marginRight:"20px"}}))),Z("div",{style:{backgroundImage:"url(assets/svg/feed.svg)",backgroundSize:"contain",width:"calc(335px / 6)",height:"calc(537px / 6)",position:"fixed",bottom:"55px",left:"150px",zIndex:1e3}}),Z("div",{class:"cut-board-workspace",style:{flex:"1",backgroundRepeat:"repeat",backgroundSize:"1700px",overflow:"hidden",position:"relative"}},Z("canvas",{id:"cut-board-canvas",style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}})),Z("div",{style:{minHeight:"50px",maxHeight:"50px",overflowX:"scroll",display:"flex",flexDirection:"row",gap:"10px",border:"1px solid #25A9E0"}},we.boards.map((t,e)=>Z("div",{style:{flexGrow:0,flexShrink:0,border:"1px solid blue",borderRadius:"8px",textWrap:"nowrap",maxHeight:"40px",display:"flex",gap:"10px",alignItems:"center",paddingLeft:"5px",paddingRight:"5px",backgroundColor:we.currentBoardIndex===e?"#25A9E0bb":"white",color:we.currentBoardIndex===e?"white":"black"}},Z("span",{onClick:async()=>{we.setSelectedBoard(e),we.displaySelectedBoard(),r.update()}},t.newBoard.boardName??t.boardName),Z("div",{onClick:async()=>{await Co("Delete Board","Are you sure you want to delete this board ?")==="ok"&&(we.boards.splice(e,1),we.currentBoardIndex=0,we.displaySelectedBoard(),r.update())},style:{minWidth:24,minHeight:24,maxWidth:24,maxHeight:24,backgroundImage:"url(assets/svg/win-close.svg)",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",fill:"black"}}))))));class o2 extends ri{constructor(){super("CutBoardPreview");tt(this,"isClosed",!1);this.registerTemplate("default",l2),this.registerDependencyProperties(["isClosed"])}}const l2=r=>(setTimeout(()=>{const t=document.querySelector(".right-pane");r.isClosed?(t.style.display="none",t.style.position="fixed"):(t.style.display="none",t.style.position="inherit"),setTimeout(()=>{t.style.display="flex"},2)},1),Z(Re,null,Z("div",{class:"cut-pane-top",style:{position:r.isClosed?"fixed":"inherit",right:r.isClosed?"0px":"inherit",width:r.isClosed?"41px":"inherit"}},Z("div",{style:{cursor:"pointer",flex:"1",maxWidth:"20px",backgroundImage:"url(assets/svg/bring-to-cut.svg)",height:"45px",backgroundSize:"stretch",backgroundRepeat:"no-repeat",backgroundPosition:"center",transform:r.isClosed?"scaleX(-1)":"scaleX(1)"},onClick:()=>{r.isClosed=!r.isClosed,setTimeout(()=>{window.searchApp.resize()},500)}}),Z("div",{style:{flex:"1",textAlign:"center"}},Z("span",{style:{display:r.isClosed?"none":"block"}},"Cut Board Preview"))),!r.isClosed&&io.map((t,e)=>Z(Re,null,Z("div",{key:`${t.guid}`,style:{flex:0,alignSelf:"center",minWidth:"95%",maxWidth:"95%",minHeight:"250px",backgroundColor:"#25a8df",borderRadius:"25px",display:"flex",flexDirection:"column",justifyContent:"start",alignItems:"center",margin:"10px",position:"relative"}},Z("div",{style:{fontSize:"x-large"}},t.name),Z("div",{style:{position:"absolute",width:"25px",height:"25px",color:"white",fontWeight:"700",fontSize:"larger",border:"1px solid white",textAlign:"center",lineHeight:"25px",borderRadius:"25px",right:"8px",top:"7px",cursor:"pointer"},onClick:()=>{io.splice(e,1),bi.images.splice(e,1),bi.selections.splice(e,1),r.update()}},"X"),Z("div",{style:{width:"95%",height:"190px",marginTop:"10px",backgroundImage:`url(${bi.images[e]})`,backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundColor:"white",borderRadius:"10px"}})))),Z("div",{style:{display:r.isClosed?"none":"flex",justifyContent:"center",marginBottom:"15px"}},Z("div",null,Hm("add-to-cut","Open Cut Board",()=>{if(we.boards.length===5){Qe("Board limit","You can only have 5 boards open at a time.");return}Lt.emit(je.ButtonBar.Click,{name:"cut-board"}),we.createBoard(),we.setSelectedBoard(we.boards.length-1),io.length=0}))))),Hm=(r,t,e)=>Z(Re,null,Z("div",{class:"filter-drop-down",style:{backgroundColor:"black",color:"white",minWidth:"190px",maxWidth:"190px",borderRadius:"10px",marginTop:"20px",marginLeft:"30px"},onClick:()=>e==null?void 0:e()},Z("div",{style:{backgroundImage:`url(assets/svg/${r}.svg)`,minWidth:"30px",minHeight:"30px",maxWidth:"30px",maxHeight:"30px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:"10px",left:"10px"}}),Z("span",{style:{fontWeight:"400",paddingLeft:"30px"}},t))),Ti=(r,t,e=150,i=!1,s)=>{const n=[],o={},h={};i?(o.right="10px",h.paddingRight="15px"):(o.left="10px",h.paddingLeft="15px");const d=Z("div",{style:{backgroundImage:`url(assets/svg/${r}.svg)`,minWidth:i?"12px":"20px",minHeight:i?"12px":"20px",maxWidth:i?"12px":"20px",maxHeight:i?"12px":"20px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:i?"12px":"8px",...o}}),p=Z("span",{style:{fontWeight:"300",fontSize:"14px",...h}},t);return n.push(p),n.push(d),Z(Re,null,Z("div",{class:"filter-drop-down",onClick:()=>s==null?void 0:s(),style:{backgroundColor:"black",color:"white",minWidth:`${e}px`,maxWidth:`${e}px`,borderRadius:"10px",marginTop:"0px",marginLeft:"0px",minHeight:"35px",maxHeight:"35px",lineHeight:"30px"}},n))},h2=async(r,t)=>{const e=[];for(let i=0;i<r.length;i++)e.push(await t(r[i],i));return e};class u2 extends ri{constructor(){super("History");tt(this,"children",[]);tt(this,"title","History");tt(this,"items",[]);tt(this,"projectStatusList",[]);this.registerTemplate("default",c2),this.registerDependencyProperties(["items"]);const e=this;this.addEventListener("mount",async function(){e.refresh()})}async refresh(){const e=await Ce("usercuttes"+(fr.id?`/${fr.id}`:""),"get",null,!0),i=this;i.items=e.payload;const s=Ie("tableHistory"),n=Ti("add-to-cut","Add to cut Board"),o=(await Ce("usercuttes/feedback/statuses","GET",null)).payload;s.rows=await h2(e.payload.filter(h=>{var d,p;return((p=(d=h.patterns[0])==null?void 0:d.name)==null?void 0:p.toLowerCase().indexOf(oh))!==-1||!oh}),async(h,d)=>{var v;let p=3;try{p=(await Ce(`usercuttes/feedback/${h.cutId}`,"get",null,!0)).payload.feedbackId}catch{p=-1}const m=Ti("white-triangle",o.filter(b=>b.id.toString()===(p===-1?3:p).toString())[0].status,100,!0,async()=>{const b=await QC();b&&(p===-1?await Ce("usercuttes/feedback","post",{cutId:h.cutId,feedbackId:Number(b),comment:""},!0):await Ce("usercuttes/feedback","put",{cutId:h.cutId,feedbackId:Number(b),comment:""},!0),i.refresh())});return Ti("bin","Delete",100,!1,async()=>{Ce("userboard/"+h.cutId,"delete",{},!0),i.refresh()}),[d+1,((v=h.patterns[0])==null?void 0:v.name)??"",new Date(h.dateCreated).toLocaleDateString(),new Date(h.dateCreated).toLocaleTimeString(),h.usageSize,m,[n]]}),s.update()}}const c2=r=>Z(Re,null,Z("div",{class:"filter-pane-top"},r.title),Z("div",{class:"filter-pane-empty",style:{marginBottom:"50px"}},d2("lens","Search",r)),r.children.map(t=>t.vdom));let oh="";const d2=(r,t,e)=>Z(Re,null,Z("div",{class:"filter-drop-down",style:{backgroundColor:"black",color:"white",minWidth:"300px",maxWidth:"300px",borderRadius:"10px",marginTop:"20px",marginLeft:"30px",display:"flex",justifyContent:"stretch",alignItems:"center"}},Z("input",{type:"text",defaultValue:"Search by board name",style:{fontWeight:"400",border:"none",backgroundColor:"black",height:"30px",flex:1,maxWidth:"235px",width:"50px",color:"white",fontSize:"20px",textAlign:"left",paddingLeft:"15px",borderRight:"1px solid #25A9E0"},onClick:i=>{i.currentTarget.value=oh},onKeyUp:async i=>{oh=i.currentTarget.value.toLowerCase(),e.refresh()}}),Z("div",{style:{backgroundImage:`url(assets/svg/${r}.svg)`,minWidth:"24px",minHeight:"24px",maxWidth:"24px",maxHeight:"24px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:"10px",right:"10px"}})));class f2 extends ri{constructor(){super("MyBoards");tt(this,"children",[]);tt(this,"title","Saved Boards");tt(this,"items",[]);this.registerTemplate("default",p2),this.registerDependencyProperties(["items"]);const e=this;this.addEventListener("mount",async function(){await e.refresh(),e.update()})}async refresh(){var s,n;const e=Ie("tableBoards");Ti("rename","Rename",100);const i=fr.id===""?await Ce("userboard","get",null,!0):await Ce(`userboard/project/${fr.id}`,"get",null,!0);this.items=i.payload,e.rows=(n=(s=i.payload)==null?void 0:s.map)==null?void 0:n.call(s,(o,h)=>{const d=o,p=Ti("add-to-cut","Add to cut Board",void 0,!1,async()=>{var q,V;if(we.boards.length===5){Qe("Board limit","You can only have 5 boards open at a time.");return}const v=await Ce("userboard/"+o.board_id,"get",null,!0),b=atob(v.payload.vector_image),y=JSON.parse(b);we.createBoard(),we.setSelectedBoard(we.boards.length-1);const P=Ie("cutBoard"),M=y.pop(),z=new Map;console.log("Legends loaded",M),M.forEach(I=>{z.set(I.key,I.value)}),we.selectedBoard.newBoard.carLegend=z,(V=(q=P==null?void 0:P.boardSurface)==null?void 0:q.items)==null||V.forEach((I,Y)=>{P.boardSurface.removeItem(I),P.boardSurface.items.length=0,P.boardSurface._spMainCtn.removeChildren()}),y.forEach((I,Y)=>{const K=new gs({paths:[]});K.originalPaths=I.originalPath,K.normalizedPaths=I.normalizePaths,K.workingPaths=I.workingPaths,K.rawX=I.x,K.rawY=I.y,K.angle=I.angle,K._carColor=I.carColor,we.selectedBoard.newBoard.mvs.push(K),we.selectedBoard.newBoard.boardName=d.name}),await Qe("Added","The board has been added to the cut board","Ok",500,210)}),m=Ti("bin","Delete",100,!1,async()=>{await Co("Deletion","Are you sure you want to delete this board?","Yes","No")==="ok"&&(await Ce("userboard/"+o.board_id,"delete",{},!0),this.refresh(),await Qe("Deleted","The board has been deleted","Ok",500,210))});return[h+1,o.name,new Date(o.date_created).toLocaleDateString(),new Date(o.date_created).toLocaleTimeString(),[p,m]]}),e.update()}}const p2=r=>Z(Re,null,Z("div",{class:"filter-pane-top"},r.title),Z("div",{class:"filter-pane-empty",style:{marginBottom:"50px"}},g2("lens","Search",r)),r.children.map(t=>t.vdom));let fn="";const g2=(r,t,e)=>Z(Re,null,Z("div",{class:"filter-drop-down",style:{backgroundColor:"black",color:"white",minWidth:"300px",maxWidth:"300px",borderRadius:"10px",marginTop:"20px",marginLeft:"30px",display:"flex",justifyContent:"stretch",alignItems:"center"}},Z("input",{type:"text",defaultValue:fn||"Search by board name",style:{fontWeight:"400",border:"none",backgroundColor:"black",height:"30px",flex:1,maxWidth:"235px",width:"50px",color:"white",fontSize:"20px",textAlign:"left",paddingLeft:"15px",borderRight:"1px solid #25A9E0"},onClick:i=>{i.currentTarget.value=fn},onKeyUp:i=>{var o,h,d;fn=i.currentTarget.value.toLowerCase(),console.log(fn);const s=Ie("tableBoards"),n=Ti("add-to-cut","Add to cut Board");s.rows=(d=(o=e.items)==null?void 0:(h=o.filter(p=>p.name.toLowerCase().indexOf(fn)!==-1||!fn)).map)==null?void 0:d.call(h,(p,m)=>{const v=Ti("bin","Delete",100,!1,async()=>{await Co("Deletion","Are you sure you want to delete this board?","Yes","No")==="ok"&&(await Ce("userboard/"+p.board_id,"delete",{},!0),e.refresh(),await Qe("Deleted","The board has been deleted","Ok",500,210))});return[m+1,p.name,new Date(p.date_created).toLocaleDateString(),new Date(p.date_created).toLocaleTimeString(),[n,v]]}),s.update()}}),Z("div",{style:{backgroundImage:`url(assets/svg/${r}.svg)`,minWidth:"24px",minHeight:"24px",maxWidth:"24px",maxHeight:"24px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:"10px",right:"10px"}})));class ls extends ri{constructor(){super("Label");tt(this,"title","");tt(this,"text","");tt(this,"isOpened",!1);tt(this,"items",[]);tt(this,"itemLabel","");tt(this,"selectedItem");tt(this,"isDisabled",!1);tt(this,"onSelect");this.registerTemplate("default",m2),this.registerDependencyProperties(["title","text","isOpened","isDisabled"])}openList(){this.isOpened||(this.isOpened=!0,console.log("openList"))}reset(){this.text="",this.isOpened=!1,this.items.length=0}}const m2=r=>(r.isOpened&&r.items.map(t=>Z("div",{class:"filter-drop-down-item",onClick:()=>{var e;r.text=t[r.itemLabel],r.isOpened=!1,r.selectedItem=t,(e=r.onSelect)==null||e.call(r,t)}},t[r.itemLabel])),Z(Re,null,Z("div",{class:"filter-drop-down",style:{opacity:r.isDisabled?"0.3":"1",minWidth:"400px",maxWidth:"400px",display:"flex",position:"relative",flexDirection:"row",justifyContent:"center",marginTop:"40px"}},Z("div",{style:{position:"absolute",left:"10px",top:"-40px",fontWeight:"500",fontStyle:"italic"}},r.title),Z("div",{class:"filter-drop-down",onClick:()=>{!r.isDisabled&&r.openList()}},Z("span",{style:{fontWeight:"500"}},r.text!==""?r.text:r.title)))));let _2=class extends ri{constructor(){super("Profile");tt(this,"firstName");tt(this,"lastName");tt(this,"email");tt(this,"phone");tt(this,"company");tt(this,"vat");tt(this,"region");tt(this,"country");tt(this,"postalCode");tt(this,"user");this.registerTemplate("default",v2),this.addEventListener("mount",async()=>{const e=await Ce("user/profile","get",null,!0);this.user=e,this.firstName=new ls,this.firstName.text=e.first_name,this.firstName.title="First Name",this.lastName=new ls,this.lastName.text=e.last_name,this.lastName.title="Last Name",this.email=new ls,this.email.text=e.email,this.email.title="Email",this.phone=new ls,this.phone.text="("+e.country_code+")"+e.phone_number,this.phone.title="Phone",this.company=new ls,this.company.text=e.company,this.company.title="Company",this.vat=new ls,this.vat.text=e.vat,this.vat.title="VAT",this.region=new ls,this.region.text=e.region_name,this.region.title="Region",this.country=new ls,this.country.text=e.country_name,this.country.title="Country",this.postalCode=new ls,this.postalCode.text=e.postal_code,this.postalCode.title="Postal Code",this.update()})}};const v2=r=>{var t,e,i,s,n,o,h,d,p,m,v;return Z(Re,null,Z("div",{style:{width:"100%",position:"fixed",left:"0px",top:"40px",right:"0px",height:"50px",backgroundColor:"#CDE7F2",color:"black",fontSize:"15px",fontWeight:"bold",paddingLeft:"170px",display:"flex",flexDirection:"row",alignItems:"center"}},"General Settings"),Z("img",{src:"assets/profile-left.png",style:{position:"fixed",left:"130px",top:"140px",width:"303px",height:"111px"}}),Z("img",{src:"assets/profile-bot.png",style:{position:"fixed",left:"160px",bottom:"20px",width:"400px"}}),Z("div",{style:{position:"fixed",left:"150px",bottom:"165px",width:"400px",zIndex:1e3,color:"#fff",border:"1px solid transparent",textAlign:"center",fontSize:"20px"}},"Hi, ",(t=r.user)==null?void 0:t.first_name),Z("div",{style:{position:"fixed",left:"364px",bottom:"133px",width:"400px",zIndex:1e3,color:"#fff",border:"1px solid transparent",textAlign:"left",fontSize:"15px"}},(e=r.user)==null?void 0:e.subscription_plan),Z("div",{style:{backgroundSize:"contain",backgroundImage:"url(assets/profileBtns.png)",position:"fixed",left:"210px",backgroundRepeat:"no-repeat",bottom:"40px",width:"290px",height:"40px",zIndex:1e3,display:"flex",justifyContent:"start",alignItems:"stretch"}},Z("div",{style:{flex:1.2,backgroundColor:"#ffffff00"},onClick:()=>{Ie("settings"),Qe("Info","This feature is not available yet.")}}),Z("div",{style:{flex:1,backgroundColor:"#ffff00dd00"},onClick:async()=>{await Co("Confirm","Are you sure you want to log out?")&&(localStorage.removeItem("user"),localStorage.removeItem("token"),Lt.emit(je.ButtonBar.Click,{id:"",name:"login"}))}})),Z("div",{style:{width:"1000px",position:"fixed",left:"calc(50% - 230px)",top:"150px"}},Z("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},Z("div",{style:{fontSize:"20px",fontWeight:"bold"}},"Personal information"),Z("div",{style:{fontSize:"20px",fontWeight:"normal",marginBottom:"0px"}},"Info about you")),Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",margin:"10px"}},Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((i=r==null?void 0:r.firstName)==null?void 0:i.vdom)??"NULL"),Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((s=r==null?void 0:r.lastName)==null?void 0:s.vdom)??"NULL")),Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",margin:"10px"}},Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((n=r==null?void 0:r.email)==null?void 0:n.vdom)??"NULL"),Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((o=r==null?void 0:r.phone)==null?void 0:o.vdom)??"NULL")),Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",margin:"10px"}},Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((h=r==null?void 0:r.company)==null?void 0:h.vdom)??"NULL"),Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((d=r==null?void 0:r.vat)==null?void 0:d.vdom)??"NULL")),Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",margin:"10px"}},Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((p=r==null?void 0:r.region)==null?void 0:p.vdom)??"NULL"),Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((m=r==null?void 0:r.country)==null?void 0:m.vdom)??"NULL")),Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",margin:"10px"}},Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}}),Z("div",{style:{flex:"1",display:"flex",justifyContent:"center"}},((v=r==null?void 0:r.postalCode)==null?void 0:v.vdom)??"NULL"))))},ur=!1;class y2 extends ri{constructor(){super("Profile");tt(this,"width",0);tt(this,"length",0);tt(this,"plotterType","");tt(this,"printerList",[]);tt(this,"summaList",[]);tt(this,"bladeNumbers",[]);tt(this,"ip","");tt(this,"port","");tt(this,"selectedPrinter","");tt(this,"selectedSumma","");tt(this,"selectedBlade","");tt(this,"target","IP");this.registerTemplate("default",x2),this.addEventListener("mount",async()=>{const e=await getConfig();this.width=e.boardWidth,this.length=e.boardLenght,Ye.unitOfMeasure===3&&(this.width=this.width/2.54,this.length=this.length/2.54),this.plotterType=e.cut.target,this.ip=e.cut.network.ip,this.port=e.cut.network.port.toString(),this.selectedPrinter=e.cut.printer.name,this.selectedSumma=e.cut.summa.model,this.selectedBlade=e.cut.summa.blade,this.update()}),this.registerDependencyProperties(["width","length","plotterType","printerList","summaList","ip","port","selectedPrinter","selectedSuma","selectedBlade"])}}const x2=r=>Z(Re,null,Z(Hi,{debug:ur,root:!0,fullSize:!0,col:!0},Z("div",{style:{width:"100%",left:"0px",top:"40px",right:"0px",height:"50px",backgroundColor:"#CDE7F2",color:"black",fontSize:"15px",fontWeight:"bold",paddingLeft:"20px",display:"flex",flexDirection:"row",alignItems:"center"}},"General Settings"),Z(Hi,{debug:ur,size:1},Z(Hi,{debug:ur,col:!0,gap:20,padding:20,fixWidth:600},Z("div",{style:{border:"1px solid #094e6a",padding:"20px",borderRadius:"20px"}},Z("div",{style:{color:"black",fontSize:"15px",fontWeight:"bold"}},"Board"),Z("hr",{style:{borderTop:"1px solid #094e6a"}}),Z("span",null,"Define the default board size settings. Width is the size representing the  roll size. Length is the size representing the roll length."),Z(Hi,{debug:ur,row:!0,gap:10,style:{marginTop:"20px"}},Z(Hi,{debug:ur,gap:10,size:1},Z("span",null,"Width (",Ye.unitOfMeasure===3?"in":cm,")"),Z("input",{className:"settings",type:"text",style:{width:"80px"},value:r.width,onChange:async t=>{const e=Ye.unitOfMeasure;let i=Number(t.currentTarget.value),s=i;e===3&&(s=i*2.54),r.width=i;const n=await getConfig();n.boardWidth=s,setConfig(n),ve.boardWidth=s,Lt.emit(Kt.BoardSurface.onReloadConfig,{})}})),Z(Hi,{debug:ur,gap:10,size:1},Z("span",null,"Length (",Ye.unitOfMeasure===3?"in":cm,")"),Z("input",{className:"settings",type:"text",style:{width:"80px"},value:r.length,onChange:async t=>{const e=Ye.unitOfMeasure;let i=Number(t.currentTarget.value),s=i;e===3&&(s=i*2.54),r.length=i;const n=await getConfig();n.boardLenght=s,setConfig(n),ve.boardLenght=s,Lt.emit(Kt.BoardSurface.onReloadConfig,{})}}))),Z(Hi,{debug:ur,row:!0,gap:10,style:{marginTop:"20px"}},Z("span",null,"Unit of Measure")," : ",Ye.unitOfMeasure===3?"Imperial":"Metric")),Z(Hi,{size:1})),Z(Hi,{debug:ur,col:!0,gap:20,padding:20,size:1},Z("div",{style:{border:"1px solid #094e6a",padding:"20px",borderRadius:"20px"}},Z("div",{style:{color:"black",fontSize:"15px",fontWeight:"bold"}},"Cutting"),Z("hr",{style:{borderTop:"1px solid #094e6a"}}),Z("span",null,"Check this option if your plotter should be reach like a standard printer device"),Z(Hi,{debug:ur,row:!0,gap:10,style:{alignItems:"center",marginBottom:"30px",marginTop:"20px"}},Z("input",{type:"radio",radioGroup:"plotter",id:"printerPlotter",name:"plotter",value:"PRINTER",checked:r.plotterType==="PRINTER",onClick:async()=>{const t=await getConfig();t.cut.target="PRINTER",r.plotterType="PRINTER",setConfig(t)}}),Z("label",{htmlFor:"printerPlotter"},"Printer Plotter"),Z("div",{class:"select-container"},Z("select",{style:{width:"350px"},onChange:async t=>{const e=t.currentTarget.selectedOptions[0].value,i=await getConfig();i.cut.printer.name=e,r.selectedPrinter=e,setConfig(i)}},Z("option",{value:""},"Select a printer"),r.printerList.map(t=>Z("option",{value:t[0],selected:t[0]===r.selectedPrinter},t[1]))))),Z("hr",{style:{borderTop:"1px solid #094e6a"}}),Z("span",null,"Check this option if your plotter is a SUMA. Select the right option in the list."),Z(Hi,{debug:ur,row:!0,gap:10,style:{alignItems:"center",marginBottom:"30px",marginTop:"20px"}},Z("input",{type:"radio",radioGroup:"plotter",id:"sumaPlotter",name:"plotter",checked:r.plotterType==="SUMMA",value:"SUMMA",onClick:async()=>{const t=await getConfig();t.cut.target="SUMMA",r.plotterType="SUMMA",setConfig(t)}}),Z("label",{htmlFor:"sumaPlotter"},"Suma Plotter"),Z("div",{class:"select-container"},Z("select",{style:{width:"350px"},onChange:async t=>{const e=t.currentTarget.selectedOptions[0].value,i=await getConfig();i.cut.summa.model=e,setConfig(i)}},Z("option",{value:""},"Select a model"),r.summaList.map(t=>(console.log(t[0],r.selectedSumma),Z("option",{value:t[0],selected:t[0]===r.selectedSumma},t[1])))),Z("hr",null),Z("select",{style:{width:"350px"},onChange:async t=>{const e=t.currentTarget.selectedOptions[0].value,i=await getConfig();i.cut.summa.blade=e,setConfig(i)}},Z("option",{value:""},"Select a blade (Summa F only)"),r.bladeNumbers.map(t=>Z("option",{value:t[0],selected:t[0]===r.selectedBlade},t[1]))))),Z("hr",{style:{borderTop:"1px solid #094e6a"}}),Z("span",null,"Check this option if your plotter should be reach via the Network. Specify the IP adress and the port. If you do not have a port given in your documentation, 9100 may be the default one"),Z(Hi,{debug:ur,row:!0,gap:10,style:{alignItems:"center",marginBottom:"30px",marginTop:"20px"}},Z("input",{type:"radio",radioGroup:"plotter",id:"ipPlotter",name:"plotter",checked:r.plotterType==="IP",value:"IP",onClick:async()=>{const t=await getConfig();t.cut.target="IP",r.plotterType="IP",setConfig(t)}}),Z("label",{htmlFor:"ipPlotter"},"IP Plotter"),Z(Hi,{debug:ur,col:!0,gap:5},Z("label",{htmlFor:"ipAddress"},"IP"),Z("input",{className:"settings",type:"text",id:"ipAddress",style:{width:"150px"},value:r.ip,onChange:async t=>{r.ip=t.currentTarget.value;const e=await getConfig();e.cut.network.ip=r.ip,setConfig(e)}})),Z(Hi,{debug:ur,col:!0,gap:5},Z("label",{htmlFor:"port"},"Port"),Z("input",{type:"number",id:"port",className:"settings",style:{width:"80px"},value:r.port,onChange:async t=>{r.port=t.currentTarget.value;const e=await getConfig();e.cut.network.port=Number(r.port),setConfig(e)}}))))))));class b2 extends ri{constructor(){super("Projects");tt(this,"children",[]);tt(this,"items",[]);this.registerTemplate("default",w2);const e=this;this.addEventListener("mount",async function(){e.refresh()})}async refresh(){const e=this,i=Ie("tableProjects");i.rows=[],i.update();const s=(await Ce("userproject/projectstatus","GET",null)).payload;Ce("UserProject","get",null,!0).then(n=>{this.items=n.payload,Ti("bin","Delete",100),i.rows=n.payload.filter(o=>o.name.toLowerCase().indexOf(lh)!==-1||!lh).map((o,h)=>{const d=Ti("add-to-cut","Load the project",void 0,void 0,async()=>{console.log("Load the project",o.projectId,o.name),fr.id=o.projectId,fr.name=o.name;const v=Ie("btnSearch");Ie("searchresult").reset(),Ie("vehicleSearch").reset(),Ie("ddMake"),Ie("ddModel"),Ie("ddSubModel"),Ie("ddVersion"),Ie("ddYear"),Ie("ddRegion");let P=[];Ir.clear(),bi.images=[],bi.selections=[],bi.selectionsDisp=[],bi.shouldBeProcessed=!1;try{P=(await Ce("userproject/projectcarsearch/"+o.projectId,"GET",null,!0)).payload??[]}catch{Ir.clear(),Ie("btnSearch")}for(let M=0;M<P.length;M++){const z=P[M],q=await Ce("lookup/carmakes/0","GET",null),V=await Ce(`lookup/carmodels/${z.makeId}/0`,"GET",null),I=await Ce(`lookup/carseries/${z.modelId}/0`,"GET",null),Y=await Ce(`lookup/carversion/${z.seriesId}/0`,"GET",null),K=await Ce("lookup/years","GET",null),T=await Ce("lookup/patternregions","POST",{page:0,page_size:1e3,sort_column:"name",sort_order:"asc",search_text:"",filters:JSON.stringify([{key:"make_id",value:z.makeId},{key:"model_id",value:z.modelId},{key:"series_id",value:z.seriesId},{key:"version_id",value:z.versionId},{key:"year_id",value:z.yearId}])}),at=q.filter(ht=>ht.id===z.makeId)[0],ct=V.filter(ht=>ht.id===z.modelId)[0],pt=I.filter(ht=>ht.id===z.seriesId)[0],wt=Y.filter(ht=>ht.id===z.versionId)[0],It=K.filter(ht=>ht.id===z.yearId)[0];let bt=T.filter(ht=>ht.id===z.regionId)[0]??-1;const dt=`${at.name} - ${ct.name} - ${pt.name} - ${wt.name} - ${It.name} - ${bt.name}`;console.log("searchKey",dt),Ir.set(dt,{needReload:!0,searchId:z.searchId,payload:{productSearchRequest:{category_id:1,make_id:z.makeId,series_id:z.modelId,model_id:z.seriesId,year_id:z.yearId,version_id:z.versionId,region_id:z.regionId}}})}Lt.emit(je.ButtonBar.Click,{id:v.guid,name:v.name})}),p=Ti("white-triangle",s.filter(v=>v.id.toString()===o.statusId.toString())[0].statusName,100,!0,async()=>{const v=await KC();v&&(await Ce("userproject","put",{projectId:o.projectId,projectINewName:o.name,statusId:Number(v)},!0),e.refresh())}),m=Ti("bin","Delete",100,!1,async()=>{await Co("Deletion","Are you sure you want to delete this project?","Yes","No")==="ok"&&(await Ce("userproject?projectid="+o.projectId,"delete",{},!0),e.refresh(),await Qe("Deleted","The project has been deleted","Ok",500,210))});return[h+1,o.name,new Date(o.dateCreated).toLocaleDateString(),new Date(o.dateCreated).toLocaleTimeString(),p,[d,m]]}),this.update(),i.update()})}}const w2=r=>Z(Re,null,Z("div",{class:"filter-pane-top"},"Projects"),Z("div",{class:"filter-pane-empty",style:{marginBottom:"50px"}},Z("img",{src:"assets/btnCreateProject.png",style:{marginTop:"16px",marginLeft:"30px",height:"50px"},onClick:async()=>{const t=await Cd("New Project",`My Project ${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}`,"Create","Cancel");t&&(await Ce("userproject","post",{projectIName:t},!0),r.refresh())}}),S2("lens","Search",r)),r.children.map(t=>t.vdom));let lh="";const S2=(r,t,e)=>Z(Re,null,Z("div",{class:"filter-drop-down",style:{backgroundColor:"black",color:"white",minWidth:"300px",maxWidth:"300px",borderRadius:"10px",marginTop:"20px",marginLeft:"30px",display:"flex",justifyContent:"stretch",alignItems:"center"}},Z("input",{type:"text",defaultValue:"Search by board name",style:{fontWeight:"400",border:"none",backgroundColor:"black",height:"30px",flex:1,maxWidth:"235px",width:"50px",color:"white",fontSize:"20px",textAlign:"left",paddingLeft:"15px",borderRight:"1px solid #25A9E0"},onClick:i=>{i.currentTarget.value=lh},onKeyUp:async i=>{lh=i.currentTarget.value.toLowerCase(),e.refresh()}}),Z("div",{style:{backgroundImage:`url(assets/svg/${r}.svg)`,minWidth:"24px",minHeight:"24px",maxWidth:"24px",maxHeight:"24px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:"10px",right:"10px"}})));class C2 extends ri{constructor(){super("FilterField"),this.registerTemplate("default",E2)}}const E2=r=>Z(Re,null,Z("div",{class:"filter-drop-down",style:{backgroundColor:"black",color:"white",minWidth:"130px",maxWidth:"130px",borderRadius:"10px",marginTop:"20px",marginLeft:"30px"}},Z("div",{style:{backgroundImage:"url(assets/svg/filter.svg)",minWidth:"18px",minHeight:"18px",maxWidth:"18px",maxHeight:"18px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:"15px",left:"15px"}}),Z("span",{style:{fontWeight:"400"}},"Filters"),Z("div",{style:{backgroundImage:"url(assets/svg/white-triangle.svg)",minWidth:"18px",minHeight:"18px",maxWidth:"18px",maxHeight:"18px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"absolute",top:"15px",right:"10px"}}))),P2=203,T2=7;function I2(r){let t=P2;const e=new Uint8Array(r.length);for(let i=0;i<r.length;i++)e[i]=(r[i]-(t+=T2)+256)%256;return e}new TextEncoder;const A2=new TextDecoder;function M2(r,t=3){return JSON.parse(A2.decode(I2(r)))}function Wm(r){const[t,e,i,s,n,o]=r,h=Math.sqrt(t*t+e*e),d=Math.sqrt(i*i+s*s);let m=Math.acos(t/h)*180/Math.PI;return e<0&&(m=-m),(h===-1||d===-1)&&(m=180),{rotate:m,scaleX:h,scaleY:d,skewX:null,skewY:null,translateX:n,translateY:o}}function k2(r){const t=Math.PI/180*r,e=Math.cos(t),i=Math.sin(t);return[e,i,-i,e,0,0]}function R2(r,t){return[r,0,0,t,0,0]}function B2(r,t){return[1,0,0,1,r,t]}function L2(r,t=10){const e=Math.pow(10,t),i={};for(const[s,n]of Object.entries(r))typeof n=="number"?i[s]=Math.round(n*e)/e:i[s]=n;return i}function D2(r){const t=r.match(/(translate|rotate|scale|matrix)\(([^)]+)\)/g),e=[];for(const i of t){let s;if(i.startsWith("translate")){const[n,o]=i.slice(10,-1).split(/[\s,]+/).map(Number);s=B2(n,o)}else if(i.startsWith("rotate")){const n=Number(i.slice(7,-1));s=k2(n)}else if(i.startsWith("scale")){const[n,o=n]=i.slice(6,-1).split(/[\s,]+/).map(Number);s=R2(n,o)}else i.startsWith("matrix")&&(s=i.slice(7,-1).split(/[\s,]+/).map(Number));e.push(L2(Wm(s),5))}return e}function F2(r,t=15){if(t<0||t>100)throw new Error("Precision should be between 0 and 100.");const e=r.map(o=>o.clone());function i(o,h,d,p,m,v=!1){let b=[];b=[];const M=new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg"><path d='${h}' /></svg>`,"image/svg+xml").querySelector("path"),z=M.getTotalLength(),q=Math.max(2,Math.ceil(d/100*z));let V=M.getPointAtLength(0);for(let I=1;I<q-1;I++)V=M.getPointAtLength(z/(q-1)*I),b.push([V.x,V.y]);V=M.getPointAtLength(z),b.push([V.x,V.y]),b.push(b[0]),o.push(b)}const s=[];e.forEach(o=>o.setRelative(!1));const n=e.map(o=>o.paths.map(h=>h.asString()).join(" "));for(const o of n)try{i(s,o,t,0,0,!0)}catch{}return s}function O2(r){return console.log(r),r.paths.map(e=>{const i=new Ws(e.path);return i.paths.forEach(s=>{s instanceof Xr&&i.changeType(s,Tr.key),s instanceof Os&&i.changeType(s,qr.key),s instanceof kr&&i.changeType(s,Kr.key),s instanceof Mr&&i.changeType(s,Kr.key),i.refreshAbsolutePositions()}),N2(i,e.transform),i}).map(e=>{const i=new Ph;return i.addRawVector(e),i.widthInMm=r.widthInMm,i.heightInMm=r.heightInMm,i.widthInVu=r.widthInVu,i.heightInVu=r.heightInVu,i})}function N2(r,t){if(!t)return;let e=[];if(typeof t=="string"?e=D2(t):Array.isArray(t)?e=[Wm(t)]:e=[],e.length>0){const i=r;let s=0,n=0;e.forEach(o=>{o.rotate&&i.rotate(s+o.translateX,n+o.translateY,o.rotate),(o.scaleX!==1||o.scaleY!==1)&&i.scale(o.scaleX,o.scaleY),(o.translateX||o.translateY)&&(i.translate(o.translateX,o.translateY),s+=o.translateX,n+=o.translateY)})}}class Ph{constructor(){tt(this,"carColor",-1);tt(this,"carLegend","");tt(this,"widthInMm",0);tt(this,"heightInMm",0);tt(this,"widthInVu",0);tt(this,"serializedWidthInVu",0);tt(this,"heightInVu",0);tt(this,"serializedHeightInVu",0);tt(this,"isDocumentNormalized",!1);tt(this,"isItemListNormalized",!1);tt(this,"isItemsMerged",!1);tt(this,"rawVectors",[]);tt(this,"serializedRawVectors",[]);tt(this,"mergedRawVectors")}setDimensions({widthInMm:t,heightInMm:e,widthInVu:i,heightInVu:s}){this.widthInMm=t,this.heightInMm=e,this.widthInVu=i,this.heightInVu=s,this.serializedWidthInVu=i,this.serializedHeightInVu=s}serialize(){return{widthInMm:this.widthInMm,heightInMm:this.heightInMm,widthInVu:this.serializedWidthInVu,heightInVu:this.serializedHeightInVu,paths:this.serializedRawVectors}}serializeState(){return{widthInMm:this.widthInMm,heightInMm:this.heightInMm,widthInVu:this.widthInVu,heightInVu:this.heightInVu,isItemListNormalized:this.isItemListNormalized,isDocumentNormalized:this.isDocumentNormalized,paths:this.rawVectors.map(t=>t.asString())}}deSerialize(t){if(!t){this.widthInVu=this.serializedWidthInVu,this.heightInVu=this.serializedHeightInVu,this.rawVectors=this.serializedRawVectors.map(e=>new Ws(e));return}this.widthInMm=t.widthInMm,this.heightInMm=t.heightInMm,this.widthInVu=t.widthInVu,this.heightInVu=t.heightInVu,this.isItemListNormalized=t.isItemListNormalized,this.isDocumentNormalized=t.isDocumentNormalized,this.serializedWidthInVu=t.widthInVu,this.serializedHeightInVu=t.heightInVu,this.serializedRawVectors=t.paths,this.rawVectors=t.paths.map(e=>new Ws(e))}clone(){const t=new Ph;return t.widthInMm=this.widthInMm,t.heightInMm=this.heightInMm,t.widthInVu=this.widthInVu,t.heightInVu=this.heightInVu,t.serializedWidthInVu=this.serializedWidthInVu,t.serializedHeightInVu=this.serializedHeightInVu,t.rawVectors=this.rawVectors.map(e=>e.clone()),t.serializedRawVectors=this.serializedRawVectors.map(e=>e),t}addRawVector(t){typeof t=="string"&&(t=new Ws(t)),this.rawVectors.push(t),this.serializedRawVectors.push(t.asString())}get merged(){return this.mergedRawVectors??this.rawVectors[0]}normalizeDocument(){if(this.isDocumentNormalized)return;const t=this.widthInMm/this.widthInVu,e=this.heightInMm/this.heightInVu;this.rawVectors.forEach(i=>{i.scale(t,e)}),this.mergeItems(),this.widthInVu=this.widthInMm,this.heightInVu=this.heightInMm}normalizeItems(){if(this.isItemsMerged){if(this.isItemListNormalized)return;this.mergedRawVectors.normalize()}else this.rawVectors.forEach(t=>{+t.normalize()});this.isItemListNormalized=!0}mergeItems(){if(this.rawVectors.length===1){this.mergedRawVectors=this.rawVectors[0];return}const t=[];this.rawVectors.forEach((s,n)=>{s.paths.forEach(o=>{o.setRelative(!1)}),t.push(s.asString())});const e=new Ws(t.join(" "));t.length=0;let i=!0;e.paths.forEach(s=>{s instanceof Hs&&i?(s.setRelative(!1),i=!1):s.setRelative(!0)}),this.isItemsMerged=!0,this.mergedRawVectors=e}}function U2(r,t){let e=0;for(let i=0,s=t.length-1;i<t.length;s=i++){const n=t[i].x,o=t[i].y,h=t[s].x,d=t[s].y;o>r.y!=d>r.y&&r.x<(h-n)*(r.y-o)/(d-o)+n&&e++}return e%2!==0}function z2(r,t){for(const e of r)if(!U2(e,t))return!1;return!0}function G2(r){const t=[];for(let e=0;e<r.length;e++){let i=!1;for(let s=0;s<r.length;s++)if(e!==s&&z2(r[e],r[s])){const n=t.find(o=>o.polygon===r[s]);n?n.children.push({index:e,polygon:r[e],children:[]}):t.push({index:s,polygon:r[s],children:[{index:e,polygon:r[e],children:[]}]}),i=!0;break}!i&&!t.some(s=>s.polygon===r[e])&&t.push({index:e,polygon:r[e],children:[]})}return t}const Kc=Ed;Kc.setup(new Kc.Size(1e4,1e4));class Td{constructor(){tt(this,"_items",[])}clone(){const t=new Td;return t._items=this._items.map(e=>e.clone()),t}serialize(){return this._items.map(t=>t.serialize())}desiialize(t){this._items=t.map(e=>{const i=new Ph;return i.deSerialize(e),i})}async loadPatternDetail(t){const i=(await Ce(`pattern/precuttool/${t}`,"GET",null,!0)).payload.vector_image,s=atob(i),n=new Uint8Array(s.length);for(let y=0;y<s.length;y++)n[y]=s.charCodeAt(y);const o=M2(n);let h=O2(o);console.log("items",h);let d=0,p=0;h.forEach(y=>{const P=new Kc.Path(Fl.from(y.rawVectors[0].asString()).toString());d+=P.segments.length,P.clockwise=!0,p+=P.segments.length,y.rawVectors[0].rebuild(P.pathData)}),console.log("Pattern",t,"Points",d,"Optimized Points",p);const m=F2(h.map(y=>y.rawVectors[0]),5).map(y=>y.map(P=>new pi(P[0],P[1]))),v=G2(m),b=[];v.forEach(y=>{y.children.length>0&&b.push([y.index,...y.children.map(P=>P.index)])}),b.forEach(y=>{const P=h[y.shift()];y.forEach(M=>{P.rawVectors.push(h[M].rawVectors[0]),delete h[M]}),P.mergeItems()}),h=h.filter(y=>y),h.forEach(y=>{y.normalizeDocument()}),this._items=h}}const Du=new Map,xa={patternId:"",pattern:null,item:null};class V2 extends ri{constructor(){super("SearchResult");tt(this,"filterField",new C2);tt(this,"currentKey","");tt(this,"filter1","all");tt(this,"filter2","all");this.registerTemplate("default",H2),this.registerDependencyProperties(["currentKey","filter1","filter2"])}reset(){this.currentKey="",this.filter1="all",this.filter2="all",this.update()}}const H2=r=>{var e,i,s,n,o,h;const t=uv(Ir);return Z(Re,null,Z("div",{class:"filter-pane-top",style:{fontSize:"18px",overflowX:"visible",overflowY:"hidden",display:"flex",flexDirection:"row",gap:"10px"}},t.map((d,p)=>Z("div",{style:{flexGrow:0,flexShrink:0,border:"1px solid blue",borderRadius:"8px",textWrap:"nowrap",maxHeight:"40px",display:"flex",gap:"10px",alignItems:"center",paddingLeft:"5px",paddingRight:"5px",backgroundColor:r.currentKey===d.key?"#25a9e099":"white",color:r.currentKey===d.key?"white":"black"}},Z("span",{onClick:async()=>{r.currentKey=d.key;const m=d.key.split("-").map(v=>v.trim());if(Us.currentSearchIdx=p,Us.currentName=`${m[0]} ${m[1]} ${m[2]} ${m[4]}`,d.value.needReload){const v=d.value.searchId;d.value=await Ce("product/precuttool/productpages","POST",{category_id:d.value.payload.productSearchRequest.category_id,make_id:d.value.payload.productSearchRequest.make_id,series_id:d.value.payload.productSearchRequest.model_id,model_id:d.value.payload.productSearchRequest.series_id,year_id:d.value.payload.productSearchRequest.year_id,version_id:d.value.payload.productSearchRequest.version_id,region_id:d.value.payload.productSearchRequest.region_id,filters:{search_text:"",page:1,page_size:32,sort_column:"name",sort_order:"asc",filters:JSON.stringify([{key:"category_id",value:d.value.payload.productSearchRequest.category_id},{key:"make_id",value:d.value.payload.productSearchRequest.make_id},{key:"series_id",value:d.value.payload.productSearchRequest.model_id},{key:"model_id",value:d.value.payload.productSearchRequest.series_id},{key:"year_id",value:d.value.payload.productSearchRequest.year_id},{key:"version_id",value:d.value.payload.productSearchRequest.version_id},{key:"region_id",value:d.value.payload.productSearchRequest.region_id}]),user_id:localStorage.getItem("userId")}}),d.value.searchId=v}Ir.set(d.key,d.value),r.update()}},d.key),Z("div",{onClick:async()=>{Ir.delete(d.key),await Ce(`userproject/projectcarsearch/${d.value.searchId}`,"DELETE",{},!0),r.update()},style:{minWidth:24,minHeight:24,maxWidth:24,maxHeight:24,backgroundImage:"url(assets/svg/win-close.svg)",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}})))),Z("div",{class:"filter-pane-top",style:{fontSize:"20px",backgroundColor:"white"}},Z("div",{style:{display:"flex",gap:"10px",marginLeft:"35px",marginTop:"30px",fontSize:"20px",fontWeight:"100",color:"#25a9e0",paddingRight:"10px"}},Z("div",{onClick:()=>{r.filter1="all"},style:{color:r.filter1!=="all"?"#25a9e0":"#fff",backgroundColor:r.filter1==="all"?"#25a9e0":"#fff",border:"1px solid #25a9e0",minWidth:"100px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center"}},"All"),Z("div",{onClick:()=>{r.filter1="Interior"},style:{color:r.filter1!=="Interior"?"#25a9e0":"#fff",backgroundColor:r.filter1==="Interior"?"#25a9e0":"#fff",border:"1px solid #25a9e0",minWidth:"100px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center"}},"Interior"),Z("div",{onClick:()=>{r.filter1="Exterior"},style:{color:r.filter1!=="Exterior"?"#25a9e0":"#fff",backgroundColor:r.filter1==="Exterior"?"#25a9e0":"#fff",border:"1px solid #25a9e0",minWidth:"100px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center"}},"Exterior"),Z("div",{onClick:()=>{r.filter1="Tint"},style:{color:r.filter1!=="Tint"?"#25a9e0":"#fff",backgroundColor:r.filter1==="Tint"?"#25a9e0":"#fff",border:"1px solid #25a9e0",minWidth:"100px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center"}},"Tint"),Z("hr",null),Z("div",{onClick:()=>{r.filter2="all"},style:{color:r.filter2!=="all"?"#25a9e0":"#fff",backgroundColor:r.filter2==="all"?"#25a9e0":"#fff",border:"1px solid #25a9e0",minWidth:"100px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center"}},"All"),Z("div",{onClick:()=>{r.filter2="wrapped"},style:{color:r.filter2!=="wrapped"?"#25a9e0":"#fff",backgroundColor:r.filter2==="wrapped"?"#25a9e0":"#fff",border:"1px solid #25a9e0",minWidth:"100px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center"}},"Wrapped"),Z("div",{onClick:()=>{r.filter2="unwrapped"},style:{color:r.filter2!=="unwrapped"?"#25a9e0":"#fff",backgroundColor:r.filter2==="unwrapped"?"#25a9e0":"#fff",border:"1px solid #25a9e0",minWidth:"100px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center"}},"Unwrapped"))),Z("div",{style:{marginTop:"30px",marginLeft:"35px",display:"flex",gap:"30px",flexWrap:"wrap",justifyContent:"center",alignItems:"center"}},((s=(i=(e=Ir.get(r.currentKey))==null?void 0:e.payload)==null?void 0:i.precutpatternListResponse)==null?void 0:s.data.filter(d=>d.TypeName===r.filter1||r.filter1==="all").filter(d=>(d.Iswrapped===!0?"wrapped":"unwrapped")===r.filter2||r.filter2==="all").length)===0?Z("div",{style:{color:"#25a9e0",fontSize:"28px",fontWeight:"700",marginTop:"150px"}},"Patterns coming soon"):(h=(o=(n=Ir.get(r.currentKey))==null?void 0:n.payload)==null?void 0:o.precutpatternListResponse)==null?void 0:h.data.filter(d=>d.TypeName===r.filter1||r.filter1==="all").filter(d=>(d.Iswrapped===!0?"wrapped":"unwrapped")===r.filter2||r.filter2==="all").map(d=>Z("div",{style:{border:"1px solid #bcbcbc",borderRadius:"8px",margin:"5px",cursor:"pointer",minHeight:"400px",maxHeight:"400px",maxWidth:"400px",minWidth:"400px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"}},Z("img",{src:d.bitmap_image,style:{maxWidth:"calc(400px*0.6)",maxHeight:"calc(500px*0.6)"}}),Z("div",{style:{minWidth:"252px",maxWidth:"252px",minHeight:"52px",maxHeight:"52px",backgroundImage:"",position:"absolute",bottom:"25px"}},Hm("hamburger","Expand",async()=>{if(!Du.has(d.pattern_id)){const p=new Td;await p.loadPatternDetail(d.pattern_id),Du.set(d.pattern_id,p)}xa.patternId=d.pattern_id,xa.pattern=Du.get(d.pattern_id),xa.item=d,Lt.emit(je.ButtonBar.Click,{id:"selectItem",name:"selectItem"})})),Z("div",{style:{position:"absolute",top:"5px",fontSize:"x-large"}},d.name)))))};function bg(r,t,e){const i=Ks.create({width:r.screen.width,height:r.screen.height});e.render(t,{renderTexture:i});const n=e.extract.canvas(i).toDataURL("image/png");return i.destroy(!0),n}const $a=[4251856,65280,16711680,255,16776960,16711935,65535,0,16777215];let Sr=0;class W2 extends ri{constructor(){super("SelectPattern");tt(this,"stage",null);tt(this,"mainCtn",null);tt(this,"zoomInEvt",null);tt(this,"zoomOutEvt",null);tt(this,"addAllEvt",null);tt(this,"addSelectedEvt",null);tt(this,"onResize",null);this.registerTemplate("default",X2),this.addEventListener("unmount",()=>{var e,i,s,n,o;(e=this.zoomInEvt)==null||e.off(),(i=this.zoomOutEvt)==null||i.off(),(s=this.addAllEvt)==null||s.off(),(n=this.addSelectedEvt)==null||n.off(),(o=this.onResize)==null||o.off()}),this.addEventListener("mount",async()=>{const e=await Ea("#select-pattern-canvas");this.zoomInEvt=Lt.on(je.PatternSelection.zoomIn,()=>{i(_e.zoomFactor,.02)}),this.zoomOutEvt=Lt.on(je.PatternSelection.zoomOut,()=>{i(_e.zoomFactor,-.02)});function i(v,b){const y=v,P=b;_e.zoomFactor+=P,h.forEach(z=>{z.rebuild(),z.render()});const M={x:(p-n.x)/y,y:(m-n.y)/y};n.x=p-M.x*_e.zoomFactor,n.y=m-M.y*_e.zoomFactor}this.addAllEvt=Lt.on(je.PatternSelection.addAll,()=>{h.forEach(y=>{y.isSelected=!0});const v=bg(s,s.stage,s.renderer);bi.images.push(v),h.forEach((y,P)=>{y.isSelected&&(o._items[P].carColor=$a[Sr],o._items[P].carLegend=Us.currentName,bi.selections.push(o._items[P]))});const b={...xa.item,guid:ho(),name:Us.currentName};io.push(b),bi.shouldBeProcessed=!0,console.log("ADDING ALL",bi),Ie("cutPreview").update(),Sr++,Sr=Sr%$a.length}),this.addSelectedEvt=Lt.on(je.PatternSelection.addSelected,()=>{const v=bg(s,s.stage,s.renderer);bi.images.push(v);let b=!1;if(h.forEach((P,M)=>{P.isSelected&&(b=!0,o._items[M].carColor=$a[Sr],o._items[M].carLegend=Us.currentName,bi.selections.push(o._items[M]))}),!b){Sr++,Sr=Sr%$a.length;return}bi.shouldBeProcessed=!0;const y={...xa.item,guid:ho(),name:Us.currentName};io.push(y),Ie("cutPreview").update(),Sr++,Sr=Sr%$a.length});const s=new bh({background:"#ffffff",antialias:!0,autoDensity:!0,view:e});window.searchApp=s,s.resizeTo=e.parentElement;const n=new Ui;s.stage.addChild(n);const o=xa.pattern.clone(),h=o._items.map(v=>(v.mergeItems(),new Yc(v.merged)));_e.zoomFactor=.2,h.forEach(v=>{n.addChild(v.getContainer()),v.getContainer().interactive=!0,v.rebuild(),v.render(),v.getContainer().onclick=b=>{console.log("CLICKED"),v.isSelected=!v.isSelected}});let d=!1,p=0,m=0;s.render(),s.stage.eventMode="static",s.stage.hitArea=s.screen,s.stage.onpointerdown=v=>{console.log("MOUSE DOWN",v.bubbles),v.button===2&&(d=!0,p=v.data.global.x,m=v.data.global.y)},s.stage.on("mouseupoutside",()=>{d=!1}),window.addEventListener("mouseup",v=>{v.button!==2&&(d=!1)}),s.stage.on("wheel",v=>{const b=v.deltaY>0;Lt.emit(b?je.PatternSelection.zoomIn:je.PatternSelection.zoomOut)}),s.stage.onpointerupoutside=v=>{d=!1},s.stage.onpointerup=v=>{console.log("MOUSE UP",v.button),v.button===2&&(d=!1)},s.stage.onmousemove=v=>{if(d){if(p===0&&m===0){p=v.data.global.x,m=v.data.global.y;return}const b=v.data.global.x,y=v.data.global.y,P=b-p,M=y-m;n.x+=P,n.y+=M,p=b,m=y}}})}}const X2=r=>Z(Re,null,Z("div",{style:{backgroundColor:"",flex:"1",display:"flex",overflow:"hidden"}},Z("canvas",{id:"select-pattern-canvas",width:"800",height:"600"})));class nr extends ri{constructor(){super("IconCmp");tt(this,"width",24);tt(this,"height",24);tt(this,"name","add-all-to-board");tt(this,"type","svg");this.registerTemplate("default",j2),this.registerDependencyProperties(["width","height","name"])}}const j2=r=>Z(Re,null,Z("div",{style:{minWidth:r.width,minHeight:r.height,maxWidth:r.width,maxHeight:r.height,backgroundImage:`url(assets/${r.type}/${r.name}.${r.type})`,backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}}));class $2 extends ri{constructor(){super("SelectPatternToolbar");tt(this,"goToSearch",new nr);tt(this,"addAllToBoard",new nr);tt(this,"addSelectedToBoard",new nr);tt(this,"zoomIn",new nr);tt(this,"zoomOut",new nr);tt(this,"leftClick",new nr);tt(this,"rightPress",new nr);tt(this,"scrolling",new nr);this.registerTemplate("default",Y2),this.goToSearch.name="lens",this.addAllToBoard.name="add-all-to-board",this.addSelectedToBoard.name="add-to-board",this.zoomIn.name="zoom-in",this.zoomOut.name="zoom-out",this.leftClick.name="left-click",this.rightPress.name="right-press",this.scrolling.name="scrolling",this.goToSearch.width=48,this.goToSearch.height=48,this.addAllToBoard.width=48,this.addAllToBoard.height=48,this.addSelectedToBoard.width=48,this.addSelectedToBoard.height=48,this.zoomIn.width=48,this.zoomIn.height=48,this.zoomOut.width=48,this.zoomOut.height=48,this.leftClick.width=48,this.leftClick.height=48,this.rightPress.width=48,this.rightPress.height=48,this.scrolling.width=48,this.scrolling.height=48,this.leftClick.type="png",this.rightPress.type="png",this.scrolling.type="png"}}const Y2=r=>Z(Re,null,Z("div",{style:{paddingBottom:0,padding:25,display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:35,flex:0,backgroundColor:"#dbdbdb"}},Z("div",{style:{cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600},onClick:()=>{const t=Ie("btnSearch");Lt.emit(je.ButtonBar.Click,{id:t.guid,name:t.name})}},r.goToSearch.vdom,Z("span",null,"Go back to search")),Z("div",{style:{cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600},onClick:()=>{Lt.emit(je.PatternSelection.addAll)}},r.addAllToBoard.vdom,Z("span",null,"Add All")),Z("div",{style:{cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600},onClick:()=>{Lt.emit(je.PatternSelection.addSelected)}},r.addSelectedToBoard.vdom,Z("span",null,"Add Selected")),Z("div",{style:{cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600},onClick:()=>{Lt.emit(je.PatternSelection.zoomIn)}},r.zoomIn.vdom,Z("span",null,"Zoom In")),Z("div",{style:{cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600},onClick:()=>{Lt.emit(je.PatternSelection.zoomOut)}},r.zoomOut.vdom,Z("span",null,"Zoom Out"))),Z("div",{style:{paddingTop:0,padding:25,display:"flex",flexDirection:"row",justifyContent:"flex-start",gap:35,flex:0,backgroundColor:"#dbdbdb"}},Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600}},r.leftClick.vdom,Z("span",null,"Left click to select / deselect an element")),Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600}},r.rightPress.vdom,Z("span",null,"Moving the mouse while pressing right button to move the area")),Z("div",{style:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",gap:3,fontWeight:600}},r.scrolling.vdom,Z("span",null,"Mouse wheel to zoom"))));class Id extends ri{constructor(){super("Table");tt(this,"columns",[]);tt(this,"rows",[]);tt(this,"fontSize","18px");this.registerTemplate("default",q2)}}const q2=r=>{var i,s;const t=r.columns.map((n,o)=>Z("div",{key:o,style:{flex:n.size,display:"flex",justifyContent:"flex-start",alignItems:"center",padding:"10px",fontSize:"20px",fontWeight:"bold"}},n.title)),e=(s=(i=r.rows)==null?void 0:i.map)==null?void 0:s.call(i,(n,o)=>{var h,d;return Z("div",{class:"table-hover",key:o,style:{flex:((d=(h=t[o])==null?void 0:h.props)==null?void 0:d.size)||1,display:"flex",flexDirection:"row",borderBottom:"1px solid #25A9E055",justifyContent:"flex-start",alignItems:"center",maxHeight:"50px"}},n.map((p,m)=>Z("div",{key:m,style:{flex:r.columns[m].size,display:"flex",justifyContent:"flex-start",alignItems:"center",padding:"10px",fontSize:r.fontSize}},p)))});return Z(Re,null,Z("div",{style:{flex:"1",display:"flex",flexDirection:"row",maxHeight:"50px"}},t),e)};class Un extends ri{constructor(){super("ButtonBar");tt(this,"name","add-all-to-board");tt(this,"icon",new nr);tt(this,"text","");tt(this,"selected",!1);tt(this,"isRoot",!1);tt(this,"notImplemented",!1);this.registerTemplate("default",Z2),this.registerDependencyProperties(["name","text","selected"]),this.icon.width=42,this.icon.height=42}}const Z2=r=>{r.icon.name=r.name;let t={};return r.isRoot&&(t={height:"130px"}),Z(Re,null,Z("div",null,Z("div",{class:"button-bar",style:{...t},onClick:()=>{r.isRoot||(r.selected=!0,Lt.emit(je.ButtonBar.Click,{id:r.guid,name:r.name}),r.notImplemented&&(Qe("Not Implemented","This feature is not implemented yet","Ok",500,210),Lt.emit(je.ButtonBar.Click,{id:"",name:""})))}},Z("div",{class:`button-bar ${r.selected?"selected":""}`,style:{position:"absolute"}}),Z("div",{class:"icon",style:{zIndex:200}},r.icon.vdom),Z("div",{class:"text",style:{zIndex:200}},r.text))))};class K2 extends ri{constructor(){super("Button");tt(this,"text");tt(this,"onClick");tt(this,"isDisabled",!1);this.registerTemplate("default",Q2),this.registerDependencyProperties(["text","isDisabled"])}}const Q2=r=>Z(Re,null,Z("div",{class:"filter-drop-down",style:{backgroundColor:"#25A8DF",opacity:r.isDisabled?.3:1},onClick:()=>{var t;return!r.isDisabled&&((t=r.onClick)==null?void 0:t.call(r))}},Z("span",{style:{fontWeight:"500",color:"white",cursor:"pointer"}},r.text)));class J2 extends ri{constructor(){super("FilterPane");tt(this,"ddCategory",new Bs);tt(this,"ddMake",new Bs);tt(this,"ddModel",new Bs);tt(this,"ddSubModel",new Bs);tt(this,"ddVersion",new Bs);tt(this,"ddYear",new Bs);tt(this,"ddRegion",new Bs);tt(this,"btnShowVehicle",new K2);this.registerTemplate("default",tP),this.init()}reset(){this.ddMake.isDisabled=!0,this.ddModel.isDisabled=!0,this.ddSubModel.isDisabled=!0,this.ddVersion.isDisabled=!0,this.ddYear.isDisabled=!0,this.ddRegion.isDisabled=!0,this.ddCategory.items=[{id:1,name:"Automobile"}],this.ddMake.reset(),this.ddModel.reset(),this.ddSubModel.reset(),this.ddVersion.reset(),this.ddYear.reset(),this.ddRegion.reset()}init(){yi({key:"ddCategory",data:this.ddCategory}),yi({key:"ddMake",data:this.ddMake}),yi({key:"ddModel",data:this.ddModel}),yi({key:"ddSubModel",data:this.ddSubModel}),yi({key:"ddVersion",data:this.ddVersion}),yi({key:"ddYear",data:this.ddYear}),yi({key:"ddRegion",data:this.ddRegion}),yi({key:"btnShowVehicle",data:this.btnShowVehicle})}}const tP=r=>Z(Re,null,Z("div",{class:"filter-pane-top"},"Search Vehicle"),Z("div",{class:"filter-pane-line"},r.ddCategory.vdom,r.ddMake.vdom,r.ddModel.vdom,r.ddSubModel.vdom),Z("div",{class:"filter-pane-line"},r.ddVersion.vdom,r.ddYear.vdom,r.ddRegion.vdom,r.btnShowVehicle.vdom)),Eo=new ov("mm",{white:"#FFFFFF",black:"#000000",blue100:"#25A8DF"},{"bar-background":{color:"var(--mm-ref-black)"},"icon-background":{color:"var(--mm-ref-blue100)"}},{"left-bar":{bg:"var(--mm-sys-bar-background-color)",size:"140px"},"top-bar":{bg:"var(--mm-sys-bar-background-color)",size:"40px","expanded-size":"60px"},ButtonBar:{position:"relative",width:"134px",height:"108px",text:{color:"var(--mm-ref-white)"},selected:{bg:"#094e6a",radius:"15px"}}});Eo.addCssSheet("main",`
  .left-bar {
    background-color : var(--mm-cmp-left-bar-bg);
    width            : var(--mm-cmp-left-bar-size);
    display          : flex;
    flex-direction   : column;
    align-items      : center;
    justify-content  : flex-start;
    position         : fixed;
    top              : 0;
    left             : 0;
    bottom           : 0;
    z-index          : 100;
    overflow-x       : hidden;
    overflow-y       : auto;
  }

  .left-bar::-webkit-scrollbar {
    width : 0px;
  }

  .top-bar {
    background-color : var(--mm-cmp-top-bar-bg);
    height           : var(--mm-cmp-top-bar-size);
    display          : flex;
    flex-direction   : row;
    align-items      : center;
    justify-content  : space-between;
    position         : fixed;
    top              : 0;
    left             : var(--mm-cmp-left-bar-size);
    right            : 0;
    z-index          : 100;
  }

  .top-bar.expanded {
    height : var(--mm-cmp-top-bar-expanded-size);
  }

  .button-bar {
    position        : var(--mm-cmp-ButtonBar-position);
    width           : var(--mm-cmp-ButtonBar-width);
    height          : var(--mm-cmp-ButtonBar-height);
    display         : flex;
    flex-direction  : column;
    align-items     : center;
    justify-content : center;
  }

  .button-bar .text {
    color : var(--mm-cmp-ButtonBar-text-color);
  }

  .button-bar.selected {
    position         : fixed;
    background-color : var(--mm-cmp-ButtonBar-selected-bg);
    border-radius    : var(--mm-cmp-ButtonBar-selected-radius);
    animation        : fadeInOpacity 0.2s ease-in-out forwards;
  }

  @keyframes fadeInOpacity {
    from { opacity: 0; }
    to   { opacity: 1; }
  }

  .main-panel {
    position        : fixed;
    top             : var(--mm-cmp-top-bar-size);
    left            : var(--mm-cmp-left-bar-size);
    right           : 0;
    bottom          : 0;
    z-index         : 0;
    display         : flex;
    flex-direction  : column;
    justify-content : flex-start;
    align-items     : stretch;
  }

  .top-pane {
    min-height       : 205px;
    max-height       : 205px;
    display          : flex;
    flex-direction   : column;
    justify-content  : stretch;
    align-items      : stretch;
  }

  .sub-panel {
    flex            : 1;
    display         : flex;
    flex-direction  : row;
    justify-content : space-between;
    align-items     : stretch;
  }

  .left-pane {
    flex             : 2;
    overflow-y       : visible;
    overflow-x       : hidden;
    max-height       : calc(100vh - 245px);
    display          : flex;
    flex-direction   : column;
    justify-content  : flex-start;
    align-items      : stretch;
  }

  /* make it green */
  .left-pane::-webkit-scrollbar {
    background-color : #E7E7E7;
    width : 20px;
  }

  .left-pane::-webkit-scrollbar-thumb {
    background-color : #25A9E0;
  }

   /* make it green */
   div::-webkit-scrollbar {
    background-color : #E7E7E7;
    width : 20px;
  }

  div::-webkit-scrollbar-thumb {
    background-color : #25A9E0;
  }


  .right-pane {
    flex             : 1;
    overflow-y       : visible;
    overflow-x       : hidden;
    max-height       : calc(100vh - 245px);
    display          : flex;
    flex-direction   : column;
    justify-content  : flex-start;
    align-items      : stretch;
  }

  /* make it green */
  .right-pane::-webkit-scrollbar {
    background-color : #E7E7E7;
    width : 20px;
  }

  .right-pane::-webkit-scrollbar-thumb {
    background-color : #25A9E0;
  }

  .max-pane {
    flex             : 1;
    overflow-y       : visible;
    overflow-x       : hidden;
    max-height       : calc(100vh - 40px);
    display          : flex;
    flex-direction   : column;
    justify-content  : flex-start;
    align-items      : stretch;
  }

  .filter-pane-top {
    flex             : 1;
    min-height       : 45px;
    max-height       : 65px;
    background-color : #CDE7F2;
    color            : #000000;
    font-size        : 24px;
    font-weight      : bold;
    padding-left     : 10px;
    line-height      : 45px;
  }

    /* make it green */
    .filter-pane-top::-webkit-scrollbar {
    background-color : #E7E7E7;
    width : 20px;
  }

  .filter-pane-top::-webkit-scrollbar-thumb {
    background-color : #25A9E0;
  }

  .filter-pane-empty {
    flex             : 1;
    min-height       : 45px;
    max-height       : 45px;
    color            : #000000;
    font-size        : 24px;
    font-weight      : bold;
    padding-left     : 10px;
    line-height      : 45px;
    display          : flex;
    flex-direction   : row;
    justify-content  : flex-start;
  }

  .filter-pane-line {
    flex             : 1;
    display          : flex;
    flex-direction   : row;
    justify-content  : space-evenly;
    align-items      : center;
    padding-left     : 10px;
  }

  .filter-drop-down {
    flex             : 1;
    min-width        : 160px;
    max-width        : 250px;
    min-height       : 45px;
    max-height       : 45px;
    border-radius    : 25px;
    line-height      : 45px;
    text-align       : center;
    background-color : #CDE7F2;
    position         : relative;
    cursor           : pointer;
    margin-left       : 10px;
    margin-right      : 10px;
  }

  .filter-drop-down-list::-webkit-scrollbar {
    background-color : #E7E7E7;
    width : 20px;
  }

  .filter-drop-down-list::-webkit-scrollbar-thumb {
    background-color : #CDE7F2;
  }


  .filter-drop-down-list {
    position         : absolute;
    top              : 45px;
    left             : 0;
    right            : 0;
    background-color : #FFFFFF;
    border-radius    : 25px;
    box-shadow       : 0 0 10px 0 rgba(0,0,0,0.1);
    z-index          : 1000;
    overflow-y       : auto;
    max-height       : 200px;
  }

  .filter-drop-down-item {
    min-height       : 45px;
    max-height       : 45px;
    line-height      : 45px;
    text-align       : center;
    cursor           : pointer;
  }

  .filter-drop-down-item:hover {
    background-color : #CDE7F2;
    border-radius    : 25px;
  }

  .cut-pane-top {
    flex             : 1;
    min-height       : 65px;
    max-height       : 65px;
    background-color : #000000;
    color            : #FFFFFF;
    font-size        : 24px;
    font-weight      : 400;
    padding-left     : 10px;
    line-height      : 45px;
    display          : flex;
    flex-direction   : row;
    justify-content  : space-between;
    align-items      : center;
  }

  .table-hover {
    background-color : #FFFFFF;
    color            : #000000;
  }

  .table-hover:hover {
    background-color : #CDE7F2;
    color            : #2DABE0;
  }

`);Eo.targetShadowRoot=!1;class Xm extends ri{constructor(){super("MainFrame");tt(this,"theme","");tt(this,"children",[]);this.registerTemplate("default",eP)}}const eP=r=>Z(Re,null,Z("div",{class:`${r.theme} mm main-frame`},r.children.map(t=>t.vdom)));Xm.registerSystemDesign(Eo);class iP extends ri{constructor(){super("Profile");tt(this,"icon",new nr);this.registerTemplate("default",rP),this.icon.width=90,this.icon.height=90,this.icon.name="logo"}}const rP=r=>Z(Re,null,Z("div",{class:"profile",style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"30px",marginBottom:"55px"},onClick:()=>{Lt.emit(je.ButtonBar.Click,{id:r.guid,name:"profile"})}},r.icon.vdom,Z("div",{style:{color:"white",fontSize:"19px"}},"Profile")));class jm extends ri{constructor(){super("LeftBar");tt(this,"children",[]);tt(this,"profile",new iP);tt(this,"brand",new nr);this.registerTemplate("default",sP),this.registerDependencyProperties(["children"]);let e=null;this.addEventListener("mount",()=>{e=Lt.on(je.ButtonBar.Click,i=>{this.children.forEach(s=>{s.guid!==i.id&&(s.selected=!1)})})}),this.addEventListener("unmount",()=>{e.off()}),this.brand.name="brand",this.brand.width=108,this.brand.height=20}}const sP=r=>Z(Re,null,Z("div",{class:"left-bar"},Z("div",{style:{flex:1,overflowY:"auto"}},r.children.map((t,e)=>[e>0&&Z("hr",{style:{width:"70%",minHeight:"1px",border:"none",backgroundColor:"var(--mm-ref-blue100)",marginTop:"0px",padding:"0",marginBottom:"0px"}}),t.vdom,e===r.children.length-1&&Z("hr",{style:{width:"70%",minHeight:"1px",border:"none",backgroundColor:"var(--mm-ref-blue100)",marginTop:"0px",padding:"0"}})]),r.profile.vdom,Z("div",{style:{marginBottom:"15px",marginLeft:"calc((140px - 108px) / 2)"}},r.brand.vdom))));jm.registerSystemDesign(Eo);class nP extends ri{constructor(){super("MainPanel");tt(this,"topPanel");tt(this,"leftPanel");tt(this,"rightPanel");tt(this,"maxPanel");this.registerTemplate("default",aP),this.registerTemplate("3Panes",oP),this.setState("3Panes")}}const aP=r=>{var t;return Z(Re,null,Z("div",{class:"main-panel"},Z("div",{class:"max-pane"},(t=r.maxPanel)==null?void 0:t.vdom)))},oP=r=>{var t,e,i;return Z(Re,null,Z("div",{class:"main-panel"},Z("div",{class:"top-pane"},(t=r.topPanel)==null?void 0:t.vdom),Z("div",{class:"sub-panel"},Z("div",{class:"left-pane"},(e=r.leftPanel)==null?void 0:e.vdom),Z("div",{class:"right-pane"},(i=r.rightPanel)==null?void 0:i.vdom))))};class $m extends ri{constructor(){super("TopBar");tt(this,"icoMinimize",new nr);tt(this,"icoMaximize",new nr);tt(this,"icoClose",new nr);tt(this,"isMaximized",!1);tt(this,"isExpanded",!1);this.registerTemplate("default",lP),this.registerDependencyProperties(["isExpanded"]),this.icoMinimize.width=25,this.icoMinimize.height=25,this.icoMinimize.name="win-minor",this.icoMaximize.width=25,this.icoMaximize.height=25,this.icoMaximize.name="win-maximize",this.icoClose.width=25,this.icoClose.height=25,this.icoClose.name="win-close"}}const lP=r=>Z(Re,null,Z("div",{class:`top-bar ${r.isExpanded&&"expanded"}`},r.isExpanded&&Z("div",{style:{minWidth:"580px",height:"100%",backgroundColor:"#cccccc11",display:"flex",flexDirection:"row",justifyContent:"flex-start"}},Ji("tb-cut","Cut",async()=>{Lt.emit(Kt.BoardSurface.onCutCommand)}),Ji("tb-nesting","Nesting",async()=>{Lt.emit(Kt.BoardSurface.onAskForNesting)}),Ji("tb-save","Save Board",async()=>{const t=Ie("cutBoard"),e=t.boardSurface.items.filter(h=>h._type==="ITEM");if(e.length===0){Qe("Empty Board","There are no items on the board to save");return}const i=e.map(h=>({zoomLevel:h.zoomLevel,angle:h.angle,x:h.rawX,y:h.rawY,originalPath:h.originalPaths,normalizePaths:h.normalizedPaths,workingPaths:h.workingPaths,carColor:h._carColor}));i.push(cv(t.boardSurface.legends));const s=btoa(JSON.stringify(i)),n=await Cd("Name your board",`My Board ${new Date().toLocaleDateString()}-${new Date().toLocaleTimeString()}`,"OK","Cancel"),o={vector_image:s,name:n};fr.id!==""&&(o.projectId=fr.id),await Ce("userboard","post",o,!0),await Qe("Added","The board has been created, you can reload it from the 'Saved Boards' section")}),Ji("tb-overlap","Overlap",()=>{Lt.emit(Kt.Item.onCheckCollisions)}),Ji("tb-undo","Undo",()=>{Lt.emit(Kt.BoardSurface.onUndo)}),Ji("tb-redo","Redo",()=>{Lt.emit(Kt.BoardSurface.onRedo)}),Ji("tb-rotate","Rotate",async()=>{Lt.emit(Kt.BoardSurface.onRotate)}),Ji("tb-zoom-in","Zoom In",()=>Lt.emit(Kt.BoardSurface.zoomIn)),Ji("tb-zoom-out","Zoom Out",()=>Lt.emit(Kt.BoardSurface.zoomOut)),Ji("tb-partial-wrap","Partial Wrap",()=>Lt.emit(Kt.Item.onEnterWrapEdit)),Ji("tb-split","Split",()=>Lt.emit(Kt.Item.onEnterSplitEdit)),Ji("tb-nodes","Nodes",()=>{console.log("Nodes"),Lt.emit(Kt.Item.onEnterEdit)}),Ji("tb-cut","Outward",async()=>{Lt.emit(Kt.BoardSurface.onOutward)}),Ji("tb-remove-sub-patterns","Sub Pattern",()=>{Lt.emit(Kt.Item.onEnterSubPatternRemove)}),Ji("tb-material","Toggle Material",()=>{Lt.emit(Kt.BoardSurface.onToggleMaterialusage)})),Z("div",{class:"dragbar",style:{flex:1,height:"100%",webkitAppRegion:"drag"}}),Z("div",{style:{flex:1,minWidth:"120px",maxWidth:"120px",height:"100%",display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center",marginRight:"10px"}},Z("div",{style:{cursor:"pointer"},onClick:()=>window.minimize()},r.icoMinimize.vdom),Z("div",{style:{cursor:"pointer"},onClick:()=>{window.maximize()}},r.icoMaximize.vdom),Z("div",{style:{cursor:"pointer"},onClick:()=>window.close()},r.icoClose.vdom)))),Ji=(r,t,e)=>Z("div",{onClick:e,style:{minWidth:"60px",maxWidth:"60px",display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center",borderRight:"1px solid #25A9E0",paddingRight:"7px",paddingLeft:"7px",cursor:"pointer",textAlign:"center"}},Z("div",{style:{backgroundImage:`url(assets/svg/${r}.svg)`,minWidth:"20px",minHeight:"20px",maxWidth:"20px",maxHeight:"20px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}}),Z("span",{style:{fontWeight:"400",fontSize:"12px",color:"#25A9E0"}},t));$m.registerSystemDesign(Eo);async function hP(){const r=Ie("ddCategory");r.title="Select a Category",r.itemLabel="name",r.onSelect=d=>{console.log("Category selected",d)};const t=Ie("ddMake");t.title="Select a Make",t.itemLabel="name",t.onSelect=d=>{console.log("Make selected",d)};const e=Ie("ddModel");e.title="Select a Model",e.itemLabel="name",e.onSelect=d=>{console.log("Model selected",d)};const i=Ie("ddSubModel");i.title="Select a SubModel",i.itemLabel="name",i.onSelect=d=>{console.log("SubModel selected",d)};const s=Ie("ddVersion");s.title="Select a Version",s.itemLabel="name",s.onSelect=d=>{console.log("Version selected",d)};const n=Ie("ddYear");n.title="Select a Year",n.itemLabel="name",n.onSelect=d=>{console.log("Year selected",d)};const o=Ie("ddRegion");o.title="Select a Region",o.itemLabel="name",o.onSelect=d=>{console.log("Region selected",d)};const h=Ie("btnShowVehicle");h.text="Show Vehicle",h.isDisabled=!0,r.reset(),t.reset(),e.reset(),i.reset(),s.reset(),n.reset(),o.reset(),t.isDisabled=!0,e.isDisabled=!0,i.isDisabled=!0,s.isDisabled=!0,n.isDisabled=!0,o.isDisabled=!0,r.items=[{id:1,name:"Automobile"}],r.onSelect=async d=>{const p=await Ce("lookup/carmakes/0","GET",null);t.items=p,t.isDisabled=!1,e.reset(),e.isDisabled=!0,i.reset(),i.isDisabled=!0,s.reset(),s.isDisabled=!0,n.reset(),n.isDisabled=!0,o.reset(),o.isDisabled=!0},t.onSelect=async d=>{const p=await Ce("lookup/carmodels/"+t.selectedItem.id+"/0","GET",null);e.reset(),e.items=p,e.isDisabled=!1,i.reset(),i.isDisabled=!0,s.reset(),s.isDisabled=!0,n.reset(),n.isDisabled=!0,o.reset(),o.isDisabled=!0},e.onSelect=async d=>{const p=await Ce("lookup/carseries/"+e.selectedItem.id+"/0","GET",null);i.reset(),i.items=p,i.isDisabled=!1,s.reset(),s.isDisabled=!0,n.reset(),n.isDisabled=!0,o.reset(),o.isDisabled=!0},i.onSelect=async d=>{const p=await Ce("lookup/carversion/"+i.selectedItem.id+"/0","GET",null);s.reset(),s.items=p,s.isDisabled=!1,n.reset(),n.isDisabled=!0,o.reset(),o.isDisabled=!0},s.onSelect=async d=>{const p=await Ce("lookup/caryear/"+s.selectedItem.id,"GET",null);n.items=p,console.log(e.selectedItem.id),n.isDisabled=!1},n.onSelect=async d=>{const p=await Ce("lookup/patternregions","POST",{page:0,page_size:1e3,sort_column:"name",sort_order:"asc",search_text:"",filters:JSON.stringify([{key:"make_id",value:t.selectedItem.id},{key:"model_id",value:e.selectedItem.id},{key:"series_id",value:i.selectedItem.id},{key:"version_id",value:s.selectedItem.id},{key:"year_id",value:n.selectedItem.id}])});o.reset(),o.items=p.map(m=>(m.id===12&&(m.id=-1),m)),o.isDisabled=!1,h.isDisabled=!1},o.onSelect=async d=>{h.isDisabled=!1},h.onClick=async()=>{var m,v,b,y,P;const d=await Ce("product/precuttool/productpages","POST",{category_id:r.selectedItem.id,make_id:t.selectedItem.id,series_id:i.selectedItem.id,model_id:e.selectedItem.id,year_id:n.selectedItem.id,version_id:s.selectedItem.id,region_id:((m=o.selectedItem)==null?void 0:m.id)??-1,filters:{search_text:"",page:1,page_size:32,sort_column:"name",sort_order:"asc",filters:JSON.stringify([{key:"category_id",value:r.selectedItem.id},{key:"make_id",value:t.selectedItem.id},{key:"series_id",value:i.selectedItem.id},{key:"model_id",value:e.selectedItem.id},{key:"year_id",value:n.selectedItem.id},{key:"version_id",value:s.selectedItem.id},{key:"region_id",value:((v=o.selectedItem)==null?void 0:v.id)??-1}]),user_id:localStorage.getItem("user")}}),p=`${t.selectedItem.name} - ${e.selectedItem.name} - ${i.selectedItem.name} - ${s.selectedItem.name} - ${n.selectedItem.name} - ${((b=o.selectedItem)==null?void 0:b.name)??""}`;if(Us.currentSearchIdx=Ir.size,Us.currentName=`${t.selectedItem.name} ${e.selectedItem.name} ${i.selectedItem.name} ${s.selectedItem.name} ${n.selectedItem.name} ${((y=o.selectedItem)==null?void 0:y.name)??""}`,Ir.set(p,d),Ie("searchresult").currentKey=p,Ie("searchresult").update(),fr.id!==""){const M=await Ce("userproject/projectcarsearch","POST",{projectId:fr.id,categoryId:r.selectedItem.id,makeId:t.selectedItem.id,yearId:n.selectedItem.id,modelId:e.selectedItem.id,seriesId:i.selectedItem.id,versionId:s.selectedItem.id,regionId:((P=o.selectedItem)==null?void 0:P.id)??-1});console.log("Project Cut",M)}}}var Ym={exports:{}};(function(r){(function(){function t(h,d){var p=h.x-d.x,m=h.y-d.y;return p*p+m*m}function e(h,d,p){var m=d.x,v=d.y,b=p.x-m,y=p.y-v;if(b!==0||y!==0){var P=((h.x-m)*b+(h.y-v)*y)/(b*b+y*y);P>1?(m=p.x,v=p.y):P>0&&(m+=b*P,v+=y*P)}return b=h.x-m,y=h.y-v,b*b+y*y}function i(h,d){for(var p=h[0],m=[p],v,b=1,y=h.length;b<y;b++)v=h[b],t(v,p)>d&&(m.push(v),p=v);return p!==v&&m.push(v),m}function s(h,d,p,m,v){for(var b=m,y,P=d+1;P<p;P++){var M=e(h[P],h[d],h[p]);M>b&&(y=P,b=M)}b>m&&(y-d>1&&s(h,d,y,m,v),v.push(h[y]),p-y>1&&s(h,y,p,m,v))}function n(h,d){var p=h.length-1,m=[h[0]];return s(h,0,p,d,m),m.push(h[p]),m}function o(h,d,p){if(h.length<=2)return h;var m=d!==void 0?d*d:1;return h=p?h:i(h,m),h=n(h,m),h}r.exports=o,r.exports.default=o})()})(Ym);var uP=Ym.exports;const cP=vo(uP),tn=new jm,Qc=new $m,Ke=new nP,Ma=new Xm;Ma.children.push(tn);Ma.children.push(Qc);Ma.children.push(Ke);const Th=new Un;Th.name="hamburger";Th.text="Menu";Th.isRoot=!0;tn.children.push(Th);const Ih=new Un;Ih.name="lens";Ih.text="Search Vehicle";tn.children.push(Ih);yi({key:"btnSearch",data:Ih});const Ad=new Un;Ad.name="cut-board";Ad.text="Cut Boards";tn.children.push(Ad);const Md=new Un;Md.name="mark";Md.text="Saved Boards";tn.children.push(Md);const kd=new Un;kd.name="projects";kd.text="Projects";tn.children.push(kd);const Rd=new Un;Rd.name="history";Rd.text="Cut History";tn.children.push(Rd);const Ah=new Un;Ah.name="settings";Ah.text="Settings";tn.children.push(Ah);yi({key:"settings",data:Ah});const Po=new bs;yi({key:"popup",data:Po});Po.content="This is a popup";Po.title="Popup Title";Po.isVisible=!1;Ma.children.push(Po);yi({key:"mainFrame",data:Ma});Lt.on(je.ButtonBar.Click,r=>{console.log(r),Qc.isExpanded=!1,r.name==="selectItem"&&(Ke.setState("3Panes"),Ke.topPanel=fP,Ke.leftPanel=dP,Ke.rightPanel=Jc),r.name==="lens"&&(Ke.setState("3Panes"),Ke.topPanel=qm,Ke.leftPanel=Zm,Ke.rightPanel=Jc),r.name==="cut-board"&&(Ke.setState("default"),Ke.maxPanel=Km,Qc.isExpanded=!0),r.name==="mark"&&(Ke.setState("default"),Ke.maxPanel=Qm),r.name==="projects"&&(Ke.setState("default"),Ke.maxPanel=Jm),r.name==="history"&&(Ke.setState("default"),Ke.maxPanel=Bd),r.name==="profile"&&(Ke.setState("default"),Ke.maxPanel=t_),r.name==="settings"&&(Ke.setState("default"),Ke.maxPanel=sr),r.name===""&&(Ke.setState("default"),Ke.maxPanel=null),r.name==="login"&&(Ke.setState("default"),Ke.maxPanel=null,ZC())});const qm=new J2,Zm=new V2,Jc=new o2,Km=new n2,dP=new W2,fP=new $2;yi({key:"vehicleSearch",data:qm});yi({key:"searchresult",data:Zm});yi({key:"cutPreview",data:Jc});yi({key:"cutBoard",data:Km});const Qm=new f2,Jm=new b2,Bd=new u2,sr=new y2;yi({key:"settings",data:sr});sr.bladeNumbers=[["1","Blade number 1"],["2","Blade number 2"],["3","Blade number 3"],["4","Blade number 4"]];sr.summaList=[["S1/S2|USB","Summa S1/S2 USB"],["S1/S2|Network","Summa S1/S2 Network"],["F|USB","Summa F USB"],["F|Network","Summa F Network"],["D|USB","Summa D & S3 USB"],["D|Network","Summa D & S3 Network"]];getPrinterList().then(r=>{console.log("Printer List",r),sr.printerList=r.map(t=>[t.name,t.displayName])});const t_=new _2;yi({key:"profile",data:t_});Bd.title="Cut History";const Mh=new Id;Mh.fontSize="14px";Mh.columns=[{size:.5,title:"S.No"},{size:2,title:"Board Name"},{size:1,title:"Date"},{size:1,title:"Time"},{size:1,title:"Action"}];Ti("add-to-cut","Add to cut Board");Ti("rename","Rename",100);Ti("bin","Delete",100);yi({key:"tableBoards",data:Mh});const To=new Id;To.fontSize="14px";To.columns=[{size:.5,title:"S.No"},{size:2,title:"Project Name"},{size:1,title:"Date"},{size:1,title:"Time"},{size:1,title:"Status"},{size:1,title:"Actions"}];Ti("add-to-cut","Add to cut Board");Ti("white-triangle","Outgoing",100,!0);Ti("bin","Delete",100);To.rows=[];yi({key:"tableProjects",data:To});const Io=new Id;Io.fontSize="14px";Io.columns=[{size:.5,title:"S.No"},{size:3.5,title:"Vehicle"},{size:1,title:"Cut Date"},{size:1,title:"Cut Time"},{size:1,title:"Material Usage"},{size:1,title:"Feedback"},{size:1,title:"Actions"}];Ti("add-to-cut","Add to cut Board");Ti("white-triangle","None",100,!0);Io.rows=[];yi({key:"tableHistory",data:Io});Qm.children.push(Mh);Jm.children.push(To);Bd.children.push(Io);Ma.attachTo(document.body,{useShadowDom:!1});setTimeout(()=>{hP()},1500);(async()=>{const r=await getConfig();console.log("Config",r),ve.boardLenght=r.boardLenght,ve.boardWidth=r.boardWidth,ve.nesting=r.nesting,ve.cut=r.cut,e_={spacing:ve.nesting.spaceBetweenParts,rotationSteps:ve.nesting.rotationSteps,population:ve.nesting.geneticAlgorithm.populationSize,generations:ve.nesting.geneticAlgorithm.generation,mutationRate:ve.nesting.geneticAlgorithm.mutationRate},sr.selectedPrinter=ve.cut.printer.name,sr.selectedSumma=ve.cut.summa.model,sr.ip=ve.cut.network.ip,sr.port=ve.cut.network.port.toString(),sr.plotterType=ve.cut.target,sr.width=ve.boardWidth,sr.length=ve.boardLenght,sr.selectedBlade=ve.cut.summa.blade,sr.update(),console.log("Config",ve),Lt.emit(Kt.BoardSurface.onConfigChange)})();setTimeout(()=>{Lt.emit(je.ButtonBar.Click,{id:"",name:"login"})},500);let hh=new Fit.Packer,e_={spacing:ve.nesting.spaceBetweenParts,rotationSteps:ve.nesting.rotationSteps,population:ve.nesting.geneticAlgorithm.populationSize,generations:ve.nesting.geneticAlgorithm.generation,mutationRate:ve.nesting.geneticAlgorithm.mutationRate},i_=0,uh=[],ch=[];Yi.sessionCreation.handle((r,t)=>{hh.stop(),hh=new Fit.Packer,uh=[],ch=[],i_=0});Yi.addPart.handle((r,t)=>{let e=[];const i=new Om.Path(r.item.workingPaths[0]);i.rotate(-r.item._angle,i.bounds.center),e=pP(r.item.getPolygonDefinition(i.pathData,!0),ve.nesting.polyognTolerance),console.log("fastpoly",e);const s=new Fit.Part(i_++,e.map(n=>new Fit.Vector(n.x,n.y)));uh.push(s)});Yi.setBin.handle((r,t)=>{ch=[new Fit.Bin(0,r.width,r.height)]});Yi.progress.handle((r,t)=>{t(r)});Yi.packingResult.handle((r,t)=>{t(r)});Yi.start.handle((r,t)=>{console.log(ch,uh),hh.start(ch,uh,e_,{onEvaluation:e=>{Yi.progress.do(e)},onPacking:e=>{e.isLast=!1,Yi.packingResult.do(e)},onPackingCompleted:e=>{e.isLast=!0,Yi.packingResult.do(e)}})});Yi.stop.handle((r,t)=>{hh.stop(),t(!0)});Lt.on(Kt.BoardSurface.onAskForNesting,()=>{YC()});function pP(r,t=50){return cP(r,t,!1)}
